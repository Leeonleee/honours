diff --git a/tests/queries/0_stateless/01391_limit_overflow.reference b/tests/queries/0_stateless/01391_limit_overflow.reference
new file mode 100644
index 000000000000..6fa0a9ec2b92
--- /dev/null
+++ b/tests/queries/0_stateless/01391_limit_overflow.reference
@@ -0,0 +1,14 @@
+2
+3
+4
+5
+6
+7
+8
+9
+---
+5
+6
+7
+8
+9
diff --git a/tests/queries/0_stateless/01391_limit_overflow.sql b/tests/queries/0_stateless/01391_limit_overflow.sql
new file mode 100644
index 000000000000..b06622799f78
--- /dev/null
+++ b/tests/queries/0_stateless/01391_limit_overflow.sql
@@ -0,0 +1,12 @@
+SELECT number FROM numbers(10) ORDER BY number ASC LIMIT 2, 9223372036854775807 WITH TIES;
+
+SELECT '---';
+
+CREATE TEMPORARY TABLE a (a UInt64);
+INSERT INTO TABLE a SELECT number FROM system.numbers LIMIT 10;
+
+SELECT a
+FROM a
+GROUP BY a
+ORDER BY a ASC
+LIMIT 5, 18446744073709551615;
diff --git a/tests/queries/0_stateless/01395_limit_more_cases.reference b/tests/queries/0_stateless/01395_limit_more_cases.reference
new file mode 100644
index 000000000000..c9d0dd73ab82
--- /dev/null
+++ b/tests/queries/0_stateless/01395_limit_more_cases.reference
@@ -0,0 +1,257 @@
+0	0	0	0	0	0	0	0
+0	1	1	0	0	0	0	0
+0	2	2	0	1	0	0	0
+0	3	3	0	2	0	0	0
+0	4	4	0	3	0	0	0
+0	5	5	0	4	0	0	0
+0	6	6	0	5	0	0	0
+0	7	7	0	6	0	0	0
+0	8	8	0	7	0	0	0
+0	9	9	0	8	0	0	0
+0	10	10	0	9	0	0	0
+0	11	11	0	10	0	0	0
+0	12	12	0	11	0	0	0
+0	13	13	0	12	0	0	0
+0	14	13	0	12	0	0	0
+0	15	13	0	12	0	0	0
+1	0	0	0	0	0	0	0
+1	1	1	1	1	0	0	0
+1	2	2	1	2	0	0	0
+1	3	3	1	3	0	0	0
+1	4	4	1	4	0	0	0
+1	5	5	1	5	0	0	0
+1	6	6	1	6	0	0	0
+1	7	7	1	7	0	0	0
+1	8	8	1	8	0	0	0
+1	9	9	1	9	0	0	0
+1	10	10	1	10	0	0	0
+1	11	11	1	11	0	0	0
+1	12	12	1	12	0	0	0
+1	13	12	1	12	0	0	0
+1	14	12	1	12	0	0	0
+1	15	12	1	12	0	0	0
+2	0	0	0	0	0	0	0
+2	1	1	2	2	0	0	0
+2	2	2	2	3	0	0	0
+2	3	3	2	4	0	0	0
+2	4	4	2	5	0	0	0
+2	5	5	2	6	0	0	0
+2	6	6	2	7	0	0	0
+2	7	7	2	8	0	0	0
+2	8	8	2	9	0	0	0
+2	9	9	2	10	0	0	0
+2	10	10	2	11	0	0	0
+2	11	11	2	12	0	0	0
+2	12	11	2	12	0	0	0
+2	13	11	2	12	0	0	0
+2	14	11	2	12	0	0	0
+2	15	11	2	12	0	0	0
+3	0	0	0	0	0	0	0
+3	1	1	3	3	0	0	0
+3	2	2	3	4	0	0	0
+3	3	3	3	5	0	0	0
+3	4	4	3	6	0	0	0
+3	5	5	3	7	0	0	0
+3	6	6	3	8	0	0	0
+3	7	7	3	9	0	0	0
+3	8	8	3	10	0	0	0
+3	9	9	3	11	0	0	0
+3	10	10	3	12	0	0	0
+3	11	10	3	12	0	0	0
+3	12	10	3	12	0	0	0
+3	13	10	3	12	0	0	0
+3	14	10	3	12	0	0	0
+3	15	10	3	12	0	0	0
+4	0	0	0	0	0	0	0
+4	1	1	4	4	0	0	0
+4	2	2	4	5	0	0	0
+4	3	3	4	6	0	0	0
+4	4	4	4	7	0	0	0
+4	5	5	4	8	0	0	0
+4	6	6	4	9	0	0	0
+4	7	7	4	10	0	0	0
+4	8	8	4	11	0	0	0
+4	9	9	4	12	0	0	0
+4	10	9	4	12	0	0	0
+4	11	9	4	12	0	0	0
+4	12	9	4	12	0	0	0
+4	13	9	4	12	0	0	0
+4	14	9	4	12	0	0	0
+4	15	9	4	12	0	0	0
+5	0	0	0	0	0	0	0
+5	1	1	5	5	0	0	0
+5	2	2	5	6	0	0	0
+5	3	3	5	7	0	0	0
+5	4	4	5	8	0	0	0
+5	5	5	5	9	0	0	0
+5	6	6	5	10	0	0	0
+5	7	7	5	11	0	0	0
+5	8	8	5	12	0	0	0
+5	9	8	5	12	0	0	0
+5	10	8	5	12	0	0	0
+5	11	8	5	12	0	0	0
+5	12	8	5	12	0	0	0
+5	13	8	5	12	0	0	0
+5	14	8	5	12	0	0	0
+5	15	8	5	12	0	0	0
+6	0	0	0	0	0	0	0
+6	1	1	6	6	0	0	0
+6	2	2	6	7	0	0	0
+6	3	3	6	8	0	0	0
+6	4	4	6	9	0	0	0
+6	5	5	6	10	0	0	0
+6	6	6	6	11	0	0	0
+6	7	7	6	12	0	0	0
+6	8	7	6	12	0	0	0
+6	9	7	6	12	0	0	0
+6	10	7	6	12	0	0	0
+6	11	7	6	12	0	0	0
+6	12	7	6	12	0	0	0
+6	13	7	6	12	0	0	0
+6	14	7	6	12	0	0	0
+6	15	7	6	12	0	0	0
+7	0	0	0	0	0	0	0
+7	1	1	7	7	0	0	0
+7	2	2	7	8	0	0	0
+7	3	3	7	9	0	0	0
+7	4	4	7	10	0	0	0
+7	5	5	7	11	0	0	0
+7	6	6	7	12	0	0	0
+7	7	6	7	12	0	0	0
+7	8	6	7	12	0	0	0
+7	9	6	7	12	0	0	0
+7	10	6	7	12	0	0	0
+7	11	6	7	12	0	0	0
+7	12	6	7	12	0	0	0
+7	13	6	7	12	0	0	0
+7	14	6	7	12	0	0	0
+7	15	6	7	12	0	0	0
+8	0	0	0	0	0	0	0
+8	1	1	8	8	0	0	0
+8	2	2	8	9	0	0	0
+8	3	3	8	10	0	0	0
+8	4	4	8	11	0	0	0
+8	5	5	8	12	0	0	0
+8	6	5	8	12	0	0	0
+8	7	5	8	12	0	0	0
+8	8	5	8	12	0	0	0
+8	9	5	8	12	0	0	0
+8	10	5	8	12	0	0	0
+8	11	5	8	12	0	0	0
+8	12	5	8	12	0	0	0
+8	13	5	8	12	0	0	0
+8	14	5	8	12	0	0	0
+8	15	5	8	12	0	0	0
+9	0	0	0	0	0	0	0
+9	1	1	9	9	0	0	0
+9	2	2	9	10	0	0	0
+9	3	3	9	11	0	0	0
+9	4	4	9	12	0	0	0
+9	5	4	9	12	0	0	0
+9	6	4	9	12	0	0	0
+9	7	4	9	12	0	0	0
+9	8	4	9	12	0	0	0
+9	9	4	9	12	0	0	0
+9	10	4	9	12	0	0	0
+9	11	4	9	12	0	0	0
+9	12	4	9	12	0	0	0
+9	13	4	9	12	0	0	0
+9	14	4	9	12	0	0	0
+9	15	4	9	12	0	0	0
+10	0	0	0	0	0	0	0
+10	1	1	10	10	0	0	0
+10	2	2	10	11	0	0	0
+10	3	3	10	12	0	0	0
+10	4	3	10	12	0	0	0
+10	5	3	10	12	0	0	0
+10	6	3	10	12	0	0	0
+10	7	3	10	12	0	0	0
+10	8	3	10	12	0	0	0
+10	9	3	10	12	0	0	0
+10	10	3	10	12	0	0	0
+10	11	3	10	12	0	0	0
+10	12	3	10	12	0	0	0
+10	13	3	10	12	0	0	0
+10	14	3	10	12	0	0	0
+10	15	3	10	12	0	0	0
+11	0	0	0	0	0	0	0
+11	1	1	11	11	0	0	0
+11	2	2	11	12	0	0	0
+11	3	2	11	12	0	0	0
+11	4	2	11	12	0	0	0
+11	5	2	11	12	0	0	0
+11	6	2	11	12	0	0	0
+11	7	2	11	12	0	0	0
+11	8	2	11	12	0	0	0
+11	9	2	11	12	0	0	0
+11	10	2	11	12	0	0	0
+11	11	2	11	12	0	0	0
+11	12	2	11	12	0	0	0
+11	13	2	11	12	0	0	0
+11	14	2	11	12	0	0	0
+11	15	2	11	12	0	0	0
+12	0	0	0	0	0	0	0
+12	1	1	12	12	0	0	0
+12	2	1	12	12	0	0	0
+12	3	1	12	12	0	0	0
+12	4	1	12	12	0	0	0
+12	5	1	12	12	0	0	0
+12	6	1	12	12	0	0	0
+12	7	1	12	12	0	0	0
+12	8	1	12	12	0	0	0
+12	9	1	12	12	0	0	0
+12	10	1	12	12	0	0	0
+12	11	1	12	12	0	0	0
+12	12	1	12	12	0	0	0
+12	13	1	12	12	0	0	0
+12	14	1	12	12	0	0	0
+12	15	1	12	12	0	0	0
+13	0	0	0	0	0	0	0
+13	1	0	0	0	0	0	0
+13	2	0	0	0	0	0	0
+13	3	0	0	0	0	0	0
+13	4	0	0	0	0	0	0
+13	5	0	0	0	0	0	0
+13	6	0	0	0	0	0	0
+13	7	0	0	0	0	0	0
+13	8	0	0	0	0	0	0
+13	9	0	0	0	0	0	0
+13	10	0	0	0	0	0	0
+13	11	0	0	0	0	0	0
+13	12	0	0	0	0	0	0
+13	13	0	0	0	0	0	0
+13	14	0	0	0	0	0	0
+13	15	0	0	0	0	0	0
+14	0	0	0	0	0	0	0
+14	1	0	0	0	0	0	0
+14	2	0	0	0	0	0	0
+14	3	0	0	0	0	0	0
+14	4	0	0	0	0	0	0
+14	5	0	0	0	0	0	0
+14	6	0	0	0	0	0	0
+14	7	0	0	0	0	0	0
+14	8	0	0	0	0	0	0
+14	9	0	0	0	0	0	0
+14	10	0	0	0	0	0	0
+14	11	0	0	0	0	0	0
+14	12	0	0	0	0	0	0
+14	13	0	0	0	0	0	0
+14	14	0	0	0	0	0	0
+14	15	0	0	0	0	0	0
+15	0	0	0	0	0	0	0
+15	1	0	0	0	0	0	0
+15	2	0	0	0	0	0	0
+15	3	0	0	0	0	0	0
+15	4	0	0	0	0	0	0
+15	5	0	0	0	0	0	0
+15	6	0	0	0	0	0	0
+15	7	0	0	0	0	0	0
+15	8	0	0	0	0	0	0
+15	9	0	0	0	0	0	0
+15	10	0	0	0	0	0	0
+15	11	0	0	0	0	0	0
+15	12	0	0	0	0	0	0
+15	13	0	0	0	0	0	0
+15	14	0	0	0	0	0	0
+15	15	0	0	0	0	0	0
+0	0	0
diff --git a/tests/queries/0_stateless/01395_limit_more_cases.sh b/tests/queries/0_stateless/01395_limit_more_cases.sh
new file mode 100755
index 000000000000..1d96d99a4887
--- /dev/null
+++ b/tests/queries/0_stateless/01395_limit_more_cases.sh
@@ -0,0 +1,35 @@
+#!/usr/bin/env bash
+
+CURDIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
+. $CURDIR/../shell_config.sh
+
+SIZE=13
+for OFFSET in {0..15}; do
+    for LIMIT in {0..15}; do
+        echo "SELECT
+            $OFFSET, $LIMIT,
+            count() AS c, min(number) AS first, max(number) AS last,
+            throwIf(first != ($OFFSET < $SIZE AND $LIMIT > 0 ? $OFFSET : 0)),
+            throwIf(last != ($OFFSET < $SIZE AND $LIMIT > 0 ? least($SIZE - 1, $OFFSET + $LIMIT - 1) : 0)),
+            throwIf((c != 0 OR first != 0 OR last != 0) AND (c != last - first + 1))
+            FROM (SELECT * FROM numbers($SIZE) LIMIT $OFFSET, $LIMIT);
+        "
+    done
+done | $CLICKHOUSE_CLIENT -n --max_block_size 5
+
+# Randomized test
+
+ITERATIONS=1000
+for i in $(seq $ITERATIONS); do
+    SIZE=$(($RANDOM % 100))
+    OFFSET=$(($RANDOM % 111))
+    LIMIT=$(($RANDOM % 111))
+
+    echo "WITH count() AS c, min(number) AS first, max(number) AS last
+            SELECT
+                throwIf(first != ($OFFSET < $SIZE AND $LIMIT > 0 ? $OFFSET : 0)),
+                throwIf(last != ($OFFSET < $SIZE AND $LIMIT > 0 ? least($SIZE - 1, $OFFSET + $LIMIT - 1) : 0)),
+                throwIf((c != 0 OR first != 0 OR last != 0) AND (c != last - first + 1))
+            FROM (SELECT * FROM numbers($SIZE) LIMIT $OFFSET, $LIMIT);
+        "
+done | $CLICKHOUSE_CLIENT -n --max_block_size $(($RANDOM % 20)) | uniq
