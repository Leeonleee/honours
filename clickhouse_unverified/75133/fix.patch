diff --git a/src/Interpreters/ClientInfo.cpp b/src/Interpreters/ClientInfo.cpp
index 84f0f7595b73..2a2e086f16f2 100644
--- a/src/Interpreters/ClientInfo.cpp
+++ b/src/Interpreters/ClientInfo.cpp
@@ -27,16 +27,24 @@ std::optional<Poco::Net::SocketAddress> ClientInfo::getLastForwardedFor() const
         return {};
     String last = forwarded_for.substr(forwarded_for.find_last_of(',') + 1);
     boost::trim(last);
-    try
-    {
-        return Poco::Net::SocketAddress{last};
-    }
-    catch (const Poco::InvalidArgumentException &)
-    {
-        return Poco::Net::SocketAddress{last, 0};
-    }
-}
 
+    /// IPv6 address with port
+    if (last[0] == '[')
+        return Poco::Net::SocketAddress{Poco::Net::AddressFamily::IPv6, last};
+
+    int colons = std::count(last.begin(), last.end(), ':');
+
+    /// IPv6 address without port
+    if (colons > 1)
+        return Poco::Net::SocketAddress{Poco::Net::AddressFamily::IPv6, last, 0};
+
+    /// IPv4 address with port
+    if (colons == 1)
+        return Poco::Net::SocketAddress{Poco::Net::AddressFamily::IPv4, last};
+
+    /// IPv4 address without port
+    return Poco::Net::SocketAddress{Poco::Net::AddressFamily::IPv4, last, 0};
+}
 
 void ClientInfo::write(WriteBuffer & out, UInt64 server_protocol_revision) const
 {
