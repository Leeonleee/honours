diff --git a/tests/queries/0_stateless/03166_mv_prewhere_duplicating_name_bug.reference b/tests/queries/0_stateless/03166_mv_prewhere_duplicating_name_bug.reference
new file mode 100644
index 000000000000..b50fdcee2090
--- /dev/null
+++ b/tests/queries/0_stateless/03166_mv_prewhere_duplicating_name_bug.reference
@@ -0,0 +1,2 @@
+a	b
+a	b
diff --git a/tests/queries/0_stateless/03166_mv_prewhere_duplicating_name_bug.sql b/tests/queries/0_stateless/03166_mv_prewhere_duplicating_name_bug.sql
new file mode 100644
index 000000000000..e32d23920dd4
--- /dev/null
+++ b/tests/queries/0_stateless/03166_mv_prewhere_duplicating_name_bug.sql
@@ -0,0 +1,7 @@
+create table src (x Int64) engine = Log;
+create table dst (s String, lc LowCardinality(String)) engine MergeTree order by s;
+create materialized view mv to dst (s String, lc String) as select 'a' as s, toLowCardinality('b') as lc from src;
+insert into src values (1);
+
+select s, lc from mv where not ignore(lc) settings allow_experimental_analyzer=0;
+select s, lc from mv where not ignore(lc) settings allow_experimental_analyzer=1;
