You will be provided with a partial code base and an issue statement explaining a problem to resolve.

<issue>
Logical Error: No user in current context, it's a bug
**Describe the bug**
Calling `defaultRoles()` function inside a projection.

**How to reproduce**
Run: https://fiddle.clickhouse.com/aff007d7-9d06-4900-a287-63cf11588159
</issue>

I need you to solve the provided issue by generating a code fix that can be applied directly to the repository

Respond below:
