{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 30244,
  "instance_id": "ClickHouse__ClickHouse-30244",
  "issue_numbers": [
    "28661"
  ],
  "base_commit": "da0021c82fef1391051b4b46fac345570cec6436",
  "patch": "diff --git a/src/Functions/MatchImpl.h b/src/Functions/MatchImpl.h\nindex d71a5a1ffe36..7dc0712023f0 100644\n--- a/src/Functions/MatchImpl.h\n+++ b/src/Functions/MatchImpl.h\n@@ -200,7 +200,7 @@ struct MatchImpl\n                     }\n \n                     /// We check that the entry does not pass through the boundaries of strings.\n-                    if (pos + strstr_pattern.size() < begin + offsets[i])\n+                    if (pos + required_substring.size() < begin + offsets[i])\n                     {\n                         /// And if it does not, if necessary, we check the regexp.\n \n@@ -344,7 +344,7 @@ struct MatchImpl\n                 const UInt8 * next_pos = begin;\n \n                 /// If required substring is larger than string size - it cannot be found.\n-                if (strstr_pattern.size() <= n)\n+                if (required_substring.size() <= n)\n                 {\n                     Searcher searcher(required_substring.data(), required_substring.size(), end - pos);\n \n@@ -360,7 +360,7 @@ struct MatchImpl\n                         }\n                         next_pos += n;\n \n-                        if (pos + strstr_pattern.size() <= next_pos)\n+                        if (pos + required_substring.size() <= next_pos)\n                         {\n                             /// And if it does not, if necessary, we check the regexp.\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02045_like_function.reference b/tests/queries/0_stateless/02045_like_function.reference\nnew file mode 100644\nindex 000000000000..0633853274a0\n--- /dev/null\n+++ b/tests/queries/0_stateless/02045_like_function.reference\n@@ -0,0 +1,2 @@\n+1\n+1\t1\t1\t1\t1\t1\ndiff --git a/tests/queries/0_stateless/02045_like_function.sql b/tests/queries/0_stateless/02045_like_function.sql\nnew file mode 100644\nindex 000000000000..d395e8d4579e\n--- /dev/null\n+++ b/tests/queries/0_stateless/02045_like_function.sql\n@@ -0,0 +1,10 @@\n+SELECT 'r\\\\a1bbb' LIKE '%r\\\\\\\\a1%bbb%' AS res;\n+\n+WITH lower('\\RealVNC\\WinVNC4 /v password') as CommandLine\n+SELECT\n+    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4%password%' as t1,\n+    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4 %password%' as t2,\n+    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4%password' as t3,\n+    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4 %password' as t4,\n+    CommandLine LIKE '%realvnc%winvnc4%password%' as t5,\n+    CommandLine LIKE '%\\\\\\\\winvnc4%password%' as t6;\n",
  "problem_statement": "Issue with LIKE matching\n```\r\nSELECT version();\r\n\r\n\u250c\u2500version()\u2500\u2500\u2500\u2500\u2510\r\n\u2502 21.10.1.8002 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\nWITH lower('\\RealVNC\\WinVNC4 /v password') as CommandLine\r\nSELECT \r\n    CommandLine,\r\n    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4%password%' as t1,\r\n    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4 %password%' as t2,\r\n    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4%password' as t3,\r\n    CommandLine LIKE '%\\\\\\\\realvnc\\\\\\\\winvnc4 %password' as t4,\r\n    CommandLine LIKE '%realvnc%winvnc4%password%' as t5,\r\n    CommandLine LIKE '%\\\\\\\\winvnc4%password%' as t6;\r\n\r\n\u250c\u2500CommandLine\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500t1\u2500\u252c\u2500t2\u2500\u252c\u2500t3\u2500\u252c\u2500t4\u2500\u252c\u2500t5\u2500\u252c\u2500t6\u2500\u2510\r\n\u2502 \\realvnc\\winvnc4 /v password \u2502  0 \u2502  1 \u2502  1 \u2502  1 \u2502  1 \u2502  1 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518\r\n\r\n1 rows in set. Elapsed: 0.001 sec. \r\n```\r\n\r\nAll should match.\r\n\r\nhttp://sqlfiddle.com/#!9/73f0c6/2\n",
  "hints_text": "Could you plese construct a minimized example?\n`SELECT 'r\\\\a1bbb' AS a, '%r\\\\\\\\a1%bbb%' b, a LIKE b AS res`",
  "created_at": "2021-10-15T17:14:06Z"
}