{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 57075,
  "instance_id": "ClickHouse__ClickHouse-57075",
  "issue_numbers": [
    "56978"
  ],
  "base_commit": "e163dbe2d94a1b7a37971f702ba5399a688823ca",
  "patch": "diff --git a/src/IO/S3/URI.cpp b/src/IO/S3/URI.cpp\nindex a08e7b5a65d4..e05e08823290 100644\n--- a/src/IO/S3/URI.cpp\n+++ b/src/IO/S3/URI.cpp\n@@ -26,7 +26,7 @@ struct URIConverter\n     static void modifyURI(Poco::URI & uri, std::unordered_map<std::string, std::string> mapper)\n     {\n         Macros macros({{\"bucket\", uri.getHost()}});\n-        uri = macros.expand(mapper[uri.getScheme()]).empty()? uri : Poco::URI(macros.expand(mapper[uri.getScheme()]) + \"/\" + uri.getPathAndQuery());\n+        uri = macros.expand(mapper[uri.getScheme()]).empty() ? uri : Poco::URI(macros.expand(mapper[uri.getScheme()]) + uri.getPathAndQuery());\n     }\n };\n \n",
  "test_patch": "diff --git a/tests/integration/test_s3_style_link/test.py b/tests/integration/test_s3_style_link/test.py\nindex 7ecf4e633e31..f90b77c360c9 100644\n--- a/tests/integration/test_s3_style_link/test.py\n+++ b/tests/integration/test_s3_style_link/test.py\n@@ -55,3 +55,34 @@ def test_s3_table_functions(started_cluster):\n         )\n         == \"1000000\\n\"\n     )\n+\n+\n+def test_s3_table_functions_line_as_string(started_cluster):\n+    node.query(\n+        \"\"\"\n+            INSERT INTO FUNCTION s3\n+                (\n+                    'minio://data/test_file_line_as_string.tsv.gz', 'minio', 'minio123'\n+                )\n+            SELECT * FROM numbers(1000000);\n+        \"\"\"\n+    )\n+\n+    assert (\n+        node.query(\n+            \"\"\"\n+            SELECT _file FROM s3\n+            (\n+                'minio://data/*as_string.tsv.gz', 'minio', 'minio123', 'LineAsString'\n+            ) LIMIT 1;\n+        \"\"\"\n+        )\n+        == node.query(\n+            \"\"\"\n+            SELECT _file FROM s3\n+            (\n+                'http://minio1:9001/root/data/*as_string.tsv.gz', 'minio', 'minio123', 'LineAsString'\n+            ) LIMIT 1;\n+        \"\"\"\n+        )\n+    )\n",
  "problem_statement": "s3-style URLs don't work\nhttps://pastila.nl/?00a139a3/0b483a6142a9ba07dfcec1c32d6b0fed#3YTUZegWa3J6LQrl0/JOlw==\n",
  "hints_text": "",
  "created_at": "2023-11-21T18:54:14Z"
}