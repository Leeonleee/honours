{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 81197,
  "instance_id": "ClickHouse__ClickHouse-81197",
  "issue_numbers": [
    "81113"
  ],
  "base_commit": "dee9cf6468082ce4d71fcee02bdc77af0650327f",
  "patch": "diff --git a/src/Functions/array/arrayFirstLast.cpp b/src/Functions/array/arrayFirstLast.cpp\nindex 76c9953e5568..3bb72164d2cf 100644\n--- a/src/Functions/array/arrayFirstLast.cpp\n+++ b/src/Functions/array/arrayFirstLast.cpp\n@@ -28,7 +28,7 @@ enum class ArrayFirstLastElementNotExistsStrategy : uint8_t\n template <ArrayFirstLastStrategy strategy, ArrayFirstLastElementNotExistsStrategy element_not_exists_strategy>\n struct ArrayFirstLastImpl\n {\n-    static bool needBoolean() { return false; }\n+    static bool needBoolean() { return true; }\n     static bool needExpression() { return true; }\n     static bool needOneArray() { return false; }\n \ndiff --git a/src/Functions/array/arrayFirstLastIndex.cpp b/src/Functions/array/arrayFirstLastIndex.cpp\nindex 3065e4ac0436..6a884bed556b 100644\n--- a/src/Functions/array/arrayFirstLastIndex.cpp\n+++ b/src/Functions/array/arrayFirstLastIndex.cpp\n@@ -21,7 +21,7 @@ enum class ArrayFirstLastIndexStrategy : uint8_t\n template <ArrayFirstLastIndexStrategy strategy>\n struct ArrayFirstLastIndexImpl\n {\n-    static bool needBoolean() { return false; }\n+    static bool needBoolean() { return true; }\n     static bool needExpression() { return true; }\n     static bool needOneArray() { return false; }\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/00182_functions_higher_order_and_consts.reference b/tests/queries/0_stateless/00182_functions_higher_order_and_consts.reference\nindex da8c457b9be4..0fc3eeb2c513 100644\n--- a/tests/queries/0_stateless/00182_functions_higher_order_and_consts.reference\n+++ b/tests/queries/0_stateless/00182_functions_higher_order_and_consts.reference\n@@ -242,8 +242,9 @@ SELECT arrayFirst(x -> x > 3, [1, 2, 3]);\n 0\n SELECT arrayFirst(x -> x, [1, 2, 3]);\n 1\n-SELECT arrayFirst(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayFirst(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayFirst(x -> NULL, [1, 2, 3]);\n+0\n+SELECT arrayFirst(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---last---';\n ---last---\n SELECT arrayLast(x -> 0, emptyArrayUInt8());\n@@ -282,8 +283,9 @@ SELECT arrayLast(x -> x > 3, [1, 2, 3]);\n 0\n SELECT arrayLast(x -> x, [1, 2, 3]);\n 3\n-SELECT arrayLast(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayLast(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayLast(x -> NULL, [1, 2, 3]);\n+0\n+SELECT arrayLast(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---first index---';\n ---first index---\n SELECT arrayFirstIndex(x -> 0, emptyArrayUInt8());\n@@ -322,8 +324,9 @@ SELECT arrayFirstIndex(x -> x > 3, [1, 2, 3]);\n 0\n SELECT arrayFirstIndex(x -> x, [1, 2, 3]);\n 1\n-SELECT arrayFirstIndex(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayFirstIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayFirstIndex(x -> NULL, [1, 2, 3]);\n+0\n+SELECT arrayFirstIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---lastindex---';\n ---lastindex---\n SELECT arrayLastIndex(x -> 0, emptyArrayUInt8());\n@@ -362,8 +365,9 @@ SELECT arrayLastIndex(x -> x > 3, [1, 2, 3]);\n 0\n SELECT arrayLastIndex(x -> x, [1, 2, 3]);\n 3\n-SELECT arrayLastIndex(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayLastIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayLastIndex(x -> NULL, [1, 2, 3]);\n+0\n+SELECT arrayLastIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---cumsum---';\n ---cumsum---\n SELECT arrayCumSum(x -> 0, emptyArrayUInt8());\ndiff --git a/tests/queries/0_stateless/00182_functions_higher_order_and_consts.sql b/tests/queries/0_stateless/00182_functions_higher_order_and_consts.sql\nindex 9c9985c89408..3d065520ee47 100644\n--- a/tests/queries/0_stateless/00182_functions_higher_order_and_consts.sql\n+++ b/tests/queries/0_stateless/00182_functions_higher_order_and_consts.sql\n@@ -63,8 +63,8 @@ SELECT arrayFirst(x -> 1, range(number)) FROM system.numbers LIMIT 10;\n SELECT arrayFirst(x -> x > 1, [1, 2, 3]);\n SELECT arrayFirst(x -> x > 3, [1, 2, 3]);\n SELECT arrayFirst(x -> x, [1, 2, 3]);\n-SELECT arrayFirst(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayFirst(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayFirst(x -> NULL, [1, 2, 3]);\n+SELECT arrayFirst(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---last---';\n SELECT arrayLast(x -> 0, emptyArrayUInt8());\n SELECT arrayLast(x -> 0, [1, 2, 3]);\n@@ -75,8 +75,8 @@ SELECT arrayLast(x -> 1, range(number)) FROM system.numbers LIMIT 10;\n SELECT arrayLast(x -> x > 1, [1, 2, 3]);\n SELECT arrayLast(x -> x > 3, [1, 2, 3]);\n SELECT arrayLast(x -> x, [1, 2, 3]);\n-SELECT arrayLast(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayLast(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayLast(x -> NULL, [1, 2, 3]);\n+SELECT arrayLast(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---first index---';\n SELECT arrayFirstIndex(x -> 0, emptyArrayUInt8());\n SELECT arrayFirstIndex(x -> 0, [1, 2, 3]);\n@@ -87,8 +87,8 @@ SELECT arrayFirstIndex(x -> 1, range(number)) FROM system.numbers LIMIT 10;\n SELECT arrayFirstIndex(x -> x > 1, [1, 2, 3]);\n SELECT arrayFirstIndex(x -> x > 3, [1, 2, 3]);\n SELECT arrayFirstIndex(x -> x, [1, 2, 3]);\n-SELECT arrayFirstIndex(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayFirstIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayFirstIndex(x -> NULL, [1, 2, 3]);\n+SELECT arrayFirstIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---lastindex---';\n SELECT arrayLastIndex(x -> 0, emptyArrayUInt8());\n SELECT arrayLastIndex(x -> 0, [1, 2, 3]);\n@@ -99,8 +99,8 @@ SELECT arrayLastIndex(x -> 1, range(number)) FROM system.numbers LIMIT 10;\n SELECT arrayLastIndex(x -> x > 1, [1, 2, 3]);\n SELECT arrayLastIndex(x -> x > 3, [1, 2, 3]);\n SELECT arrayLastIndex(x -> x, [1, 2, 3]);\n-SELECT arrayLastIndex(x -> NULL, [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n-SELECT arrayLastIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_COLUMN }\n+SELECT arrayLastIndex(x -> NULL, [1, 2, 3]);\n+SELECT arrayLastIndex(x -> 'string', [1, 2, 3]); -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }\n SELECT '---cumsum---';\n SELECT arrayCumSum(x -> 0, emptyArrayUInt8());\n SELECT arrayCumSum(x -> 0, [1, 2, 3]);\ndiff --git a/tests/queries/0_stateless/03538_higher_order_functions_null_filter.reference b/tests/queries/0_stateless/03538_higher_order_functions_null_filter.reference\nnew file mode 100644\nindex 000000000000..3ebc5cd14e3b\n--- /dev/null\n+++ b/tests/queries/0_stateless/03538_higher_order_functions_null_filter.reference\n@@ -0,0 +1,5 @@\n+arrayFirst\n+2\n+['arrayFilter']\n+1\n+0\ndiff --git a/tests/queries/0_stateless/03538_higher_order_functions_null_filter.sql b/tests/queries/0_stateless/03538_higher_order_functions_null_filter.sql\nnew file mode 100644\nindex 000000000000..e2d8efaa9116\n--- /dev/null\n+++ b/tests/queries/0_stateless/03538_higher_order_functions_null_filter.sql\n@@ -0,0 +1,5 @@\n+SELECT arrayFirst(x -> x != '', [NULL, 'arrayFirst']);\n+SELECT arrayFirstIndex(x -> x != '', [NULL, 'arrayFirstIndex']);\n+SELECT arrayFilter(x -> x != '', [NULL, 'arrayFilter']);\n+SELECT arrayExists(x -> x != '', [NULL, 'arrayExists']);\n+SELECT arrayAll(x -> x != '', [NULL, 'arrayAll']);\n",
  "problem_statement": "Allow Nullable filters in higher-order functions\n### Company or project name\n\nClickHouse\n\n### Use case\n\n`SELECT arrayFirst(x -> x != '', [NULL, 'Hello'])`\n\n### Describe the solution you'd like\n\nImplement it.\n\n### Describe alternatives you've considered\n\n_No response_\n\n### Additional context\n\n_No response_\n",
  "hints_text": "",
  "created_at": "2025-06-03T10:36:10Z"
}