{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 69845,
  "instance_id": "ClickHouse__ClickHouse-69845",
  "issue_numbers": [
    "69261"
  ],
  "base_commit": "6e87c801edb195baaa6f346032e0f9c02b69dd36",
  "patch": "diff --git a/src/Interpreters/FillingRow.cpp b/src/Interpreters/FillingRow.cpp\nindex 7efbb62b0d20..21b5b04bca3f 100644\n--- a/src/Interpreters/FillingRow.cpp\n+++ b/src/Interpreters/FillingRow.cpp\n@@ -16,6 +16,10 @@ bool less(const Field & lhs, const Field & rhs, int direction)\n \n bool equals(const Field & lhs, const Field & rhs)\n {\n+    /// This will treat NaNs as equal\n+    if (lhs.getType() == rhs.getType())\n+        return lhs == rhs;\n+\n     return applyVisitor(FieldVisitorAccurateEquals(), lhs, rhs);\n }\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/03239_nan_with_fill.reference b/tests/queries/0_stateless/03239_nan_with_fill.reference\nnew file mode 100644\nindex 000000000000..10c8c316670f\n--- /dev/null\n+++ b/tests/queries/0_stateless/03239_nan_with_fill.reference\n@@ -0,0 +1,3 @@\n+nan\n+nan\n+nan\ndiff --git a/tests/queries/0_stateless/03239_nan_with_fill.sql b/tests/queries/0_stateless/03239_nan_with_fill.sql\nnew file mode 100644\nindex 000000000000..69eaf9b0c42b\n--- /dev/null\n+++ b/tests/queries/0_stateless/03239_nan_with_fill.sql\n@@ -0,0 +1,3 @@\n+SELECT nan ORDER BY 1 WITH FILL;\n+SELECT -nan ORDER BY 1 WITH FILL;\n+SELECT 0./0. ORDER BY 1 WITH FILL;\n",
  "problem_statement": "Query taking forever to run\n**Company or project name**\r\n\r\nClickhouse employee :smile: \r\n\r\n**Describe what's wrong**\r\n\r\nThe query: \r\n```sql\r\nSELECT nan ORDER BY 1 WITH FILL;\r\n```\r\ntakes forever to run. I can't place a Fiddle link because it doesn't finish running.\r\n\r\n**Does it reproduce on the most recent release?**\r\n\r\nYes\r\n\r\n**How to reproduce**\r\n\r\nRun the query above.\r\n\r\n**Expected behavior**\r\n\r\nIt shouldn't hang forever.\n",
  "hints_text": "",
  "created_at": "2024-09-21T23:07:24Z"
}