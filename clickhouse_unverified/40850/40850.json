{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 40850,
  "instance_id": "ClickHouse__ClickHouse-40850",
  "issue_numbers": [
    "40021"
  ],
  "base_commit": "849262bd9969bd0696ccdeb012846fe628906ade",
  "patch": "diff --git a/src/Interpreters/Set.cpp b/src/Interpreters/Set.cpp\nindex af05b33c1f66..258731456ee9 100644\n--- a/src/Interpreters/Set.cpp\n+++ b/src/Interpreters/Set.cpp\n@@ -393,7 +393,13 @@ void Set::checkColumnsNumber(size_t num_key_columns) const\n \n bool Set::areTypesEqual(size_t set_type_idx, const DataTypePtr & other_type) const\n {\n-    return removeNullable(recursiveRemoveLowCardinality(data_types[set_type_idx]))->equals(*removeNullable(recursiveRemoveLowCardinality(other_type)));\n+    /// Out-of-bound access can happen when same set expression built with different columns.\n+    /// Caller may call this method to make sure that the set is indeed the one they want\n+    /// without awaring data_types.size().\n+    if (set_type_idx >= data_types.size())\n+        return false;\n+    return removeNullable(recursiveRemoveLowCardinality(data_types[set_type_idx]))\n+        ->equals(*removeNullable(recursiveRemoveLowCardinality(other_type)));\n }\n \n void Set::checkTypesEqual(size_t set_type_idx, const DataTypePtr & other_type) const\ndiff --git a/src/Storages/MergeTree/KeyCondition.cpp b/src/Storages/MergeTree/KeyCondition.cpp\nindex 04007ce9356a..f5eeb4ed35c8 100644\n--- a/src/Storages/MergeTree/KeyCondition.cpp\n+++ b/src/Storages/MergeTree/KeyCondition.cpp\n@@ -297,8 +297,10 @@ class KeyCondition::Tree\n                 assert(indexes_mapping.size() == data_types.size());\n \n                 for (size_t i = 0; i < indexes_mapping.size(); ++i)\n+                {\n                     if (!candidate_set->areTypesEqual(indexes_mapping[i].tuple_index, data_types[i]))\n                         return false;\n+                }\n \n                 return true;\n             };\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02416_in_set_same_ast_diff_columns.reference b/tests/queries/0_stateless/02416_in_set_same_ast_diff_columns.reference\nnew file mode 100644\nindex 000000000000..d00491fd7e5b\n--- /dev/null\n+++ b/tests/queries/0_stateless/02416_in_set_same_ast_diff_columns.reference\n@@ -0,0 +1,1 @@\n+1\ndiff --git a/tests/queries/0_stateless/02416_in_set_same_ast_diff_columns.sql b/tests/queries/0_stateless/02416_in_set_same_ast_diff_columns.sql\nnew file mode 100644\nindex 000000000000..c3475f37e7e6\n--- /dev/null\n+++ b/tests/queries/0_stateless/02416_in_set_same_ast_diff_columns.sql\n@@ -0,0 +1,3 @@\n+CREATE TABLE set_crash (key1 Int32, id1 Int64, c1 Int64) ENGINE = MergeTree PARTITION BY id1 ORDER BY key1;\n+INSERT INTO set_crash VALUES (-1, 1, 0);\n+SELECT 1 in (-1, 1) FROM set_crash WHERE (key1, id1) in (-1, 1);\n",
  "problem_statement": "KeyCondition: `index out of bounds` when extracting prepared set\n```\r\n../contrib/libcxx/include/vector:1449: _LIBCPP_ASSERT '__n < size()' failed. vector[] index out of bounds Received signal 6 Received signal Aborted (6)\r\n```\r\n\r\nhttps://s3.amazonaws.com/clickhouse-test-reports/39973/24ee3e022df7e970b5925fea657bec3ad7303702/fuzzer_astfuzzerdebug//report.html\r\n\n",
  "hints_text": "```\r\n2022.08.09 11:49:08.081735 [ 513 ] {} <Fatal> BaseDaemon: ########################################\r\n2022.08.09 11:49:08.082370 [ 513 ] {} <Fatal> BaseDaemon: (version 22.8.1.1, build id: 92B408D951B32E4E) (from thread 269) (query_id: 1d409d83-e158-47c3-bd7e-79edafce5b22) (query: SELECT (NULL, NULL, NULL, NULL, NULL, NULL, NULL, (NULL, NULL, 257)), NULL, max(NULL, ((NULL, NULL), (NULL, 100000002004087730000.)), id1 IN (255), (NULL, NULL, NULL, NULL), (NULL IN (NULL, NULL)) AND ((key1, -2147483647) IN (NULL, '-0.2147483648'))) FROM tab_00612 WHERE ((key1, id1) IN (NULL, NULL)) AND ((key1, NULL) IN (2147483646, '655.36')) SETTINGS force_primary_key = 1) Received signal Aborted (6)\r\n2022.08.09 11:49:08.082691 [ 513 ] {} <Fatal> BaseDaemon: \r\n2022.08.09 11:49:08.083225 [ 513 ] {} <Fatal> BaseDaemon: Stack trace: 0x7f18c94fd00b 0x7f18c94dc859 0x30bb7dfc 0x1755059a 0x275808ab 0x282e1159 0x282e0ce7 0x282db3db 0x282b81da 0x282b470f 0x282b33c1 0x282b32ce 0x282b32ce 0x282b2f07 0x2845cf7e 0x2845ce04 0x28456444 0x284462c6 0x28fbd306 0x28fbc34f 0x28fbe00d 0x28fbe1bb 0x28f77915 0x28f9e280 0x27385591 0x277dee37 0x277db664 0x288b37a6 0x288c35a5 0x2cee1bd9 0x2cee243c 0x2d12ff94 0x2d12ca5a 0x2d12b7fe 0x7f18c96b4609 0x7f18c95d9133\r\n2022.08.09 11:49:08.083682 [ 513 ] {} <Fatal> BaseDaemon: 4. raise in ?\r\n2022.08.09 11:49:08.084084 [ 513 ] {} <Fatal> BaseDaemon: 5. abort in ?\r\n2022.08.09 11:49:08.257124 [ 513 ] {} <Fatal> BaseDaemon: 6. /build/build_docker/../contrib/libcxx/src/debug.cpp:0: std::__1::__libcpp_abort_debug_function(std::__1::__libcpp_debug_info const&) in /workspace/clickhouse\r\n2022.08.09 11:49:08.455508 [ 513 ] {} <Fatal> BaseDaemon: 7. /build/build_docker/../contrib/libcxx/include/vector:1449: std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > >::operator[](unsigned long) const in /workspace/clickhouse\r\n2022.08.09 11:49:08.709140 [ 513 ] {} <Fatal> BaseDaemon: 8. /build/build_docker/../src/Interpreters/Set.cpp:396: DB::Set::areTypesEqual(unsigned long, std::__1::shared_ptr<DB::IDataType const> const&) const in /workspace/clickhouse\r\n2022.08.09 11:49:10.053254 [ 513 ] {} <Fatal> BaseDaemon: 9. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:309: auto DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const::'lambda'(auto const&)::operator()<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > >(auto const&) const in /workspace/clickhouse\r\n2022.08.09 11:49:12.017242 [ 513 ] {} <Fatal> BaseDaemon: 10. /build/build_docker/../contrib/libcxx/include/__algorithm/find_if.h:25: auto std::__1::find_if<std::__1::__hash_map_const_iterator<std::__1::__hash_const_iterator<std::__1::__hash_node<std::__1::__hash_value_type<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set> >, void*>*> >, DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const::'lambda'(auto const&)>(auto, auto, DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const::'lambda'(auto const&)) in /workspace/clickhouse\r\n2022.08.09 11:49:13.313751 [ 513 ] {} <Fatal> BaseDaemon: 11. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:301: DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const in /workspace/clickhouse\r\n2022.08.09 11:49:14.610798 [ 513 ] {} <Fatal> BaseDaemon: 12. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:1330: DB::KeyCondition::tryPrepareSetIndex(DB::KeyCondition::FunctionTree const&, std::__1::shared_ptr<DB::Context const>, DB::KeyCondition::RPNElement&, unsigned long&) in /workspace/clickhouse\r\n2022.08.09 11:49:15.929871 [ 513 ] {} <Fatal> BaseDaemon: 13. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:1607: DB::KeyCondition::tryParseAtomFromAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::KeyCondition::RPNElement&) in /workspace/clickhouse\r\n2022.08.09 11:49:17.226258 [ 513 ] {} <Fatal> BaseDaemon: 14. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:1083: DB::KeyCondition::traverseAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&) in /workspace/clickhouse\r\n2022.08.09 11:49:18.516965 [ 513 ] {} <Fatal> BaseDaemon: 15. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:1070: DB::KeyCondition::traverseAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&) in /workspace/clickhouse\r\n2022.08.09 11:49:19.808900 [ 513 ] {} <Fatal> BaseDaemon: 16. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:1070: DB::KeyCondition::traverseAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&) in /workspace/clickhouse\r\n2022.08.09 11:49:21.112060 [ 513 ] {} <Fatal> BaseDaemon: 17. /build/build_docker/../src/Storages/MergeTree/KeyCondition.cpp:911: DB::KeyCondition::KeyCondition(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const>, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > >, std::__1::shared_ptr<DB::Context const>, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::ExpressionActions> const&, bool, bool) in /workspace/clickhouse\r\n2022.08.09 11:49:21.967301 [ 513 ] {} <Fatal> BaseDaemon: 18. /build/build_docker/../contrib/libcxx/include/__memory/construct_at.h:38: DB::KeyCondition* std::__1::construct_at<DB::KeyCondition, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>, DB::KeyCondition*>(DB::KeyCondition*, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>&&) in /workspace/clickhouse\r\n2022.08.09 11:49:22.744579 [ 513 ] {} <Fatal> BaseDaemon: 19. /build/build_docker/../contrib/libcxx/include/optional:351: void std::__1::__optional_storage_base<DB::KeyCondition, false>::__construct<std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions> >(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>&&) in /workspace/clickhouse\r\n2022.08.09 11:49:23.476090 [ 513 ] {} <Fatal> BaseDaemon: 20. /build/build_docker/../contrib/libcxx/include/optional:875: DB::KeyCondition& std::__1::optional<DB::KeyCondition>::emplace<std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>, void>(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>&&) in /workspace/clickhouse\r\n2022.08.09 11:49:24.207421 [ 513 ] {} <Fatal> BaseDaemon: 21. /build/build_docker/../src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp:772: DB::MergeTreeDataSelectExecutor::filterPartsByPartition(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >&, std::__1::optional<std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::MergeTreeData const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, long, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, long> > > const*, Poco::Logger*, std::__1::vector<DB::ReadFromMergeTree::IndexStat, std::__1::allocator<DB::ReadFromMergeTree::IndexStat> >&) in /workspace/clickhouse\r\n2022.08.09 11:49:24.768224 [ 513 ] {} <Fatal> BaseDaemon: 22. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:931: DB::ReadFromMergeTree::selectRangesToRead(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >, std::__1::shared_ptr<DB::PrewhereInfo> const&, std::__1::shared_ptr<DB::ActionsDAG> const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, unsigned int, std::__1::shared_ptr<std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, long, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, long> > > >, DB::MergeTreeData const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, bool, Poco::Logger*) in /workspace/clickhouse\r\n2022.08.09 11:49:25.330303 [ 513 ] {} <Fatal> BaseDaemon: 23. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:835: DB::ReadFromMergeTree::selectRangesToRead(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >) const in /workspace/clickhouse\r\n2022.08.09 11:49:25.892881 [ 513 ] {} <Fatal> BaseDaemon: 24. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:1045: DB::ReadFromMergeTree::getAnalysisResult() const in /workspace/clickhouse\r\n2022.08.09 11:49:26.426114 [ 513 ] {} <Fatal> BaseDaemon: 25. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:0: DB::ReadFromMergeTree::initializePipeline(DB::QueryPipelineBuilder&, DB::BuildQueryPipelineSettings const&) in /workspace/clickhouse\r\n2022.08.09 11:49:26.562084 [ 513 ] {} <Fatal> BaseDaemon: 26. /build/build_docker/../src/Processors/QueryPlan/ISourceStep.cpp:16: DB::ISourceStep::updatePipeline(std::__1::vector<std::__1::unique_ptr<DB::QueryPipelineBuilder, std::__1::default_delete<DB::QueryPipelineBuilder> >, std::__1::allocator<std::__1::unique_ptr<DB::QueryPipelineBuilder, std::__1::default_delete<DB::QueryPipelineBuilder> > > >, DB::BuildQueryPipelineSettings const&) in /workspace/clickhouse\r\n2022.08.09 11:49:26.761056 [ 513 ] {} <Fatal> BaseDaemon: 27. /build/build_docker/../src/Processors/QueryPlan/QueryPlan.cpp:187: DB::QueryPlan::buildQueryPipeline(DB::QueryPlanOptimizationSettings const&, DB::BuildQueryPipelineSettings const&) in /workspace/clickhouse\r\n2022.08.09 11:49:27.041563 [ 513 ] {} <Fatal> BaseDaemon: 28. /build/build_docker/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:370: DB::InterpreterSelectWithUnionQuery::execute() in /workspace/clickhouse\r\n2022.08.09 11:49:27.395124 [ 513 ] {} <Fatal> BaseDaemon: 29. /build/build_docker/../src/Interpreters/executeQuery.cpp:694: DB::executeQueryImpl(char const*, char const*, std::__1::shared_ptr<DB::Context>, bool, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) in /workspace/clickhouse\r\n2022.08.09 11:49:27.771371 [ 513 ] {} <Fatal> BaseDaemon: 30. /build/build_docker/../src/Interpreters/executeQuery.cpp:1085: DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::Context>, bool, DB::QueryProcessingStage::Enum) in /workspace/clickhouse\r\n\r\n```\nI tried to reproduce it but not successfully. Do you have a reproducing case?\nIt's quite easy to reproduce, you only need to find relevant CREATE statement for `tab_00612` and insert some data:\r\n```\r\ndell9510 :) CREATE TABLE tab_00612 (key1 Int32, id1  Int64, c1 Int64) ENGINE = MergeTree  PARTITION BY id1 ORDER BY (key1) ;\r\n\r\nCREATE TABLE tab_00612\r\n(\r\n    `key1` Int32,\r\n    `id1` Int64,\r\n    `c1` Int64\r\n)\r\nENGINE = MergeTree\r\nPARTITION BY id1\r\nORDER BY key1\r\n\r\nQuery id: 8a794626-8ba7-4269-ba9e-d1adb258af59\r\n\r\nOk.\r\n\r\n0 rows in set. Elapsed: 0.020 sec. \r\n\r\ndell9510 :) insert into tab_00612 values ( -1, 1, 0 );\r\n\r\nINSERT INTO tab_00612 FORMAT Values\r\n\r\nQuery id: a755d137-a927-4bfa-93c7-279f4b8b88fe\r\n\r\nOk.\r\n\r\n1 row in set. Elapsed: 0.013 sec. \r\n\r\ndell9510 :) SELECT (NULL, NULL, NULL, NULL, NULL, NULL, NULL, (NULL, NULL, 257)), NULL, max(NULL, ((NULL, NULL), (NULL, 100000002004087730000.)), id1 IN (255), (NULL, NULL, NULL, NULL), (NULL IN (NULL, NULL)) AND ((key1, -2147483647) IN (NULL, '-0.2147483648'))) FROM tab_00612 WHERE ((key1, id1) IN (NULL, NULL)) AND ((key1, NULL) IN (2147483646, '655.36')) SETTINGS force_primary_key = 1\r\n\r\nSELECT\r\n    (NULL, NULL, NULL, NULL, NULL, NULL, NULL, (NULL, NULL, 257)),\r\n    NULL,\r\n    max(NULL, ((NULL, NULL), (NULL, 100000002004087730000.)), id1 IN (255), (NULL, NULL, NULL, NULL), (NULL IN (NULL, NULL)) AND ((key1, -2147483647) IN (NULL, '-0.2147483648')))\r\nFROM tab_00612\r\nWHERE ((key1, id1) IN (NULL, NULL)) AND ((key1, NULL) IN (2147483646, '655.36'))\r\nSETTINGS force_primary_key = 1\r\n\r\nQuery id: 4c12ae79-972e-4038-8063-5bdc9182c122\r\n\r\nException on client:\r\nCode: 32. DB::Exception: Attempt to read after eof: while receiving packet from localhost:9000. (ATTEMPT_TO_READ_AFTER_EOF)\r\n\r\nConnecting to localhost:9000 as user default.\r\nCode: 210. DB::NetException: Connection refused (localhost:9000). (NETWORK_ERROR)\r\n```\r\n```\r\n2022.08.10 17:58:15.728207 [ 1020165 ] {} <Fatal> BaseDaemon: ########################################\r\n2022.08.10 17:58:15.729094 [ 1020165 ] {} <Fatal> BaseDaemon: (version 22.8.1.1, build id: 9A6758278FA51CEBC8AFF04218B42CF1D6DE383C) (from thread 723893) (query_id: 4c12ae79-972e-4038-8063-5bdc9182c122) (query: SELECT (NULL, NULL, NULL, NULL, NULL, NULL, NULL, (NULL, NULL, 257)), NULL, max(NULL, ((NULL, NULL), (NULL, 100000002004087730000.)), id1 IN (255), (NULL, NULL, NULL, NULL), (NULL IN (NULL, NULL)) AND ((key1, -2147483647) IN (NULL, '-0.2147483648'))) FROM tab_00612 WHERE ((key1, id1) IN (NULL, NULL)) AND ((key1, NULL) IN (2147483646, '655.36')) SETTINGS force_primary_key = 1) Received signal Aborted (6)\r\n2022.08.10 17:58:15.729347 [ 1020165 ] {} <Fatal> BaseDaemon: \r\n2022.08.10 17:58:15.729623 [ 1020165 ] {} <Fatal> BaseDaemon: Stack trace: 0x7f06cc07e36c 0x7f06cc02e838 0x7f06cc018535 0x3389997c 0x17d3680f 0x295ec9d8 0x2a456659 0x2a456134 0x2a44fd3d 0x2a41d6c9 0x2a4199af 0x2a41850b 0x2a418414 0x2a418414 0x2a417fdd 0x2a5f2f7d 0x2a5f2db8 0x2a5eb8c4 0x2a5da773 0x2b295695 0x2b29463c 0x2b296458 0x2b296628 0x2b24a399 0x2b273ea6 0x293bc30b 0x298839f7 0x298801fb 0x2aadc066 0x2aaec8f2 0x2f6cd999 0x2f6ce208 0x2f949b61 0x2f94617a 0x2f944e15 0x7f06cc07c54d 0x7f06cc101874\r\n2022.08.10 17:58:15.729819 [ 1020165 ] {} <Fatal> BaseDaemon: 4. ? @ 0x7f06cc07e36c in ?\r\n2022.08.10 17:58:15.729997 [ 1020165 ] {} <Fatal> BaseDaemon: 5. raise @ 0x7f06cc02e838 in ?\r\n2022.08.10 17:58:15.730109 [ 1020165 ] {} <Fatal> BaseDaemon: 6. abort @ 0x7f06cc018535 in ?\r\n2022.08.10 17:58:15.831263 [ 1020165 ] {} <Fatal> BaseDaemon: 7. /home/tavplubix/ch/ClickHouse/contrib/libcxx/src/debug.cpp:0: std::__1::__libcpp_abort_debug_function(std::__1::__libcpp_debug_info const&) @ 0x3389997c in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:15.916821 [ 1020165 ] {} <Fatal> BaseDaemon: 8. /home/tavplubix/ch/ClickHouse/contrib/libcxx/include/vector:1449: std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > >::operator[](unsigned long) const @ 0x17d3680f in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:16.277443 [ 1020165 ] {} <Fatal> BaseDaemon: 9. /home/tavplubix/ch/ClickHouse/src/Interpreters/Set.cpp:396: DB::Set::areTypesEqual(unsigned long, std::__1::shared_ptr<DB::IDataType const> const&) const @ 0x295ec9d8 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:17.421158 [ 1020165 ] {} <Fatal> BaseDaemon: 10. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:309: auto DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const::'lambda'(auto const&)::operator()<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > >(auto const&) const @ 0x2a456659 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:18.903888 [ 1020165 ] {} <Fatal> BaseDaemon: 11. /home/tavplubix/ch/ClickHouse/contrib/libcxx/include/__algorithm/find_if.h:25: auto std::__1::find_if<std::__1::__hash_map_const_iterator<std::__1::__hash_const_iterator<std::__1::__hash_node<std::__1::__hash_value_type<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set> >, void*>*> >, DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const::'lambda'(auto const&)>(auto, auto, DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const::'lambda'(auto const&)) @ 0x2a456134 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:19.863870 [ 1020165 ] {} <Fatal> BaseDaemon: 12. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:301: DB::KeyCondition::Tree::tryGetPreparedSet(std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::vector<DB::MergeTreeSetIndex::KeyTuplePositionMapping, std::__1::allocator<DB::MergeTreeSetIndex::KeyTuplePositionMapping> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&) const @ 0x2a44fd3d in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:20.830040 [ 1020165 ] {} <Fatal> BaseDaemon: 13. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:1330: DB::KeyCondition::tryPrepareSetIndex(DB::KeyCondition::FunctionTree const&, std::__1::shared_ptr<DB::Context const>, DB::KeyCondition::RPNElement&, unsigned long&) @ 0x2a41d6c9 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:21.777968 [ 1020165 ] {} <Fatal> BaseDaemon: 14. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:1607: DB::KeyCondition::tryParseAtomFromAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::KeyCondition::RPNElement&) @ 0x2a4199af in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:22.762409 [ 1020165 ] {} <Fatal> BaseDaemon: 15. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:1083: DB::KeyCondition::traverseAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&) @ 0x2a41850b in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:23.699922 [ 1020165 ] {} <Fatal> BaseDaemon: 16. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:1070: DB::KeyCondition::traverseAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&) @ 0x2a418414 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:24.614025 [ 1020165 ] {} <Fatal> BaseDaemon: 17. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:1070: DB::KeyCondition::traverseAST(DB::KeyCondition::Tree const&, std::__1::shared_ptr<DB::Context const>, DB::Block&) @ 0x2a418414 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:25.523135 [ 1020165 ] {} <Fatal> BaseDaemon: 18. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/KeyCondition.cpp:911: DB::KeyCondition::KeyCondition(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const>, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > >, std::__1::shared_ptr<DB::Context const>, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::ExpressionActions> const&, bool, bool) @ 0x2a417fdd in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:26.282480 [ 1020165 ] {} <Fatal> BaseDaemon: 19. /home/tavplubix/ch/ClickHouse/contrib/libcxx/include/__memory/construct_at.h:38: DB::KeyCondition* std::__1::construct_at<DB::KeyCondition, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>, DB::KeyCondition*>(DB::KeyCondition*, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>&&) @ 0x2a5f2f7d in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:26.837919 [ 1020165 ] {} <Fatal> BaseDaemon: 20. /home/tavplubix/ch/ClickHouse/contrib/libcxx/include/optional:351: void std::__1::__optional_storage_base<DB::KeyCondition, false>::__construct<std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions> >(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>&&) @ 0x2a5f2db8 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:27.362063 [ 1020165 ] {} <Fatal> BaseDaemon: 21. /home/tavplubix/ch/ClickHouse/contrib/libcxx/include/optional:875: DB::KeyCondition& std::__1::optional<DB::KeyCondition>::emplace<std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>, void>(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, std::__1::unordered_map<DB::PreparedSetKey, std::__1::shared_ptr<DB::Set>, DB::PreparedSetKey::Hash, std::__1::equal_to<DB::PreparedSetKey>, std::__1::allocator<std::__1::pair<DB::PreparedSetKey const, std::__1::shared_ptr<DB::Set> > > > const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, std::__1::shared_ptr<DB::ExpressionActions>&&) @ 0x2a5eb8c4 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:27.925592 [ 1020165 ] {} <Fatal> BaseDaemon: 22. /home/tavplubix/ch/ClickHouse/src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp:772: DB::MergeTreeDataSelectExecutor::filterPartsByPartition(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >&, std::__1::optional<std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::MergeTreeData const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const> const&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, long, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, long> > > const*, Poco::Logger*, std::__1::vector<DB::ReadFromMergeTree::IndexStat, std::__1::allocator<DB::ReadFromMergeTree::IndexStat> >&) @ 0x2a5da773 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:28.412203 [ 1020165 ] {} <Fatal> BaseDaemon: 23. /home/tavplubix/ch/ClickHouse/src/Processors/QueryPlan/ReadFromMergeTree.cpp:931: DB::ReadFromMergeTree::selectRangesToRead(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >, std::__1::shared_ptr<DB::PrewhereInfo> const&, std::__1::shared_ptr<DB::ActionsDAG> const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, unsigned int, std::__1::shared_ptr<std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, long, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, long> > > >, DB::MergeTreeData const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, bool, Poco::Logger*) @ 0x2b295695 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:28.846472 [ 1020165 ] {} <Fatal> BaseDaemon: 24. /home/tavplubix/ch/ClickHouse/src/Processors/QueryPlan/ReadFromMergeTree.cpp:835: DB::ReadFromMergeTree::selectRangesToRead(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >) const @ 0x2b29463c in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:29.260892 [ 1020165 ] {} <Fatal> BaseDaemon: 25. /home/tavplubix/ch/ClickHouse/src/Processors/QueryPlan/ReadFromMergeTree.cpp:1045: DB::ReadFromMergeTree::getAnalysisResult() const @ 0x2b296458 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:29.646700 [ 1020165 ] {} <Fatal> BaseDaemon: 26. /home/tavplubix/ch/ClickHouse/src/Processors/QueryPlan/ReadFromMergeTree.cpp:0: DB::ReadFromMergeTree::initializePipeline(DB::QueryPipelineBuilder&, DB::BuildQueryPipelineSettings const&) @ 0x2b296628 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:29.749656 [ 1020165 ] {} <Fatal> BaseDaemon: 27. /home/tavplubix/ch/ClickHouse/src/Processors/QueryPlan/ISourceStep.cpp:16: DB::ISourceStep::updatePipeline(std::__1::vector<std::__1::unique_ptr<DB::QueryPipelineBuilder, std::__1::default_delete<DB::QueryPipelineBuilder> >, std::__1::allocator<std::__1::unique_ptr<DB::QueryPipelineBuilder, std::__1::default_delete<DB::QueryPipelineBuilder> > > >, DB::BuildQueryPipelineSettings const&) @ 0x2b24a399 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:29.897392 [ 1020165 ] {} <Fatal> BaseDaemon: 28. /home/tavplubix/ch/ClickHouse/src/Processors/QueryPlan/QueryPlan.cpp:187: DB::QueryPlan::buildQueryPipeline(DB::QueryPlanOptimizationSettings const&, DB::BuildQueryPipelineSettings const&) @ 0x2b273ea6 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:30.113254 [ 1020165 ] {} <Fatal> BaseDaemon: 29. /home/tavplubix/ch/ClickHouse/src/Interpreters/InterpreterSelectWithUnionQuery.cpp:370: DB::InterpreterSelectWithUnionQuery::execute() @ 0x293bc30b in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:30.393053 [ 1020165 ] {} <Fatal> BaseDaemon: 30. /home/tavplubix/ch/ClickHouse/src/Interpreters/executeQuery.cpp:694: DB::executeQueryImpl(char const*, char const*, std::__1::shared_ptr<DB::Context>, bool, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) @ 0x298839f7 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:30.671516 [ 1020165 ] {} <Fatal> BaseDaemon: 31. /home/tavplubix/ch/ClickHouse/src/Interpreters/executeQuery.cpp:1085: DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::Context>, bool, DB::QueryProcessingStage::Enum) @ 0x298801fb in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:30.955242 [ 1020165 ] {} <Fatal> BaseDaemon: 32. /home/tavplubix/ch/ClickHouse/src/Server/TCPHandler.cpp:338: DB::TCPHandler::runImpl() @ 0x2aadc066 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.255768 [ 1020165 ] {} <Fatal> BaseDaemon: 33. /home/tavplubix/ch/ClickHouse/src/Server/TCPHandler.cpp:1838: DB::TCPHandler::run() @ 0x2aaec8f2 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.314209 [ 1020165 ] {} <Fatal> BaseDaemon: 34. /home/tavplubix/ch/ClickHouse/contrib/poco/Net/src/TCPServerConnection.cpp:43: Poco::Net::TCPServerConnection::start() @ 0x2f6cd999 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.390152 [ 1020165 ] {} <Fatal> BaseDaemon: 35. /home/tavplubix/ch/ClickHouse/contrib/poco/Net/src/TCPServerDispatcher.cpp:115: Poco::Net::TCPServerDispatcher::run() @ 0x2f6ce208 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.473213 [ 1020165 ] {} <Fatal> BaseDaemon: 36. /home/tavplubix/ch/ClickHouse/contrib/poco/Foundation/src/ThreadPool.cpp:199: Poco::PooledThread::run() @ 0x2f949b61 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.549045 [ 1020165 ] {} <Fatal> BaseDaemon: 37. /home/tavplubix/ch/ClickHouse/contrib/poco/Foundation/src/Thread.cpp:56: Poco::(anonymous namespace)::RunnableHolder::run() @ 0x2f94617a in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.621872 [ 1020165 ] {} <Fatal> BaseDaemon: 38. /home/tavplubix/ch/ClickHouse/contrib/poco/Foundation/src/Thread_POSIX.cpp:345: Poco::ThreadImpl::runnableEntry(void*) @ 0x2f944e15 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse\r\n2022.08.10 17:58:31.622143 [ 1020165 ] {} <Fatal> BaseDaemon: 39. ? @ 0x7f06cc07c54d in ?\r\n2022.08.10 17:58:31.622298 [ 1020165 ] {} <Fatal> BaseDaemon: 40. clone @ 0x7f06cc101874 in ?\r\n2022.08.10 17:58:32.539458 [ 1020165 ] {} <Fatal> BaseDaemon: Integrity check of the executable skipped because the reference checksum could not be read. (calculated checksum: 5E21F00BE7E6CF324941162F7EDC3547)\r\n\r\n```",
  "created_at": "2022-08-31T13:50:18Z"
}