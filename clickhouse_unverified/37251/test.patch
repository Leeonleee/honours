diff --git a/docs/en/development/adding_test_queries.md b/docs/en/development/adding_test_queries.md
index 9b993a96ed52..ca47818dad75 100644
--- a/docs/en/development/adding_test_queries.md
+++ b/docs/en/development/adding_test_queries.md
@@ -106,7 +106,7 @@ vim tests/queries/0_stateless/01521_dummy_test.sql
 
 4) run the test, and put the result of that into the reference file:
 ```
-clickhouse-client -nmT < tests/queries/0_stateless/01521_dummy_test.sql | tee tests/queries/0_stateless/01521_dummy_test.reference
+clickhouse-client -nm < tests/queries/0_stateless/01521_dummy_test.sql | tee tests/queries/0_stateless/01521_dummy_test.reference
 ```
 
 5) ensure everything is correct, if the test output is incorrect (due to some bug for example), adjust the reference file using text editor.
diff --git a/tests/queries/0_stateless/02294_stringsearch_with_nonconst_needle.reference b/tests/queries/0_stateless/02294_stringsearch_with_nonconst_needle.reference
new file mode 100644
index 000000000000..7471bcad00cb
--- /dev/null
+++ b/tests/queries/0_stateless/02294_stringsearch_with_nonconst_needle.reference
@@ -0,0 +1,190 @@
+LIKE
+1	Hello		0
+2	Hello	%	1
+3	Hello	%%	1
+4	Hello	%%%	1
+5	Hello	%_%	1
+6	Hello	_	0
+7	Hello	_%	1
+8	Hello	%_	1
+9	Hello	H%o	1
+10	hello	H%0	0
+11	hello	h%o	1
+12	Hello	h%o	0
+13	OHello	%lhell%	0
+14	OHello	%hell%	0
+15	hEllo	%HEL%	0
+16	abcdef	%aBc%def%	0
+17	ABCDDEF	%abc%def%	0
+18	Abc
Def	%abc%def%	0
+19	abc
tdef	%abc%def%	1
+20	abct
def	%abc%dEf%	0
+21	abc

deF	%abc%def%	0
+22	abc

tdef	%abc%deF%	0
+23	Abc
t
def	%abc%def%	0
+24	abct

def	%abc%def%	1
+25	ab
def	%Abc%def%	0
+26	aBc
ef	%ABC%DEF%	0
+27	ёЁё	Ё%Ё	0
+28	ощщЁё	Щ%Ё	0
+29	ощЩЁё	%Щ%Ё	0
+30	Щущпандер	%щп%е%	1
+31	Щущпандер	%щП%е%	0
+32	ощщЁё	%щ%	1
+33	ощЩЁё	%ё%	1
+34	Hello	.*	0
+35	Hello	.*ell.*	0
+36	Hello	o$	0
+37	Hello	hE.*lO	0
+NOT LIKE
+1	Hello		1
+2	Hello	%	0
+3	Hello	%%	0
+4	Hello	%%%	0
+5	Hello	%_%	0
+6	Hello	_	1
+7	Hello	_%	0
+8	Hello	%_	0
+9	Hello	H%o	0
+10	hello	H%0	1
+11	hello	h%o	0
+12	Hello	h%o	1
+13	OHello	%lhell%	1
+14	OHello	%hell%	1
+15	hEllo	%HEL%	1
+16	abcdef	%aBc%def%	1
+17	ABCDDEF	%abc%def%	1
+18	Abc
Def	%abc%def%	1
+19	abc
tdef	%abc%def%	0
+20	abct
def	%abc%dEf%	1
+21	abc

deF	%abc%def%	1
+22	abc

tdef	%abc%deF%	1
+23	Abc
t
def	%abc%def%	1
+24	abct

def	%abc%def%	0
+25	ab
def	%Abc%def%	1
+26	aBc
ef	%ABC%DEF%	1
+27	ёЁё	Ё%Ё	1
+28	ощщЁё	Щ%Ё	1
+29	ощЩЁё	%Щ%Ё	1
+30	Щущпандер	%щп%е%	0
+31	Щущпандер	%щП%е%	1
+32	ощщЁё	%щ%	0
+33	ощЩЁё	%ё%	0
+34	Hello	.*	1
+35	Hello	.*ell.*	1
+36	Hello	o$	1
+37	Hello	hE.*lO	1
+ILIKE
+1	Hello		0
+2	Hello	%	1
+3	Hello	%%	1
+4	Hello	%%%	1
+5	Hello	%_%	1
+6	Hello	_	0
+7	Hello	_%	1
+8	Hello	%_	1
+9	Hello	H%o	1
+10	hello	H%0	0
+11	hello	h%o	1
+12	Hello	h%o	1
+13	OHello	%lhell%	0
+14	OHello	%hell%	1
+15	hEllo	%HEL%	1
+16	abcdef	%aBc%def%	1
+17	ABCDDEF	%abc%def%	1
+18	Abc
Def	%abc%def%	1
+19	abc
tdef	%abc%def%	1
+20	abct
def	%abc%dEf%	1
+21	abc

deF	%abc%def%	1
+22	abc

tdef	%abc%deF%	1
+23	Abc
t
def	%abc%def%	1
+24	abct

def	%abc%def%	1
+25	ab
def	%Abc%def%	0
+26	aBc
ef	%ABC%DEF%	0
+27	ёЁё	Ё%Ё	1
+28	ощщЁё	Щ%Ё	0
+29	ощЩЁё	%Щ%Ё	1
+30	Щущпандер	%щп%е%	1
+31	Щущпандер	%щП%е%	1
+32	ощщЁё	%щ%	1
+33	ощЩЁё	%ё%	1
+34	Hello	.*	0
+35	Hello	.*ell.*	0
+36	Hello	o$	0
+37	Hello	hE.*lO	0
+NOT ILIKE
+1	Hello		1
+2	Hello	%	0
+3	Hello	%%	0
+4	Hello	%%%	0
+5	Hello	%_%	0
+6	Hello	_	1
+7	Hello	_%	0
+8	Hello	%_	0
+9	Hello	H%o	0
+10	hello	H%0	1
+11	hello	h%o	0
+12	Hello	h%o	0
+13	OHello	%lhell%	1
+14	OHello	%hell%	0
+15	hEllo	%HEL%	0
+16	abcdef	%aBc%def%	0
+17	ABCDDEF	%abc%def%	0
+18	Abc
Def	%abc%def%	0
+19	abc
tdef	%abc%def%	0
+20	abct
def	%abc%dEf%	0
+21	abc

deF	%abc%def%	0
+22	abc

tdef	%abc%deF%	0
+23	Abc
t
def	%abc%def%	0
+24	abct

def	%abc%def%	0
+25	ab
def	%Abc%def%	1
+26	aBc
ef	%ABC%DEF%	1
+27	ёЁё	Ё%Ё	0
+28	ощщЁё	Щ%Ё	1
+29	ощЩЁё	%Щ%Ё	0
+30	Щущпандер	%щп%е%	0
+31	Щущпандер	%щП%е%	0
+32	ощщЁё	%щ%	0
+33	ощЩЁё	%ё%	0
+34	Hello	.*	1
+35	Hello	.*ell.*	1
+36	Hello	o$	1
+37	Hello	hE.*lO	1
+MATCH
+1	Hello		1
+2	Hello	%	0
+3	Hello	%%	0
+4	Hello	%%%	0
+5	Hello	%_%	0
+6	Hello	_	0
+7	Hello	_%	0
+8	Hello	%_	0
+9	Hello	H%o	0
+10	hello	H%0	0
+11	hello	h%o	0
+12	Hello	h%o	0
+13	OHello	%lhell%	0
+14	OHello	%hell%	0
+15	hEllo	%HEL%	0
+16	abcdef	%aBc%def%	0
+17	ABCDDEF	%abc%def%	0
+18	Abc
Def	%abc%def%	0
+19	abc
tdef	%abc%def%	0
+20	abct
def	%abc%dEf%	0
+21	abc

deF	%abc%def%	0
+22	abc

tdef	%abc%deF%	0
+23	Abc
t
def	%abc%def%	0
+24	abct

def	%abc%def%	0
+25	ab
def	%Abc%def%	0
+26	aBc
ef	%ABC%DEF%	0
+27	ёЁё	Ё%Ё	0
+28	ощщЁё	Щ%Ё	0
+29	ощЩЁё	%Щ%Ё	0
+30	Щущпандер	%щп%е%	0
+31	Щущпандер	%щП%е%	0
+32	ощщЁё	%щ%	0
+33	ощЩЁё	%ё%	0
+34	Hello	.*	1
+35	Hello	.*ell.*	1
+36	Hello	o$	1
+37	Hello	hE.*lO	0
diff --git a/tests/queries/0_stateless/02294_stringsearch_with_nonconst_needle.sql b/tests/queries/0_stateless/02294_stringsearch_with_nonconst_needle.sql
new file mode 100644
index 000000000000..3057e3427332
--- /dev/null
+++ b/tests/queries/0_stateless/02294_stringsearch_with_nonconst_needle.sql
@@ -0,0 +1,36 @@
+drop table if exists non_const_needle;
+
+create table non_const_needle
+  (id UInt32, haystack String, needle String)
+  engine = MergeTree()
+  order by id;
+
+-- 1 - 33: LIKE-syntax, 34-37: re2-syntax
+insert into non_const_needle values (1, 'Hello', '') (2, 'Hello', '%') (3, 'Hello', '%%') (4, 'Hello', '%%%') (5, 'Hello', '%_%') (6, 'Hello', '_') (7, 'Hello', '_%') (8, 'Hello', '%_') (9, 'Hello', 'H%o') (10, 'hello', 'H%0') (11, 'hello', 'h%o') (12, 'Hello', 'h%o') (13, 'OHello', '%lhell%') (14, 'OHello', '%hell%') (15, 'hEllo', '%HEL%') (16, 'abcdef', '%aBc%def%') (17, 'ABCDDEF', '%abc%def%') (18, 'Abc
Def', '%abc%def%') (19, 'abc
tdef', '%abc%def%') (20, 'abct
def', '%abc%dEf%') (21, 'abc

deF', '%abc%def%') (22, 'abc

tdef', '%abc%deF%') (23, 'Abc
t
def', '%abc%def%') (24, 'abct

def', '%abc%def%') (25, 'ab
def', '%Abc%def%') (26, 'aBc
ef', '%ABC%DEF%') (27, 'ёЁё', 'Ё%Ё') (28, 'ощщЁё', 'Щ%Ё') (29, 'ощЩЁё', '%Щ%Ё') (30, 'Щущпандер', '%щп%е%') (31, 'Щущпандер', '%щП%е%') (32, 'ощщЁё', '%щ%') (33, 'ощЩЁё', '%ё%') (34, 'Hello', '.*') (35, 'Hello', '.*ell.*') (36, 'Hello', 'o$') (37, 'Hello', 'hE.*lO');
+
+select 'LIKE';
+select id, haystack, needle, like(haystack, needle)
+  from non_const_needle
+  order by id;
+
+select 'NOT LIKE';
+select id, haystack, needle, not like(haystack, needle)
+  from non_const_needle
+  order by id;
+
+select 'ILIKE';
+select id, haystack, needle, ilike(haystack, needle)
+  from non_const_needle
+  order by id;
+
+select 'NOT ILIKE';
+select id, haystack, needle, not ilike(haystack, needle)
+  from non_const_needle
+  order by id;
+
+select 'MATCH';
+select id, haystack, needle, match(haystack, needle)
+  from non_const_needle
+  order by id;
+
+drop table if exists non_const_needle;
