{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 12593,
  "instance_id": "ClickHouse__ClickHouse-12593",
  "issue_numbers": [
    "12592"
  ],
  "base_commit": "dad8d85b7d0a014e617ffc66cc0f138e365556e8",
  "patch": "diff --git a/src/Interpreters/AnyInputOptimize.cpp b/src/Interpreters/AnyInputOptimize.cpp\nindex 13246fd81726..1b31ea4024ba 100644\n--- a/src/Interpreters/AnyInputOptimize.cpp\n+++ b/src/Interpreters/AnyInputOptimize.cpp\n@@ -71,10 +71,13 @@ void AnyInputMatcher::visit(ASTPtr & current_ast, Data data)\n         && function_argument && function_argument->as<ASTFunction>())\n     {\n         auto name = function_node->name;\n+        auto alias = function_node->alias;\n+\n         ///cut any or anyLast\n         if (!function_argument->as<ASTFunction>()->arguments->children.empty())\n         {\n             current_ast = function_argument->clone();\n+            current_ast->setAlias(alias);\n             for (size_t i = 0; i < current_ast->as<ASTFunction>()->arguments->children.size(); ++i)\n                 changeAllIdentifiers(current_ast, i, name);\n         }\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01398_any_with_alias.reference b/tests/queries/0_stateless/01398_any_with_alias.reference\nnew file mode 100644\nindex 000000000000..4f8e72ef29c8\n--- /dev/null\n+++ b/tests/queries/0_stateless/01398_any_with_alias.reference\n@@ -0,0 +1,8 @@\n+\"n\"\n+0\n+SELECT any(number) * any(number) AS n\n+FROM numbers(100)\n+\"n\"\n+0,0\n+SELECT (any(number), any(number) * 2) AS n\n+FROM numbers(100)\ndiff --git a/tests/queries/0_stateless/01398_any_with_alias.sql b/tests/queries/0_stateless/01398_any_with_alias.sql\nnew file mode 100644\nindex 000000000000..32e67f3f4b6a\n--- /dev/null\n+++ b/tests/queries/0_stateless/01398_any_with_alias.sql\n@@ -0,0 +1,5 @@\n+SELECT any(number * number) AS n FROM numbers(100) FORMAT CSVWithNames;\n+EXPLAIN SYNTAX SELECT any(number * number) AS n FROM numbers(100);\n+\n+SELECT any((number, number * 2)) as n FROM numbers(100) FORMAT CSVWithNames;\n+EXPLAIN SYNTAX SELECT any((number, number * 2)) as n FROM numbers(100);\n",
  "problem_statement": "optimize_move_functions_out_of_any doesn't respect aliases.\n**How to reproduce**\r\n```\r\nSELECT any(number * 2) AS n\r\nFROM numbers(100)\r\n\r\n\u250c\u2500multiply(any(number), 2)\u2500\u2510\r\n\u2502                        0 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n\r\n```\r\nSELECT any(number * 2) AS n\r\nFROM numbers(100)\r\nSETTINGS optimize_move_functions_out_of_any = 0\r\n\r\n\u250c\u2500n\u2500\u2510\r\n\u2502 0 \u2502\r\n\u2514\u2500\u2500\u2500\u2518\r\n\r\n```\n",
  "hints_text": "",
  "created_at": "2020-07-20T09:05:32Z",
  "modified_files": [
    "src/Interpreters/AnyInputOptimize.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/01398_any_with_alias.reference",
    "b/tests/queries/0_stateless/01398_any_with_alias.sql"
  ]
}