{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 9823,
  "instance_id": "ClickHouse__ClickHouse-9823",
  "issue_numbers": [
    "9777"
  ],
  "base_commit": "437ffab07e56161e2d845f3f093d6a5540e1e15b",
  "patch": "diff --git a/dbms/src/Processors/Transforms/ExpressionTransform.cpp b/dbms/src/Processors/Transforms/ExpressionTransform.cpp\nindex 7ae2eafa0c64..cbc83692c4ba 100644\n--- a/dbms/src/Processors/Transforms/ExpressionTransform.cpp\n+++ b/dbms/src/Processors/Transforms/ExpressionTransform.cpp\n@@ -29,7 +29,7 @@ void ExpressionTransform::transform(Chunk & chunk)\n         if (expression->resultIsAlwaysEmpty())\n         {\n             stopReading();\n-            chunk = Chunk(getOutputPort().getHeader().getColumns(), 0);\n+            chunk.clear();\n             return;\n         }\n     }\ndiff --git a/dbms/src/Processors/Transforms/InflatingExpressionTransform.cpp b/dbms/src/Processors/Transforms/InflatingExpressionTransform.cpp\nindex 837922533905..b5d288197b14 100644\n--- a/dbms/src/Processors/Transforms/InflatingExpressionTransform.cpp\n+++ b/dbms/src/Processors/Transforms/InflatingExpressionTransform.cpp\n@@ -28,7 +28,7 @@ void InflatingExpressionTransform::transform(Chunk & chunk)\n         if (expression->resultIsAlwaysEmpty())\n         {\n             stopReading();\n-            chunk = Chunk(getOutputPort().getHeader().getColumns(), 0);\n+            chunk.clear();\n             return;\n         }\n     }\n",
  "test_patch": "diff --git a/dbms/tests/queries/0_stateless/02001_empty_join_and_totals.reference b/dbms/tests/queries/0_stateless/02001_empty_join_and_totals.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/dbms/tests/queries/0_stateless/02001_empty_join_and_totals.sql b/dbms/tests/queries/0_stateless/02001_empty_join_and_totals.sql\nnew file mode 100644\nindex 000000000000..2424e7bbae91\n--- /dev/null\n+++ b/dbms/tests/queries/0_stateless/02001_empty_join_and_totals.sql\n@@ -0,0 +1,11 @@\n+select * from system.one t1\n+join system.one t2\n+on t1.dummy = t2.dummy\n+limit 0\n+FORMAT TabSeparated;\n+\n+select * from system.one t1\n+join system.one t2\n+on t1.dummy = t2.dummy\n+where t2.dummy > 0\n+FORMAT TabSeparated;\n",
  "problem_statement": "Logical error 'Got 0 in totals chunk, expected 1'\n```\r\nselect * from system.one t1\r\njoin system.one t2\r\non t1.dummy = t2.dummy\r\nlimit 0\r\nFORMAT TabSeparated;\r\n```\r\n\r\n```\r\nProgress: 0.00 rows, 0.00 B (0.00 rows/s., 0.00 B/s.) Logical error: 'Got 0 in totals chunk, expected 1'.\r\nclickhouse-client: /home/chertus/src/ClickHouse/dbms/src/Common/Exception.cpp:37: DB::Exception::Exception(const std::string &, int): Assertion `false' failed.\r\nAborted (core dumped)\r\n```\n",
  "hints_text": "",
  "created_at": "2020-03-23T12:38:03Z",
  "modified_files": [
    "dbms/src/Processors/Transforms/ExpressionTransform.cpp",
    "dbms/src/Processors/Transforms/InflatingExpressionTransform.cpp"
  ],
  "modified_test_files": [
    "b/dbms/tests/queries/0_stateless/02001_empty_join_and_totals.sql"
  ]
}