{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 18211,
  "instance_id": "ClickHouse__ClickHouse-18211",
  "issue_numbers": [
    "16372",
    "18186"
  ],
  "base_commit": "44734a829ea4add9ba88be3844408c1a1484f8e5",
  "patch": "diff --git a/src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp b/src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp\nindex e5263f546969..7f4da0638d4d 100644\n--- a/src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp\n+++ b/src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp\n@@ -202,10 +202,10 @@ static inline std::tuple<NamesAndTypesList, NamesAndTypesList, NamesAndTypesList\n                 keys->arguments->children.insert(keys->arguments->children.end(),\n                     index_columns->children.begin(), index_columns->children.end());\n             else if (startsWith(declare_index->index_type, \"UNIQUE_\"))\n-                unique_keys->arguments->children.insert(keys->arguments->children.end(),\n+                unique_keys->arguments->children.insert(unique_keys->arguments->children.end(),\n                     index_columns->children.begin(), index_columns->children.end());\n             if (startsWith(declare_index->index_type, \"PRIMARY_KEY_\"))\n-                primary_keys->arguments->children.insert(keys->arguments->children.end(),\n+                primary_keys->arguments->children.insert(primary_keys->arguments->children.end(),\n                     index_columns->children.begin(), index_columns->children.end());\n         }\n     }\n",
  "test_patch": "diff --git a/src/Interpreters/MySQL/tests/gtest_create_rewritten.cpp b/src/Interpreters/MySQL/tests/gtest_create_rewritten.cpp\nindex d7209330ec6b..0d8e57aafc54 100644\n--- a/src/Interpreters/MySQL/tests/gtest_create_rewritten.cpp\n+++ b/src/Interpreters/MySQL/tests/gtest_create_rewritten.cpp\n@@ -195,3 +195,15 @@ TEST(MySQLCreateRewritten, RewrittenQueryWithPrefixKey)\n         \"ReplacingMergeTree(_version) PARTITION BY intDiv(key, 4294967) ORDER BY (key, prefix_key)\");\n }\n \n+TEST(MySQLCreateRewritten, UniqueKeysConvert)\n+{\n+    tryRegisterFunctions();\n+    const auto & context_holder = getContext();\n+\n+    EXPECT_EQ(queryToString(tryRewrittenCreateQuery(\n+        \"CREATE TABLE `test_database`.`test_table_1` (code varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,name varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,\"\n+        \" id bigint NOT NULL AUTO_INCREMENT, tenant_id bigint NOT NULL, PRIMARY KEY (id), UNIQUE KEY code_id (code, tenant_id), UNIQUE KEY name_id (name, tenant_id))\"\n+        \" ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\", context_holder.context)),\n+        \"CREATE TABLE test_database.test_table_1 (`code` String, `name` String, `id` Int64, `tenant_id` Int64, `_sign` Int8() MATERIALIZED 1, `_version` UInt64() MATERIALIZED 1)\"\n+        \" ENGINE = ReplacingMergeTree(_version) PARTITION BY intDiv(id, 18446744073709551) ORDER BY (code, name, tenant_id, id)\");\n+}\n",
  "problem_statement": "Create MaterializeMySQL cause clickhouse server Segmentation fault\n(you don't have to strictly follow this form)\r\n\r\n**Describe the bug**\r\n\r\nAfter create database with engine MaterializeMySQL, clickhouse server Segmentation fault and restart\r\n\r\n**How to reproduce**\r\n* 20.10.2.20 (official build)\r\n* `CREATE DATABASE xxx ENGINE = MaterializeMySQL('host', 'dbname', 'user', 'pass');`\r\n\r\n**Error message and/or stacktrace**\r\n\r\n```\r\n2020.10.26 10:56:31.340735 [ 18476 ] {} <Fatal> BaseDaemon: ########################################\r\n2020.10.26 10:56:31.340793 [ 18476 ] {} <Fatal> BaseDaemon: (version 20.10.2.20 (official build), build id: FFE5E11E2023F86A) (from thread 1298) (no query) Received signal Segmentation fault (11)\r\n2020.10.26 10:56:31.340818 [ 18476 ] {} <Fatal> BaseDaemon: Address: 0xfffffffffb0f8320 Access: write. Address not mapped to object.\r\n2020.10.26 10:56:31.340840 [ 18476 ] {} <Fatal> BaseDaemon: Stack trace: 0xdef5e7e 0xdeeaeec 0xdb5214c 0xdb511d7 0xdecaff8 0xdec9e9d 0xdb00ba4 0xdb16b98 0xdb1c79e 0xdb1cc91 0xdafa7a9 0xdaf9e2a 0xdb162cd 0x7b8b75d 0x7b8f273 0x7fb9096a12de 0x7fb908fc5133\r\n2020.10.26 10:56:31.340923 [ 18476 ] {} <Fatal> BaseDaemon: 2. std::__1::enable_if<(__is_cpp17_forward_iterator<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> >::value) && (is_constructible<std::__1::shared_ptr<DB::IAST>, std::__1::iterator_traits<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> >::reference>::value), std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> >::type std::__1::vector<std::__1::shared_ptr<DB::IAST>, std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::insert<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> >(std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST> const*>, std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*>, std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*>) @ 0xdef5e7e in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.340957 [ 18476 ] {} <Fatal> BaseDaemon: 3. DB::MySQLInterpreter::InterpreterCreateImpl::getRewrittenQueries(DB::MySQLParser::ASTCreateQuery const&, DB::Context const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0xdeeaeec in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.340979 [ 18476 ] {} <Fatal> BaseDaemon: 4. DB::MySQLInterpreter::InterpreterMySQLDDLQuery<DB::MySQLInterpreter::InterpreterCreateImpl>::execute() @ 0xdb5214c in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.340993 [ 18476 ] {} <Fatal> BaseDaemon: 5. DB::InterpreterExternalDDLQuery::execute() @ 0xdb511d7 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341006 [ 18476 ] {} <Fatal> BaseDaemon: 6. ? @ 0xdecaff8 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341022 [ 18476 ] {} <Fatal> BaseDaemon: 7. DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool) @ 0xdec9e9d in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341036 [ 18476 ] {} <Fatal> BaseDaemon: 8. ? @ 0xdb00ba4 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341056 [ 18476 ] {} <Fatal> BaseDaemon: 9. ? @ 0xdb16b98 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341094 [ 18476 ] {} <Fatal> BaseDaemon: 10. DB::commitMetadata(std::__1::function<void ()> const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0xdb1c79e in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341111 [ 18476 ] {} <Fatal> BaseDaemon: 11. DB::MaterializeMetadata::transaction(DB::MySQLReplication::Position const&, std::__1::function<void ()> const&) @ 0xdb1cc91 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341126 [ 18476 ] {} <Fatal> BaseDaemon: 12. DB::MaterializeMySQLSyncThread::prepareSynchronized(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0xdafa7a9 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341146 [ 18476 ] {} <Fatal> BaseDaemon: 13. DB::MaterializeMySQLSyncThread::synchronization(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0xdaf9e2a in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341174 [ 18476 ] {} <Fatal> BaseDaemon: 14. ? @ 0xdb162cd in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341189 [ 18476 ] {} <Fatal> BaseDaemon: 15. ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0x7b8b75d in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341203 [ 18476 ] {} <Fatal> BaseDaemon: 16. ? @ 0x7b8f273 in /usr/bin/clickhouse\r\n2020.10.26 10:56:31.341232 [ 18476 ] {} <Fatal> BaseDaemon: 17. start_thread @ 0x82de in /usr/lib64/libpthread-2.28.so\r\n2020.10.26 10:56:31.341254 [ 18476 ] {} <Fatal> BaseDaemon: 18. clone @ 0xfc133 in /usr/lib64/libc-2.28.so\r\n2020.10.26 10:57:13.074460 [ 18605 ] {} <Fatal> BaseDaemon: ########################################\r\n```\nMaterializeMySQL crashed when replicating data from MySQL8.0.21\n**Describe the bug**\r\nI use MaterializeMySQL to replicate data from MySQL to ClickHouse. It's crashed in DDL stage. It seems that clickhouse accesses an invalid address.\r\n\r\n**How to reproduce**\r\njust create the following table in MySQL, and then create MaterializeMySQL table in ClickHouse.\r\nCREATE TABLE `test1` (\r\n  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,\r\n  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,\r\n  `id` bigint NOT NULL AUTO_INCREMENT,\r\n  `tenant_id` bigint NOT NULL,\r\n   PRIMARY KEY (`id`),\r\n  UNIQUE KEY `code_id` (`code`, `tenant_id`),\r\n  UNIQUE KEY `name_id` (`name`, `tenant_id`)\r\n  ) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\r\n\r\n\r\n* Which ClickHouse server version to use\r\nI have tested version 20.10.6.27 and 20.12.3.3. Both have this problem.\r\n\r\n\r\n\r\n* `CREATE TABLE` statements for all tables involved\r\nIn MySQL side:\r\nCREATE TABLE `test1` (\r\n  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,\r\n  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,\r\n  `id` bigint NOT NULL AUTO_INCREMENT,\r\n  `tenant_id` bigint NOT NULL,\r\n   PRIMARY KEY (`id`),\r\n  UNIQUE KEY `code_id` (`code`, `tenant_id`),\r\n  UNIQUE KEY `name_id` (`name`, `tenant_id`)\r\n  ) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\r\n\r\n**Expected behavior**\r\ncreate MaterializeMySQL table success in ClickHouse side.\r\n\r\n**Error message and/or stacktrace**\r\n\r\nstack of version 20.10.6.27\r\nCannot access memory at address 0x7f69ca4a2128\r\nCannot access memory at address 0x7f69ca4a2120\r\nFailed to read a valid object file image from memory.\r\nCore was generated by `./clickhouse-server'.\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  0x0000000015f106cc in std::__1::shared_ptr<DB::IAST>::shared_ptr (__r=..., this=0x9640) at ../contrib/libcxx/include/memory:4057\r\n4057\t../contrib/libcxx/include/memory: No such file or directory.\r\n[Current thread is 1 (LWP 10227)]\r\n(gdb) bt\r\n#0  0x0000000015f106cc in std::__1::shared_ptr<DB::IAST>::shared_ptr (__r=..., this=0x9640) at ../contrib/libcxx/include/memory:4057\r\n#1  std::__1::allocator<std::__1::shared_ptr<DB::IAST> >::construct<std::__1::shared_ptr<DB::IAST>, std::__1::shared_ptr<DB::IAST>&> (__p=0x9640, this=0x7f6809975d10)\r\n    at ../contrib/libcxx/include/memory:1876\r\n#2  std::__1::allocator_traits<std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::__construct<std::__1::shared_ptr<DB::IAST>, std::__1::shared_ptr<DB::IAST>&> (\r\n    __p=0x9640, __a=...) at ../contrib/libcxx/include/memory:1768\r\n#3  std::__1::allocator_traits<std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::construct<std::__1::shared_ptr<DB::IAST>, std::__1::shared_ptr<DB::IAST>&> (\r\n    __p=0x9640, __a=...) at ../contrib/libcxx/include/memory:1595\r\n#4  std::__1::__split_buffer<std::__1::shared_ptr<DB::IAST>, std::__1::allocator<std::__1::shared_ptr<DB::IAST> >&>::__construct_at_end<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> > (this=0x7f67f7de7460, __first=..., __last=...) at ../contrib/libcxx/include/__split_buffer:275\r\n#5  0x0000000015f0ec4e in std::__1::vector<std::__1::shared_ptr<DB::IAST>, std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::insert<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> > (this=0x7f6809975d00, __position=..., __first=..., __last=...) at ../contrib/libcxx/include/vector:2009\r\n#6  0x0000000015edb55a in DB::MySQLInterpreter::getKeys (columns_define=0x7f6809975c98, indices_define=0x7f6809975b58, context=..., columns=...)\r\n    at ../src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp:177\r\n#7  0x0000000015eeffb3 in DB::MySQLInterpreter::InterpreterCreateImpl::getRewrittenQueries (create_query=..., context=..., mapped_to_database=..., mysql_database=...)\r\n    at ../src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp:365\r\n#8  0x0000000015d5623f in DB::MySQLInterpreter::InterpreterMySQLDDLQuery<DB::MySQLInterpreter::InterpreterCreateImpl>::execute (this=0x7f67f7dec7b0)\r\n    at ../src/Interpreters/MySQL/InterpretersMySQLDDLQuery.h:68\r\n#9  0x0000000015d53782 in DB::InterpreterExternalDDLQuery::execute (this=0x7f6809971c40) at ../src/Interpreters/InterpreterExternalDDLQuery.cpp:64\r\n#10 0x000000001427afc6 in DB::executeQueryImpl (\r\n    begin=0x7f6809893600 \"/*Materialize MySQL step 1: execute MySQL DDL for dump data*/ EXTERNAL DDL FROM MySQL(ch23, ch23)  CREATE TABLE `test1` (\\n  `code` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,\\n  `name` v\"..., end=0x7f68098937ff \"\", context=..., internal=true, stage=DB::QueryProcessingStage::Complete, \r\n    has_query_tail=true, istr=0x0) at ../src/Interpreters/executeQuery.cpp:422\r\n#11 0x000000001427ece1 in DB::executeQuery (query=..., context=..., internal=true, stage=DB::QueryProcessingStage::Complete, may_have_embedded_data=false)\r\n    at ../src/Interpreters/executeQuery.cpp:718\r\n#12 0x0000000015796c28 in DB::tryToExecuteQuery (query_to_execute=..., query_context=..., database=..., comment=...)\r\n    at ../src/Databases/MySQL/MaterializeMySQLSyncThread.cpp:62\r\n#13 0x000000001579f9d6 in DB::dumpDataForTables(mysqlxx::Pool::Entry &, DB::MaterializeMetadata &, const DB::String &, const DB::String &, const DB::String &, const DB::Context &, const std::__1::function<bool()> &) (connection=..., master_info=..., query_prefix=..., database_name=..., mysql_database_name=..., context=..., is_cancelled=...)\r\n    at ../src/Databases/MySQL/MaterializeMySQLSyncThread.cpp:277\r\n#14 0x00000000157a2737 in DB::MaterializeMySQLSyncThread::<lambda()>::operator()(void) const (__closure=0x7f67f7df4028)\r\n    at ../src/Databases/MySQL/MaterializeMySQLSyncThread.cpp:327\r\n#15 0x00000000157b7f99 in std::__1::__invoke<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()>&> (__f=...)\r\n    at ../contrib/libcxx/include/type_traits:3519\r\n#16 std::__1::__invoke_void_return_wrapper<void>::__call<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()>&>(void) ()\r\n\r\n\r\n\r\n\r\n\r\nstack of version 20.12.3.3\r\n@\r\nCannot access memory at address 0x7f6a12d5e128\r\nCannot access memory at address 0x7f6a12d5e120\r\nFailed to read a valid object file image from memory.\r\nCore was generated by `./clickhouse-server'.\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  0x00000000098a60e8 in std::__1::shared_ptr<DB::IAST>::shared_ptr (__r=..., \r\n    this=0xac1e080 <llvm::Pass* llvm::callDefaultCtor<(anonymous namespace)::InterleavedLoadCombine>()+128>) at ../contrib/libcxx/include/new:220\r\n220\t../contrib/libcxx/include/new: No such file or directory.\r\n[Current thread is 1 (LWP 44708)]\r\n(gdb) bt\r\n#0  0x00000000098a60e8 in std::__1::shared_ptr<DB::IAST>::shared_ptr (__r=..., \r\n    this=0xac1e080 <llvm::Pass* llvm::callDefaultCtor<(anonymous namespace)::InterleavedLoadCombine>()+128>) at ../contrib/libcxx/include/new:220\r\n#1  std::__1::allocator<std::__1::shared_ptr<DB::IAST> >::construct<std::__1::shared_ptr<DB::IAST>, std::__1::shared_ptr<DB::IAST>&> (\r\n    __p=0xac1e080 <llvm::Pass* llvm::callDefaultCtor<(anonymous namespace)::InterleavedLoadCombine>()+128>, this=0x7f689ae15090) at ../contrib/libcxx/include/memory:1876\r\n#2  std::__1::allocator_traits<std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::__construct<std::__1::shared_ptr<DB::IAST>, std::__1::shared_ptr<DB::IAST>&> (\r\n    __p=0xac1e080 <llvm::Pass* llvm::callDefaultCtor<(anonymous namespace)::InterleavedLoadCombine>()+128>, __a=...) at ../contrib/libcxx/include/memory:1768\r\n#3  std::__1::allocator_traits<std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::construct<std::__1::shared_ptr<DB::IAST>, std::__1::shared_ptr<DB::IAST>&> (\r\n    __p=0xac1e080 <llvm::Pass* llvm::callDefaultCtor<(anonymous namespace)::InterleavedLoadCombine>()+128>, __a=...) at ../contrib/libcxx/include/memory:1595\r\n#4  std::__1::__split_buffer<std::__1::shared_ptr<DB::IAST>, std::__1::allocator<std::__1::shared_ptr<DB::IAST> >&>::__construct_at_end<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> > (__last=..., __first=..., this=0x7f6891bf4de0) at ../contrib/libcxx/include/__split_buffer:275\r\n#5  std::__1::vector<std::__1::shared_ptr<DB::IAST>, std::__1::allocator<std::__1::shared_ptr<DB::IAST> > >::insert<std::__1::__wrap_iter<std::__1::shared_ptr<DB::IAST>*> > (this=0x7f689ae15080, __position=..., __first=..., __last=...) at ../contrib/libcxx/include/vector:2009\r\n#6  0x000000000989e4f8 in DB::MySQLInterpreter::getKeys (columns_define=0x7f6a113018b8, indices_define=<optimized out>, context=..., columns=...)\r\n    at ../src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp:176\r\n#7  0x00000000098a09c4 in DB::MySQLInterpreter::InterpreterCreateImpl::getRewrittenQueries (create_query=..., context=..., mapped_to_database=..., mysql_database=...)\r\n    at ../src/Interpreters/MySQL/InterpretersMySQLDDLQuery.cpp:365\r\n#8  0x0000000009833d85 in DB::MySQLInterpreter::InterpreterMySQLDDLQuery<DB::MySQLInterpreter::InterpreterCreateImpl>::execute (this=0x7f6891bf5320)\r\n    at ../contrib/libcxx/include/memory:3474\r\n#9  DB::InterpreterExternalDDLQuery::execute (this=<optimized out>) at ../src/Interpreters/InterpreterExternalDDLQuery.cpp:64\r\n#10 0x0000000008eb3a63 in DB::executeQueryImpl (begin=<optimized out>, end=<optimized out>, context=..., internal=<optimized out>, \r\n    stage=DB::QueryProcessingStage::Complete, has_query_tail=true, istr=0x0) at ../src/Interpreters/executeQuery.cpp:482\r\n#11 0x0000000008eb595e in DB::executeQuery (query=..., context=..., internal=internal@entry=true, stage=stage@entry=DB::QueryProcessingStage::Complete, \r\n    may_have_embedded_data=may_have_embedded_data@entry=false) at ../src/Interpreters/executeQuery.cpp:813\r\n#12 0x0000000009682381 in DB::tryToExecuteQuery (query_to_execute=..., query_context=..., database=..., comment=...) at ../contrib/libcxx/include/string:1526\r\n#13 0x000000000968d41d in DB::dumpDataForTables(mysqlxx::Pool::Entry &, DB::MaterializeMetadata &, const DB::String &, const DB::String &, const DB::String &, const DB::Context &, const std::__1::function<bool()> &) (connection=..., master_info=..., query_prefix=..., database_name=..., mysql_database_name=..., context=..., is_cancelled=...)\r\n    at ../contrib/libcxx/include/string:1526\r\n#14 0x000000000968eaa0 in operator() (__closure=<optimized out>) at ../contrib/libcxx/include/new:220\r\n#15 std::__1::__invoke<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()>&> (__f=...) at ../contrib/libcxx/include/type_traits:3519\r\n#16 std::__1::__invoke_void_return_wrapper<void>::__call<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()>&> ()\r\n    at ../contrib/libcxx/include/__functional_base:348\r\n#17 std::__1::__function::__alloc_func<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()>, std::__1::allocator<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()> >, void()>::operator() (this=<optimized out>) at ../contrib/libcxx/include/functional:1540\r\n#18 std::__1::__function::__func<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()>, std::__1::allocator<DB::MaterializeMySQLSyncThread::prepareSynchronized(const String&)::<lambda()> >, void()>::operator()(void) (this=<optimized out>) at ../contrib/libcxx/include/functional:1714\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n#19 0x0000000009ac0275 in std::__1::__function::__value_func<void ()>::operator()() const (this=<optimized out>) at ../src/Databases/MySQL/MaterializeMetadata.cpp:197\r\n#20 std::__1::function<void ()>::operator()() const (this=<optimized out>) at ../contrib/libcxx/include/functional:2473\r\n#21 DB::commitMetadata(std::__1::function<void ()> const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) (function=..., persistent_tmp_path=..., persistent_path=...)\r\n    at ../src/Databases/MySQL/MaterializeMetadata.cpp:197\r\n#22 0x0000000009ac269e in DB::MaterializeMetadata::transaction(DB::MySQLReplication::Position const&, std::__1::function<void ()> const&) (this=this@entry=0x7f6891bf85c0, \r\n    position=..., fun=...) at ../src/Databases/MySQL/MaterializeMetadata.cpp:231\r\n#23 0x0000000009683bf5 in DB::MaterializeMySQLSyncThread::prepareSynchronized (this=0x7f68925d5ca8, mysql_version=...) at ../contrib/libcxx/include/new:220\r\n#24 0x000000000968b834 in DB::MaterializeMySQLSyncThread::synchronization (this=0x7f68925d5ca8, mysql_version=...)\r\n    at ../src/Databases/MySQL/MaterializeMySQLSyncThread.cpp:169\r\n#25 0x000000000968bd8b in operator() (__closure=0x7f6891bf9c20) at ../src/Databases/MySQL/MaterializeMySQLSyncThread.cpp:223\r\n#26 std::__1::__invoke_constexpr<DB::MaterializeMySQLSyncThread::startSynchronization()::<lambda()>&> (__f=...) at ../contrib/libcxx/include/type_traits:3525\r\n#27 std::__1::__apply_tuple_impl<DB::MaterializeMySQLSyncThread::startSynchronization()::<lambda()>&, std::__1::tuple<>&> (__t=<synthetic pointer>..., __f=...)\r\n    at ../contrib/libcxx/include/tuple:1415\r\n#28 std::__1::apply<DB::MaterializeMySQLSyncThread::startSynchronization()::<lambda()>&, std::__1::tuple<>&> (__t=<synthetic pointer>..., __f=...)\r\n    at ../contrib/libcxx/include/tuple:1424\r\n#29 operator() (this=<optimized out>) at ../src/Common/ThreadPool.h:178\r\n#30 0x00000000039e7425 in std::__1::__function::__value_func<void ()>::operator()() const (this=0x7f6891bf9e90) at ../contrib/libcxx/include/atomic:676\r\n#31 std::__1::function<void ()>::operator()() const (this=0x7f6891bf9e90) at ../contrib/libcxx/include/functional:2473\r\n#32 ThreadPoolImpl<std::__1::thread>::worker (this=0x7f6a1122e700, thread_it=...) at ../src/Common/ThreadPool.cpp:236\r\n\r\n**Additional context**\r\nIf I remove the 'UNIQUE' and it works fine. \r\n\r\n\r\n@zhang2014  Please take a look when you are free.\n",
  "hints_text": "Try to build the newest version?\n> \r\n> \r\n> Try to build the newest version?\r\n\r\nUpgrade to version 20.11.2.1 (official build) still has this error.\nCould you  provide you table structure under the mysql database\uff1f\n> \r\n> \r\n> Could you provide you table structure under the mysql database\uff1f\r\n\r\nOver 70 tables, and I don't know which one's causing the problems.\n> > Could you provide you table structure under the mysql database\uff1f\r\n> \r\n> Over 70 tables, and I don't know which one's causing the problems.\r\n\r\nI think you can use information_schema to verify which type of cols under the table.\r\n\r\ne.g.\r\n\r\n```\r\nroot@mysqldb 17:27:36 [information_schema]> select COLUMN_TYPE, COLUMN_KEY from COLUMNS where TABLE_SCHEMA='test_database';\r\n+-------------+------------+\r\n| COLUMN_TYPE | COLUMN_KEY |\r\n+-------------+------------+\r\n| int(11)     | PRI        |\r\n| int(11)     | PRI        |\r\n| varchar(20) |            |\r\n+-------------+------------+\r\n3 rows in set (0.00 sec)\r\n\r\n```\r\n\r\n\r\n\n```\r\n+------------------------+------------+\r\n| COLUMN_TYPE            | COLUMN_KEY |\r\n+------------------------+------------+\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| tinyint(4)             |            |\r\n| decimal(10,2) unsigned |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| tinyint(4) unsigned    |            |\r\n| tinyint(4) unsigned    |            |\r\n| varchar(128)           | UNI        |\r\n| tinyint(4)             |            |\r\n| datetime               | MUL        |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| int(10) unsigned       |            |\r\n| int(10) unsigned       |            |\r\n| int(10) unsigned       |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | UNI        |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| smallint(6)            |            |\r\n| bigint(20) unsigned    |            |\r\n| int(10) unsigned       |            |\r\n| int(10) unsigned       |            |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| text                   |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| varchar(255)           |            |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| bigint(20)             | MUL        |\r\n| varchar(32)            |            |\r\n| bigint(20)             |            |\r\n| int(4)                 |            |\r\n| varchar(128)           | UNI        |\r\n| int(4)                 |            |\r\n| int(10)                |            |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| int(10)                |            |\r\n| int(10)                |            |\r\n| datetime               | MUL        |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(64)            |            |\r\n| int(10)                |            |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| tinyint(4)             |            |\r\n| int(11)                |            |\r\n| int(4)                 |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| decimal(10,2)          |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| decimal(10,2)          |            |\r\n| int(10)                |            |\r\n| int(10)                |            |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| datetime               |            |\r\n| int(4)                 |            |\r\n| varchar(128)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| int(4)                 |            |\r\n| decimal(10,4)          |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| smallint(5)            |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             |            |\r\n| bigint(20)             |            |\r\n| int(11)                |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             |            |\r\n| int(11)                |            |\r\n| tinyint(4) unsigned    |            |\r\n| text                   |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| tinyint(4)             |            |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    |            |\r\n| text                   |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| int(11)                | MUL        |\r\n| smallint(6)            |            |\r\n| decimal(24,6)          |            |\r\n| decimal(24,6)          |            |\r\n| decimal(24,6)          |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| bigint(20)             |            |\r\n| int(11)                |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| int(11)                |            |\r\n| int(11)                |            |\r\n| int(11)                |            |\r\n| int(11)                |            |\r\n| int(11)                |            |\r\n| decimal(5,1)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| int(11)                |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(128)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| varchar(128)           |            |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             |            |\r\n| varchar(255)           |            |\r\n| varchar(128)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20)             | PRI        |\r\n| bigint(20)             | MUL        |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| text                   |            |\r\n| int(11)                |            |\r\n| int(11) unsigned       |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20)             | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(100)           |            |\r\n| int(11) unsigned       |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20)             | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             |            |\r\n| bigint(20)             |            |\r\n| datetime               |            |\r\n| bigint(20)             | PRI        |\r\n| bigint(20)             | MUL        |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| int(11)                |            |\r\n| int(11)                |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| int(11)                |            |\r\n| int(11)                |            |\r\n| smallint(6)            | MUL        |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20)             | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(128)           | UNI        |\r\n| text                   |            |\r\n| tinyint(4)             |            |\r\n| text                   |            |\r\n| datetime               | MUL        |\r\n| smallint(6)            |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| tinyint(3) unsigned    |            |\r\n| varchar(64)            |            |\r\n| tinyint(3) unsigned    |            |\r\n| int(10) unsigned       |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | UNI        |\r\n| varchar(128)           |            |\r\n| bigint(20)             |            |\r\n| varchar(255)           |            |\r\n| varchar(128)           |            |\r\n| text                   |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| int(10) unsigned       |            |\r\n| int(10) unsigned       |            |\r\n| varchar(30)            |            |\r\n| tinyint(3) unsigned    |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(128)           | MUL        |\r\n| varchar(128)           | UNI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | MUL        |\r\n| varchar(50)            |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| smallint(6)            |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| decimal(20,4)          |            |\r\n| tinyint(3) unsigned    |            |\r\n| tinyint(3) unsigned    |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| smallint(6)            |            |\r\n| varchar(1024)          |            |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| varchar(128)           | MUL        |\r\n| bigint(19) unsigned    | PRI        |\r\n| varchar(50)            |            |\r\n| text                   |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             | MUL        |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| text                   |            |\r\n| tinyint(4)             | MUL        |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| varchar(255)           |            |\r\n| smallint(5) unsigned   |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(32)            | UNI        |\r\n| varchar(32)            |            |\r\n| int(4)                 |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| bigint(20)             |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| int(4)                 |            |\r\n| int(10)                |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| decimal(10,4)          |            |\r\n| int(4)                 |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(64)            | UNI        |\r\n| decimal(10,4)          |            |\r\n| int(4)                 |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| varchar(64)            | MUL        |\r\n| bigint(20)             |            |\r\n| int(4)                 |            |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| varchar(64)            |            |\r\n| varchar(64)            |            |\r\n| int(4)                 |            |\r\n| int(4)                 |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| varchar(128)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| int(4)                 |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,4)          |            |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| int(4)                 |            |\r\n| decimal(10,4)          |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | UNI        |\r\n| bigint(20) unsigned    |            |\r\n| varchar(50)            | MUL        |\r\n| tinyint(3) unsigned    |            |\r\n| text                   |            |\r\n| int(10) unsigned       |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(255)           |            |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| datetime               |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(64)            | MUL        |\r\n| varchar(128)           | UNI        |\r\n| int(10)                |            |\r\n| varchar(128)           |            |\r\n| varchar(256)           |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| int(4)                 |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| int(10) unsigned       |            |\r\n| decimal(20,2)          |            |\r\n| int(4)                 |            |\r\n| int(4)                 |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| bigint(20)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| tinyint(4)             |            |\r\n| int(10) unsigned       |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(20)            | MUL        |\r\n| tinyint(4)             |            |\r\n| varchar(255)           |            |\r\n| tinyint(1)             |            |\r\n| varchar(255)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(50)            |            |\r\n| varchar(50)            | MUL        |\r\n| tinyint(3) unsigned    |            |\r\n| smallint(5) unsigned   |            |\r\n| tinyint(3) unsigned    |            |\r\n| tinyint(3) unsigned    |            |\r\n| datetime               |            |\r\n| text                   |            |\r\n| varchar(100)           | UNI        |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| smallint(6)            |            |\r\n| tinyint(4)             |            |\r\n| smallint(6)            |            |\r\n| bigint(20)             |            |\r\n| decimal(24,6)          |            |\r\n| decimal(24,6)          |            |\r\n| varchar(128)           | UNI        |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | UNI        |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| varchar(1024)          |            |\r\n| bigint(20)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| tinyint(1) unsigned    |            |\r\n| datetime               |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | MUL        |\r\n| int(10) unsigned       |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| int(10)                |            |\r\n| bigint(20)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | UNI        |\r\n| int(11) unsigned       |            |\r\n| int(11)                |            |\r\n| int(11) unsigned       |            |\r\n| varchar(200)           |            |\r\n| varchar(2000)          |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    |            |\r\n| smallint(6)            |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(100)           | UNI        |\r\n| tinyint(4)             |            |\r\n| tinyint(2)             |            |\r\n| decimal(20,4)          |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    |            |\r\n| varchar(64)            | UNI        |\r\n| varchar(500)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | MUL        |\r\n| tinyint(4)             | MUL        |\r\n| decimal(20,4)          |            |\r\n| tinyint(4) unsigned    |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(19) unsigned    | PRI        |\r\n| bigint(19) unsigned    | MUL        |\r\n| bigint(19) unsigned    | MUL        |\r\n| tinyint(4)             |            |\r\n| bigint(20)             |            |\r\n| tinyint(4)             | MUL        |\r\n| tinyint(4)             | MUL        |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| int(4)                 |            |\r\n| varchar(128)           | UNI        |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| varchar(128)           | MUL        |\r\n| int(4)                 |            |\r\n| int(4)                 |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| varchar(1024)          |            |\r\n| varchar(255)           |            |\r\n| varchar(32)            |            |\r\n| varchar(255)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | UNI        |\r\n| varchar(64)            | UNI        |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | UNI        |\r\n| varchar(100)           |            |\r\n| varchar(128)           | UNI        |\r\n| date                   |            |\r\n| varchar(50)            |            |\r\n| tinyint(4)             |            |\r\n| varchar(255)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| tinyint(3) unsigned    |            |\r\n| tinyint(3) unsigned    |            |\r\n| int(10) unsigned       |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | UNI        |\r\n| varchar(64)            |            |\r\n| varchar(64)            |            |\r\n| varchar(128)           |            |\r\n| varchar(255)           |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| varchar(128)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| decimal(20,4)          |            |\r\n| varchar(64)            | UNI        |\r\n| bigint(20)             |            |\r\n| tinyint(4)             |            |\r\n| tinyint(4)             |            |\r\n| varchar(512)           |            |\r\n| varchar(255)           |            |\r\n| datetime               |            |\r\n| int(4)                 |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| varchar(32)            |            |\r\n| int(11)                |            |\r\n| varchar(20)            | MUL        |\r\n| varchar(30)            |            |\r\n| varchar(32)            |            |\r\n| tinyint(1) unsigned    |            |\r\n| bigint(20) unsigned    | MUL        |\r\n| bigint(20) unsigned    | MUL        |\r\n| varchar(64)            | UNI        |\r\n| int(11) unsigned       |            |\r\n| int(11) unsigned       |            |\r\n| varchar(64)            |            |\r\n| varchar(64)            | MUL        |\r\n| varchar(64)            | UNI        |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| tinyint(1) unsigned    |            |\r\n| tinyint(1) unsigned    |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| tinyint(1) unsigned    |            |\r\n| datetime               |            |\r\n| varchar(2000)          |            |\r\n| int(4)                 |            |\r\n| varchar(128)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| varchar(255)           |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| int(4)                 |            |\r\n| int(4)                 |            |\r\n| varchar(64)            |            |\r\n| varchar(64)            | UNI        |\r\n| varchar(32)            |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               | MUL        |\r\n| bigint(20)             | MUL        |\r\n| varchar(255)           |            |\r\n| varchar(64)            |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20)             | MUL        |\r\n| smallint(6)            |            |\r\n| decimal(24,6)          |            |\r\n| tinyint(4)             |            |\r\n| datetime               |            |\r\n| datetime               |            |\r\n+------------------------+------------+\r\n772 rows in set (0.67 sec)\r\n\r\n```\nDISTINCT records\r\n\r\n```\r\nmysql> select DISTINCT COLUMN_TYPE, COLUMN_KEY from COLUMNS where TABLE_SCHEMA='xxx';\r\n+------------------------+------------+\r\n| COLUMN_TYPE            | COLUMN_KEY |\r\n+------------------------+------------+\r\n| bigint(20) unsigned    | PRI        |\r\n| bigint(20) unsigned    | MUL        |\r\n| tinyint(4)             |            |\r\n| decimal(10,2) unsigned |            |\r\n| datetime               |            |\r\n| tinyint(4) unsigned    |            |\r\n| varchar(128)           | UNI        |\r\n| datetime               | MUL        |\r\n| smallint(6)            |            |\r\n| varchar(255)           |            |\r\n| text                   |            |\r\n| int(10) unsigned       |            |\r\n| bigint(20) unsigned    | UNI        |\r\n| bigint(20) unsigned    |            |\r\n| bigint(20)             |            |\r\n| bigint(20)             | MUL        |\r\n| int(10)                |            |\r\n| decimal(10,4)          |            |\r\n| decimal(10,2)          |            |\r\n| varchar(32)            |            |\r\n| int(4)                 |            |\r\n| varchar(64)            |            |\r\n| int(11)                |            |\r\n| varchar(128)           |            |\r\n| smallint(5)            |            |\r\n| int(11)                | MUL        |\r\n| decimal(24,6)          |            |\r\n| decimal(5,1)           |            |\r\n| bigint(20)             | PRI        |\r\n| int(11) unsigned       |            |\r\n| varchar(100)           |            |\r\n| smallint(6)            | MUL        |\r\n| tinyint(3) unsigned    |            |\r\n| bigint(20)             | UNI        |\r\n| varchar(30)            |            |\r\n| varchar(128)           | MUL        |\r\n| varchar(50)            |            |\r\n| decimal(20,4)          |            |\r\n| varchar(1024)          |            |\r\n| bigint(19) unsigned    | PRI        |\r\n| tinyint(4)             | MUL        |\r\n| smallint(5) unsigned   |            |\r\n| varchar(32)            | UNI        |\r\n| varchar(64)            | UNI        |\r\n| varchar(64)            | MUL        |\r\n| varchar(50)            | MUL        |\r\n| varchar(256)           |            |\r\n| decimal(20,2)          |            |\r\n| varchar(20)            | MUL        |\r\n| tinyint(1)             |            |\r\n| varchar(100)           | UNI        |\r\n| tinyint(1) unsigned    |            |\r\n| varchar(200)           |            |\r\n| varchar(2000)          |            |\r\n| tinyint(2)             |            |\r\n| varchar(500)           |            |\r\n| bigint(19) unsigned    | MUL        |\r\n| date                   |            |\r\n| varchar(512)           |            |\r\n+------------------------+------------+\r\n59 rows in set (0.20 sec)\r\n```\nLooks similar to #16372",
  "created_at": "2020-12-18T04:06:15Z"
}