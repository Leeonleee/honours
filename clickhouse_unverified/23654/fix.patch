diff --git a/src/AggregateFunctions/StatCommon.h b/src/AggregateFunctions/StatCommon.h
index ba887567ad80..dc94a6b6e77b 100644
--- a/src/AggregateFunctions/StatCommon.h
+++ b/src/AggregateFunctions/StatCommon.h
@@ -11,6 +11,11 @@
 namespace DB
 {
 
+namespace ErrorCodes
+{
+    extern const int BAD_ARGUMENTS;
+}
+
 template <typename F>
 static Float64 integrateSimpson(Float64 a, Float64 b, F && func)
 {
@@ -48,6 +53,11 @@ std::pair<RanksArray, Float64> computeRanksAndTieCorrection(const Values & value
             ++right;
         auto adjusted = (left + right + 1.) / 2.;
         auto count_equal = right - left;
+
+        /// Scipy implementation throws exception in this case too.
+        if (count_equal == size)
+            throw Exception("All numbers in both samples are identical", ErrorCodes::BAD_ARGUMENTS);
+
         tie_numenator += std::pow(count_equal, 3) - count_equal;
         for (size_t iter = left; iter < right; ++iter)
             out[indexes[iter]] = adjusted;
