{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 41588,
  "instance_id": "ClickHouse__ClickHouse-41588",
  "issue_numbers": [
    "41383"
  ],
  "base_commit": "14b256f64d210a60971175cd9590c37e12f16643",
  "patch": "diff --git a/src/Processors/OffsetTransform.cpp b/src/Processors/OffsetTransform.cpp\nindex 0b2fb0a5cc40..40a0833ffb4a 100644\n--- a/src/Processors/OffsetTransform.cpp\n+++ b/src/Processors/OffsetTransform.cpp\n@@ -96,13 +96,14 @@ OffsetTransform::Status OffsetTransform::preparePair(PortsData & data)\n     auto & input = *data.input_port;\n \n     /// Check can output.\n-    bool output_finished = false;\n+\n     if (output.isFinished())\n     {\n-        output_finished = true;\n+        input.close();\n+        return Status::Finished;\n     }\n \n-    if (!output_finished && !output.canPush())\n+    if (!output.canPush())\n     {\n         input.setNotNeeded();\n         return Status::PortFull;\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02429_offset_pipeline_stuck_bug.reference b/tests/queries/0_stateless/02429_offset_pipeline_stuck_bug.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/02429_offset_pipeline_stuck_bug.sql b/tests/queries/0_stateless/02429_offset_pipeline_stuck_bug.sql\nnew file mode 100644\nindex 000000000000..59365ca5bd58\n--- /dev/null\n+++ b/tests/queries/0_stateless/02429_offset_pipeline_stuck_bug.sql\n@@ -0,0 +1,4 @@\n+CREATE TABLE t ENGINE = Log AS SELECT * FROM system.numbers LIMIT 20;\n+SET enable_optimize_predicate_expression = 0;\n+SELECT number FROM (select number FROM t ORDER BY number OFFSET 3) WHERE number < NULL;\n+\n",
  "problem_statement": "Logical error: Pipeline stuck \nhttps://pastila.nl/?001ae728/52bc538966a011139c5dac06472b22f6\n",
  "hints_text": "",
  "created_at": "2022-09-20T15:01:44Z"
}