{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 42072,
  "instance_id": "ClickHouse__ClickHouse-42072",
  "issue_numbers": [
    "40099"
  ],
  "base_commit": "2933a28a5de3c8b0aa4b4da4ddd2d95d897750e3",
  "patch": "diff --git a/src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp b/src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp\nindex a1ccd465128f..3dd0568107e5 100644\n--- a/src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp\n+++ b/src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp\n@@ -542,7 +542,10 @@ bool MergeTreeIndexConditionBloomFilter::traverseASTEquals(\n             {\n                 out.function = RPNElement::FUNCTION_HAS;\n                 const DataTypePtr actual_type = BloomFilter::getPrimitiveType(array_type->getNestedType());\n-                Field converted_field = convertFieldToType(value_field, *actual_type, value_type.get());\n+                auto converted_field = convertFieldToType(value_field, *actual_type, value_type.get());\n+                if (converted_field.isNull())\n+                    return false;\n+\n                 out.predicate.emplace_back(std::make_pair(position, BloomFilterHash::hashWithField(actual_type.get(), converted_field)));\n             }\n         }\n@@ -565,7 +568,11 @@ bool MergeTreeIndexConditionBloomFilter::traverseASTEquals(\n                     if ((f.isNull() && !is_nullable) || f.isDecimal(f.getType()))\n                         return false;\n \n-                    mutable_column->insert(convertFieldToType(f, *actual_type, value_type.get()));\n+                    auto converted = convertFieldToType(f, *actual_type);\n+                    if (converted.isNull())\n+                        return false;\n+\n+                    mutable_column->insert(converted);\n                 }\n \n                 column = std::move(mutable_column);\n@@ -583,7 +590,10 @@ bool MergeTreeIndexConditionBloomFilter::traverseASTEquals(\n \n             out.function = function_name == \"equals\" ? RPNElement::FUNCTION_EQUALS : RPNElement::FUNCTION_NOT_EQUALS;\n             const DataTypePtr actual_type = BloomFilter::getPrimitiveType(index_type);\n-            Field converted_field = convertFieldToType(value_field, *actual_type, value_type.get());\n+            auto converted_field = convertFieldToType(value_field, *actual_type, value_type.get());\n+            if (converted_field.isNull())\n+                return false;\n+\n             out.predicate.emplace_back(std::make_pair(position, BloomFilterHash::hashWithField(actual_type.get(), converted_field)));\n         }\n \n@@ -611,9 +621,11 @@ bool MergeTreeIndexConditionBloomFilter::traverseASTEquals(\n \n         out.function = RPNElement::FUNCTION_HAS;\n         const DataTypePtr actual_type = BloomFilter::getPrimitiveType(array_type->getNestedType());\n-        Field converted_field = convertFieldToType(value_field, *actual_type, value_type.get());\n-        out.predicate.emplace_back(std::make_pair(position, BloomFilterHash::hashWithField(actual_type.get(), converted_field)));\n+        auto converted_field = convertFieldToType(value_field, *actual_type, value_type.get());\n+        if (converted_field.isNull())\n+            return false;\n \n+        out.predicate.emplace_back(std::make_pair(position, BloomFilterHash::hashWithField(actual_type.get(), converted_field)));\n         return true;\n     }\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02456_bloom_filter_assert.reference b/tests/queries/0_stateless/02456_bloom_filter_assert.reference\nnew file mode 100644\nindex 000000000000..a21090781f33\n--- /dev/null\n+++ b/tests/queries/0_stateless/02456_bloom_filter_assert.reference\n@@ -0,0 +1,7 @@\n+0\n+0\n+0\n+0\n+0\n+0\n+0\ndiff --git a/tests/queries/0_stateless/02456_bloom_filter_assert.sql.j2 b/tests/queries/0_stateless/02456_bloom_filter_assert.sql.j2\nnew file mode 100644\nindex 000000000000..8322d3d29e76\n--- /dev/null\n+++ b/tests/queries/0_stateless/02456_bloom_filter_assert.sql.j2\n@@ -0,0 +1,28 @@\n+{% for type in [\"Int8\", \"Int16\", \"Int32\", \"Int64\", 'UInt8', 'UInt16', 'UInt32'] -%}\n+\n+DROP TABLE IF EXISTS bftest__fuzz_21;\n+\n+CREATE TABLE bftest__fuzz_21\n+(\n+    `k` Int64,\n+    `x` Array({{ type }}),\n+    INDEX ix1 x TYPE bloom_filter GRANULARITY 3\n+)\n+ENGINE = MergeTree\n+ORDER BY k;\n+\n+INSERT INTO bftest__fuzz_21 (k, x) SELECT\n+    number,\n+    arrayMap(i -> (rand64() % 565656), range(10))\n+FROM numbers(1000);\n+\n+{% if 'UInt' in type -%}\n+    SELECT count() FROM bftest__fuzz_21 WHERE hasAll(x, [42, -42]) SETTINGS use_skip_indexes=1;\n+    SELECT count() FROM bftest__fuzz_21 WHERE hasAll(x, [42, -42]) SETTINGS use_skip_indexes=1, force_data_skipping_indices='ix1'; -- { serverError INDEX_NOT_USED }\n+{% else -%}\n+    SELECT count() FROM bftest__fuzz_21 WHERE hasAll(x, [42, -42]) SETTINGS use_skip_indexes=1, force_data_skipping_indices='ix1';\n+{% endif -%}\n+\n+DROP TABLE IF EXISTS bftest__fuzz_21;\n+\n+{% endfor -%}\n",
  "problem_statement": "Logical error: 'Invalid Field get from type Null to type UInt64' in bloom filter\n\r\n**How to reproduce**\r\n```sql\r\nSET allow_suspicious_low_cardinality_types = 1;\r\n\r\nDROP TABLE IF EXISTS bftest__fuzz_21;\r\n\r\nCREATE TABLE bftest__fuzz_21\r\n(\r\n    `k` LowCardinality(Int8),\r\n    `y` Array(Int8) DEFAULT x,\r\n    `x` Array(UInt8),\r\n    INDEX ix1 x TYPE bloom_filter GRANULARITY 3\r\n)\r\nENGINE = MergeTree\r\nORDER BY k;\r\n\r\nINSERT INTO bftest__fuzz_21 (k, x) SELECT\r\n    number,\r\n    arrayMap(i -> (rand64() % 565656), range(10))\r\nFROM numbers(1000);\r\n\r\nSELECT count() FROM bftest__fuzz_21 WHERE hasAll(x, [42, -42]);\r\n```\r\n\r\n```\r\n2022.08.11 03:12:06.528850 [ 2541331 ] {5b6b953a-d88f-4816-800f-6af5cd95421c} <Fatal> : Logical error: 'Invalid Field get from type Null to type UInt64'.\r\n2022.08.11 03:12:06.529685 [ 2541328 ] {} <Trace> BaseDaemon: Received signal 6\r\n2022.08.11 03:12:06.530359 [ 2541616 ] {} <Fatal> BaseDaemon: ########################################\r\n2022.08.11 03:12:06.530660 [ 2541616 ] {} <Fatal> BaseDaemon: (version 22.8.1.1 (official build), build id: B7F0FF29F1059780) (from thread 2541331) (query_id: 5b6b953a-d88f-4816-800f-6af5cd95421c) (query: SELECT count() FROM bftest__fuzz_21 WHERE hasAll(x, [42, -42]);) Received signal Aborted (6)\r\n2022.08.11 03:12:06.530880 [ 2541616 ] {} <Fatal> BaseDaemon:\r\n2022.08.11 03:12:06.531124 [ 2541616 ] {} <Fatal> BaseDaemon: Stack trace: 0x7f8966b5a03b 0x7f8966b39859 0x17168fb6 0x17169075 0x17169125 0x1731132e 0x19403166 0x1b6eb7bd 0x263ff035 0x27a85945 0x284a1ccf 0x284a0e07 0x284a09d3 0x284a5938 0x284a58b6 0x284a5851 0x284a57cc 0x284a5754 0x284cbe7a 0x284cacb0 0x284ca910 0x284a5c94 0x2849f834 0x28497193 0x28496ef0 0x28496b5f 0x28496946 0x2849494d 0x28493998 0x2842efab 0x28fdb572 0x28fda0cf 0x28fdbd8d 0x28fdbf3b 0x28f95695 0x28fbc000 0x273a22b1 0x277fbb17 0x277f8344 0x288d1d66 0x288e1c25\r\n2022.08.11 03:12:06.531378 [ 2541616 ] {} <Fatal> BaseDaemon: 4. raise in ?\r\n2022.08.11 03:12:06.531488 [ 2541616 ] {} <Fatal> BaseDaemon: 5. abort in ?\r\n2022.08.11 03:12:06.624359 [ 2541616 ] {} <Fatal> BaseDaemon: 6. /build/build_docker/../src/Common/Exception.cpp:40: DB::abortOnFailedAssertion(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:06.716830 [ 2541616 ] {} <Fatal> BaseDaemon: 7. /build/build_docker/../src/Common/Exception.cpp:63: DB::handle_error_code(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int, bool, std::__1::vector<void*, std::__1::allocator<void*> > const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:06.794950 [ 2541616 ] {} <Fatal> BaseDaemon: 8. /build/build_docker/../src/Common/Exception.cpp:70: DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int, bool) in /usr/bin/clickhouse\r\n2022.08.11 03:12:08.451962 [ 2541616 ] {} <Fatal> BaseDaemon: 10. /build/build_docker/../src/Core/Field.h:838: DB::NearestFieldTypeImpl<std::__1::decay<char8_t>::type, void>::Type& DB::Field::get<char8_t>() in /usr/bin/clickhouse\r\n2022.08.11 03:12:09.000280 [ 2541468 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 1.40 GiB, peak 1.40 GiB, will set to 1.43 GiB (RSS), difference: 36.82 MiB\r\n2022.08.11 03:12:09.161333 [ 2541616 ] {} <Fatal> BaseDaemon: 11. /build/build_docker/../src/Core/Field.h:429: auto const& DB::Field::get<char8_t>() const in /usr/bin/clickhouse\r\n2022.08.11 03:12:09.299471 [ 2541616 ] {} <Fatal> BaseDaemon: 12. /build/build_docker/../src/Core/Field.h:888: char8_t DB::get<char8_t>(DB::Field const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:09.669271 [ 2541616 ] {} <Fatal> BaseDaemon: 13. /build/build_docker/../src/Columns/ColumnVector.h:304: DB::ColumnVector<char8_t>::insert(DB::Field const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:09.897558 [ 2541616 ] {} <Fatal> BaseDaemon: 14. /build/build_docker/../src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp:558: DB::MergeTreeIndexConditionBloomFilter::traverseASTEquals(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::IDataType const> const&, DB::Field const&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&, std::__1::shared_ptr<DB::IAST> const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:10.000262 [ 2541468 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 1.43 GiB, peak 1.43 GiB, will set to 1.53 GiB (RSS), difference: 93.09 MiB\r\n2022.08.11 03:12:10.122826 [ 2541616 ] {} <Fatal> BaseDaemon: 15. /build/build_docker/../src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp:299: DB::MergeTreeIndexConditionBloomFilter::traverseFunction(std::__1::shared_ptr<DB::IAST> const&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&, std::__1::shared_ptr<DB::IAST> const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:10.340862 [ 2541330 ] {} <Trace> KeeperTCPHandler: Received heartbeat for session #2\r\n2022.08.11 03:12:10.347824 [ 2541616 ] {} <Fatal> BaseDaemon: 16. /build/build_docker/../src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp:255: DB::MergeTreeIndexConditionBloomFilter::traverseAtomAST(std::__1::shared_ptr<DB::IAST> const&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:10.682069 [ 2541616 ] {} <Fatal> BaseDaemon: 17. /build/build_docker/../src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp:113: auto DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3::operator()<std::__1::shared_ptr<DB::IAST> const, std::__1::shared_ptr<DB::Context const>, DB::Block, DB::MergeTreeIndexConditionBloomFilter::RPNElement>(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) const in /usr/bin/clickhouse\r\n2022.08.11 03:12:11.000260 [ 2541468 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 1.53 GiB, peak 1.53 GiB, will set to 1.53 GiB (RSS), difference: 2.42 MiB\r\n2022.08.11 03:12:11.022188 [ 2541616 ] {} <Fatal> BaseDaemon: 18. /build/build_docker/../contrib/libcxx/include/type_traits:3640: decltype(static_cast<DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3&>(fp)(static_cast<std::__1::shared_ptr<DB::IAST> const&>(fp0), static_cast<std::__1::shared_ptr<DB::Context const>>(fp0), static_cast<DB::Block&>(fp0), static_cast<DB::MergeTreeIndexConditionBloomFilter::RPNElement&>(fp0))) std::__1::__invoke<DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3&, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&>(DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3&, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>&&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:11.356611 [ 2541616 ] {} <Fatal> BaseDaemon: 19. /build/build_docker/../contrib/libcxx/include/__functional/invoke.h:30: bool std::__1::__invoke_void_return_wrapper<bool, false>::__call<DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3&, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&>(DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3&, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>&&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:11.691110 [ 2541616 ] {} <Fatal> BaseDaemon: 20. /build/build_docker/../contrib/libcxx/include/__functional/function.h:230: std::__1::__function::__default_alloc_func<DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3, bool (std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&)>::operator()(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>&&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:12.000260 [ 2541468 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 1.53 GiB, peak 1.53 GiB, will set to 1.53 GiB (RSS), difference: 2.44 MiB\r\n2022.08.11 03:12:12.026338 [ 2541616 ] {} <Fatal> BaseDaemon: 21. /build/build_docker/../contrib/libcxx/include/__functional/function.h:711: bool std::__1::__function::__policy_invoker<bool (std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&)>::__call_impl<std::__1::__function::__default_alloc_func<DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long)::$_3, bool (std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&)> >(std::__1::__function::__policy_storage const*, std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>&&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:12.367854 [ 2541616 ] {} <Fatal> BaseDaemon: 22. /build/build_docker/../contrib/libcxx/include/__functional/function.h:843: std::__1::__function::__policy_func<bool (std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&)>::operator()(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>&&, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) const in /usr/bin/clickhouse\r\n2022.08.11 03:12:12.708338 [ 2541616 ] {} <Fatal> BaseDaemon: 23. /build/build_docker/../contrib/libcxx/include/__functional/function.h:1184: std::__1::function<bool (std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&)>::operator()(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&) const in /usr/bin/clickhouse\r\n2022.08.11 03:12:13.047339 [ 2541616 ] {} <Fatal> BaseDaemon: 24. /build/build_docker/../src/Storages/MergeTree/RPNBuilder.h:82: DB::RPNBuilder<DB::MergeTreeIndexConditionBloomFilter::RPNElement>::traverseAST(std::__1::shared_ptr<DB::IAST> const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:13.271870 [ 2541616 ] {} <Fatal> BaseDaemon: 25. /build/build_docker/../src/Storages/MergeTree/RPNBuilder.h:37: DB::RPNBuilder<DB::MergeTreeIndexConditionBloomFilter::RPNElement>::RPNBuilder(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, std::__1::function<bool (std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::Context const>, DB::Block&, DB::MergeTreeIndexConditionBloomFilter::RPNElement&)> const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:13.483676 [ 2541616 ] {} <Fatal> BaseDaemon: 26. /build/build_docker/../src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp:114: DB::MergeTreeIndexConditionBloomFilter::MergeTreeIndexConditionBloomFilter(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, DB::Block const&, unsigned long) in /usr/bin/clickhouse\r\n2022.08.11 03:12:13.638278 [ 2541616 ] {} <Fatal> BaseDaemon: 27. /build/build_docker/../contrib/libcxx/include/__memory/construct_at.h:38: DB::MergeTreeIndexConditionBloomFilter* std::__1::construct_at<DB::MergeTreeIndexConditionBloomFilter, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&, DB::MergeTreeIndexConditionBloomFilter*>(DB::MergeTreeIndexConditionBloomFilter*, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:13.790731 [ 2541616 ] {} <Fatal> BaseDaemon: 28. /build/build_docker/../contrib/libcxx/include/__memory/allocator_traits.h:302: void std::__1::allocator_traits<std::__1::allocator<DB::MergeTreeIndexConditionBloomFilter> >::construct<DB::MergeTreeIndexConditionBloomFilter, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&, void, void>(std::__1::allocator<DB::MergeTreeIndexConditionBloomFilter>&, DB::MergeTreeIndexConditionBloomFilter*, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:13.943037 [ 2541616 ] {} <Fatal> BaseDaemon: 29. /build/build_docker/../contrib/libcxx/include/__memory/shared_ptr.h:293: std::__1::__shared_ptr_emplace<DB::MergeTreeIndexConditionBloomFilter, std::__1::allocator<DB::MergeTreeIndexConditionBloomFilter> >::__shared_ptr_emplace<DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&>(std::__1::allocator<DB::MergeTreeIndexConditionBloomFilter>, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:14.096882 [ 2541616 ] {} <Fatal> BaseDaemon: 30. /build/build_docker/../contrib/libcxx/include/__memory/shared_ptr.h:954: std::__1::shared_ptr<DB::MergeTreeIndexConditionBloomFilter> std::__1::allocate_shared<DB::MergeTreeIndexConditionBloomFilter, std::__1::allocator<DB::MergeTreeIndexConditionBloomFilter>, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&, void>(std::__1::allocator<DB::MergeTreeIndexConditionBloomFilter> const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:14.243510 [ 2541616 ] {} <Fatal> BaseDaemon: 31. /build/build_docker/../contrib/libcxx/include/__memory/shared_ptr.h:963: std::__1::shared_ptr<DB::MergeTreeIndexConditionBloomFilter> std::__1::make_shared<DB::MergeTreeIndexConditionBloomFilter, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&, void>(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>&, DB::Block const&, unsigned long const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:14.379671 [ 2541616 ] {} <Fatal> BaseDaemon: 32. /build/build_docker/../src/Storages/MergeTree/MergeTreeIndexBloomFilter.cpp:76: DB::MergeTreeIndexBloomFilter::createIndexCondition(DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>) const in /usr/bin/clickhouse\r\n2022.08.11 03:12:15.010721 [ 2541616 ] {} <Fatal> BaseDaemon: 33. /build/build_docker/../src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp:915: DB::MergeTreeDataSelectExecutor::filterPartsByPrimaryKeyAndSkipIndexes(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >&&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const> const&, DB::KeyCondition const&, DB::MergeTreeReaderSettings const&, Poco::Logger*, unsigned long, std::__1::vector<DB::ReadFromMergeTree::IndexStat, std::__1::allocator<DB::ReadFromMergeTree::IndexStat> >&, bool) in /usr/bin/clickhouse\r\n2022.08.11 03:12:15.509153 [ 2541616 ] {} <Fatal> BaseDaemon: 34. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:966: DB::ReadFromMergeTree::selectRangesToRead(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >, std::__1::shared_ptr<DB::PrewhereInfo> const&, std::__1::shared_ptr<DB::ActionsDAG> const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context const>, unsigned int, std::__1::shared_ptr<std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, long, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, long> > > >, DB::MergeTreeData const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, bool, Poco::Logger*) in /usr/bin/clickhouse\r\n2022.08.11 03:12:16.006159 [ 2541616 ] {} <Fatal> BaseDaemon: 35. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:835: DB::ReadFromMergeTree::selectRangesToRead(std::__1::vector<std::__1::shared_ptr<DB::IMergeTreeDataPart const>, std::__1::allocator<std::__1::shared_ptr<DB::IMergeTreeDataPart const> > >) const in /usr/bin/clickhouse\r\n2022.08.11 03:12:16.502883 [ 2541616 ] {} <Fatal> BaseDaemon: 36. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:1045: DB::ReadFromMergeTree::getAnalysisResult() const in /usr/bin/clickhouse\r\n2022.08.11 03:12:16.971319 [ 2541616 ] {} <Fatal> BaseDaemon: 37. /build/build_docker/../src/Processors/QueryPlan/ReadFromMergeTree.cpp:0: DB::ReadFromMergeTree::initializePipeline(DB::QueryPipelineBuilder&, DB::BuildQueryPipelineSettings const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:17.093883 [ 2541616 ] {} <Fatal> BaseDaemon: 38. /build/build_docker/../src/Processors/QueryPlan/ISourceStep.cpp:16: DB::ISourceStep::updatePipeline(std::__1::vector<std::__1::unique_ptr<DB::QueryPipelineBuilder, std::__1::default_delete<DB::QueryPipelineBuilder> >, std::__1::allocator<std::__1::unique_ptr<DB::QueryPipelineBuilder, std::__1::default_delete<DB::QueryPipelineBuilder> > > >, DB::BuildQueryPipelineSettings const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:17.271959 [ 2541616 ] {} <Fatal> BaseDaemon: 39. /build/build_docker/../src/Processors/QueryPlan/QueryPlan.cpp:187: DB::QueryPlan::buildQueryPipeline(DB::QueryPlanOptimizationSettings const&, DB::BuildQueryPipelineSettings const&) in /usr/bin/clickhouse\r\n2022.08.11 03:12:17.521363 [ 2541616 ] {} <Fatal> BaseDaemon: 40. /build/build_docker/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:370: DB::InterpreterSelectWithUnionQuery::execute() in /usr/bin/clickhouse\r\n2022.08.11 03:12:17.835238 [ 2541616 ] {} <Fatal> BaseDaemon: 41. /build/build_docker/../src/Interpreters/executeQuery.cpp:694: DB::executeQueryImpl(char const*, char const*, std::__1::shared_ptr<DB::Context>, bool, DB::QueryProcessingStage::Enum, DB::ReadBuffer*) in /usr/bin/clickhouse\r\n2022.08.11 03:12:18.166707 [ 2541616 ] {} <Fatal> BaseDaemon: 42. /build/build_docker/../src/Interpreters/executeQuery.cpp:1085: DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::Context>, bool, DB::QueryProcessingStage::Enum) in /usr/bin/clickhouse\r\n2022.08.11 03:12:18.482551 [ 2541616 ] {} <Fatal> BaseDaemon: 43. /build/build_docker/../src/Server/TCPHandler.cpp:338: DB::TCPHandler::runImpl() in /usr/bin/clickhouse\r\n2022.08.11 03:12:18.826774 [ 2541616 ] {} <Fatal> BaseDaemon: 44. /build/build_docker/../src/Server/TCPHandler.cpp:1838: DB::TCPHandler::run() in /usr/bin/clickhouse\r\n```\r\n\n",
  "hints_text": "",
  "created_at": "2022-10-04T19:34:12Z"
}