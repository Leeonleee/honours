{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 8619,
  "instance_id": "ClickHouse__ClickHouse-8619",
  "issue_numbers": [
    "8618"
  ],
  "base_commit": "5e29fe3425a6dcb331a7a7abdb2d2973e4685d65",
  "patch": "diff --git a/utils/compressor/CMakeLists.txt b/utils/compressor/CMakeLists.txt\nindex c032054187b1..3498640acd1b 100644\n--- a/utils/compressor/CMakeLists.txt\n+++ b/utils/compressor/CMakeLists.txt\n@@ -1,17 +1,5 @@\n-find_package (Threads)\n-\n-add_executable (zstd_test zstd_test.cpp)\n-if(ZSTD_LIBRARY)\n-    target_link_libraries(zstd_test PRIVATE ${ZSTD_LIBRARY})\n-endif()\n-target_link_libraries (zstd_test PRIVATE common)\n-\n add_executable (mutator mutator.cpp)\n target_link_libraries(mutator PRIVATE clickhouse_common_io)\n \n add_executable (decompress_perf decompress_perf.cpp)\n target_link_libraries(decompress_perf PRIVATE dbms ${LZ4_LIBRARY})\n-\n-if (NOT USE_INTERNAL_ZSTD_LIBRARY AND ZSTD_INCLUDE_DIR)\n-    target_include_directories (zstd_test BEFORE PRIVATE ${ZSTD_INCLUDE_DIR})\n-endif ()\n",
  "test_patch": "diff --git a/utils/compressor/zstd_test.cpp b/utils/compressor/zstd_test.cpp\ndeleted file mode 100644\nindex 01016830e7d5..000000000000\n--- a/utils/compressor/zstd_test.cpp\n+++ /dev/null\n@@ -1,68 +0,0 @@\n-#include <port/unistd.h>\n-#include <zstd.h>\n-#include <vector>\n-#include <stdexcept>\n-#include <sys/types.h>\n-\n-\n-int main(int argc, char ** argv)\n-{\n-    bool compress = argc == 1;\n-\n-    const size_t size = 1048576;\n-    std::vector<char> src_buf(size);\n-    std::vector<char> dst_buf;\n-\n-    size_t pos = 0;\n-    while (true)\n-    {\n-        ssize_t read_res = read(STDIN_FILENO, &src_buf[pos], size - pos);\n-        if (read_res < 0)\n-            throw std::runtime_error(\"Cannot read from stdin\");\n-        if (read_res == 0)\n-            break;\n-        pos += read_res;\n-    }\n-\n-    src_buf.resize(pos);\n-\n-    size_t zstd_res;\n-\n-    if (compress)\n-    {\n-        dst_buf.resize(ZSTD_compressBound(src_buf.size()));\n-\n-        zstd_res = ZSTD_compress(\n-            &dst_buf[0],\n-            dst_buf.size(),\n-            &src_buf[0],\n-            src_buf.size(),\n-            1);\n-    }\n-    else\n-    {\n-        dst_buf.resize(size);\n-\n-        zstd_res = ZSTD_decompress(\n-            &dst_buf[0],\n-            dst_buf.size(),\n-            &src_buf[0],\n-            src_buf.size());\n-    }\n-\n-    if (ZSTD_isError(zstd_res))\n-        throw std::runtime_error(ZSTD_getErrorName(zstd_res));\n-\n-    dst_buf.resize(zstd_res);\n-\n-    pos = 0;\n-    while (pos < dst_buf.size())\n-    {\n-        ssize_t write_res = write(STDOUT_FILENO, &dst_buf[pos], dst_buf.size());\n-        if (write_res <= 0)\n-            throw std::runtime_error(\"Cannot write to stdout\");\n-        pos += write_res;\n-    }\n-\n-    return 0;\n-}\n",
  "problem_statement": "ubutntu aarch64  -- zstd linker command failed\nroot@deeb23de376a:/opt/ClickHouse/build/build-arm64# cd build-arm64 ;/usr/bin/clang++-8  -fdiagnostics-color=always -std=c++2a -fsized-deallocation  -gdwarf-aranges -pipe   -Wall -Wno-unused-command-line-argument  -Wnon-virtual-dtor -fno-omit-frame-pointer -Werror -O2 -g -DNDEBUG -O3  -fno-pie  -fuse-ld=/usr/bin/ld.gold -rdynamic -Wl,--no-undefined -Wl,-no-pie   -rdynamic dbms/CMakeFiles/clickhouse_malloc.dir/src/Common/malloc.cpp.o utils/compressor/CMakeFiles/zstd_test.dir/zstd_test.cpp.o  -o utils/compressor/zstd_test  dbms/libclickhouse_new_delete.a contrib/jemalloc-cmake/libjemalloc.a contrib/zstd-cmake/libzstd.a libs/libcommon/libcommon.a dbms/libclickhouse_common_io.a libs/libcommon/libcommon.a contrib/cctz-cmake/libcctz.a contrib/poco/Util/libPocoUtil.a contrib/poco/Foundation/libPocoFoundation.a contrib/cityhash102/libcityhash.a contrib/boost-cmake/libboost_system_internal.a dbms/src/Common/StringUtils/libstring_utils.a libs/libwidechar_width/libwidechar_width.a contrib/double-conversion-cmake/libdouble-conversion.a contrib/ryu-cmake/libryu.a contrib/poco/Net/libPocoNet.a contrib/poco/XML/libPocoXML.a contrib/re2/libre2.a contrib/re2_st/libre2_st.a contrib/boost-cmake/libboost_program_options_internal.a libs/libcommon/libapple_rt.a contrib/croaring/libroaring.a contrib/poco/Data/libPocoData.a contrib/poco/NetSSL_OpenSSL/libPocoNetSSL.a contrib/poco/Crypto/libPocoCrypto.a contrib/poco/Net/libPocoNet.a contrib/poco/Util/libPocoUtil.a contrib/poco/XML/libPocoXML.a contrib/poco/JSON/libPocoJSON.a contrib/poco/Crypto/libPocoCrypto.a contrib/openssl-cmake/libssl.a contrib/openssl-cmake/libcrypto.a contrib/poco/Foundation/libPocoFoundation.a contrib/zlib-ng/libz.a -lpthread -ldl -lrt -pthread contrib/brotli-cmake/libbrotli.a -Wl,--start-group libs/libglibc-compatibility/libglibc-compatibility.a contrib/libcxx-cmake/libcxx.a contrib/libcxxabi-cmake/libcxxabi.a -lgcc_eh -Wl,--end-group -nodefaultlibs /usr/lib/llvm-8/lib/clang/8.0.0/lib/linux/libclang_rt.builtins-aarch64.a  -lc -lm -lrt -lpthread -ldl\r\nbash: cd: build-arm64: No such file or directory\r\n../../contrib/zstd/lib/compress/zstd_compress.c:1974: error: undefined reference to 'ZSTD_compressLiterals'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2016: error: undefined reference to 'HIST_countFast_wksp'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2019: error: undefined reference to 'ZSTD_selectEncodingType'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2026: error: undefined reference to 'ZSTD_buildCTable'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2042: error: undefined reference to 'HIST_countFast_wksp'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2048: error: undefined reference to 'ZSTD_selectEncodingType'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2054: error: undefined reference to 'ZSTD_buildCTable'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2070: error: undefined reference to 'HIST_countFast_wksp'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2074: error: undefined reference to 'ZSTD_selectEncodingType'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2080: error: undefined reference to 'ZSTD_buildCTable'\r\n../../contrib/zstd/lib/compress/zstd_compress.c:2097: error: undefined reference to 'ZSTD_encodeSequences'\r\n../../contrib/zstd/lib/compress/zstd_opt.c:176: error: undefined reference to 'HIST_count_simple'\r\n../../contrib/zstd/lib/compress/zstd_opt.c:176: error: undefined reference to 'HIST_count_simple'\r\n../../contrib/zstd/lib/compress/zstd_opt.c:176: error: undefined reference to 'HIST_count_simple'\r\n../../contrib/zstd/lib/compress/zstd_opt.c:176: error: undefined reference to 'HIST_count_simple'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:82: error: undefined reference to 'ZSTD_sizeof_DDict'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:150: error: undefined reference to 'ZSTD_freeDDict'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:493: error: undefined reference to 'ZSTD_getcBlockSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:713: error: undefined reference to 'ZSTD_DDict_dictContent'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:714: error: undefined reference to 'ZSTD_DDict_dictSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1171: error: undefined reference to 'ZSTD_DDict_dictContent'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1172: error: undefined reference to 'ZSTD_DDict_dictSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1180: error: undefined reference to 'ZSTD_copyDDictParameters'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:646: error: undefined reference to 'ZSTD_getcBlockSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:656: error: undefined reference to 'ZSTD_decompressBlock_internal'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:150: error: undefined reference to 'ZSTD_freeDDict'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:150: error: undefined reference to 'ZSTD_freeDDict'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:946: error: undefined reference to 'ZSTD_decompressBlock_internal'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:912: error: undefined reference to 'ZSTD_getcBlockSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1064: error: undefined reference to 'ZSTD_buildFSETable'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1077: error: undefined reference to 'ZSTD_buildFSETable'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1090: error: undefined reference to 'ZSTD_buildFSETable'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1171: error: undefined reference to 'ZSTD_DDict_dictContent'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1172: error: undefined reference to 'ZSTD_DDict_dictSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1180: error: undefined reference to 'ZSTD_copyDDictParameters'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:150: error: undefined reference to 'ZSTD_freeDDict'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1272: error: undefined reference to 'ZSTD_createDDict_advanced'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1272: error: undefined reference to 'ZSTD_createDDict_advanced'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1272: error: undefined reference to 'ZSTD_createDDict_advanced'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1272: error: undefined reference to 'ZSTD_createDDict_advanced'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:82: error: undefined reference to 'ZSTD_sizeof_DDict'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1171: error: undefined reference to 'ZSTD_DDict_dictContent'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1172: error: undefined reference to 'ZSTD_DDict_dictSize'\r\n../../contrib/zstd/lib/decompress/zstd_decompress.c:1180: error: undefined reference to 'ZSTD_copyDDictParameters'\r\n../../contrib/zstd/lib/compress/fse_compress.c:675: error: undefined reference to 'HIST_count_wksp'\r\n../../contrib/zstd/lib/compress/huf_compress.c:674: error: undefined reference to 'HIST_count_wksp'\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n",
  "hints_text": "",
  "created_at": "2020-01-10T18:42:27Z"
}