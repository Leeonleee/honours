{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 35480,
  "instance_id": "ClickHouse__ClickHouse-35480",
  "issue_numbers": [
    "34586"
  ],
  "base_commit": "64e0b0cf8ffcd42e0ebead46229f24d9b838da54",
  "patch": "diff --git a/src/Storages/System/attachInformationSchemaTables.cpp b/src/Storages/System/attachInformationSchemaTables.cpp\nindex 68a1eac305ee..61a916853242 100644\n--- a/src/Storages/System/attachInformationSchemaTables.cpp\n+++ b/src/Storages/System/attachInformationSchemaTables.cpp\n@@ -32,6 +32,8 @@ static void createInformationSchemaView(ContextMutablePtr context, IDatabase & d\n \n         auto & ast_create = ast->as<ASTCreateQuery &>();\n         assert(view_name == ast_create.getTable());\n+        ast_create.attach = false;\n+        ast_create.setDatabase(database.getDatabaseName());\n         if (is_uppercase)\n             ast_create.setTable(Poco::toUpper(view_name));\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02206_information_schema_show_database.reference b/tests/queries/0_stateless/02206_information_schema_show_database.reference\nindex 551186fa0abe..af437aca9899 100644\n--- a/tests/queries/0_stateless/02206_information_schema_show_database.reference\n+++ b/tests/queries/0_stateless/02206_information_schema_show_database.reference\n@@ -1,1 +1,4 @@\n CREATE DATABASE INFORMATION_SCHEMA\\nENGINE = Memory\n+CREATE VIEW INFORMATION_SCHEMA.COLUMNS\\n(\\n    `table_catalog` String,\\n    `table_schema` String,\\n    `table_name` String,\\n    `column_name` String,\\n    `ordinal_position` UInt64,\\n    `column_default` String,\\n    `is_nullable` UInt8,\\n    `data_type` String,\\n    `character_maximum_length` Nullable(UInt64),\\n    `character_octet_length` Nullable(UInt64),\\n    `numeric_precision` Nullable(UInt64),\\n    `numeric_precision_radix` Nullable(UInt64),\\n    `numeric_scale` Nullable(UInt64),\\n    `datetime_precision` Nullable(UInt64),\\n    `character_set_catalog` Nullable(String),\\n    `character_set_schema` Nullable(String),\\n    `character_set_name` Nullable(String),\\n    `collation_catalog` Nullable(String),\\n    `collation_schema` Nullable(String),\\n    `collation_name` Nullable(String),\\n    `domain_catalog` Nullable(String),\\n    `domain_schema` Nullable(String),\\n    `domain_name` Nullable(String),\\n    `column_comment` String,\\n    `column_type` String,\\n    `TABLE_CATALOG` String ALIAS table_catalog,\\n    `TABLE_SCHEMA` String ALIAS table_schema,\\n    `TABLE_NAME` String ALIAS table_name,\\n    `COLUMN_NAME` String ALIAS column_name,\\n    `ORDINAL_POSITION` UInt64 ALIAS ordinal_position,\\n    `COLUMN_DEFAULT` String ALIAS column_default,\\n    `IS_NULLABLE` UInt8 ALIAS is_nullable,\\n    `DATA_TYPE` String ALIAS data_type,\\n    `CHARACTER_MAXIMUM_LENGTH` Nullable(UInt64) ALIAS character_maximum_length,\\n    `CHARACTER_OCTET_LENGTH` Nullable(UInt64) ALIAS character_octet_length,\\n    `NUMERIC_PRECISION` Nullable(UInt64) ALIAS numeric_precision,\\n    `NUMERIC_PRECISION_RADIX` Nullable(UInt64) ALIAS numeric_precision_radix,\\n    `NUMERIC_SCALE` Nullable(UInt64) ALIAS numeric_scale,\\n    `DATETIME_PRECISION` Nullable(UInt64) ALIAS datetime_precision,\\n    `CHARACTER_SET_CATALOG` Nullable(String) ALIAS character_set_catalog,\\n    `CHARACTER_SET_SCHEMA` Nullable(String) ALIAS character_set_schema,\\n    `CHARACTER_SET_NAME` Nullable(String) ALIAS character_set_name,\\n    `COLLATION_CATALOG` Nullable(String) ALIAS collation_catalog,\\n    `COLLATION_SCHEMA` Nullable(String) ALIAS collation_schema,\\n    `COLLATION_NAME` Nullable(String) ALIAS collation_name,\\n    `DOMAIN_CATALOG` Nullable(String) ALIAS domain_catalog,\\n    `DOMAIN_SCHEMA` Nullable(String) ALIAS domain_schema,\\n    `DOMAIN_NAME` Nullable(String) ALIAS domain_name,\\n    `COLUMN_COMMENT` String ALIAS column_comment,\\n    `COLUMN_TYPE` String ALIAS column_type\\n) AS\\nSELECT\\n    database AS table_catalog,\\n    database AS table_schema,\\n    table AS table_name,\\n    name AS column_name,\\n    position AS ordinal_position,\\n    default_expression AS column_default,\\n    type LIKE \\'Nullable(%)\\' AS is_nullable,\\n    type AS data_type,\\n    character_octet_length AS character_maximum_length,\\n    character_octet_length,\\n    numeric_precision,\\n    numeric_precision_radix,\\n    numeric_scale,\\n    datetime_precision,\\n    NULL AS character_set_catalog,\\n    NULL AS character_set_schema,\\n    NULL AS character_set_name,\\n    NULL AS collation_catalog,\\n    NULL AS collation_schema,\\n    NULL AS collation_name,\\n    NULL AS domain_catalog,\\n    NULL AS domain_schema,\\n    NULL AS domain_name,\\n    comment AS column_comment,\\n    type AS column_type\\nFROM system.columns\n+CREATE VIEW INFORMATION_SCHEMA.TABLES (`table_catalog` String, `table_schema` String, `table_name` String, `table_type` Enum8(\\'BASE TABLE\\' = 1, \\'VIEW\\' = 2, \\'FOREIGN TABLE\\' = 3, \\'LOCAL TEMPORARY\\' = 4, \\'SYSTEM VIEW\\' = 5), `TABLE_CATALOG` String ALIAS table_catalog, `TABLE_SCHEMA` String ALIAS table_schema, `TABLE_NAME` String ALIAS table_name, `TABLE_TYPE` Enum8(\\'BASE TABLE\\' = 1, \\'VIEW\\' = 2, \\'FOREIGN TABLE\\' = 3, \\'LOCAL TEMPORARY\\' = 4, \\'SYSTEM VIEW\\' = 5) ALIAS table_type) AS SELECT database AS table_catalog, database AS table_schema, name AS table_name, multiIf(is_temporary, 4, engine LIKE \\'%View\\', 2, engine LIKE \\'System%\\', 5, has_own_data = 0, 3, 1) AS table_type FROM system.tables\n+CREATE VIEW information_schema.tables (`table_catalog` String, `table_schema` String, `table_name` String, `table_type` Enum8(\\'BASE TABLE\\' = 1, \\'VIEW\\' = 2, \\'FOREIGN TABLE\\' = 3, \\'LOCAL TEMPORARY\\' = 4, \\'SYSTEM VIEW\\' = 5), `TABLE_CATALOG` String ALIAS table_catalog, `TABLE_SCHEMA` String ALIAS table_schema, `TABLE_NAME` String ALIAS table_name, `TABLE_TYPE` Enum8(\\'BASE TABLE\\' = 1, \\'VIEW\\' = 2, \\'FOREIGN TABLE\\' = 3, \\'LOCAL TEMPORARY\\' = 4, \\'SYSTEM VIEW\\' = 5) ALIAS table_type) AS SELECT database AS table_catalog, database AS table_schema, name AS table_name, multiIf(is_temporary, 4, engine LIKE \\'%View\\', 2, engine LIKE \\'System%\\', 5, has_own_data = 0, 3, 1) AS table_type FROM system.tables\ndiff --git a/tests/queries/0_stateless/02206_information_schema_show_database.sql b/tests/queries/0_stateless/02206_information_schema_show_database.sql\nindex de5ca495e2e9..91a8a0d1dea8 100644\n--- a/tests/queries/0_stateless/02206_information_schema_show_database.sql\n+++ b/tests/queries/0_stateless/02206_information_schema_show_database.sql\n@@ -1,1 +1,3 @@\n SHOW CREATE DATABASE INFORMATION_SCHEMA;\n+SHOW CREATE INFORMATION_SCHEMA.COLUMNS;\n+SELECT create_table_query FROM system.tables WHERE database ILIKE 'INFORMATION_SCHEMA' AND table ILIKE 'TABLES'; -- supress style check: database = currentDatabase()\n",
  "problem_statement": "Wrong create_table_query for INFORMATION_SCHEMA\n```\r\nSELECT create_table_query\r\nFROM system.tables\r\nWHERE table = 'usual_view'\r\n\r\nQuery id: f9ef8cf7-25ee-42af-bafa-26d506332c35\r\n\r\n\u250c\u2500create_table_query\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 CREATE VIEW default.usual_view (`number` UInt64) AS SELECT * FROM numbers(10) \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\n1 rows in set. Elapsed: 0.004 sec. \r\n```\r\n\r\nBut\r\n\r\n```\r\nSELECT create_table_query\r\nFROM system.tables\r\nWHERE table = 'COLUMNS'\r\n\r\nQuery id: e7032015-4031-47d6-a5e3-c9ee5d787455\r\n\r\n\u250c\u2500create_table_query\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 ATTACH VIEW COLUMNS (`table_catalog` String, `table_schema` String, `table_name` String, `column_name` String, `ordinal_position` UInt64, `column_default` String, `is_nullable` UInt8, `data_type` String, `character_maximum_length` Nullable(UInt64), `character_octet_length` Nullable(UInt64), `numeric_precision` Nullable(UInt64), `numeric_precision_radix` Nullable(UInt64), `numeric_scale` Nullable(UInt64), `datetime_precision` Nullable(UInt64), `character_set_catalog` Nullable(String), `character_set_schema` Nullable(String), `character_set_name` Nullable(String), `collation_catalog` Nullable(String), `collation_schema` Nullable(String), `collation_name` Nullable(String), `domain_catalog` Nullable(String), `domain_schema` Nullable(String), `domain_name` Nullable(String), `column_comment` String, `column_type` String, `TABLE_CATALOG` String ALIAS table_catalog, `TABLE_SCHEMA` String ALIAS table_schema, `TABLE_NAME` String ALIAS table_name, `COLUMN_NAME` String ALIAS column_name, `ORDINAL_POSITION` UInt64 ALIAS ordinal_position, `COLUMN_DEFAULT` String ALIAS column_default, `IS_NULLABLE` UInt8 ALIAS is_nullable, `DATA_TYPE` String ALIAS data_type, `CHARACTER_MAXIMUM_LENGTH` Nullable(UInt64) ALIAS character_maximum_length, `CHARACTER_OCTET_LENGTH` Nullable(UInt64) ALIAS character_octet_length, `NUMERIC_PRECISION` Nullable(UInt64) ALIAS numeric_precision, `NUMERIC_PRECISION_RADIX` Nullable(UInt64) ALIAS numeric_precision_radix, `NUMERIC_SCALE` Nullable(UInt64) ALIAS numeric_scale, `DATETIME_PRECISION` Nullable(UInt64) ALIAS datetime_precision, `CHARACTER_SET_CATALOG` Nullable(String) ALIAS character_set_catalog, `CHARACTER_SET_SCHEMA` Nullable(String) ALIAS character_set_schema, `CHARACTER_SET_NAME` Nullable(String) ALIAS character_set_name, `COLLATION_CATALOG` Nullable(String) ALIAS collation_catalog, `COLLATION_SCHEMA` Nullable(String) ALIAS collation_schema, `COLLATION_NAME` Nullable(String) ALIAS collation_name, `DOMAIN_CATALOG` Nullable(String) ALIAS domain_catalog, `DOMAIN_SCHEMA` Nullable(String) ALIAS domain_schema, `DOMAIN_NAME` Nullable(String) ALIAS domain_name, `COLUMN_COMMENT` String ALIAS column_comment, `COLUMN_TYPE` String ALIAS column_type) AS SELECT database AS table_catalog, database AS table_schema, table AS table_name, name AS column_name, position AS ordinal_position, default_expression AS column_default, type LIKE 'Nullable(%)' AS is_nullable, type AS data_type, character_octet_length AS character_maximum_length, character_octet_length, numeric_precision, numeric_precision_radix, numeric_scale, datetime_precision, NULL AS character_set_catalog, NULL AS character_set_schema, NULL AS character_set_name, NULL AS collation_catalog, NULL AS collation_schema, NULL AS collation_name, NULL AS domain_catalog, NULL AS domain_schema, NULL AS domain_name, comment AS column_comment, type AS column_type FROM system.columns \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n\r\nATTACH vs CREATE + missing the dbname. That may lead to the recreation of the VIEW in the different DB (by some backup / recovery tools).\r\n\r\n\r\n\n",
  "hints_text": "",
  "created_at": "2022-03-21T16:02:35Z"
}