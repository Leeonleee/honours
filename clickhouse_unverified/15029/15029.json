{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 15029,
  "instance_id": "ClickHouse__ClickHouse-15029",
  "issue_numbers": [
    "13992"
  ],
  "base_commit": "c185db46f93e3163ed72a9a698a426363886cdd7",
  "patch": "diff --git a/src/Interpreters/OptimizeIfWithConstantConditionVisitor.cpp b/src/Interpreters/OptimizeIfWithConstantConditionVisitor.cpp\nindex dd63093493f7..765e7b1fa3d4 100644\n--- a/src/Interpreters/OptimizeIfWithConstantConditionVisitor.cpp\n+++ b/src/Interpreters/OptimizeIfWithConstantConditionVisitor.cpp\n@@ -33,6 +33,9 @@ static bool tryExtractConstValueFromCondition(const ASTPtr & condition, bool & v\n         {\n             if (const auto * expr_list = function->arguments->as<ASTExpressionList>())\n             {\n+                if (expr_list->children.size() != 2)\n+                    throw Exception(\"Function CAST must have exactly two arguments\", ErrorCodes::NUMBER_OF_ARGUMENTS_DOESNT_MATCH);\n+\n                 const ASTPtr & type_ast = expr_list->children.at(1);\n                 if (const auto * type_literal = type_ast->as<ASTLiteral>())\n                 {\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01503_if_const_optimization.reference b/tests/queries/0_stateless/01503_if_const_optimization.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/01503_if_const_optimization.sql b/tests/queries/0_stateless/01503_if_const_optimization.sql\nnew file mode 100644\nindex 000000000000..047f6f757e80\n--- /dev/null\n+++ b/tests/queries/0_stateless/01503_if_const_optimization.sql\n@@ -0,0 +1,1 @@\n+SELECT if(CAST(NULL), '2.55', NULL) AS x; -- { serverError 42 }\n",
  "problem_statement": "Syntax check fails for function CAST() (found by fuzzer)\n**Describe the bug**\r\nClickHouse is unable to detect syntax error in expression: `SELECT if(CAST(NULL), '2.55', NULL) AS x`, which leads to a failure.\r\n\r\n**How to reproduce**\r\n* Reproduces in 20.7, 20.8 version of ClickHouse\r\n* Queries to run that lead to unexpected result\r\n\r\n**Expected behavior**\r\nA clear message, indicating there is a syntax error in the above expression (CAST(NULL) is not a valid logical expression).\r\n\r\n**Error message and/or stacktrace**\r\nThe original AST-fuzzer report - https://clickhouse-test-reports.s3.yandex.net/12550/48333b29f619490fd1df50230301596e44e2af45/fuzzer/fuzzer.log#fail1\r\n\r\nServer error log - https://clickhouse-test-reports.s3.yandex.net/12550/48333b29f619490fd1df50230301596e44e2af45/fuzzer/server.log\n",
  "hints_text": "",
  "created_at": "2020-09-19T19:35:22Z"
}