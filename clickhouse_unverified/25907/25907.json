{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 25907,
  "instance_id": "ClickHouse__ClickHouse-25907",
  "issue_numbers": [
    "24035"
  ],
  "base_commit": "9169a4cbb0512cbc11c65a2fcb8e738673db1a28",
  "patch": "diff --git a/src/Common/StringUtils/StringUtils.h b/src/Common/StringUtils/StringUtils.h\nindex 20c0a5ca3805..f6ad61f8fd9b 100644\n--- a/src/Common/StringUtils/StringUtils.h\n+++ b/src/Common/StringUtils/StringUtils.h\n@@ -149,7 +149,11 @@ inline bool isPunctuationASCII(char c)\n \n inline bool isValidIdentifier(const std::string_view & str)\n {\n-    return !str.empty() && isValidIdentifierBegin(str[0]) && std::all_of(str.begin() + 1, str.end(), isWordCharASCII);\n+    return !str.empty()\n+        && isValidIdentifierBegin(str[0])\n+        && std::all_of(str.begin() + 1, str.end(), isWordCharASCII)\n+        /// NULL is not a valid identifier in SQL, any case.\n+        && !(str.size() == strlen(\"null\") && 0 == strncasecmp(str.data(), \"null\", strlen(\"null\")));\n }\n \n /// Works assuming isAlphaASCII.\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01932_null_valid_identifier.reference b/tests/queries/0_stateless/01932_null_valid_identifier.reference\nnew file mode 100644\nindex 000000000000..8600160f48cb\n--- /dev/null\n+++ b/tests/queries/0_stateless/01932_null_valid_identifier.reference\n@@ -0,0 +1,3 @@\n+1\n+1\n+1\t\\N\ndiff --git a/tests/queries/0_stateless/01932_null_valid_identifier.sql b/tests/queries/0_stateless/01932_null_valid_identifier.sql\nnew file mode 100644\nindex 000000000000..31f1a7716759\n--- /dev/null\n+++ b/tests/queries/0_stateless/01932_null_valid_identifier.sql\n@@ -0,0 +1,3 @@\n+SELECT `null` FROM remote('127.0.0.2', view(SELECT 1 AS `null`));\n+SELECT `NULL` FROM remote('127.0.0.2', view(SELECT 1 AS `NULL`));\n+SELECT `nULl`, null FROM remote('127.0.0.2', view(SELECT 1 AS `nULl`));\ndiff --git a/tests/queries/0_stateless/arcadia_skip_list.txt b/tests/queries/0_stateless/arcadia_skip_list.txt\nindex afd11cb5a7da..8453094cc657 100644\n--- a/tests/queries/0_stateless/arcadia_skip_list.txt\n+++ b/tests/queries/0_stateless/arcadia_skip_list.txt\n@@ -251,3 +251,4 @@\n 01924_argmax_bitmap_state\n 01914_exchange_dictionaries\n 01923_different_expression_name_alias\n+01932_null_valid_identifier\ndiff --git a/tests/queries/skip_list.json b/tests/queries/skip_list.json\nindex 1f7b50b17912..be52bee71b1a 100644\n--- a/tests/queries/skip_list.json\n+++ b/tests/queries/skip_list.json\n@@ -521,6 +521,7 @@\n         \"01915_create_or_replace_dictionary\",\n         \"01913_names_of_tuple_literal\",\n         \"01925_merge_prewhere_table\",\n+        \"01932_null_valid_identifier\",\n         \"01934_constexpr_aggregate_function_parameters\"\n     ],\n     \"parallel\":\n",
  "problem_statement": "Can't create table on cluster when order by `null`\nMy clickhouse version is 21.3.9.83,   I want to create table contains a field named `null`, I can create it successfully on local table:\r\n```sql\r\nvm2173 :) CREATE TABLE default.test_table (\r\n:-] `id` Int64 , \r\n:-] `day` DateTime, \r\n:-] `null` Int32 ) \r\n:-] ENGINE = MergeTree() \r\n:-] PARTITION BY toYYYYMMDD(`day`) \r\n:-] ORDER BY (`day`, `null`);\r\n\r\nCREATE TABLE default.test_table\r\n(\r\n    `id` Int64,\r\n    `day` DateTime,\r\n    `null` Int32\r\n)\r\nENGINE = MergeTree\r\nPARTITION BY toYYYYMMDD(day)\r\nORDER BY (day, null)\r\n\r\nQuery id: 6eb6df0e-1934-4ea3-86cc-742961c7b974\r\n\r\nOk.\r\n\r\n0 rows in set. Elapsed: 0.016 sec.\r\n```\r\n\r\nbut when I create it on cluster, I get error like this: `Column NULL with type Nullable(Nothing) is not allowed in key expression`:\r\n```sql\r\nvm2173 :) CREATE TABLE default.test_table ON CLUSTER eoi (\r\n:-] `id` Int64 , \r\n:-] `day` DateTime, \r\n:-] `null` Int32 ) \r\n:-] ENGINE = MergeTree() \r\n:-] PARTITION BY toYYYYMMDD(`day`) \r\n:-] ORDER BY (`day`, `null`);\r\n\r\nCREATE TABLE default.test_table ON CLUSTER eoi\r\n(\r\n    `id` Int64,\r\n    `day` DateTime,\r\n    `null` Int32\r\n)\r\nENGINE = MergeTree\r\nPARTITION BY toYYYYMMDD(day)\r\nORDER BY (day, null)\r\n\r\nQuery id: e1afba47-e631-4087-a0b5-944b014d6a8b\r\n\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 worker-1 \u2502 9000 \u2502    549 \u2502 Code: 549, e.displayText() = DB::Exception: Column `NULL` with type Nullable(Nothing) is not allowed in key expression, it's not comparable (version 21.3.9.83 (official build)) \u2502                   2 \u2502                0 \u2502\r\n\u2502 worker-2 \u2502 9000 \u2502    549 \u2502 Code: 549, e.displayText() = DB::Exception: Column `NULL` with type Nullable(Nothing) is not allowed in key expression, it's not comparable (version 21.3.9.83 (official build)) \u2502                   1 \u2502                0 \u2502\r\n\u2502 vm2173   \u2502 9000 \u2502    549 \u2502 Code: 549, e.displayText() = DB::Exception: Column `NULL` with type Nullable(Nothing) is not allowed in key expression, it's not comparable (version 21.3.9.83 (official build)) \u2502                   0 \u2502                0 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u2192 Progress: 0.00 rows, 0.00 B (0.00 rows/s., 0.00 B/s.)  0%\r\n3 rows in set. Elapsed: 0.112 sec. \r\n\r\nReceived exception from server (version 21.3.9):\r\nCode: 549. DB::Exception: Received from localhost:9000. DB::Exception: There was an error on [worker-1:9000]: Code: 549, e.displayText() = DB::Exception: Column `NULL` with type Nullable(Nothing) is not allowed in key expression, it's not comparable (version 21.3.9.83 (official build)).\r\n```\r\n\r\nI want to know why it happends.\r\n\r\n\n",
  "hints_text": "```\r\nSELECT `null` FROM remote('127.0.0.2', view(SELECT 1 AS `null`))\r\n```",
  "created_at": "2021-07-01T23:03:14Z",
  "modified_files": [
    "src/Common/StringUtils/StringUtils.h"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/01932_null_valid_identifier.reference",
    "b/tests/queries/0_stateless/01932_null_valid_identifier.sql",
    "tests/queries/0_stateless/arcadia_skip_list.txt",
    "tests/queries/skip_list.json"
  ]
}