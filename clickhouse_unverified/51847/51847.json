{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 51847,
  "instance_id": "ClickHouse__ClickHouse-51847",
  "issue_numbers": [
    "51811"
  ],
  "base_commit": "e20ae34c30c46da640dc9dd7ee23fe27948a7e84",
  "patch": "diff --git a/src/Storages/checkAndGetLiteralArgument.cpp b/src/Storages/checkAndGetLiteralArgument.cpp\nindex 1aa942548a75..5baf47fe91a9 100644\n--- a/src/Storages/checkAndGetLiteralArgument.cpp\n+++ b/src/Storages/checkAndGetLiteralArgument.cpp\n@@ -12,7 +12,15 @@ namespace ErrorCodes\n template <typename T>\n T checkAndGetLiteralArgument(const ASTPtr & arg, const String & arg_name)\n {\n-    return checkAndGetLiteralArgument<T>(*arg->as<ASTLiteral>(), arg_name);\n+    if (arg && arg->as<ASTLiteral>())\n+        return checkAndGetLiteralArgument<T>(*arg->as<ASTLiteral>(), arg_name);\n+\n+    throw Exception(\n+        ErrorCodes::BAD_ARGUMENTS,\n+        \"Argument '{}' must be a literal, get {} (value: {})\",\n+        arg_name,\n+        arg ? arg->getID() : \"NULL\",\n+        arg ? arg->formatForErrorMessage() : \"NULL\");\n }\n \n template <typename T>\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02811_invalid_embedded_rocksdb_create.reference b/tests/queries/0_stateless/02811_invalid_embedded_rocksdb_create.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/02811_invalid_embedded_rocksdb_create.sql b/tests/queries/0_stateless/02811_invalid_embedded_rocksdb_create.sql\nnew file mode 100644\nindex 000000000000..a87ac5e0de08\n--- /dev/null\n+++ b/tests/queries/0_stateless/02811_invalid_embedded_rocksdb_create.sql\n@@ -0,0 +1,2 @@\n+-- Tags: no-fasttest\n+CREATE TABLE dict (`k` String, `v` String) ENGINE = EmbeddedRocksDB(k) PRIMARY KEY k; -- {serverError 36}\n",
  "problem_statement": "Wrong create sql with EmbeddedRocksDB engine can crash the server\n> You have to provide the following information whenever possible.\r\n\r\nReproduce SQL:\r\n\r\n```sql\r\nCREATE TABLE dict\r\n(\r\n    `k` String,\r\n    `v` String\r\n)\r\nENGINE = EmbeddedRocksDB(k)\r\nPRIMARY KEY k\r\n```\r\n\r\nhttps://fiddle.clickhouse.com/b8df4e3e-110b-43ad-838f-da6a1d5636e8\r\n\r\n**Does it reproduce on recent release?**\r\n\r\nYes\r\n\r\n\n",
  "hints_text": "",
  "created_at": "2023-07-05T14:58:57Z"
}