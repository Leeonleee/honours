{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 22964,
  "instance_id": "ClickHouse__ClickHouse-22964",
  "issue_numbers": [
    "22943"
  ],
  "base_commit": "9d08695ce10ea1304854abf4437b5d8c43479a65",
  "patch": "diff --git a/src/Common/FieldVisitors.h b/src/Common/FieldVisitors.h\nindex 954cd004e846..5adbf2b01ac2 100644\n--- a/src/Common/FieldVisitors.h\n+++ b/src/Common/FieldVisitors.h\n@@ -185,12 +185,20 @@ class FieldVisitorConvertToNumber : public StaticVisitor<T>\n                 /// Conversion of infinite values to integer is undefined.\n                 throw Exception(\"Cannot convert infinite value to integer type\", ErrorCodes::CANNOT_CONVERT_TYPE);\n             }\n+            else if (x > std::numeric_limits<T>::max() || x < std::numeric_limits<T>::lowest())\n+            {\n+                throw Exception(\"Cannot convert out of range floating point value to integer type\", ErrorCodes::CANNOT_CONVERT_TYPE);\n+            }\n         }\n \n         if constexpr (std::is_same_v<Decimal256, T>)\n+        {\n             return Int256(x);\n+        }\n         else\n+        {\n             return T(x);\n+        }\n     }\n \n     T operator() (const UInt128 &) const\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01386_negative_float_constant_key_condition.reference b/tests/queries/0_stateless/01386_negative_float_constant_key_condition.reference\nindex 44e0be8e3569..bb0b1cf658d1 100644\n--- a/tests/queries/0_stateless/01386_negative_float_constant_key_condition.reference\n+++ b/tests/queries/0_stateless/01386_negative_float_constant_key_condition.reference\n@@ -1,4 +1,3 @@\n 0\n 0\n 0\n-0\ndiff --git a/tests/queries/0_stateless/01386_negative_float_constant_key_condition.sql b/tests/queries/0_stateless/01386_negative_float_constant_key_condition.sql\nindex 216f43c42855..c2191d6ab968 100644\n--- a/tests/queries/0_stateless/01386_negative_float_constant_key_condition.sql\n+++ b/tests/queries/0_stateless/01386_negative_float_constant_key_condition.sql\n@@ -12,7 +12,7 @@ SETTINGS index_granularity = 8192;\n INSERT INTO t0 VALUES (0, 0);\n \n SELECT t0.c1 FROM t0 WHERE NOT (t0.c1 OR (t0.c0 AND -1524532316));\n-SELECT t0.c1 FROM t0 WHERE NOT (t0.c1 OR (t0.c0 AND -1.0));\n+SELECT t0.c1 FROM t0 WHERE NOT (t0.c1 OR (t0.c0 AND -1.0)); -- { serverError 70 }\n SELECT t0.c1 FROM t0 WHERE NOT (t0.c1 OR (t0.c0 AND inf));\n SELECT t0.c1 FROM t0 WHERE NOT (t0.c1 OR (t0.c0 AND nan));\n \ndiff --git a/tests/queries/0_stateless/01804_uniq_up_to_ubsan.reference b/tests/queries/0_stateless/01804_uniq_up_to_ubsan.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/01804_uniq_up_to_ubsan.sql b/tests/queries/0_stateless/01804_uniq_up_to_ubsan.sql\nnew file mode 100644\nindex 000000000000..fcbe585b70ab\n--- /dev/null\n+++ b/tests/queries/0_stateless/01804_uniq_up_to_ubsan.sql\n@@ -0,0 +1,2 @@\n+SELECT uniqUpTo(1e100)(number) FROM numbers(5); -- { serverError 70 }\n+SELECT uniqUpTo(-1e100)(number) FROM numbers(5); -- { serverError 70 }\n",
  "problem_statement": "UBSan: AggregateFunctionTopK: ../src/Common/FieldVisitors.h:193:22: runtime error: 1e+20 is outside the range of representable values of type 'unsigned long'\n```\r\nWITH CAST(round(sqrt(number)) % 1048576, 'Enum(\\'\\' = 0, \\'hello\\' = 1, \\'world\\' = 2, \\'test\\' = 3)') AS x SELECT topK(100000002004087730000.)(x) FROM numbers(1)\r\n\r\n../src/Common/FieldVisitors.h:193:22: runtime error: 1e+20 is outside the range of representable values of type 'unsigned long'\r\n    #0 0xf0362bc in DB::FieldVisitorConvertToNumber<unsigned long>::operator()(double const&) const obj-x86_64-linux-gnu/../src/Common/FieldVisitors.h:193:22\r\n    #1 0xf033594 in auto DB::applyVisitor<DB::FieldVisitorConvertToNumber<unsigned long>, DB::Field const&>(DB::FieldVisitorConvertToNumber<unsigned long>&&, DB::Field const&) obj-x86_64-linux-gnu/../src/Common/FieldVisitors.h:46:12\r\n    #2 0xf033594 in std::__1::shared_ptr<DB::IAggregateFunction> DB::(anonymous namespace)::createAggregateFunctionTopK<false>(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&, DB::Array const&) obj-x86_64-linux-gnu/../src/AggregateFunctions/AggregateFunctionTopK.cpp:82:20\r\n    #3 0x1a0930ab in DB::AggregateFunctionFactory::getImpl(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&, DB::Array const&, DB::AggregateFunctionProperties&, bool) const obj-x86_64-linux-gnu/../src/AggregateFunctions/AggregateFunctionFactory.cpp:140:16\r\n    #4 0x1a092152 in DB::AggregateFunctionFactory::get(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&, DB::Array const&, DB::AggregateFunctionProperties&) const obj-x86_64-linux-gnu/../src/AggregateFunctions/AggregateFunctionFactory.cpp:94:16\r\n    #5 0x1ab0f18b in DB::ExpressionAnalyzer::makeAggregateDescriptions(std::__1::shared_ptr<DB::ActionsDAG>&) obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.cpp:463:67\r\n    #6 0x1ab0d0e4 in DB::ExpressionAnalyzer::analyzeAggregation() obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.cpp:218:23\r\n    #7 0x1ab0c91c in DB::ExpressionAnalyzer::ExpressionAnalyzer(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, DB::Context const&, unsigned long, bool, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > >) obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.cpp:152:5\r\n    #8 0x1a89f5c5 in DB::SelectQueryExpressionAnalyzer::SelectQueryExpressionAnalyzer(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, DB::Context const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, bool, DB::SelectQueryOptions const&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > >) obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.h:281:11\r\n    #9 0x1a8a5e65 in std::__1::__unique_if<DB::SelectQueryExpressionAnalyzer>::__unique_single std::__1::make_unique<DB::SelectQueryExpressionAnalyzer, std::__1::shared_ptr<DB::IAST>&, std::__1::shared_ptr<DB::TreeRewriterResult const>&, DB::Context&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >, bool, DB::SelectQueryOptions&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > > >(std::__1::shared_ptr<DB::IAST>&, std::__1::shared_ptr<DB::TreeRewriterResult const>&, DB::Context&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&&, bool&&, DB::SelectQueryOptions&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > >&&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2068:32\r\n    #10 0x1a87f66a in DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&)::$_2::operator()(bool) const obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:414:26\r\n    #11 0x1a87ac78 in DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:478:5\r\n    #12 0x1a8787e9 in DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:160:7\r\n    #13 0x1adadbb7 in std::__1::__unique_if<DB::InterpreterSelectQuery>::__unique_single std::__1::make_unique<DB::InterpreterSelectQuery, std::__1::shared_ptr<DB::IAST> const&, DB::Context&, DB::SelectQueryOptions&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&>(std::__1::shared_ptr<DB::IAST> const&, DB::Context&, DB::SelectQueryOptions&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2068:32\r\n    #14 0x1adab533 in DB::InterpreterSelectWithUnionQuery::buildCurrentChildInterpreter(std::__1::shared_ptr<DB::IAST> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:211:16\r\n    #15 0x1ada9a69 in DB::InterpreterSelectWithUnionQuery::InterpreterSelectWithUnionQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:133:13\r\n    #16 0x1a81b675 in std::__1::__unique_if<DB::InterpreterSelectWithUnionQuery>::__unique_single std::__1::make_unique<DB::InterpreterSelectWithUnionQuery, std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions const&>(std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions const&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2068:32\r\n    #17 0x1a81a1ca in DB::InterpreterFactory::get(std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions const&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterFactory.cpp:110:16\r\n    #18 0x1aff29b9 in DB::executeQueryImpl(char const*, char const*, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool, DB::ReadBuffer*) obj-x86_64-linux-gnu/../src/Interpreters/executeQuery.cpp:520:28\r\n    #19 0x1aff1804 in DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool) obj-x86_64-linux-gnu/../src/Interpreters/executeQuery.cpp:908:30\r\n    #20 0x1bab6b9a in DB::TCPHandler::runImpl() obj-x86_64-linux-gnu/../src/Server/TCPHandler.cpp:290:24\r\n    #21 0x1bad13ac in DB::TCPHandler::run() obj-x86_64-linux-gnu/../src/Server/TCPHandler.cpp:1548:9\r\n    #22 0x1ca0f29b in Poco::Net::TCPServerConnection::start() obj-x86_64-linux-gnu/../contrib/poco/Net/src/TCPServerConnection.cpp:43:3\r\n    #23 0x1ca0f6f2 in Poco::Net::TCPServerDispatcher::run() obj-x86_64-linux-gnu/../contrib/poco/Net/src/TCPServerDispatcher.cpp:113:19\r\n    #24 0x1caecdb9 in Poco::PooledThread::run() obj-x86_64-linux-gnu/../contrib/poco/Foundation/src/ThreadPool.cpp:199:14\r\n    #25 0x1caeabbb in Poco::ThreadImpl::runnableEntry(void*) obj-x86_64-linux-gnu/../contrib/poco/Foundation/src/Thread_POSIX.cpp:345:27\r\n    #26 0x7f99e166e608 in start_thread /build/glibc-eX1tMB/glibc-2.31/nptl/pthread_create.c:477:8\r\n    #27 0x7f99e1595292 in clone /build/glibc-eX1tMB/glibc-2.31/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior ../src/Common/FieldVisitors.h:193:22 in \r\n\r\n2021.04.08 11:04:49.126739 [ 44 ] {} <Trace> BaseDaemon: Received signal -3\r\n2021.04.08 11:04:49.127343 [ 176 ] {} <Fatal> BaseDaemon: ########################################\r\n2021.04.08 11:04:49.127461 [ 176 ] {} <Fatal> BaseDaemon: (version 21.5.1.6496, build id: 36ED625CE04C9C57EB364086557F54CAE0B88F83) (from thread 46) (query_id: 0b73bc11-dede-450d-affd-1d7bc52f2905) Received signal Unknown signal (-3)\r\n2021.04.08 11:04:49.127512 [ 176 ] {} <Fatal> BaseDaemon: Sanitizer trap.\r\n2021.04.08 11:04:49.127598 [ 176 ] {} <Fatal> BaseDaemon: Stack trace: 0xec7bb65 0xeeae6b6 0xec3e116 0xec4bbaf 0xf0362bd 0xf033595 0x1a0930ac 0x1a092153 0x1ab0f18c 0x1ab0d0e5 0x1ab0c91d 0x1a89f5c6 0x1a8a5e66 0x1a87f66b 0x1a87ac79 0x1a8787ea 0x1adadbb8 0x1adab534 0x1ada9a6a 0x1a81b676 0x1a81a1cb 0x1aff29ba 0x1aff1805 0x1bab6b9b 0x1bad13ad 0x1ca0f29c 0x1ca0f6f3 0x1caecdba 0x1caeabbc 0x7f99e166e609 0x7f99e1595293\r\n2021.04.08 11:04:49.144590 [ 176 ] {} <Fatal> BaseDaemon: 0.1. inlined from ./obj-x86_64-linux-gnu/../src/Common/StackTrace.cpp:300: StackTrace::tryCapture()\r\n2021.04.08 11:04:49.144628 [ 176 ] {} <Fatal> BaseDaemon: 0. ../src/Common/StackTrace.cpp:261: StackTrace::StackTrace() @ 0xec7bb65 in /workspace/clickhouse\r\n2021.04.08 11:04:49.197844 [ 176 ] {} <Fatal> BaseDaemon: 1. ./obj-x86_64-linux-gnu/../base/daemon/BaseDaemon.cpp:381: sanitizerDeathCallback() @ 0xeeae6b6 in /workspace/clickhouse\r\n2021.04.08 11:04:50.029762 [ 176 ] {} <Fatal> BaseDaemon: 2. __sanitizer::Die() @ 0xec3e116 in /workspace/clickhouse\r\n2021.04.08 11:04:50.831193 [ 176 ] {} <Fatal> BaseDaemon: 3. ? @ 0xec4bbaf in /workspace/clickhouse\r\n2021.04.08 11:04:50.896386 [ 176 ] {} <Fatal> BaseDaemon: 4. ./obj-x86_64-linux-gnu/../src/Common/FieldVisitors.h:0: DB::FieldVisitorConvertToNumber<unsigned long>::operator()(double const&) const @ 0xf0362bd in /workspace/clickhouse\r\n2021.04.08 11:04:50.994786 [ 176 ] {} <Fatal> BaseDaemon: 5.1. inlined from ./obj-x86_64-linux-gnu/../src/Common/FieldVisitors.h:46: auto DB::applyVisitor<DB::FieldVisitorConvertToNumber<unsigned long>, DB::Field const&>(DB::FieldVisitorConvertToNumber<unsigned long>&&, DB::Field const&)\r\n2021.04.08 11:04:50.994814 [ 176 ] {} <Fatal> BaseDaemon: 5. ../src/AggregateFunctions/AggregateFunctionTopK.cpp:82: std::__1::shared_ptr<DB::IAggregateFunction> DB::(anonymous namespace)::createAggregateFunctionTopK<false>(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&, DB::Array const&) @ 0xf033595 in /workspace/clickhouse\r\n2021.04.08 11:04:51.031960 [ 176 ] {} <Fatal> BaseDaemon: 6. ./obj-x86_64-linux-gnu/../src/AggregateFunctions/AggregateFunctionFactory.cpp:0: DB::AggregateFunctionFactory::getImpl(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&, DB::Array const&, DB::AggregateFunctionProperties&, bool) const @ 0x1a0930ac in /workspace/clickhouse\r\n2021.04.08 11:04:51.067950 [ 176 ] {} <Fatal> BaseDaemon: 7. ./obj-x86_64-linux-gnu/../src/AggregateFunctions/AggregateFunctionFactory.cpp:94: DB::AggregateFunctionFactory::get(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::shared_ptr<DB::IDataType const>, std::__1::allocator<std::__1::shared_ptr<DB::IDataType const> > > const&, DB::Array const&, DB::AggregateFunctionProperties&) const @ 0x1a092153 in /workspace/clickhouse\r\n2021.04.08 11:04:51.170389 [ 176 ] {} <Fatal> BaseDaemon: 8.1. inlined from ./obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:3124: shared_ptr\r\n2021.04.08 11:04:51.170435 [ 176 ] {} <Fatal> BaseDaemon: 8.2. inlined from ../contrib/libcxx/include/memory:3243: std::__1::shared_ptr<DB::IAggregateFunction>::operator=(std::__1::shared_ptr<DB::IAggregateFunction>&&)\r\n2021.04.08 11:04:51.170487 [ 176 ] {} <Fatal> BaseDaemon: 8. ../src/Interpreters/ExpressionAnalyzer.cpp:463: DB::ExpressionAnalyzer::makeAggregateDescriptions(std::__1::shared_ptr<DB::ActionsDAG>&) @ 0x1ab0f18c in /workspace/clickhouse\r\n2021.04.08 11:04:51.269036 [ 176 ] {} <Fatal> BaseDaemon: 9. ./obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.cpp:218: DB::ExpressionAnalyzer::analyzeAggregation() @ 0x1ab0d0e5 in /workspace/clickhouse\r\n2021.04.08 11:04:51.365711 [ 176 ] {} <Fatal> BaseDaemon: 10. ./obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.cpp:153: DB::ExpressionAnalyzer::ExpressionAnalyzer(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, DB::Context const&, unsigned long, bool, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > >) @ 0x1ab0c91d in /workspace/clickhouse\r\n2021.04.08 11:04:51.532691 [ 176 ] {} <Fatal> BaseDaemon: 11. ./obj-x86_64-linux-gnu/../src/Interpreters/ExpressionAnalyzer.h:0: DB::SelectQueryExpressionAnalyzer::SelectQueryExpressionAnalyzer(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, DB::Context const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, bool, DB::SelectQueryOptions const&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > >) @ 0x1a89f5c6 in /workspace/clickhouse\r\n2021.04.08 11:04:51.747115 [ 176 ] {} <Fatal> BaseDaemon: 12. ./obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2068: std::__1::__unique_if<DB::SelectQueryExpressionAnalyzer>::__unique_single std::__1::make_unique<DB::SelectQueryExpressionAnalyzer, std::__1::shared_ptr<DB::IAST>&, std::__1::shared_ptr<DB::TreeRewriterResult const>&, DB::Context&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >, bool, DB::SelectQueryOptions&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > > >(std::__1::shared_ptr<DB::IAST>&, std::__1::shared_ptr<DB::TreeRewriterResult const>&, DB::Context&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&&, bool&&, DB::SelectQueryOptions&, std::__1::unordered_map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::SubqueryForSet, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::SubqueryForSet> > >&&) @ 0x1a8a5e66 in /workspace/clickhouse\r\n2021.04.08 11:04:51.914584 [ 176 ] {} <Fatal> BaseDaemon: 13. ./obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:414: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&)::$_2::operator()(bool) const @ 0x1a87f66b in /workspace/clickhouse\r\n2021.04.08 11:04:52.079534 [ 176 ] {} <Fatal> BaseDaemon: 14. ./obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:481: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&) @ 0x1a87ac79 in /workspace/clickhouse\r\n2021.04.08 11:04:52.244147 [ 176 ] {} <Fatal> BaseDaemon: 15. ./obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:160: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0x1a8787ea in /workspace/clickhouse\r\n2021.04.08 11:04:52.316168 [ 176 ] {} <Fatal> BaseDaemon: 16. ./obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2068: std::__1::__unique_if<DB::InterpreterSelectQuery>::__unique_single std::__1::make_unique<DB::InterpreterSelectQuery, std::__1::shared_ptr<DB::IAST> const&, DB::Context&, DB::SelectQueryOptions&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&>(std::__1::shared_ptr<DB::IAST> const&, DB::Context&, DB::SelectQueryOptions&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0x1adadbb8 in /workspace/clickhouse\r\n2021.04.08 11:04:52.382445 [ 176 ] {} <Fatal> BaseDaemon: 17. ./obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:211: DB::InterpreterSelectWithUnionQuery::buildCurrentChildInterpreter(std::__1::shared_ptr<DB::IAST> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0x1adab534 in /workspace/clickhouse\r\n2021.04.08 11:04:52.449237 [ 176 ] {} <Fatal> BaseDaemon: 18. ./obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:133: DB::InterpreterSelectWithUnionQuery::InterpreterSelectWithUnionQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0x1ada9a6a in /workspace/clickhouse\r\n2021.04.08 11:04:52.510702 [ 176 ] {} <Fatal> BaseDaemon: 19. ./obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:0: std::__1::__unique_if<DB::InterpreterSelectWithUnionQuery>::__unique_single std::__1::make_unique<DB::InterpreterSelectWithUnionQuery, std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions const&>(std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions const&) @ 0x1a81b676 in /workspace/clickhouse\r\n2021.04.08 11:04:52.569660 [ 176 ] {} <Fatal> BaseDaemon: 20.1. inlined from ./obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:1649: std::__1::unique_ptr<DB::InterpreterSelectWithUnionQuery, std::__1::default_delete<DB::InterpreterSelectWithUnionQuery> >::release()\r\n2021.04.08 11:04:52.569700 [ 176 ] {} <Fatal> BaseDaemon: 20.2. inlined from ../contrib/libcxx/include/memory:1563: unique_ptr<DB::InterpreterSelectWithUnionQuery, std::__1::default_delete<DB::InterpreterSelectWithUnionQuery>, void, void>\r\n2021.04.08 11:04:52.569746 [ 176 ] {} <Fatal> BaseDaemon: 20. ../src/Interpreters/InterpreterFactory.cpp:110: DB::InterpreterFactory::get(std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions const&) @ 0x1a81a1cb in /workspace/clickhouse\r\n2021.04.08 11:04:52.665738 [ 176 ] {} <Fatal> BaseDaemon: 21. ./obj-x86_64-linux-gnu/../src/Interpreters/executeQuery.cpp:520: DB::executeQueryImpl(char const*, char const*, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool, DB::ReadBuffer*) @ 0x1aff29ba in /workspace/clickhouse\r\n2021.04.08 11:04:52.767035 [ 176 ] {} <Fatal> BaseDaemon: 22. ./obj-x86_64-linux-gnu/../src/Interpreters/executeQuery.cpp:908: DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool) @ 0x1aff1805 in /workspace/clickhouse\r\n2021.04.08 11:04:52.863922 [ 176 ] {} <Fatal> BaseDaemon: 23. ./obj-x86_64-linux-gnu/../src/Server/TCPHandler.cpp:290: DB::TCPHandler::runImpl() @ 0x1bab6b9b in /workspace/clickhouse\r\n2021.04.08 11:04:52.974552 [ 176 ] {} <Fatal> BaseDaemon: 24. ./obj-x86_64-linux-gnu/../src/Server/TCPHandler.cpp:1550: DB::TCPHandler::run() @ 0x1bad13ad in /workspace/clickhouse\r\n2021.04.08 11:04:52.977917 [ 176 ] {} <Fatal> BaseDaemon: 25. ./obj-x86_64-linux-gnu/../contrib/poco/Net/src/TCPServerConnection.cpp:57: Poco::Net::TCPServerConnection::start() @ 0x1ca0f29c in /workspace/clickhouse\r\n2021.04.08 11:04:52.987752 [ 176 ] {} <Fatal> BaseDaemon: 26.1. inlined from ./obj-x86_64-linux-gnu/../contrib/libcxx/include/atomic:1072: int std::__1::__cxx_atomic_fetch_sub<int>(std::__1::__cxx_atomic_base_impl<int>*, int, std::__1::memory_order)\r\n2021.04.08 11:04:52.987796 [ 176 ] {} <Fatal> BaseDaemon: 26.2. inlined from ../contrib/libcxx/include/atomic:1725: std::__1::__atomic_base<int, true>::fetch_sub(int, std::__1::memory_order)\r\n2021.04.08 11:04:52.987846 [ 176 ] {} <Fatal> BaseDaemon: 26.3. inlined from ../contrib/libcxx/include/atomic:1760: std::__1::__atomic_base<int, true>::operator--()\r\n2021.04.08 11:04:52.987891 [ 176 ] {} <Fatal> BaseDaemon: 26.4. inlined from ../contrib/poco/Net/src/TCPServerDispatcher.cpp:231: Poco::Net::TCPServerDispatcher::endConnection()\r\n2021.04.08 11:04:52.987931 [ 176 ] {} <Fatal> BaseDaemon: 26. ../contrib/poco/Net/src/TCPServerDispatcher.cpp:114: Poco::Net::TCPServerDispatcher::run() @ 0x1ca0f6f3 in /workspace/clickhouse\r\n2021.04.08 11:04:52.996415 [ 176 ] {} <Fatal> BaseDaemon: 27.1. inlined from ./obj-x86_64-linux-gnu/../contrib/poco/Foundation/include/Poco/ScopedLock.h:36: ScopedLock\r\n2021.04.08 11:04:52.996452 [ 176 ] {} <Fatal> BaseDaemon: 27. ../contrib/poco/Foundation/src/ThreadPool.cpp:213: Poco::PooledThread::run() @ 0x1caecdba in /workspace/clickhouse\r\n2021.04.08 11:04:53.004316 [ 176 ] {} <Fatal> BaseDaemon: 28.1. inlined from ./obj-x86_64-linux-gnu/../contrib/poco/Foundation/include/Poco/SharedPtr.h:156: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable> >::assign(Poco::Runnable*)\r\n2021.04.08 11:04:53.004358 [ 176 ] {} <Fatal> BaseDaemon: 28.2. inlined from ../contrib/poco/Foundation/include/Poco/SharedPtr.h:208: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable> >::operator=(Poco::Runnable*)\r\n2021.04.08 11:04:53.004399 [ 176 ] {} <Fatal> BaseDaemon: 28. ../contrib/poco/Foundation/src/Thread_POSIX.cpp:360: Poco::ThreadImpl::runnableEntry(void*) @ 0x1caeabbc in /workspace/clickhouse\r\n2021.04.08 11:04:53.004468 [ 176 ] {} <Fatal> BaseDaemon: 29. start_thread @ 0x9609 in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so\r\n2021.04.08 11:04:53.004534 [ 176 ] {} <Fatal> BaseDaemon: 30. __clone @ 0x122293 in /usr/lib/x86_64-linux-gnu/libc-2.31.so\r\n2021.04.08 11:04:53.206689 [ 176 ] {} <Fatal> BaseDaemon: Calculated checksum of the binary: F070D1BB61D06EBE1341764BCA164F25. There is no information about the reference checksum.\r\n```\n",
  "hints_text": "",
  "created_at": "2021-04-10T20:38:39Z"
}