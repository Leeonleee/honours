diff --git a/tests/integration/test_storage_hdfs/test.py b/tests/integration/test_storage_hdfs/test.py
index 5ac1d3bea6f1..8ff88791a3a1 100644
--- a/tests/integration/test_storage_hdfs/test.py
+++ b/tests/integration/test_storage_hdfs/test.py
@@ -85,6 +85,32 @@ def test_read_write_storage_with_globs(started_cluster):
         assert "in readonly mode" in str(ex)
 
 
+def test_storage_with_multidirectory_glob(started_cluster):
+    hdfs_api = started_cluster.hdfs_api
+    for i in ["1", "2"]:
+        hdfs_api.write_data(
+            f"/multiglob/p{i}/path{i}/postfix/data{i}", f"File{i}\t{i}{i}
"
+        )
+        assert (
+            hdfs_api.read_data(f"/multiglob/p{i}/path{i}/postfix/data{i}")
+            == f"File{i}\t{i}{i}
"
+        )
+
+    r = node1.query(
+        "SELECT * FROM hdfs('hdfs://hdfs1:9000/multiglob/{p1/path1,p2/path2}/postfix/data{1,2}', TSV)"
+    )
+    assert (r == f"File1\t11
File2\t22
") or (r == f"File2\t22
File1\t11
")
+
+    try:
+        node1.query(
+            "SELECT * FROM hdfs('hdfs://hdfs1:9000/multiglob/{p4/path1,p2/path3}/postfix/data{1,2}.nonexist', TSV)"
+        )
+        assert False, "Exception have to be thrown"
+    except Exception as ex:
+        print(ex)
+        assert "no files" in str(ex)
+
+
 def test_read_write_table(started_cluster):
     hdfs_api = started_cluster.hdfs_api
 
diff --git a/tests/queries/0_stateless/02771_complex_globs_in_storage_file_path.reference b/tests/queries/0_stateless/02771_complex_globs_in_storage_file_path.reference
new file mode 100644
index 000000000000..e1b420ecf37e
--- /dev/null
+++ b/tests/queries/0_stateless/02771_complex_globs_in_storage_file_path.reference
@@ -0,0 +1,4 @@
+This is file data1	data1.csv
+This is file data2	data2.csv
+This is file data1	data1.csv
+This is file data2	data2.csv
diff --git a/tests/queries/0_stateless/02771_complex_globs_in_storage_file_path.sql b/tests/queries/0_stateless/02771_complex_globs_in_storage_file_path.sql
new file mode 100644
index 000000000000..1d1259202204
--- /dev/null
+++ b/tests/queries/0_stateless/02771_complex_globs_in_storage_file_path.sql
@@ -0,0 +1,12 @@
+-- Tags: no-replicated-database, no-parallel
+
+SELECT *, _file FROM file('02771/dir{?/subdir?1/da,2/subdir2?/da}ta/non_existing.csv', CSV); -- {serverError CANNOT_EXTRACT_TABLE_STRUCTURE}
+
+INSERT INTO TABLE FUNCTION file('02771/dir1/subdir11/data1.csv', 'CSV', 's String') SELECT 'This is file data1' SETTINGS engine_file_truncate_on_insert=1;
+INSERT INTO TABLE FUNCTION file('02771/dir2/subdir22/data2.csv', 'CSV', 's String') SELECT 'This is file data2' SETTINGS engine_file_truncate_on_insert=1;
+
+SELECT *, _file FROM file('02771/dir{?/subdir?1/da,2/subdir2?/da}ta1.csv', CSV);
+SELECT *, _file FROM file('02771/dir{?/subdir?1/da,2/subdir2?/da}ta2.csv', CSV);
+
+SELECT *, _file FROM file('02771/dir?/{subdir?1/data1,subdir2?/data2}.csv', CSV) WHERE _file == 'data1.csv';
+SELECT *, _file FROM file('02771/dir?/{subdir?1/data1,subdir2?/data2}.csv', CSV) WHERE _file == 'data2.csv';
