diff --git a/tests/queries/0_stateless/00098_k_union_all.sql b/tests/queries/0_stateless/00098_k_union_all.sql
index 311e5bb19c45..8f396d3479ad 100644
--- a/tests/queries/0_stateless/00098_k_union_all.sql
+++ b/tests/queries/0_stateless/00098_k_union_all.sql
@@ -1,3 +1,4 @@
+SET output_format_pretty_squash_ms = 0;
 SELECT 1 FORMAT PrettySpace;
 SELECT 1 UNION ALL SELECT 1 FORMAT PrettySpace;
 SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 FORMAT PrettySpace;
diff --git a/tests/queries/0_stateless/00405_pretty_formats.sql b/tests/queries/0_stateless/00405_pretty_formats.sql
index 3c8af7762784..a7dc5aa06008 100644
--- a/tests/queries/0_stateless/00405_pretty_formats.sql
+++ b/tests/queries/0_stateless/00405_pretty_formats.sql
@@ -1,3 +1,5 @@
+SET output_format_pretty_squash_ms = 0;
+
 SELECT number AS hello, toString(number) AS world, (hello, world) AS tuple, nullIf(hello % 3, 0) AS sometimes_nulls FROM system.numbers LIMIT 10 SETTINGS max_block_size = 5 FORMAT Pretty;
 SELECT number AS hello, toString(number) AS world, (hello, world) AS tuple, nullIf(hello % 3, 0) AS sometimes_nulls FROM system.numbers LIMIT 10 SETTINGS max_block_size = 5 FORMAT PrettyCompact;
 SELECT number AS hello, toString(number) AS world, (hello, world) AS tuple, nullIf(hello % 3, 0) AS sometimes_nulls FROM system.numbers LIMIT 10 SETTINGS max_block_size = 5 FORMAT PrettySpace;
diff --git a/tests/queries/0_stateless/00730_unicode_terminal_format.sql b/tests/queries/0_stateless/00730_unicode_terminal_format.sql
index b7a8084c406e..6327b41a05a0 100644
--- a/tests/queries/0_stateless/00730_unicode_terminal_format.sql
+++ b/tests/queries/0_stateless/00730_unicode_terminal_format.sql
@@ -1,5 +1,7 @@
 DROP TABLE IF EXISTS unicode;
 
+SET output_format_pretty_squash_ms = 0;
+
 CREATE TABLE unicode(c1 String, c2 String) ENGINE = Memory;
 INSERT INTO unicode VALUES ('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ', '–≠—Ç–æ—Ç –∫–æ–¥ –º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å!');
 INSERT INTO unicode VALUES ('‰Ω†Â•Ω', 'ËøôÊÆµ‰ª£Á†ÅÊòØÂèØ‰ª•ÁºñËæëÂπ∂‰∏îËÉΩÂ§üËøêË°åÁöÑÔºÅ');
diff --git a/tests/queries/0_stateless/01065_window_view_event_hop_watch_bounded.py b/tests/queries/0_stateless/01065_window_view_event_hop_watch_bounded.py
index 7f00130b184e..52d0c2c87d45 100755
--- a/tests/queries/0_stateless/01065_window_view_event_hop_watch_bounded.py
+++ b/tests/queries/0_stateless/01065_window_view_event_hop_watch_bounded.py
@@ -19,13 +19,17 @@
     client1.expect(prompt)
     client2.expect(prompt)
 
-    client1.send("SET allow_experimental_analyzer = 0")
+    client1.send(
+        "SET allow_experimental_analyzer = 0, output_format_pretty_squash_ms = 0;"
+    )
     client1.expect(prompt)
     client1.send("SET allow_experimental_window_view = 1")
     client1.expect(prompt)
     client1.send("SET window_view_heartbeat_interval = 1")
     client1.expect(prompt)
-    client2.send("SET allow_experimental_window_view = 1")
+    client2.send(
+        "SET allow_experimental_window_view = 1, output_format_pretty_squash_ms = 0;"
+    )
     client2.expect(prompt)
 
     client1.send(
diff --git a/tests/queries/0_stateless/01082_window_view_watch_limit.py b/tests/queries/0_stateless/01082_window_view_watch_limit.py
index 12c8d2955918..07dbc232a63d 100755
--- a/tests/queries/0_stateless/01082_window_view_watch_limit.py
+++ b/tests/queries/0_stateless/01082_window_view_watch_limit.py
@@ -19,13 +19,17 @@
     client1.expect(prompt)
     client2.expect(prompt)
 
-    client1.send("SET allow_experimental_analyzer = 0")
+    client1.send(
+        "SET allow_experimental_analyzer = 0, output_format_pretty_squash_ms = 0;"
+    )
     client1.expect(prompt)
     client1.send("SET allow_experimental_window_view = 1")
     client1.expect(prompt)
     client1.send("SET window_view_heartbeat_interval = 1")
     client1.expect(prompt)
-    client2.send("SET allow_experimental_window_view = 1")
+    client2.send(
+        "SET allow_experimental_window_view = 1, output_format_pretty_squash_ms = 0;"
+    )
     client2.expect(prompt)
 
     client1.send("CREATE DATABASE IF NOT EXISTS 01082_window_view_watch_limit")
diff --git a/tests/queries/0_stateless/01509_output_format_pretty_row_numbers.sql b/tests/queries/0_stateless/01509_output_format_pretty_row_numbers.sql
index f8ec0be74d7d..fb4c743d54bb 100644
--- a/tests/queries/0_stateless/01509_output_format_pretty_row_numbers.sql
+++ b/tests/queries/0_stateless/01509_output_format_pretty_row_numbers.sql
@@ -1,3 +1,5 @@
+SET output_format_pretty_squash_ms = 0;
+
 SELECT * FROM numbers(10) FORMAT Pretty;
 SELECT * FROM numbers(10) FORMAT PrettyCompact;
 SELECT * FROM numbers(10) FORMAT PrettyCompactMonoBlock;
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_Pretty.reference b/tests/queries/0_stateless/02122_parallel_formatting_Pretty.reference
deleted file mode 100644
index 72d346f82f73..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_Pretty.reference
+++ /dev/null
@@ -1,2 +0,0 @@
-Pretty-1
-Pretty-2
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_Pretty.sh b/tests/queries/0_stateless/02122_parallel_formatting_Pretty.sh
deleted file mode 100755
index a72510b06140..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_Pretty.sh
+++ /dev/null
@@ -1,5 +0,0 @@
-#!/usr/bin/env bash
-# Tags: no-fasttest
-
-CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
-${CUR_DIR}/02122_parallel_formatting.lib Pretty
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompact.reference b/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompact.reference
deleted file mode 100644
index 35761b294db8..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompact.reference
+++ /dev/null
@@ -1,2 +0,0 @@
-PrettyCompact-1
-PrettyCompact-2
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompact.sh b/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompact.sh
deleted file mode 100755
index 351f7ce0cd6d..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompact.sh
+++ /dev/null
@@ -1,5 +0,0 @@
-#!/usr/bin/env bash
-# Tags: no-fasttest
-
-CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
-${CUR_DIR}/02122_parallel_formatting.lib PrettyCompact
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompactNoEscapes.reference b/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompactNoEscapes.reference
deleted file mode 100644
index 8b70c25b168b..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompactNoEscapes.reference
+++ /dev/null
@@ -1,2 +0,0 @@
-PrettyCompactNoEscapes-1
-PrettyCompactNoEscapes-2
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompactNoEscapes.sh b/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompactNoEscapes.sh
deleted file mode 100755
index fd1e7a83ead8..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettyCompactNoEscapes.sh
+++ /dev/null
@@ -1,5 +0,0 @@
-#!/usr/bin/env bash
-# Tags: no-fasttest
-
-CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
-${CUR_DIR}/02122_parallel_formatting.lib PrettyCompactNoEscapes
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettyNoEscapes.reference b/tests/queries/0_stateless/02122_parallel_formatting_PrettyNoEscapes.reference
deleted file mode 100644
index e2bfec67b7cb..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettyNoEscapes.reference
+++ /dev/null
@@ -1,2 +0,0 @@
-PrettyNoEscapes-1
-PrettyNoEscapes-2
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettyNoEscapes.sh b/tests/queries/0_stateless/02122_parallel_formatting_PrettyNoEscapes.sh
deleted file mode 100755
index 20e6d9c6973a..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettyNoEscapes.sh
+++ /dev/null
@@ -1,5 +0,0 @@
-#!/usr/bin/env bash
-# Tags: no-fasttest
-
-CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
-${CUR_DIR}/02122_parallel_formatting.lib PrettyNoEscapes
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpace.reference b/tests/queries/0_stateless/02122_parallel_formatting_PrettySpace.reference
deleted file mode 100644
index fab8c8bde762..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpace.reference
+++ /dev/null
@@ -1,2 +0,0 @@
-PrettySpace-1
-PrettySpace-2
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpace.sh b/tests/queries/0_stateless/02122_parallel_formatting_PrettySpace.sh
deleted file mode 100755
index 8af990d9113a..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpace.sh
+++ /dev/null
@@ -1,5 +0,0 @@
-#!/usr/bin/env bash
-# Tags: no-fasttest
-
-CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
-${CUR_DIR}/02122_parallel_formatting.lib PrettySpace
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpaceNoEscapes.reference b/tests/queries/0_stateless/02122_parallel_formatting_PrettySpaceNoEscapes.reference
deleted file mode 100644
index 154ee87e82a1..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpaceNoEscapes.reference
+++ /dev/null
@@ -1,2 +0,0 @@
-PrettySpaceNoEscapes-1
-PrettySpaceNoEscapes-2
diff --git a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpaceNoEscapes.sh b/tests/queries/0_stateless/02122_parallel_formatting_PrettySpaceNoEscapes.sh
deleted file mode 100755
index 8fcbfbc16cfd..000000000000
--- a/tests/queries/0_stateless/02122_parallel_formatting_PrettySpaceNoEscapes.sh
+++ /dev/null
@@ -1,5 +0,0 @@
-#!/usr/bin/env bash
-# Tags: no-fasttest
-
-CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
-${CUR_DIR}/02122_parallel_formatting.lib PrettySpaceNoEscapes
diff --git a/tests/queries/0_stateless/02375_pretty_formats.sql.j2 b/tests/queries/0_stateless/02375_pretty_formats.sql.j2
index cc61346d267f..92e0a357138f 100644
--- a/tests/queries/0_stateless/02375_pretty_formats.sql.j2
+++ b/tests/queries/0_stateless/02375_pretty_formats.sql.j2
@@ -3,6 +3,7 @@
                   'PrettySpaceNoEscapesMonoBlock'] -%}
 
 select '{{ format }}';
+SET output_format_pretty_squash_ms = 0;
 select number as x, number + 1 as y from numbers(4) settings max_block_size=2 format {{ format }};
 
 {% endfor -%}
diff --git a/tests/queries/0_stateless/02731_pretty_time_based_squashing.reference b/tests/queries/0_stateless/02731_pretty_time_based_squashing.reference
new file mode 100644
index 000000000000..653faf33a468
--- /dev/null
+++ b/tests/queries/0_stateless/02731_pretty_time_based_squashing.reference
@@ -0,0 +1,14 @@
+‚îå‚îÄ[1mnumber[0m‚îÄ‚îê
+‚îÇ      0 ‚îÇ
+‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
+‚îå‚îÄ[1mnumber[0m‚îÄ‚îê
+‚îÇ      1 ‚îÇ
+‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
+‚îå‚îÄ[1mnumber[0m‚îÄ‚îê
+‚îÇ      2 ‚îÇ
+‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
+‚îå‚îÄ[1mnumber[0m‚îÄ‚îê
+‚îÇ      0 ‚îÇ
+‚îÇ      1 ‚îÇ
+‚îÇ      2 ‚îÇ
+‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
diff --git a/tests/queries/0_stateless/02731_pretty_time_based_squashing.sql b/tests/queries/0_stateless/02731_pretty_time_based_squashing.sql
new file mode 100644
index 000000000000..e5656c8e1cac
--- /dev/null
+++ b/tests/queries/0_stateless/02731_pretty_time_based_squashing.sql
@@ -0,0 +1,2 @@
+SELECT * FROM numbers(3) FORMAT PrettyCompact SETTINGS max_block_size = 1, max_threads = 1, output_format_pretty_squash_ms = 0;
+SELECT * FROM numbers(3) FORMAT PrettyCompact SETTINGS max_block_size = 1, max_threads = 1, output_format_pretty_squash_ms = 600_000;
