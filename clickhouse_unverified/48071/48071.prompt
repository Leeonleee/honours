You will be provided with a partial code base and an issue statement explaining a problem to resolve.

<issue>
Better map and array (array* lambda functions) support
**Use case**

> A clear and concise description of what is the intended usage scenario is.

**Describe the solution you'd like**

Ability to use map in array* functions.

```
WITH map(1, 'val1', 2, 'val2') AS map
SELECT arrayFilter(x -> (x.key = 1), map)

Query id: ee3dc4fe-b86e-4803-b5d2-c01e5d1bc471


0 rows in set. Elapsed: 0.003 sec.

Received exception from server (version 21.13.1):
Code: 47. DB::Exception: Received from localhost:9000. DB::Exception: Missing columns: 'x.key' while processing query: 'WITH map(1, 'val1', 2, 'val2') AS map SELECT arrayFilter(x -> (x.key = 1), map)', required columns: 'x.key'. (UNKNOWN_IDENTIFIER)


WITH map(1, 'val1', 2, 'val2') AS map
SELECT arrayFilter((x, y) -> (y = 1), arrayZip(mapKeys(map), mapValues(map)), mapKeys(map)) AS res

Query id: 275051be-8206-4973-9974-f667f701d8c8

┌─res──────────┐
│ [(1,'val1')] │
└──────────────┘
```

Ability to cast map to Array(Tuple(key, value)) or Tuple(Array(key), Array(value))

```
WITH map(1, 'val1', 2, 'val2') AS map
SELECT CAST(map, 'Array(Tuple(key UInt32, value String))')

Query id: 7100017e-f99f-4667-9665-cba69f24edff


0 rows in set. Elapsed: 0.003 sec.

Received exception from server (version 21.13.1):
Code: 53. DB::Exception: Received from localhost:9000. DB::Exception: CAST AS Array can only be performed between same-dimensional Array or String types: While processing CAST(map(1, 'val1', 2, 'val2') AS map, 'Array(Tuple(key UInt32, value String))'). (TYPE_MISMATCH)

WITH map(1, 'val1', 2, 'val2') AS map
SELECT CAST(map, 'Tuple(key Array(UInt32), value Array(String))')

Query id: 39700924-2168-4faa-af9b-002ceffb18c4


0 rows in set. Elapsed: 0.003 sec.

Received exception from server (version 21.13.1):
Code: 53. DB::Exception: Received from localhost:9000. DB::Exception: CAST AS Tuple can only be performed between tuple types or from String.
Left type: Map(UInt8, String), right type: Tuple(key Array(UInt32), value Array(String)): While processing CAST(map(1, 'val1', 2, 'val2') AS map, 'Tuple(key Array(UInt32), value Array(String))'). (TYPE_MISMATCH)
```

Map subcolumns .keys/.values doesn't work in case if map was created in query.

https://clickhouse.com/docs/en/sql-reference/data-types/map/#map-subcolumns

```
WITH map(1, 'val1', 2, 'val2') AS map
SELECT
    map.keys,
    map.values

Query id: c0d9d077-6edc-42ba-adae-37a1f9b9ac1c


0 rows in set. Elapsed: 0.002 sec.

Received exception from server (version 21.13.1):
Code: 47. DB::Exception: Received from localhost:9000. DB::Exception: Missing columns: 'map.values' 'map.keys' while processing query: 'WITH map(1, 'val1', 2, 'val2') AS map SELECT map.keys, map.values', required columns: 'map.keys' 'map.values'. (UNKNOWN_IDENTIFIER)
```
</issue>

I need you to solve the provided issue by generating a code fix that can be applied directly to the repository

Respond below:
