diff --git a/tests/queries/0_stateless/01495_subqueries_in_with_statement.reference b/tests/queries/0_stateless/01495_subqueries_in_with_statement.reference
new file mode 100644
index 000000000000..8e851cd3ba1b
--- /dev/null
+++ b/tests/queries/0_stateless/01495_subqueries_in_with_statement.reference
@@ -0,0 +1,14 @@
+0
+1
+2
+3
+4
+2	3
+4	5
+2	3
+4	5
+1	1	2
+3	3	4
+4	5
+4	5
+4	5
diff --git a/tests/queries/0_stateless/01495_subqueries_in_with_statement.sql b/tests/queries/0_stateless/01495_subqueries_in_with_statement.sql
new file mode 100644
index 000000000000..9ec921a9d4cb
--- /dev/null
+++ b/tests/queries/0_stateless/01495_subqueries_in_with_statement.sql
@@ -0,0 +1,13 @@
+DROP TABLE IF EXISTS test1;
+
+CREATE TABLE test1(i int, j int) ENGINE Log;
+
+INSERT INTO test1 VALUES (1, 2), (3, 4);
+
+WITH test1 AS (SELECT * FROM numbers(5)) SELECT * FROM test1;
+WITH test1 AS (SELECT i + 1, j + 1 FROM test1) SELECT * FROM test1;
+WITH test1 AS (SELECT i + 1, j + 1 FROM test1) SELECT * FROM (SELECT * FROM test1);
+SELECT * FROM (WITH test1 AS (SELECT toInt32(*) i FROM numbers(5)) SELECT * FROM test1) l ANY INNER JOIN test1 r on (l.i == r.i);
+WITH test1 AS (SELECT i + 1, j + 1 FROM test1) SELECT toInt64(4) i, toInt64(5) j FROM numbers(3) WHERE (i, j) IN test1;
+
+DROP TABLE IF EXISTS test1;
