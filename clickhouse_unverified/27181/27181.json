{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 27181,
  "instance_id": "ClickHouse__ClickHouse-27181",
  "issue_numbers": [
    "27169"
  ],
  "base_commit": "7f7bf9654b141b76323b56d57ff27e7b0a148c18",
  "patch": "diff --git a/src/Functions/MultiSearchFirstIndexImpl.h b/src/Functions/MultiSearchFirstIndexImpl.h\nindex bb0bb57b9db4..4b29577d0eb8 100644\n--- a/src/Functions/MultiSearchFirstIndexImpl.h\n+++ b/src/Functions/MultiSearchFirstIndexImpl.h\n@@ -42,6 +42,8 @@ struct MultiSearchFirstIndexImpl\n             }\n             ++iteration;\n         }\n+        if (iteration == 0)\n+            std::fill(res.begin(), res.end(), 0);\n     }\n };\n \ndiff --git a/src/Functions/MultiSearchFirstPositionImpl.h b/src/Functions/MultiSearchFirstPositionImpl.h\nindex 4743518e61e1..bb1017c43eee 100644\n--- a/src/Functions/MultiSearchFirstPositionImpl.h\n+++ b/src/Functions/MultiSearchFirstPositionImpl.h\n@@ -51,6 +51,8 @@ struct MultiSearchFirstPositionImpl\n             }\n             ++iteration;\n         }\n+        if (iteration == 0)\n+            std::fill(res.begin(), res.end(), 0);\n     }\n };\n \ndiff --git a/src/Functions/MultiSearchImpl.h b/src/Functions/MultiSearchImpl.h\nindex 5b881e2fd557..461af5c32951 100644\n--- a/src/Functions/MultiSearchImpl.h\n+++ b/src/Functions/MultiSearchImpl.h\n@@ -41,6 +41,8 @@ struct MultiSearchImpl\n             }\n             ++iteration;\n         }\n+        if (iteration == 0)\n+            std::fill(res.begin(), res.end(), 0);\n     }\n };\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/00233_position_function_family.reference b/tests/queries/0_stateless/00233_position_function_family.reference\nindex 1523094261f9..f6cacbc70270 100644\n--- a/tests/queries/0_stateless/00233_position_function_family.reference\n+++ b/tests/queries/0_stateless/00233_position_function_family.reference\n@@ -23796,3 +23796,19 @@\n 1\n 1\n 1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\n+1\ndiff --git a/tests/queries/0_stateless/00233_position_function_family.sql b/tests/queries/0_stateless/00233_position_function_family.sql\nindex 8e443f5cd101..36f8a5535d9f 100644\n--- a/tests/queries/0_stateless/00233_position_function_family.sql\n+++ b/tests/queries/0_stateless/00233_position_function_family.sql\n@@ -483,6 +483,22 @@ select 1 = position('abab', materialize('ab'));\n select 1 = position('abababababababababababab', materialize('abab'));\n select 1 = position('abababababababababababab', materialize('abababababababababa'));\n \n+select 0 = multiSearchAny('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchAnyCaseInsensitive('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchAnyCaseInsensitiveUTF8('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchAnyUTF8('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstIndex('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstIndexCaseInsensitive('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstIndexCaseInsensitiveUTF8('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstIndexUTF8('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstPosition('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstPositionCaseInsensitive('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstPositionCaseInsensitiveUTF8('\\0', CAST([], 'Array(String)'));\n+select 0 = multiSearchFirstPositionUTF8('\\0', CAST([], 'Array(String)'));\n+select [] = multiSearchAllPositions('\\0', CAST([], 'Array(String)'));\n+select [] = multiSearchAllPositionsCaseInsensitive('\\0', CAST([], 'Array(String)'));\n+select [] = multiSearchAllPositionsCaseInsensitiveUTF8('\\0', CAST([], 'Array(String)'));\n+select [] = multiSearchAllPositionsUTF8('\\0', CAST([], 'Array(String)'));\n \n select [2] = multiSearchAllPositions(materialize('abcdefgh'), ['b']);\n select [2] = multiSearchAllPositions(materialize('abcdefgh'), ['bc']);\n@@ -1177,7 +1193,6 @@ select 0 = multiSearchAnyCaseInsensitiveUTF8(materialize('\u0428\u041d\u0432\u043f\u043a\u0444\u0417\u0432\u0433\u0414\u0436\n select 1 = multiSearchAnyCaseInsensitiveUTF8(materialize('\u0424\u0420\u0425\u0433\u0430\u0421\u043b\u0447\u0427\u041e\u0446\u043a\u0428\u0433\u0437\u043c\u041a\u0417\u0448\u0424\u0444\u0411\u0411\u0432\u0427'), ['\u043a\u0437\u0428\u0444\u0424\u0431', '\u0413\u0410\u0441\u043b\u0427\u0427\u041e\u0446\u043a\u0448\u0433', '\u0424\u0444\u0431\u0431\u0412\u0427', '\u0426\u043a\u0428', '', '\u0410\u0441\u043b\u0447\u0427\u041e\u0426\u041a\u0428\u0433\u0437\u041c\u043a\u0417\u0428\u0444\u0444\u0431\u0411\u0432\u0447', '\u0420\u0425\u0433\u0430\u0441\u043b\u0427\u0447\u041e\u0426\u041a\u0428\u0413\u0437', '\u0420\u0445\u0433\u0430\u0441\u043b\u0447\u0427\u041e\u0446\u041a\u0428\u0433\u0437\u041c\u043a\u0437\u0448\u0424\u0444\u0411\u0431\u0412', '\u0428\u0433', '\u0424', '\u0425\u0413\u0410\u0441\u043b\u0447\u0427\u043e\u0446\u041a\u0428\u0413\u0437\u041c\u043a\u0437\u0448', '\u0428\u0433\u0417\u043c\u041a\u0417\u0448\u0444\u0424\u0431']) from system.numbers limit 10;\n select 1 = multiSearchAnyCaseInsensitiveUTF8(materialize('\u0427\u0434\u0439\u0428\u043a\u0445\u041e\u043b\u0430\u043b\u0449\u041d\u0439\u0431\u0421\u0421\u0425\u041a\u0430\u0424\u0437\u041e\u041c\u0440\u041a\u0415\u0419\u0420'), ['\u0431\u0441\u0441\u0425\u043a\u0430\u0444\u0437\u041e\u043c', '\u0425\u041e\u041b\u0430\u041b\u0449\u043d\u0439\u0411\u0441\u0441\u0425\u043a\u0430\u0424\u0437', '\u043b\u0430\u041b\u0449\u043d\u0439\u0411\u0441\u0421\u0425', '\u0429\u043d\u0419\u0431\u0421\u0441\u0445\u041a\u0430\u0424\u0417\u041e', '\u0439\u0411\u0421\u0441\u0425\u041a\u0410\u0424\u0417\u041e\u043c\u0420', '\u0439\u0448\u043a\u0425\u043e\u043b\u0430\u041b\u0429\u041d\u0439\u0431\u0441\u0421\u0445\u041a', '\u0421', '', '\u0419\u0448\u043a\u0445\u041e\u043b\u0430\u043b\u0449\u041d\u0419\u0411\u0441\u0421\u0445\u041a\u0430\u0424\u0437\u043e\u043c', '\u0419\u0440', '\u0449\u043d\u0419\u0411\u0441\u0441\u0445\u041a\u0410\u0444\u0437\u043e\u041c\u0440\u041a', '\u0440\u041a\u0435']) from system.numbers limit 10;\n \n-\n select 1 = multiSearchFirstIndex(materialize('alhpvldsiwsydwhfdasqju'), ['sydwh', 'dwh', 'dwhfdasqj', 'w', 'briozrtpq', 'fdasq', 'lnuvpuxdhhuxjbolw', 'vldsiws', 'dasqju', 'uancllygwoifwnnp', 'wfxputfnen', 'hzaclvjumecnmweungz']) from system.numbers limit 10;\n select 0 = multiSearchFirstIndex(materialize('kcwchxxyujbhrxkxgnomg'), ['jmvqipszutxfnhdfaxqwoxcz', 'nrgzkbsakdtdiiyphozjoauyughyvlz', 'qbszx', 'sllthykcnttqecpequommemygee', 'bvsbdiufrrrjxaxzxgbd', 'hdkpcmpdyjildw', 'frxkyukiywngfcxfzwkcun', 'dmvxf', 'esamivybor', 'eoggdynqwlnlxr']) from system.numbers limit 10;\n select 0 = multiSearchFirstIndex(materialize('zggbeilrfpkleafjjldgyfgn'), ['rpypxkpgvljhqthneremvabcd', 'qchzlnsctuwkdxqcrjgihvtfxhqxfqsxm', 'vtozkivjyqcqetmqenuihq', 'fixcvjyzbzejmwdivjf', 'lydoolvnuuamwlnzbyuuwpqqjaxf', 'elkodwthxqpcybwezm', 'wpiju', 'wdzuuwumlqfvga', 'iokphkai', 'wkbwdstplhivjyk', 'wxfbhfturuqoymwklohawgwltptytc', 'jehprkzofqvurepbvuwdqj']) from system.numbers limit 10;\n",
  "problem_statement": "Msan on multiSearchFirstPositionCaseInsensitive (from 00746_sql_fuzzy.sh)\nReproduced on current master:\r\n\r\n\r\n```\r\nSELECT multiSearchFirstPositionCaseInsensitive('\\0', enabledRoles());\r\n```\r\n\r\n\r\nhttps://clickhouse-test-reports.s3.yandex.net/27078/cc0c3a90336f7527209e2be8d00089db8b9c2697/functional_stateless_tests_(memory).html\r\n\r\n\r\nLogs mirrored to:\r\nhttp://transfer.sh/1QoOQ3m/stderr.log\r\nhttp://transfer.sh/LJPpZ/clickhouse-server.log (only Fatal and queryid `cf20e9a5-a9df-4f32-8c2c-d7d535dd64e0`)\n",
  "hints_text": "",
  "created_at": "2021-08-04T13:45:29Z"
}