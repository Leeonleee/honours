{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 19224,
  "instance_id": "ClickHouse__ClickHouse-19224",
  "issue_numbers": [
    "19163"
  ],
  "base_commit": "1444ccb85e35e973bf0b454b012147dcfc5fcf6e",
  "patch": "diff --git a/docs/en/sql-reference/functions/date-time-functions.md b/docs/en/sql-reference/functions/date-time-functions.md\nindex 628c321adee3..9de780fb596c 100644\n--- a/docs/en/sql-reference/functions/date-time-functions.md\n+++ b/docs/en/sql-reference/functions/date-time-functions.md\n@@ -622,7 +622,7 @@ Using replacement fields, you can define a pattern for the resulting string. \u201c\n | %C       | year divided by 100 and truncated to integer (00-99)    | 20         |\n | %d       | day of the month, zero-padded (01-31)                   | 02         |\n | %D       | Short MM/DD/YY date, equivalent to %m/%d/%y             | 01/02/18   |\n-| %e       | day of the month, space-padded ( 1-31)                  | 2          |\n+| %e       | day of the month, space-padded ( 1-31)                  |  2         |\n | %F       | short YYYY-MM-DD date, equivalent to %Y-%m-%d           | 2018-01-02 |\n | %G       | four-digit year format for ISO week number, calculated from the week-based year [defined by the ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Week_dates) standard, normally useful only with %V  | 2018         |\n | %g       | two-digit year format, aligned to ISO 8601, abbreviated from four-digit notation                                | 18       |\n@@ -633,6 +633,7 @@ Using replacement fields, you can define a pattern for the resulting string. \u201c\n | %M       | minute (00-59)                                          | 33         |\n | %n       | new-line character (\u2018\u2019)                                 |            |\n | %p       | AM or PM designation                                    | PM         |\n+| %Q       | Quarter (1-4)                                           | 1          |\n | %R       | 24-hour HH:MM time, equivalent to %H:%M                 | 22:33      |\n | %S       | second (00-59)                                          | 44         |\n | %t       | horizontal-tab character (\u2019)                            |            |\ndiff --git a/docs/zh/sql-reference/functions/date-time-functions.md b/docs/zh/sql-reference/functions/date-time-functions.md\nindex 00dab5ee680e..df365ee9c1cd 100644\n--- a/docs/zh/sql-reference/functions/date-time-functions.md\n+++ b/docs/zh/sql-reference/functions/date-time-functions.md\n@@ -613,24 +613,25 @@ formatDateTime(Time, Format\\[, Timezone\\])\n | %C     | \u5e74\u9664\u4ee5100\u5e76\u622a\u65ad\u4e3a\u6574\u6570(00-99)                                                                                                                                                                        | 20         |\n | %d     | \u6708\u4e2d\u7684\u4e00\u5929\uff0c\u96f6\u586b\u5145\uff0801-31)                                                                                                                                                                          | 02         |\n | %D     | \u77edMM/DD/YY\u65e5\u671f\uff0c\u76f8\u5f53\u4e8e%m/%d/%y                                                                                                                                                                      | 01/02/2018 |\n-| %e     | \u6708\u4e2d\u7684\u4e00\u5929\uff0c\u7a7a\u683c\u586b\u5145\uff081-31)                                                                                                                                                                         | 2          |\n+| %e     | \u6708\u4e2d\u7684\u4e00\u5929\uff0c\u7a7a\u683c\u586b\u5145\uff08 1-31)                                                                                                                                                                         |  2          |\n | %F     | \u77edYYYY-MM-DD\u65e5\u671f\uff0c\u76f8\u5f53\u4e8e%Y-%m-%d                                                                                                                                                                    | 2018-01-02 |\n | %G     | ISO\u5468\u53f7\u7684\u56db\u4f4d\u6570\u5e74\u4efd\u683c\u5f0f\uff0c \u4ece\u57fa\u4e8e\u5468\u7684\u5e74\u4efd[\u7531ISO 8601\u5b9a\u4e49](https://en.wikipedia.org/wiki/ISO_8601#Week_dates) \u6807\u51c6\u8ba1\u7b97\u5f97\u51fa\uff0c\u901a\u5e38\u4ec5\u5bf9\uff05V\u6709\u7528 | 2018       |\n | %g     | \u4e24\u4f4d\u6570\u7684\u5e74\u4efd\u683c\u5f0f\uff0c\u4e0eISO 8601\u4e00\u81f4\uff0c\u56db\u4f4d\u6570\u8868\u793a\u6cd5\u7684\u7f29\u5199                                                                                                                    | 18         |\n | %H     | 24\u5c0f\u65f6\u683c\u5f0f\uff0800-23)                                                                                                                                                                                  | 22         |\n-| %I     | \u5c0f\u65f612h\u683c\u5f0f\uff0801-12)                                                                                                                                                                                 | 10         |\n-| %j     | \u4e00\u5e74(001-366)                                                                                                                                                                                       | 002        |\n+| %I     | 12\u5c0f\u65f6\u683c\u5f0f\uff0801-12)                                                                                                                                                                                 | 10         |\n+| %j     | \u4e00\u5e74\u4e2d\u7684\u4e00\u5929 (001-366)                                                                                                                                                                                       | 002        |\n | %m     | \u6708\u4efd\u4e3a\u5341\u8fdb\u5236\u6570\uff0801-12)                                                                                                                                                                              | 01         |\n | %M     | \u5206\u949f(00-59)                                                                                                                                                                                         | 33         |\n | %n     | \u6362\u884c\u7b26(\")                                                                                                                                                                                           |            |\n | %p     | AM\u6216PM\u6307\u5b9a                                                                                                                                                                                          | PM         |\n+| %Q     | \u5b63\u5ea6\uff081-4)                                                                                                                                                                          | 1          |\n | %R     | 24\u5c0f\u65f6HH:MM\u65f6\u95f4\uff0c\u76f8\u5f53\u4e8e%H:%M                                                                                                                                                                        | 22:33      |\n-| %S     | \u7b2c\u4e8c(00-59)                                                                                                                                                                                         | 44         |\n+| %S     | \u79d2 (00-59)                                                                                                                                                                                         | 44         |\n | %t     | \u6c34\u5e73\u5236\u8868\u7b26(\u2019)                                                                                                                                                                                       |            |\n | %T     | ISO8601\u65f6\u95f4\u683c\u5f0f(HH:MM:SS)\uff0c\u76f8\u5f53\u4e8e%H:%M:%S                                                                                                                                                           | 22:33:44   |\n-| %u     | ISO8601\u5e73\u65e5as\u7f16\u53f7\uff0c\u661f\u671f\u4e00\u4e3a1(1-7)                                                                                                                                                                   | 2          |\n+| %u     | ISO8601\u5de5\u4f5c\u65e5\u4e3a\u6570\u5b57\uff0c\u661f\u671f\u4e00\u4e3a1(1-7)                                                                                                                                                                   | 2          |\n | %V     | ISO8601\u5468\u7f16\u53f7(01-53)                                                                                                                                                                                | 01         |\n-| %w     | \u5468\u65e5\u4e3a\u5341\u8fdb\u5236\u6570\uff0c\u5468\u65e5\u4e3a0(0-6)                                                                                                                                                                        | 2          |\n+| %w     | \u5de5\u4f5c\u65e5\u4e3a\u5341\u8fdb\u5236\u6570\uff0c\u5468\u65e5\u4e3a0(0-6)                                                                                                                                                                        | 2          |\n | %y     | \u5e74\u4efd\uff0c\u6700\u540e\u4e24\u4f4d\u6570\u5b57\uff0800-99)                                                                                                                                                                          | 18         |\n | %Y     | \u5e74                                                                                                                                                                                                  | 2018       |\n | %%     | %\u7b26\u53f7                                                                                                                                                                                               | %          |\ndiff --git a/src/Functions/formatDateTime.cpp b/src/Functions/formatDateTime.cpp\nindex 362390a2cbc7..fd909ed6fce9 100644\n--- a/src/Functions/formatDateTime.cpp\n+++ b/src/Functions/formatDateTime.cpp\n@@ -272,6 +272,11 @@ class FunctionFormatDateTimeImpl : public IFunction\n             writeNumber2(target + 3, ToMinuteImpl::execute(source, timezone));\n             writeNumber2(target + 6, ToSecondImpl::execute(source, timezone));\n         }\n+\n+        static void quarter(char * target, Time source, const DateLUTImpl & timezone)\n+        {\n+            *target += ToQuarterImpl::execute(source, timezone);\n+        }\n     };\n \n public:\n@@ -621,6 +626,12 @@ class FunctionFormatDateTimeImpl : public IFunction\n                         result.append(\"0000\");\n                         break;\n \n+                    // Quarter (1-4)\n+                    case 'Q':\n+                        instructions.template emplace_back(&Action<T>::quarter, 1);\n+                        result.append(\"0\");\n+                        break;\n+\n                     /// Time components. If the argument is Date, not a DateTime, then this components will have default value.\n \n                     // Minute (00-59)\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01655_quarter_modificator_for_formatDateTime.reference b/tests/queries/0_stateless/01655_quarter_modificator_for_formatDateTime.reference\nnew file mode 100644\nindex 000000000000..94ebaf900161\n--- /dev/null\n+++ b/tests/queries/0_stateless/01655_quarter_modificator_for_formatDateTime.reference\n@@ -0,0 +1,4 @@\n+1\n+2\n+3\n+4\ndiff --git a/tests/queries/0_stateless/01655_quarter_modificator_for_formatDateTime.sql b/tests/queries/0_stateless/01655_quarter_modificator_for_formatDateTime.sql\nnew file mode 100644\nindex 000000000000..0d8a764082e7\n--- /dev/null\n+++ b/tests/queries/0_stateless/01655_quarter_modificator_for_formatDateTime.sql\n@@ -0,0 +1,4 @@\n+SELECT formatDateTime(toDate('2010-01-04'), '%Q');\n+SELECT formatDateTime(toDate('2010-04-30'), '%Q');\n+SELECT formatDateTime(toDate('2010-07-31'), '%Q');\n+SELECT formatDateTime(toDate('2010-10-07'), '%Q');\n",
  "problem_statement": "Add a %Q replacement fields to function formatDateTime to format date to quarter\n**Example**\r\n\r\nQuery:\r\n\r\n```` sql\r\nSELECT formatDateTime(toDate('2010-01-04'), '%Q')\r\n````\r\n\r\nResult:\r\n\r\n```` sql\r\n\u250c\u2500formatDateTime(toDate('2010-01-04'), '%Q')\u2500\u2510\r\n\u2502 1                                          \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n````\r\n\r\n\n",
  "hints_text": "Would you please assign this to me if possible?",
  "created_at": "2021-01-18T04:24:15Z"
}