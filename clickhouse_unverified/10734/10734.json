{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 10734,
  "instance_id": "ClickHouse__ClickHouse-10734",
  "issue_numbers": [
    "10583"
  ],
  "base_commit": "6edb0ea96219355c40b92c474b5de4a70a38719d",
  "patch": "diff --git a/src/Storages/StorageGenerateRandom.cpp b/src/Storages/StorageGenerateRandom.cpp\nindex 70b84c076b74..8c186f38943a 100644\n--- a/src/Storages/StorageGenerateRandom.cpp\n+++ b/src/Storages/StorageGenerateRandom.cpp\n@@ -338,43 +338,46 @@ class GenerateSource : public SourceWithProgress\n {\n public:\n     GenerateSource(UInt64 block_size_, UInt64 max_array_length_, UInt64 max_string_length_, UInt64 random_seed_, Block block_header_, const Context & context_)\n-        : SourceWithProgress(block_header_), block_size(block_size_), max_array_length(max_array_length_), max_string_length(max_string_length_)\n-        , block_header(block_header_), rng(random_seed_), context(context_) {}\n+        : SourceWithProgress(Nested::flatten(prepareBlockToFill(block_header_)))\n+        , block_size(block_size_), max_array_length(max_array_length_), max_string_length(max_string_length_)\n+        , block_to_fill(std::move(block_header_)), rng(random_seed_), context(context_) {}\n \n     String getName() const override { return \"GenerateRandom\"; }\n \n protected:\n     Chunk generate() override\n     {\n-        /// To support Nested types, we will collect them to single Array of Tuple.\n-        auto names_and_types = Nested::collect(block_header.getNamesAndTypesList());\n-\n         Columns columns;\n-        columns.reserve(names_and_types.size());\n+        columns.reserve(block_to_fill.columns());\n \n-        Block compact_block;\n-        for (const auto & elem : names_and_types)\n-        {\n-            compact_block.insert(\n-            {\n-                fillColumnWithRandomData(elem.type, block_size, max_array_length, max_string_length, rng, context),\n-                elem.type,\n-                elem.name\n-            });\n-        }\n+        for (const auto & elem : block_to_fill)\n+            columns.emplace_back(fillColumnWithRandomData(elem.type, block_size, max_array_length, max_string_length, rng, context));\n \n-        return {Nested::flatten(compact_block).getColumns(), block_size};\n+        columns = Nested::flatten(block_to_fill.cloneWithColumns(std::move(columns))).getColumns();\n+        return {std::move(columns), block_size};\n     }\n \n private:\n     UInt64 block_size;\n     UInt64 max_array_length;\n     UInt64 max_string_length;\n-    Block block_header;\n+    Block block_to_fill;\n \n     pcg64 rng;\n \n     const Context & context;\n+\n+    static Block & prepareBlockToFill(Block & block)\n+    {\n+        /// To support Nested types, we will collect them to single Array of Tuple.\n+        auto names_and_types = Nested::collect(block.getNamesAndTypesList());\n+        block.clear();\n+\n+        for (auto & column : names_and_types)\n+            block.insert(ColumnWithTypeAndName(column.type, column.name));\n+\n+        return block;\n+    }\n };\n \n }\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01274_generate_random_nested.reference b/tests/queries/0_stateless/01274_generate_random_nested.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/01274_generate_random_nested.sh b/tests/queries/0_stateless/01274_generate_random_nested.sh\nnew file mode 100755\nindex 000000000000..025ad2be32c8\n--- /dev/null\n+++ b/tests/queries/0_stateless/01274_generate_random_nested.sh\n@@ -0,0 +1,6 @@\n+#!/usr/bin/env bash\n+\n+CURDIR=$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\n+. $CURDIR/../shell_config.sh\n+\n+${CLICKHOUSE_CURL} -sS $CLICKHOUSE_URL -d \"SELECT * FROM generateRandom('\\\"ParsedParams.Key1\\\" Array(String), \\\"ParsedParams.Key2\\\" Array(Float64), x String', 1, 10, 2) LIMIT 10\" > /dev/null;\n\\ No newline at end of file\n",
  "problem_statement": "Column with Array type is not represented by ColumnArray column: FixedString(size = 100000).\n\r\n**How to reproduce**\r\n* ClickHouse server version 20.3.7 revision 54433.\r\n``` sql\r\nCREATE TABLE mass_table_169 ON CLUSTER mdbumosolg396n0tk705 (`WatchID` UInt64, `JavaEnable` UInt8, `Title` String, `GoodEvent` Int16, `EventTime` DateTime, `EventDate` Date, `CounterID` UInt32, `ClientIP` UInt32, `ClientIP6` FixedString(16), `RegionID` UInt32, `UserID` UInt64, `CounterClass` Int8, `OS` UInt8, `UserAgent` UInt8, `URL` String, `Referer` String, `URLDomain` String, `RefererDomain` String, `Refresh` UInt8, `IsRobot` UInt8, `RefererCategories` Array(UInt16), `URLCategories` Array(UInt16), `URLRegions` Array(UInt32), `RefererRegions` Array(UInt32), `ResolutionWidth` UInt16, `ResolutionHeight` UInt16, `ResolutionDepth` UInt8, `FlashMajor` UInt8, `FlashMinor` UInt8, `FlashMinor2` String, `NetMajor` UInt8, `NetMinor` UInt8, `UserAgentMajor` UInt16, `UserAgentMinor` FixedString(2), `CookieEnable` UInt8, `JavascriptEnable` UInt8, `IsMobile` UInt8, `MobilePhone` UInt8, `MobilePhoneModel` String, `Params` String, `IPNetworkID` UInt32, `TraficSourceID` Int8, `SearchENGINEID` UInt16, `SearchPhrase` String, `AdvENGINEID` UInt8, `IsArtifical` UInt8, `WindowClientWidth` UInt16, `WindowClientHeight` UInt16, `ClientTimeZone` Int16, `ClientEventTime` DateTime, `SilverlightVersion1` UInt8, `SilverlightVersion2` UInt8, `SilverlightVersion3` UInt32, `SilverlightVersion4` UInt16, `PageCharset` String, `CodeVersion` UInt32, `IsLink` UInt8, `IsDownload` UInt8, `IsNotBounce` UInt8, `FUniqID` UInt64, `HID` UInt32, `IsOldCounter` UInt8, `IsEvent` UInt8, `IsParameter` UInt8, `DontCountHits` UInt8, `WithHash` UInt8, `HitColor` FixedString(1), `UTCEventTime` DateTime, `Age` UInt8, `Sex` UInt8, `Income` UInt8, `Interests` UInt16, `Robotness` UInt8, `GeneralInterests` Array(UInt16), `RemoteIP` UInt32, `RemoteIP6` FixedString(16), `WindowName` Int32, `OpenerName` Int32, `HistoryLength` Int16, `BrowserLanguage` FixedString(2), `BrowserCountry` FixedString(2), `SocialNetwork` String, `SocialAction` String, `HTTPError` UInt16, `SendTiming` Int32, `DNSTiming` Int32, `ConnectTiming` Int32, `ResponseStartTiming` Int32, `ResponseEndTiming` Int32, `FetchTiming` Int32, `RedirectTiming` Int32, `DOMInteractiveTiming` Int32, `DOMContentLoadedTiming` Int32, `DOMCompleteTiming` Int32, `LoadEventStartTiming` Int32, `LoadEventEndTiming` Int32, `NSToDOMContentLoadedTiming` Int32, `FirstPaintTiming` Int32, `RedirectCount` Int8, `SocialSourceNetworkID` UInt8, `SocialSourcePage` String, `ParamPrice` Int64, `ParamOrderID` String, `ParamCurrency` FixedString(3), `ParamCurrencyID` UInt16, `GoalsReached` Array(UInt32), `OpenstatServiceName` String, `OpenstatCampaignID` String, `OpenstatAdID` String, `OpenstatSourceID` String, `UTMSource` String, `UTMMedium` String, `UTMCampaign` String, `UTMContent` String, `UTMTerm` String, `FromTag` String, `HasGCLID` UInt8, `RefererHash` UInt64, `URLHash` UInt64, `CLID` UInt32, `YCLID` UInt64, `ShareService` String, `ShareURL` String, `ShareTitle` String, `ParsedParams.Key1` Array(String), `ParsedParams.Key2` Array(String), `ParsedParams.Key3` Array(String), `ParsedParams.Key4` Array(String), `ParsedParams.Key5` Array(String), `ParsedParams.ValueDouble` Array(Float64), `IslandID` FixedString(16), `RequestNum` UInt32, `RequestTry` UInt8) ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/mass_table_169', '{replica}') PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate, intHash32(UserID)) SAMPLE BY intHash32(UserID) SETTINGS index_granularity=8192, enable_mixed_granularity_parts=1, index_granularity_bytes=0;\r\nINSERT INTO mass_table_169 SELECT `WatchID`, `JavaEnable`,`Title`,`GoodEvent`,`EventTime`,(today() - 2 + EventDate % 5) as EventDate,`CounterID`, `ClientIP`, `ClientIP6` ,`RegionID`, `UserID`, `CounterClass`,`OS`,`UserAgent`,`URL`,`Referer`,`URLDomain`,`RefererDomain`,`Refresh`,`IsRobot`,`RefererCategories` ,`URLCategories` ,`URLRegions` ,`RefererRegions` ,`ResolutionWidth`,`ResolutionHeight`,`ResolutionDepth`,`FlashMajor`,`FlashMinor`,`FlashMinor2`,`NetMajor`,`NetMinor`,`UserAgentMajor`,`UserAgentMinor` ,`CookieEnable`,`JavascriptEnable`,`IsMobile`,`MobilePhone`,`MobilePhoneModel`,`Params`,`IPNetworkID`, `TraficSourceID`,`SearchENGINEID`,`SearchPhrase`,`AdvENGINEID`,`IsArtifical`,`WindowClientWidth`,`WindowClientHeight`,`ClientTimeZone`,`ClientEventTime`,`SilverlightVersion1`,`SilverlightVersion2`,`SilverlightVersion3`, `SilverlightVersion4`,`PageCharset`,`CodeVersion`, `IsLink`,`IsDownload`,`IsNotBounce`,`FUniqID`, `HID`, `IsOldCounter`,`IsEvent`,`IsParameter`,`DontCountHits`,`WithHash`,`HitColor` ,`UTCEventTime`,`Age`,`Sex`,`Income`,`Interests`,`Robotness`,`GeneralInterests` ,`RemoteIP`, `RemoteIP6` ,`WindowName`, `OpenerName`, `HistoryLength`,`BrowserLanguage` ,`BrowserCountry` ,`SocialNetwork`,`SocialAction`,`HTTPError`,`SendTiming`, `DNSTiming`, `ConnectTiming`, `ResponseStartTiming`, `ResponseEndTiming`, `FetchTiming`, `RedirectTiming`, `DOMInteractiveTiming`, `DOMContentLoadedTiming`, `DOMCompleteTiming`, `LoadEventStartTiming`, `LoadEventEndTiming`, `NSToDOMContentLoadedTiming`, `FirstPaintTiming`, `RedirectCount`,`SocialSourceNetworkID`,`SocialSourcePage`,`ParamPrice`, `ParamOrderID`,`ParamCurrency` ,`ParamCurrencyID`,`GoalsReached` ,`OpenstatServiceName`,`OpenstatCampaignID`,`OpenstatAdID`,`OpenstatSourceID`,`UTMSource`,`UTMMedium`,`UTMCampaign`,`UTMContent`,`UTMTerm`,`FromTag`,`HasGCLID`,`RefererHash`, `URLHash`, `CLID`, `YCLID`, `ShareService`,`ShareURL`,`ShareTitle`,`ParsedParams.Key1` ,`ParsedParams.Key2` ,`ParsedParams.Key3` ,`ParsedParams.Key4` ,`ParsedParams.Key5` ,`ParsedParams.ValueDouble` ,`IslandID` ,`RequestNum`, `RequestTry` FROM generateRandom('`WatchID` UInt64,`JavaEnable` UInt8,`Title` String,`GoodEvent` Int16,`EventTime` DateTime,`EventDate` Date,`CounterID` UInt32,`ClientIP` UInt32,`ClientIP6` FixedString(16),`RegionID` UInt32,`UserID` UInt64,`CounterClass` Int8,`OS` UInt8,`UserAgent` UInt8,`URL` String,`Referer` String,`URLDomain` String,`RefererDomain` String,`Refresh` UInt8,`IsRobot` UInt8,`RefererCategories` Array(UInt16),`URLCategories` Array(UInt16),`URLRegions` Array(UInt32),`RefererRegions` Array(UInt32),`ResolutionWidth` UInt16,`ResolutionHeight` UInt16,`ResolutionDepth` UInt8,`FlashMajor` UInt8,`FlashMinor` UInt8,`FlashMinor2` String,`NetMajor` UInt8,`NetMinor` UInt8,`UserAgentMajor` UInt16,`UserAgentMinor` FixedString(2),`CookieEnable` UInt8,`JavascriptEnable` UInt8,`IsMobile` UInt8,`MobilePhone` UInt8,`MobilePhoneModel` String,`Params` String,`IPNetworkID` UInt32,`TraficSourceID` Int8,`SearchENGINEID` UInt16,`SearchPhrase` String,`AdvENGINEID` UInt8,`IsArtifical` UInt8,`WindowClientWidth` UInt16,`WindowClientHeight` UInt16,`ClientTimeZone` Int16,`ClientEventTime` DateTime,`SilverlightVersion1` UInt8,`SilverlightVersion2` UInt8,`SilverlightVersion3` UInt32,`SilverlightVersion4` UInt16,`PageCharset` String,`CodeVersion` UInt32,`IsLink` UInt8,`IsDownload` UInt8,`IsNotBounce` UInt8,`FUniqID` UInt64,`HID` UInt32,`IsOldCounter` UInt8,`IsEvent` UInt8,`IsParameter` UInt8,`DontCountHits` UInt8,`WithHash` UInt8,`HitColor` FixedString(1),`UTCEventTime` DateTime,`Age` UInt8,`Sex` UInt8,`Income` UInt8,`Interests` UInt16,`Robotness` UInt8,`GeneralInterests` Array(UInt16),`RemoteIP` UInt32,`RemoteIP6` FixedString(16),`WindowName` Int32,`OpenerName` Int32,`HistoryLength` Int16,`BrowserLanguage` FixedString(2),`BrowserCountry` FixedString(2),`SocialNetwork` String,`SocialAction` String,`HTTPError` UInt16,`SendTiming` Int32,`DNSTiming` Int32,`ConnectTiming` Int32,`ResponseStartTiming` Int32,`ResponseEndTiming` Int32,`FetchTiming` Int32,`RedirectTiming` Int32,`DOMInteractiveTiming` Int32,`DOMContentLoadedTiming` Int32,`DOMCompleteTiming` Int32,`LoadEventStartTiming` Int32,`LoadEventEndTiming` Int32,`NSToDOMContentLoadedTiming` Int32,`FirstPaintTiming` Int32,`RedirectCount` Int8,`SocialSourceNetworkID` UInt8,`SocialSourcePage` String,`ParamPrice` Int64,`ParamOrderID` String,`ParamCurrency` FixedString(3),`ParamCurrencyID` UInt16,`GoalsReached` Array(UInt32),`OpenstatServiceName` String,`OpenstatCampaignID` String,`OpenstatAdID` String,`OpenstatSourceID` String,`UTMSource` String,`UTMMedium` String,`UTMCampaign` String,`UTMContent` String,`UTMTerm` String,`FromTag` String,`HasGCLID` UInt8,`RefererHash` UInt64,`URLHash` UInt64,`CLID` UInt32,`YCLID` UInt64,`ShareService` String,`ShareURL` String,`ShareTitle` String,`ParsedParams.Key1` Array(String),`ParsedParams.Key2` Array(String),`ParsedParams.Key3` Array(String),`ParsedParams.Key4` Array(String),`ParsedParams.Key5` Array(String),`ParsedParams.ValueDouble` Array(Float64),`IslandID` FixedString(16),`RequestNum` UInt32,`RequestTry` UInt8', 1, 10, 2) LIMIT 100000;\r\n```\r\n\r\n**Error message and/or stacktrace**\r\n```\r\n[vla-6twf28t3rlhvk2nv.db.yandex.net] 2020.04.29 18:30:16.957006 [ 341044 ] {246475f2-9590-4fcb-bb0a-bea2ed2e9184} <Error> executeQuery: Code: 44, e.displayText() = DB::Exception: Column with Array type is not represented by ColumnArray column: FixedString(size = 100000) (version 20.3.7.46 (official build)) (from [2a02:6b8:c1b:2212:0:696:3f8:0]:51118) (in query: INSERT INTO mass_table_169 SELECT WatchID, JavaEnable, Title, GoodEvent, EventTime, (today() - 2) + (EventDate % 5) AS EventDate, CounterID, ClientIP, ClientIP6, RegionID, UserID, CounterClass, OS, UserAgent, URL, Referer, URLDomain, RefererDomain, Refresh, IsRobot, RefererCategories, URLCategories, URLRegions, RefererRegions, ResolutionWidth, ResolutionHeight, ResolutionDepth, FlashMajor, FlashMinor, FlashMinor2, NetMajor, NetMinor, UserAgentMajor, UserAgentMinor, CookieEnable, JavascriptEnable, IsMobile, MobilePhone, MobilePhoneModel, Params, IPNetworkID, TraficSourceID, SearchENGINEID, SearchPhrase, AdvENGINEID, IsArtifical, WindowClientWidth, WindowClientHeight, ClientTimeZone, ClientEventTime, SilverlightVersion1, SilverlightVersion2, SilverlightVersion3, SilverlightVersion4, PageCharset, CodeVersion, IsLink, IsDownload, IsNotBounce, FUniqID, HID, IsOldCounter, IsEvent, IsParameter, DontCountHits, WithHash, HitColor, UTCEventTime, Age, Sex, Income, Interests, Robotness, GeneralInterests, RemoteIP, RemoteIP6, WindowName, OpenerName, HistoryLength, BrowserLanguage, BrowserCountry, SocialNetwork, SocialAction, HTTPError, SendTiming, DNSTiming, ConnectTiming, ResponseStartTiming, ResponseEndTiming, FetchTiming, RedirectTiming, DOMInteractiveTiming, DOMContentLoadedTiming, DOMCompleteTiming, LoadEventStartTiming, LoadEventEndTiming, NSToDOMContentLoadedTiming, FirstPaintTiming, RedirectCount, SocialSourceNetworkID, SocialSourcePage, ParamPrice, ParamOrderID, ParamCurrency, ParamCurrencyID, GoalsReached, OpenstatServiceName, OpenstatCampaignID, OpenstatAdID, OpenstatSourceID, UTMSource, UTMMedium, UTMCampaign, UTMContent, UTMTerm, FromTag, HasGCLID, RefererHash, URLHash, CLID, YCLID, ShareService, ShareURL, ShareTitle, `ParsedParams.Key1`, `ParsedParams.Key2`, `ParsedParams.Key3`, `ParsedParams.Key4`, `ParsedParams.Key5`, `ParsedParams.ValueDouble`, IslandID, RequestNum, RequestTry FROM generateRandom('`WatchID` UInt64,`JavaEnable` UInt8,`Title` String,`GoodEvent` Int16,`EventTime` DateTime,`EventDate` Date,`CounterID` UInt32,`ClientIP` UInt32,`ClientIP6` FixedString(16),`RegionID` UInt32,`UserID` UInt64,`CounterClass` Int8,`OS` UInt8,`UserAgent` UInt8,`URL` String,`Referer` String,`URLDomain` String,`RefererDomain` String,`Refresh` UInt8,`IsRobot` UInt8,`RefererCategories` Array(UInt16),`URLCategories` Array(UInt16),`URLRegions` Array(UInt32),`RefererRegions` Array(UInt32),`ResolutionWidth` UInt16,`ResolutionHeight` UInt16,`ResolutionDepth` UInt8,`FlashMajor` UInt8,`FlashMinor` UInt8,`FlashMinor2` String,`NetMajor` UInt8,`NetMinor` UInt8,`UserAgentMajor` UInt16,`UserAgentMinor` FixedString(2),`CookieEnable` UInt8,`JavascriptEnable` UInt8,`IsMobile` UInt8,`MobilePhone` UInt8,`MobilePhoneModel` String,`Params` String,`IPNetworkID` UInt32,`TraficSourceID` Int8,`SearchENGINEID` UInt16,`SearchPhrase` String,`AdvENGINEID` UInt8,`IsArtifical` UInt8,`WindowClientWidth` UInt16,`WindowClientHeight` UInt16,`ClientTimeZone` Int16,`ClientEventTime` DateTime,`SilverlightVersion1` UInt8,`SilverlightVersion2` UInt8,`SilverlightVersion3` UInt32,`SilverlightVersion4` UInt16,`PageCharset` String,`CodeVersion` UInt32,`IsLink` UInt8,`IsDownload` UInt8,`IsNotBounce` UInt8,`FUniqID` UInt64,`HID` UInt32,`IsOldCounter` UInt8,`IsEvent` UInt8,`IsParameter` UInt8,`DontCountHits` UInt8,`WithHash` UInt8,`HitColor` FixedString(1),`UTCEventTime` DateTime,`Age` UInt8,`Sex` UInt8,`Income` UInt8,`Interests` UInt16,`Robotness` UInt8,`GeneralInterests` Array(UInt16),`RemoteIP` UInt32,`RemoteIP6` FixedString(16),`WindowName` Int32,`OpenerName` Int32,`HistoryLength` Int16,`BrowserLanguage` FixedString(2),`BrowserCountry` FixedString(2),`SocialNetwork` String,`SocialAction` String,`HTTPError` UInt16,`SendTiming` Int32,`DNSTiming` Int32,`ConnectTiming` Int32,`ResponseStartTiming` Int32,`ResponseEndTiming` Int32,`FetchTiming` Int32,`RedirectTiming` Int32,`DOMInteractiveTiming` Int32,`DOMContentLoadedTiming` Int32,`DOMCompleteTiming` Int32,`LoadEventStartTiming` Int32,`LoadEventEndTiming` Int32,`NSToDOMContentLoadedTiming` Int32,`FirstPaintTiming` Int32,`RedirectCount` Int8,`SocialSourceNetworkID` UInt8,`SocialSourcePage` String,`ParamPrice` Int64,`ParamOrderID` String,`ParamCurrency` FixedString(3),`ParamCurrencyID` UInt16,`GoalsReached` Array(UInt32),`OpenstatServiceName` String,`OpenstatCampaignID` String,`OpenstatAdID` String,`OpenstatSourceID` String,`UTMSource` String,`UTMMedium` String,`UTMCampaign` String,`UTMContent` String,`UTMTerm` String,`FromTag` String,`HasGCLID` UInt8,`RefererHash` UInt64,`URLHash` UInt64,`CLID` UInt32,`YCLID` UInt64,`ShareService` String,`ShareURL` String,`ShareTitle` String,`ParsedParams.Key1` Array(String),`ParsedParams.Key2` Array(String),`ParsedParams.Key3` Array(String),`ParsedParams.Key4` Array(String),`ParsedParams.Key5` Array(String),`ParsedParams.ValueDouble` Array(Float64),`IslandID` FixedString(16),`RequestNum` UInt32,`RequestTry` UInt8', 1, 10, 2) LIMIT 100000), Stack trace (when copying this message, always include the lines below):\r\n\r\n0. /build/obj-x86_64-linux-gnu/../contrib/poco/Foundation/src/Exception.cpp:27: Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x10541260 in /usr/lib/debug/usr/bin/clickhouse\r\n1. /build/obj-x86_64-linux-gnu/../src/Common/Exception.cpp:29: DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x8f3f72d in /usr/lib/debug/usr/bin/clickhouse\r\n2. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/string:2134: DB::Nested::validateArraySizes(DB::Block const&) (.cold) @ 0xcf7684d in /usr/lib/debug/usr/bin/clickhouse\r\n3. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:3821: DB::PushingToViewsBlockOutputStream::write(DB::Block const&) @ 0xd0d4726 in /usr/lib/debug/usr/bin/clickhouse\r\n4. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/map:1090: DB::SquashingBlockOutputStream::writeSuffix() @ 0xd0e286a in /usr/lib/debug/usr/bin/clickhouse\r\n5. /build/obj-x86_64-linux-gnu/../src/DataStreams/copyData.cpp:139: DB::copyData(DB::IBlockInputStream&, DB::IBlockOutputStream&, std::__1::atomic<bool>*) @ 0xce981de in /usr/lib/debug/usr/bin/clickhouse\r\n6. /build/obj-x86_64-linux-gnu/../src/DataStreams/NullAndDoCopyBlockInputStream.h:57: DB::NullAndDoCopyBlockInputStream::readImpl() @ 0xd0ce8fa in /usr/lib/debug/usr/bin/clickhouse\r\n7. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:1003: DB::IBlockInputStream::read() @ 0xce5942f in /usr/lib/debug/usr/bin/clickhouse\r\n8. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:1003: DB::AsynchronousBlockInputStream::calculate() @ 0xce4dc78 in /usr/lib/debug/usr/bin/clickhouse\r\n9. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/atomic:856: std::__1::__function::__func<DB::AsynchronousBlockInputStream::next()::'lambda'(), std::__1::allocator<DB::AsynchronousBlockInputStream::next()::'lambda'()>, void ()>::operator()() @ 0xce4f458 in /usr/lib/debug/usr/bin/clickhouse\r\n10. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/atomic:856: ThreadPoolImpl<ThreadFromGlobalPool>::worker(std::__1::__list_iterator<ThreadFromGlobalPool, void*>) @ 0x8f6492b in /usr/lib/debug/usr/bin/clickhouse\r\n11. /build/obj-x86_64-linux-gnu/../src/Common/ThreadPool.h:159: ThreadFromGlobalPool::ThreadFromGlobalPool<void ThreadPoolImpl<ThreadFromGlobalPool>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(void&&, void ThreadPoolImpl<ThreadFromGlobalPool>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()&&...)::'lambda'()::operator()() const @ 0x8f65608 in /usr/lib/debug/usr/bin/clickhouse\r\n12. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/atomic:856: ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0x8f637eb in /usr/lib/debug/usr/bin/clickhouse\r\n13. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2615: void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()> >(void*) @ 0x8f61c33 in /usr/lib/debug/usr/bin/clickhouse\r\n14. start_thread @ 0x76db in /lib/x86_64-linux-gnu/libpthread-2.27.so\r\n15. __clone @ 0x12188f in /lib/x86_64-linux-gnu/libc-2.27.so\r\n\r\nReceived exception from server (version 20.3.7):\r\nCode: 44. DB::Exception: Received from vla-6twf28t3rlhvk2nv.db.yandex.net:9440. DB::Exception: Column with Array type is not represented by ColumnArray column: FixedString(size = 100000).\r\n```\r\n\n",
  "hints_text": "You mean:\r\n\r\n```\r\ncurl http://localhost:8123/ -d \"SELECT * FROM generateRandom('\\\"ParsedParams.Key1\\\" Array(String), \\\"ParsedParams.Key2\\\" Array(Float64), x String', 1, 10, 2) LIMIT 10\"\r\ncurl: (52) Empty reply from server\r\n```\nYour request kills 20.4 prestable\r\n```\r\n2020.05.06 18:27:31.772125 [ 745456 ] {} <Trace> BaseDaemon: Received signal 11\r\n2020.05.06 18:27:31.772330 [ 748841 ] {} <Fatal> BaseDaemon: ########################################\r\n2020.05.06 18:27:31.772405 [ 748841 ] {} <Fatal> BaseDaemon: (version 20.4.2.2 (official build)) (from thread 745819) (query_id: dec89dc8-4199-4f08-b411-0e60da6f040b) Received signal Segmentation fault (11).\r\n2020.05.06 18:27:31.772432 [ 748841 ] {} <Fatal> BaseDaemon: Address: 0x3f7ffff8 Access: read. Address not mapped to object.\r\n2020.05.06 18:27:31.772451 [ 748841 ] {} <Fatal> BaseDaemon: Stack trace: 0xce75127 0xdb52229 0xdb520b2 0xdb1ff85 0xdb07ce1 0xdb0bc9d 0xdb0ddd8 0xdb0dfa5 0xd538a7b 0x90dd7fc 0x90e1256 0x102b35e3 0x102ee9ab 0x102eee3b 0x1049ca06 0x10497cc0 0x7f9b013126db 0x7f9b019e988f\r\n2020.05.06 18:27:31.772502 [ 748841 ] {} <Fatal> BaseDaemon: 3. DB::DataTypeArray::serializeText(DB::IColumn const&, unsigned long, DB::WriteBuffer&, DB::FormatSettings const&) const @ 0xce75127 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772527 [ 748841 ] {} <Fatal> BaseDaemon: 4. DB::IRowOutputFormat::write(std::__1::vector<COW<DB::IColumn>::immutable_ptr<DB::IColumn>, std::__1::allocator<COW<DB::IColumn>::immutable_ptr<DB::IColumn> > > const&, unsigned long) @ 0xdb52229 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772548 [ 748841 ] {} <Fatal> BaseDaemon: 5. DB::IRowOutputFormat::consume(DB::Chunk) @ 0xdb520b2 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772564 [ 748841 ] {} <Fatal> BaseDaemon: 6. DB::IOutputFormat::work() @ 0xdb1ff85 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772580 [ 748841 ] {} <Fatal> BaseDaemon: 7. ? @ 0xdb07ce1 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772595 [ 748841 ] {} <Fatal> BaseDaemon: 8. DB::PipelineExecutor::executeSingleThread(unsigned long, unsigned long) @ 0xdb0bc9d in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772610 [ 748841 ] {} <Fatal> BaseDaemon: 9. DB::PipelineExecutor::executeImpl(unsigned long) @ 0xdb0ddd8 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772625 [ 748841 ] {} <Fatal> BaseDaemon: 10. DB::PipelineExecutor::execute(unsigned long) @ 0xdb0dfa5 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772663 [ 748841 ] {} <Fatal> BaseDaemon: 11. DB::executeQuery(DB::ReadBuffer&, DB::WriteBuffer&, bool, DB::Context&, std::__1::function<void (std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)>) @ 0xd538a7b in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772685 [ 748841 ] {} <Fatal> BaseDaemon: 12. DB::HTTPHandler::processQuery(Poco::Net::HTTPServerRequest&, HTMLForm&, Poco::Net::HTTPServerResponse&, DB::HTTPHandler::Output&) @ 0x90dd7fc in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.772700 [ 748841 ] {} <Fatal> BaseDaemon: 13. DB::HTTPHandler::handleRequest(Poco::Net::HTTPServerRequest&, Poco::Net::HTTPServerResponse&) @ 0x90e1256 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.773314 [ 748841 ] {} <Fatal> BaseDaemon: 14. Poco::Net::HTTPServerConnection::run() @ 0x102b35e3 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.773338 [ 748841 ] {} <Fatal> BaseDaemon: 15. Poco::Net::TCPServerConnection::start() @ 0x102ee9ab in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.773357 [ 748841 ] {} <Fatal> BaseDaemon: 16. Poco::Net::TCPServerDispatcher::run() @ 0x102eee3b in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.773373 [ 748841 ] {} <Fatal> BaseDaemon: 17. Poco::PooledThread::run() @ 0x1049ca06 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.773389 [ 748841 ] {} <Fatal> BaseDaemon: 18. Poco::ThreadImpl::runnableEntry(void*) @ 0x10497cc0 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2020.05.06 18:27:31.773412 [ 748841 ] {} <Fatal> BaseDaemon: 19. start_thread @ 0x76db in /lib/x86_64-linux-gnu/libpthread-2.27.so\r\n2020.05.06 18:27:31.773473 [ 748841 ] {} <Fatal> BaseDaemon: 20. /build/glibc-OTsEL5/glibc-2.27/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:97: clone @ 0x12188f in /usr/lib/debug/lib/x86_64-linux-gnu/libc-2.27.so\r\n```\r\n\r\n``` sql\r\nCREATE TABLE mass_table_169 (`WatchID` UInt64, `JavaEnable` UInt8, `Title` String, `GoodEvent` Int16, `EventTime` DateTime, `EventDate` Date, `CounterID` UInt32, `ClientIP` UInt32, `ClientIP6` FixedString(16), `RegionID` UInt32, `UserID` UInt64, `CounterClass` Int8, `OS` UInt8, `UserAgent` UInt8, `URL` String, `Referer` String, `URLDomain` String, `RefererDomain` String, `Refresh` UInt8, `IsRobot` UInt8, `RefererCategories` Array(UInt16), `URLCategories` Array(UInt16), `URLRegions` Array(UInt32), `RefererRegions` Array(UInt32), `ResolutionWidth` UInt16, `ResolutionHeight` UInt16, `ResolutionDepth` UInt8, `FlashMajor` UInt8, `FlashMinor` UInt8, `FlashMinor2` String, `NetMajor` UInt8, `NetMinor` UInt8, `UserAgentMajor` UInt16, `UserAgentMinor` FixedString(2), `CookieEnable` UInt8, `JavascriptEnable` UInt8, `IsMobile` UInt8, `MobilePhone` UInt8, `MobilePhoneModel` String, `Params` String, `IPNetworkID` UInt32, `TraficSourceID` Int8, `SearchENGINEID` UInt16, `SearchPhrase` String, `AdvENGINEID` UInt8, `IsArtifical` UInt8, `WindowClientWidth` UInt16, `WindowClientHeight` UInt16, `ClientTimeZone` Int16, `ClientEventTime` DateTime, `SilverlightVersion1` UInt8, `SilverlightVersion2` UInt8, `SilverlightVersion3` UInt32, `SilverlightVersion4` UInt16, `PageCharset` String, `CodeVersion` UInt32, `IsLink` UInt8, `IsDownload` UInt8, `IsNotBounce` UInt8, `FUniqID` UInt64, `HID` UInt32, `IsOldCounter` UInt8, `IsEvent` UInt8, `IsParameter` UInt8, `DontCountHits` UInt8, `WithHash` UInt8, `HitColor` FixedString(1), `UTCEventTime` DateTime, `Age` UInt8, `Sex` UInt8, `Income` UInt8, `Interests` UInt16, `Robotness` UInt8, `GeneralInterests` Array(UInt16), `RemoteIP` UInt32, `RemoteIP6` FixedString(16), `WindowName` Int32, `OpenerName` Int32, `HistoryLength` Int16, `BrowserLanguage` FixedString(2), `BrowserCountry` FixedString(2), `SocialNetwork` String, `SocialAction` String, `HTTPError` UInt16, `SendTiming` Int32, `DNSTiming` Int32, `ConnectTiming` Int32, `ResponseStartTiming` Int32, `ResponseEndTiming` Int32, `FetchTiming` Int32, `RedirectTiming` Int32, `DOMInteractiveTiming` Int32, `DOMContentLoadedTiming` Int32, `DOMCompleteTiming` Int32, `LoadEventStartTiming` Int32, `LoadEventEndTiming` Int32, `NSToDOMContentLoadedTiming` Int32, `FirstPaintTiming` Int32, `RedirectCount` Int8, `SocialSourceNetworkID` UInt8, `SocialSourcePage` String, `ParamPrice` Int64, `ParamOrderID` String, `ParamCurrency` FixedString(3), `ParamCurrencyID` UInt16, `GoalsReached` Array(UInt32), `OpenstatServiceName` String, `OpenstatCampaignID` String, `OpenstatAdID` String, `OpenstatSourceID` String, `UTMSource` String, `UTMMedium` String, `UTMCampaign` String, `UTMContent` String, `UTMTerm` String, `FromTag` String, `HasGCLID` UInt8, `RefererHash` UInt64, `URLHash` UInt64, `CLID` UInt32, `YCLID` UInt64, `ShareService` String, `ShareURL` String, `ShareTitle` String, `ParsedParams.Key1` Array(String), `ParsedParams.Key2` Array(String), `ParsedParams.Key3` Array(String), `ParsedParams.Key4` Array(String), `ParsedParams.Key5` Array(String), `ParsedParams.ValueDouble` Array(Float64), `IslandID` FixedString(16), `RequestNum` UInt32, `RequestTry` UInt8) ENGINE = MergeTree PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate, intHash32(UserID)) SAMPLE BY intHash32(UserID) SETTINGS index_granularity=8192, enable_mixed_granularity_parts=1, index_granularity_bytes=0;\r\nINSERT INTO mass_table_169 SELECT `WatchID`, `JavaEnable`,`Title`,`GoodEvent`,`EventTime`,(today() - 2 + EventDate % 5) as EventDate,`CounterID`, `ClientIP`, `ClientIP6` ,`RegionID`, `UserID`, `CounterClass`,`OS`,`UserAgent`,`URL`,`Referer`,`URLDomain`,`RefererDomain`,`Refresh`,`IsRobot`,`RefererCategories` ,`URLCategories` ,`URLRegions` ,`RefererRegions` ,`ResolutionWidth`,`ResolutionHeight`,`ResolutionDepth`,`FlashMajor`,`FlashMinor`,`FlashMinor2`,`NetMajor`,`NetMinor`,`UserAgentMajor`,`UserAgentMinor` ,`CookieEnable`,`JavascriptEnable`,`IsMobile`,`MobilePhone`,`MobilePhoneModel`,`Params`,`IPNetworkID`, `TraficSourceID`,`SearchENGINEID`,`SearchPhrase`,`AdvENGINEID`,`IsArtifical`,`WindowClientWidth`,`WindowClientHeight`,`ClientTimeZone`,`ClientEventTime`,`SilverlightVersion1`,`SilverlightVersion2`,`SilverlightVersion3`, `SilverlightVersion4`,`PageCharset`,`CodeVersion`, `IsLink`,`IsDownload`,`IsNotBounce`,`FUniqID`, `HID`, `IsOldCounter`,`IsEvent`,`IsParameter`,`DontCountHits`,`WithHash`,`HitColor` ,`UTCEventTime`,`Age`,`Sex`,`Income`,`Interests`,`Robotness`,`GeneralInterests` ,`RemoteIP`, `RemoteIP6` ,`WindowName`, `OpenerName`, `HistoryLength`,`BrowserLanguage` ,`BrowserCountry` ,`SocialNetwork`,`SocialAction`,`HTTPError`,`SendTiming`, `DNSTiming`, `ConnectTiming`, `ResponseStartTiming`, `ResponseEndTiming`, `FetchTiming`, `RedirectTiming`, `DOMInteractiveTiming`, `DOMContentLoadedTiming`, `DOMCompleteTiming`, `LoadEventStartTiming`, `LoadEventEndTiming`, `NSToDOMContentLoadedTiming`, `FirstPaintTiming`, `RedirectCount`,`SocialSourceNetworkID`,`SocialSourcePage`,`ParamPrice`, `ParamOrderID`,`ParamCurrency` ,`ParamCurrencyID`,`GoalsReached` ,`OpenstatServiceName`,`OpenstatCampaignID`,`OpenstatAdID`,`OpenstatSourceID`,`UTMSource`,`UTMMedium`,`UTMCampaign`,`UTMContent`,`UTMTerm`,`FromTag`,`HasGCLID`,`RefererHash`, `URLHash`, `CLID`, `YCLID`, `ShareService`,`ShareURL`,`ShareTitle`,`ParsedParams.Key1` ,`ParsedParams.Key2` ,`ParsedParams.Key3` ,`ParsedParams.Key4` ,`ParsedParams.Key5` ,`ParsedParams.ValueDouble` ,`IslandID` ,`RequestNum`, `RequestTry` FROM generateRandom('`WatchID` UInt64,`JavaEnable` UInt8,`Title` String,`GoodEvent` Int16,`EventTime` DateTime,`EventDate` Date,`CounterID` UInt32,`ClientIP` UInt32,`ClientIP6` FixedString(16),`RegionID` UInt32,`UserID` UInt64,`CounterClass` Int8,`OS` UInt8,`UserAgent` UInt8,`URL` String,`Referer` String,`URLDomain` String,`RefererDomain` String,`Refresh` UInt8,`IsRobot` UInt8,`RefererCategories` Array(UInt16),`URLCategories` Array(UInt16),`URLRegions` Array(UInt32),`RefererRegions` Array(UInt32),`ResolutionWidth` UInt16,`ResolutionHeight` UInt16,`ResolutionDepth` UInt8,`FlashMajor` UInt8,`FlashMinor` UInt8,`FlashMinor2` String,`NetMajor` UInt8,`NetMinor` UInt8,`UserAgentMajor` UInt16,`UserAgentMinor` FixedString(2),`CookieEnable` UInt8,`JavascriptEnable` UInt8,`IsMobile` UInt8,`MobilePhone` UInt8,`MobilePhoneModel` String,`Params` String,`IPNetworkID` UInt32,`TraficSourceID` Int8,`SearchENGINEID` UInt16,`SearchPhrase` String,`AdvENGINEID` UInt8,`IsArtifical` UInt8,`WindowClientWidth` UInt16,`WindowClientHeight` UInt16,`ClientTimeZone` Int16,`ClientEventTime` DateTime,`SilverlightVersion1` UInt8,`SilverlightVersion2` UInt8,`SilverlightVersion3` UInt32,`SilverlightVersion4` UInt16,`PageCharset` String,`CodeVersion` UInt32,`IsLink` UInt8,`IsDownload` UInt8,`IsNotBounce` UInt8,`FUniqID` UInt64,`HID` UInt32,`IsOldCounter` UInt8,`IsEvent` UInt8,`IsParameter` UInt8,`DontCountHits` UInt8,`WithHash` UInt8,`HitColor` FixedString(1),`UTCEventTime` DateTime,`Age` UInt8,`Sex` UInt8,`Income` UInt8,`Interests` UInt16,`Robotness` UInt8,`GeneralInterests` Array(UInt16),`RemoteIP` UInt32,`RemoteIP6` FixedString(16),`WindowName` Int32,`OpenerName` Int32,`HistoryLength` Int16,`BrowserLanguage` FixedString(2),`BrowserCountry` FixedString(2),`SocialNetwork` String,`SocialAction` String,`HTTPError` UInt16,`SendTiming` Int32,`DNSTiming` Int32,`ConnectTiming` Int32,`ResponseStartTiming` Int32,`ResponseEndTiming` Int32,`FetchTiming` Int32,`RedirectTiming` Int32,`DOMInteractiveTiming` Int32,`DOMContentLoadedTiming` Int32,`DOMCompleteTiming` Int32,`LoadEventStartTiming` Int32,`LoadEventEndTiming` Int32,`NSToDOMContentLoadedTiming` Int32,`FirstPaintTiming` Int32,`RedirectCount` Int8,`SocialSourceNetworkID` UInt8,`SocialSourcePage` String,`ParamPrice` Int64,`ParamOrderID` String,`ParamCurrency` FixedString(3),`ParamCurrencyID` UInt16,`GoalsReached` Array(UInt32),`OpenstatServiceName` String,`OpenstatCampaignID` String,`OpenstatAdID` String,`OpenstatSourceID` String,`UTMSource` String,`UTMMedium` String,`UTMCampaign` String,`UTMContent` String,`UTMTerm` String,`FromTag` String,`HasGCLID` UInt8,`RefererHash` UInt64,`URLHash` UInt64,`CLID` UInt32,`YCLID` UInt64,`ShareService` String,`ShareURL` String,`ShareTitle` String,`ParsedParams.Key1` Array(String),`ParsedParams.Key2` Array(String),`ParsedParams.Key3` Array(String),`ParsedParams.Key4` Array(String),`ParsedParams.Key5` Array(String),`ParsedParams.ValueDouble` Array(Float64),`IslandID` FixedString(16),`RequestNum` UInt32,`RequestTry` UInt8', 1, 10, 2) LIMIT 100000;\r\n```\r\n\r\nmine:\r\n```\r\n2020.05.06 18:31:29.640422 [ 749397 ] {4fd57a28-2743-4a1e-b6a1-2f526f8ced39} <Error> executeQuery: Code: 44, e.displayText() = DB::Exception: Column with Array type is not represented by ColumnArray column: FixedString(size = 100000) (version 20.4.2.2 (official build)) (from [::1]:54756) (in query: INSERT INTO mass_table_169 SELECT WatchID, JavaEnable, Title, GoodEvent, EventTime, (today() - 2) + (EventDate % 5) AS EventDate, CounterID, ClientIP, ClientIP6, RegionID, UserID, CounterClass, OS, UserAgent, URL, Referer, URLDomain, RefererDomain, Refresh, IsRobot, RefererCategories, URLCategories, URLRegions, RefererRegions, ResolutionWidth, ResolutionHeight, ResolutionDepth, FlashMajor, FlashMinor, FlashMinor2, NetMajor, NetMinor, UserAgentMajor, UserAgentMinor, CookieEnable, JavascriptEnable, IsMobile, MobilePhone, MobilePhoneModel, Params, IPNetworkID, TraficSourceID, SearchENGINEID, SearchPhrase, AdvENGINEID, IsArtifical, WindowClientWidth, WindowClientHeight, ClientTimeZone, ClientEventTime, SilverlightVersion1, SilverlightVersion2, SilverlightVersion3, SilverlightVersion4, PageCharset, CodeVersion, IsLink, IsDownload, IsNotBounce, FUniqID, HID, IsOldCounter, IsEvent, IsParameter, DontCountHits, WithHash, HitColor, UTCEventTime, Age, Sex, Income, Interests, Robotness, GeneralInterests, RemoteIP, RemoteIP6, WindowName, OpenerName, HistoryLength, BrowserLanguage, BrowserCountry, SocialNetwork, SocialAction, HTTPError, SendTiming, DNSTiming, ConnectTiming, ResponseStartTiming, ResponseEndTiming, FetchTiming, RedirectTiming, DOMInteractiveTiming, DOMContentLoadedTiming, DOMCompleteTiming, LoadEventStartTiming, LoadEventEndTiming, NSToDOMContentLoadedTiming, FirstPaintTiming, RedirectCount, SocialSourceNetworkID, SocialSourcePage, ParamPrice, ParamOrderID, ParamCurrency, ParamCurrencyID, GoalsReached, OpenstatServiceName, OpenstatCampaignID, OpenstatAdID, OpenstatSourceID, UTMSource, UTMMedium, UTMCampaign, UTMContent, UTMTerm, FromTag, HasGCLID, RefererHash, URLHash, CLID, YCLID, ShareService, ShareURL, ShareTitle, `ParsedParams.Key1`, `ParsedParams.Key2`, `ParsedParams.Key3`, `ParsedParams.Key4`, `ParsedParams.Key5`, `ParsedParams.ValueDouble`, IslandID, RequestNum, RequestTry FROM generateRandom('`WatchID` UInt64,`JavaEnable` UInt8,`Title` String,`GoodEvent` Int16,`EventTime` DateTime,`EventDate` Date,`CounterID` UInt32,`ClientIP` UInt32,`ClientIP6` FixedString(16),`RegionID` UInt32,`UserID` UInt64,`CounterClass` Int8,`OS` UInt8,`UserAgent` UInt8,`URL` String,`Referer` String,`URLDomain` String,`RefererDomain` String,`Refresh` UInt8,`IsRobot` UInt8,`RefererCategories` Array(UInt16),`URLCategories` Array(UInt16),`URLRegions` Array(UInt32),`RefererRegions` Array(UInt32),`ResolutionWidth` UInt16,`ResolutionHeight` UInt16,`ResolutionDepth` UInt8,`FlashMajor` UInt8,`FlashMinor` UInt8,`FlashMinor2` String,`NetMajor` UInt8,`NetMinor` UInt8,`UserAgentMajor` UInt16,`UserAgentMinor` FixedString(2),`CookieEnable` UInt8,`JavascriptEnable` UInt8,`IsMobile` UInt8,`MobilePhone` UInt8,`MobilePhoneModel` String,`Params` String,`IPNetworkID` UInt32,`TraficSourceID` Int8,`SearchENGINEID` UInt16,`SearchPhrase` String,`AdvENGINEID` UInt8,`IsArtifical` UInt8,`WindowClientWidth` UInt16,`WindowClientHeight` UInt16,`ClientTimeZone` Int16,`ClientEventTime` DateTime,`SilverlightVersion1` UInt8,`SilverlightVersion2` UInt8,`SilverlightVersion3` UInt32,`SilverlightVersion4` UInt16,`PageCharset` String,`CodeVersion` UInt32,`IsLink` UInt8,`IsDownload` UInt8,`IsNotBounce` UInt8,`FUniqID` UInt64,`HID` UInt32,`IsOldCounter` UInt8,`IsEvent` UInt8,`IsParameter` UInt8,`DontCountHits` UInt8,`WithHash` UInt8,`HitColor` FixedString(1),`UTCEventTime` DateTime,`Age` UInt8,`Sex` UInt8,`Income` UInt8,`Interests` UInt16,`Robotness` UInt8,`GeneralInterests` Array(UInt16),`RemoteIP` UInt32,`RemoteIP6` FixedString(16),`WindowName` Int32,`OpenerName` Int32,`HistoryLength` Int16,`BrowserLanguage` FixedString(2),`BrowserCountry` FixedString(2),`SocialNetwork` String,`SocialAction` String,`HTTPError` UInt16,`SendTiming` Int32,`DNSTiming` Int32,`ConnectTiming` Int32,`ResponseStartTiming` Int32,`ResponseEndTiming` Int32,`FetchTiming` Int32,`RedirectTiming` Int32,`DOMInteractiveTiming` Int32,`DOMContentLoadedTiming` Int32,`DOMCompleteTiming` Int32,`LoadEventStartTiming` Int32,`LoadEventEndTiming` Int32,`NSToDOMContentLoadedTiming` Int32,`FirstPaintTiming` Int32,`RedirectCount` Int8,`SocialSourceNetworkID` UInt8,`SocialSourcePage` String,`ParamPrice` Int64,`ParamOrderID` String,`ParamCurrency` FixedString(3),`ParamCurrencyID` UInt16,`GoalsReached` Array(UInt32),`OpenstatServiceName` String,`OpenstatCampaignID` String,`OpenstatAdID` String,`OpenstatSourceID` String,`UTMSource` String,`UTMMedium` String,`UTMCampaign` String,`UTMContent` String,`UTMTerm` String,`FromTag` String,`HasGCLID` UInt8,`RefererHash` UInt64,`URLHash` UInt64,`CLID` UInt32,`YCLID` UInt64,`ShareService` String,`ShareURL` String,`ShareTitle` String,`ParsedParams.Key1` Array(String),`ParsedParams.Key2` Array(String),`ParsedParams.Key3` Array(String),`ParsedParams.Key4` Array(String),`ParsedParams.Key5` Array(String),`ParsedParams.ValueDouble` Array(Float64),`IslandID` FixedString(16),`RequestNum` UInt32,`RequestTry` UInt8', 1, 10, 2) LIMIT 100000), Stack trace (when copying this message, always include the lines below):\r\n\r\n0. Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x10402c30 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n1. DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x8ff88ad in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n2. ? @ 0xcf44581 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n3. DB::PushingToViewsBlockOutputStream::write(DB::Block const&) @ 0xd1be166 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n4. DB::SquashingBlockOutputStream::finalize() @ 0xd1c2c97 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n5. DB::SquashingBlockOutputStream::writeSuffix() @ 0xd1c2d7d in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n6. DB::copyData(DB::IBlockInputStream&, DB::IBlockOutputStream&, std::__1::atomic<bool>*) @ 0xce64070 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n7. DB::NullAndDoCopyBlockInputStream::readImpl() @ 0xd1b77ca in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n8. DB::IBlockInputStream::read() @ 0xce34e5d in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n9. DB::AsynchronousBlockInputStream::calculate() @ 0xce2bb77 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n10. ? @ 0xce2bfd8 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n11. ThreadPoolImpl<ThreadFromGlobalPool>::worker(std::__1::__list_iterator<ThreadFromGlobalPool, void*>) @ 0x901f3ab in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n12. ThreadFromGlobalPool::ThreadFromGlobalPool<void ThreadPoolImpl<ThreadFromGlobalPool>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(void&&, void ThreadPoolImpl<ThreadFromGlobalPool>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()&&...)::'lambda'()::operator()() const @ 0x902017a in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n13. ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0x901e26b in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n14. ? @ 0x901c753 in /home/qoega/clickhouse-server/clickhouse-20.4/usr/bin/clickhouse\r\n15. start_thread @ 0x76db in /lib/x86_64-linux-gnu/libpthread-2.27.so\r\n16. /build/glibc-OTsEL5/glibc-2.27/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:97: clone @ 0x12188f in /usr/lib/debug/lib/x86_64-linux-gnu/libc-2.27.so\r\n```\nSame problem\r\n``` sql\r\nSELECT `WatchID`, `JavaEnable`,`Title`,`GoodEvent`,`EventTime`,(today() - 2 + EventDate % 5) as EventDate,`CounterID`, `ClientIP`, `ClientIP6` ,`RegionID`, `UserID`, `CounterClass`,`OS`,`UserAgent`,`URL`,`Referer`,`URLDomain`,`RefererDomain`,`Refresh`,`IsRobot`,`RefererCategories` ,`URLCategories` ,`URLRegions` ,`RefererRegions` ,`ResolutionWidth`,`ResolutionHeight`,`ResolutionDepth`,`FlashMajor`,`FlashMinor`,`FlashMinor2`,`NetMajor`,`NetMinor`,`UserAgentMajor`,`UserAgentMinor` ,`CookieEnable`,`JavascriptEnable`,`IsMobile`,`MobilePhone`,`MobilePhoneModel`,`Params`,`IPNetworkID`, `TraficSourceID`,`SearchENGINEID`,`SearchPhrase`,`AdvENGINEID`,`IsArtifical`,`WindowClientWidth`,`WindowClientHeight`,`ClientTimeZone`,`ClientEventTime`,`SilverlightVersion1`,`SilverlightVersion2`,`SilverlightVersion3`, `SilverlightVersion4`,`PageCharset`,`CodeVersion`, `IsLink`,`IsDownload`,`IsNotBounce`,`FUniqID`, `HID`, `IsOldCounter`,`IsEvent`,`IsParameter`,`DontCountHits`,`WithHash`,`HitColor` ,`UTCEventTime`,`Age`,`Sex`,`Income`,`Interests`,`Robotness`,`GeneralInterests` ,`RemoteIP`, `RemoteIP6` ,`WindowName`, `OpenerName`, `HistoryLength`,`BrowserLanguage` ,`BrowserCountry` ,`SocialNetwork`,`SocialAction`,`HTTPError`,`SendTiming`, `DNSTiming`, `ConnectTiming`, `ResponseStartTiming`, `ResponseEndTiming`, `FetchTiming`, `RedirectTiming`, `DOMInteractiveTiming`, `DOMContentLoadedTiming`, `DOMCompleteTiming`, `LoadEventStartTiming`, `LoadEventEndTiming`, `NSToDOMContentLoadedTiming`, `FirstPaintTiming`, `RedirectCount`,`SocialSourceNetworkID`,`SocialSourcePage`,`ParamPrice`, `ParamOrderID`,`ParamCurrency` ,`ParamCurrencyID`,`GoalsReached` ,`OpenstatServiceName`,`OpenstatCampaignID`,`OpenstatAdID`,`OpenstatSourceID`,`UTMSource`,`UTMMedium`,`UTMCampaign`,`UTMContent`,`UTMTerm`,`FromTag`,`HasGCLID`,`RefererHash`, `URLHash`, `CLID`, `YCLID`, `ShareService`,`ShareURL`,`ShareTitle`,`ParsedParams.Key1` ,`ParsedParams.Key2` ,`ParsedParams.Key3` ,`ParsedParams.Key4` ,`ParsedParams.Key5` ,`ParsedParams.ValueDouble` ,`IslandID` ,`RequestNum`, `RequestTry` FROM generateRandom('`WatchID` UInt64,`JavaEnable` UInt8,`Title` String,`GoodEvent` Int16,`EventTime` DateTime,`EventDate` Date,`CounterID` UInt32,`ClientIP` UInt32,`ClientIP6` FixedString(16),`RegionID` UInt32,`UserID` UInt64,`CounterClass` Int8,`OS` UInt8,`UserAgent` UInt8,`URL` String,`Referer` String,`URLDomain` String,`RefererDomain` String,`Refresh` UInt8,`IsRobot` UInt8,`RefererCategories` Array(UInt16),`URLCategories` Array(UInt16),`URLRegions` Array(UInt32),`RefererRegions` Array(UInt32),`ResolutionWidth` UInt16,`ResolutionHeight` UInt16,`ResolutionDepth` UInt8,`FlashMajor` UInt8,`FlashMinor` UInt8,`FlashMinor2` String,`NetMajor` UInt8,`NetMinor` UInt8,`UserAgentMajor` UInt16,`UserAgentMinor` FixedString(2),`CookieEnable` UInt8,`JavascriptEnable` UInt8,`IsMobile` UInt8,`MobilePhone` UInt8,`MobilePhoneModel` String,`Params` String,`IPNetworkID` UInt32,`TraficSourceID` Int8,`SearchENGINEID` UInt16,`SearchPhrase` String,`AdvENGINEID` UInt8,`IsArtifical` UInt8,`WindowClientWidth` UInt16,`WindowClientHeight` UInt16,`ClientTimeZone` Int16,`ClientEventTime` DateTime,`SilverlightVersion1` UInt8,`SilverlightVersion2` UInt8,`SilverlightVersion3` UInt32,`SilverlightVersion4` UInt16,`PageCharset` String,`CodeVersion` UInt32,`IsLink` UInt8,`IsDownload` UInt8,`IsNotBounce` UInt8,`FUniqID` UInt64,`HID` UInt32,`IsOldCounter` UInt8,`IsEvent` UInt8,`IsParameter` UInt8,`DontCountHits` UInt8,`WithHash` UInt8,`HitColor` FixedString(1),`UTCEventTime` DateTime,`Age` UInt8,`Sex` UInt8,`Income` UInt8,`Interests` UInt16,`Robotness` UInt8,`GeneralInterests` Array(UInt16),`RemoteIP` UInt32,`RemoteIP6` FixedString(16),`WindowName` Int32,`OpenerName` Int32,`HistoryLength` Int16,`BrowserLanguage` FixedString(2),`BrowserCountry` FixedString(2),`SocialNetwork` String,`SocialAction` String,`HTTPError` UInt16,`SendTiming` Int32,`DNSTiming` Int32,`ConnectTiming` Int32,`ResponseStartTiming` Int32,`ResponseEndTiming` Int32,`FetchTiming` Int32,`RedirectTiming` Int32,`DOMInteractiveTiming` Int32,`DOMContentLoadedTiming` Int32,`DOMCompleteTiming` Int32,`LoadEventStartTiming` Int32,`LoadEventEndTiming` Int32,`NSToDOMContentLoadedTiming` Int32,`FirstPaintTiming` Int32,`RedirectCount` Int8,`SocialSourceNetworkID` UInt8,`SocialSourcePage` String,`ParamPrice` Int64,`ParamOrderID` String,`ParamCurrency` FixedString(3),`ParamCurrencyID` UInt16,`GoalsReached` Array(UInt32),`OpenstatServiceName` String,`OpenstatCampaignID` String,`OpenstatAdID` String,`OpenstatSourceID` String,`UTMSource` String,`UTMMedium` String,`UTMCampaign` String,`UTMContent` String,`UTMTerm` String,`FromTag` String,`HasGCLID` UInt8,`RefererHash` UInt64,`URLHash` UInt64,`CLID` UInt32,`YCLID` UInt64,`ShareService` String,`ShareURL` String,`ShareTitle` String,`ParsedParams.Key1` Array(String),`ParsedParams.Key2` Array(String),`ParsedParams.Key3` Array(String),`ParsedParams.Key4` Array(String),`ParsedParams.Key5` Array(String),`ParsedParams.ValueDouble` Array(Float64),`IslandID` FixedString(16),`RequestNum` UInt32,`RequestTry` UInt8', 1, 10, 2) LIMIT 1;\r\n```\r\n\r\n```\r\nCode: 271, e.displayText() = DB::Exception: Data compressed with different methods, given method byte 0x69, previous method byte 0x82: while receiving packet from localhost:9000, Stack trace (when copying this message, always include the lines below):\r\n\r\n0. /home/qoega/clickhouse/build/../contrib/libcxx/include/exception:129: std::exception::capture() @ 0xd914ae3 in /home/qoega/clickhouse/build/programs/clickhouse\r\n1. /home/qoega/clickhouse/build/../contrib/libcxx/include/exception:109: Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x1d6c0a84 in /home/qoega/clickhouse/build/programs/clickhouse\r\n2. /home/qoega/clickhouse/build/../src/Common/Exception.cpp:32: DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0xd9423dc in /home/qoega/clickhouse/build/programs/clickhouse\r\n3. /home/qoega/clickhouse/build/../src/Compression/CompressedReadBufferBase.cpp:116: DB::CompressedReadBufferBase::readCompressedData(unsigned long&, unsigned long&) @ 0x16955bb1 in /home/qoega/clickhouse/build/programs/clickhouse\r\n4. /home/qoega/clickhouse/build/../src/Compression/CompressedReadBuffer.cpp:13: DB::CompressedReadBuffer::nextImpl() @ 0x169535e7 in /home/qoega/clickhouse/build/programs/clickhouse\r\n5. /home/qoega/clickhouse/build/../src/IO/ReadBuffer.h:53: DB::ReadBuffer::next() @ 0xd92a42e in /home/qoega/clickhouse/build/programs/clickhouse\r\n6. /home/qoega/clickhouse/build/../src/IO/ReadBuffer.h:81: DB::NativeBlockInputStream::readImpl() @ 0x1699c915 in /home/qoega/clickhouse/build/programs/clickhouse\r\n7. /home/qoega/clickhouse/build/../src/DataStreams/IBlockInputStream.cpp:60: DB::IBlockInputStream::read() @ 0x1698c47c in /home/qoega/clickhouse/build/programs/clickhouse\r\n8. /home/qoega/clickhouse/build/../src/Client/Connection.cpp:775: DB::Connection::receiveDataImpl(std::__1::shared_ptr<DB::IBlockInputStream>&) @ 0x181182a0 in /home/qoega/clickhouse/build/programs/clickhouse\r\n9. /home/qoega/clickhouse/build/../src/Client/Connection.cpp:755: DB::Connection::receiveData() @ 0x181180bd in /home/qoega/clickhouse/build/programs/clickhouse\r\n10. /home/qoega/clickhouse/build/../src/Client/Connection.cpp:704: DB::Connection::receivePacket() @ 0x1811728e in /home/qoega/clickhouse/build/programs/clickhouse\r\n11. /home/qoega/clickhouse/build/../programs/client/Client.cpp:1175: DB::Client::receiveAndProcessPacket() @ 0xdc13b37 in /home/qoega/clickhouse/build/programs/clickhouse\r\n12. /home/qoega/clickhouse/build/../programs/client/Client.cpp:1160: DB::Client::receiveResult() @ 0xdc136c7 in /home/qoega/clickhouse/build/programs/clickhouse\r\n13. /home/qoega/clickhouse/build/../programs/client/Client.cpp:915: DB::Client::processOrdinaryQuery() @ 0xdc0f661 in /home/qoega/clickhouse/build/programs/clickhouse\r\n14. /home/qoega/clickhouse/build/../programs/client/Client.cpp:811: DB::Client::processSingleQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::shared_ptr<DB::IAST>) @ 0xdc0d4d3 in /home/qoega/clickhouse/build/programs/clickhouse\r\n15. /home/qoega/clickhouse/build/../programs/client/Client.cpp:722: DB::Client::process(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0xdc0ba96 in /home/qoega/clickhouse/build/programs/clickhouse\r\n16. /home/qoega/clickhouse/build/../programs/client/Client.cpp:523: DB::Client::mainImpl() @ 0xdc03ab9 in /home/qoega/clickhouse/build/programs/clickhouse\r\n17. /home/qoega/clickhouse/build/../programs/client/Client.cpp:236: DB::Client::main(std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0xdbfbd58 in /home/qoega/clickhouse/build/programs/clickhouse\r\n18. /home/qoega/clickhouse/build/../contrib/poco/Util/src/Application.cpp:334: Poco::Util::Application::run() @ 0x1d5717ea in /home/qoega/clickhouse/build/programs/clickhouse\r\n19. /home/qoega/clickhouse/build/../programs/client/Client.cpp:1896: mainEntryClickHouseClient(int, char**) @ 0xdbf46ec in /home/qoega/clickhouse/build/programs/clickhouse\r\n20. /home/qoega/clickhouse/build/../programs/main.cpp:317: main @ 0xd900365 in /home/qoega/clickhouse/build/programs/clickhouse\r\n21. /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:344: __libc_start_main @ 0x21b97 in /usr/lib/debug/lib/x86_64-linux-gnu/libc-2.27.so\r\n22. _start @ 0xd8fe8ea in /home/qoega/clickhouse/build/programs/clickhouse\r\n```\nalso reproducing in 20.3.7.46",
  "created_at": "2020-05-07T15:28:34Z"
}