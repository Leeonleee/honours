{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 36130,
  "instance_id": "ClickHouse__ClickHouse-36130",
  "issue_numbers": [
    "36111"
  ],
  "base_commit": "ac74757f923402d67afa6202a7d8b46b9d2eedce",
  "patch": "diff --git a/src/Client/ClientBase.cpp b/src/Client/ClientBase.cpp\nindex e77d683d26f3..329fdc20cd93 100644\n--- a/src/Client/ClientBase.cpp\n+++ b/src/Client/ClientBase.cpp\n@@ -1838,7 +1838,7 @@ void ClientBase::runInteractive()\n     }\n \n     LineReader::Patterns query_extenders = {\"\\\\\"};\n-    LineReader::Patterns query_delimiters = {\";\", \"\\\\G\"};\n+    LineReader::Patterns query_delimiters = {\";\", \"\\\\G\", \"\\\\G;\"};\n \n #if USE_REPLXX\n     replxx::Replxx::highlighter_callback_t highlight_callback{};\n@@ -1860,9 +1860,13 @@ void ClientBase::runInteractive()\n             break;\n \n         has_vertical_output_suffix = false;\n-        if (input.ends_with(\"\\\\G\"))\n+        if (input.ends_with(\"\\\\G\") || input.ends_with(\"\\\\G;\"))\n         {\n-            input.resize(input.size() - 2);\n+            if (input.ends_with(\"\\\\G\"))\n+                input.resize(input.size() - 2);\n+            else if (input.ends_with(\"\\\\G;\"))\n+                input.resize(input.size() - 3);\n+\n             has_vertical_output_suffix = true;\n         }\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01293_client_interactive_vertical_multiline.expect b/tests/queries/0_stateless/01293_client_interactive_vertical_multiline.expect\nindex 5057ec44e8a7..07bdbcdac76e 100755\n--- a/tests/queries/0_stateless/01293_client_interactive_vertical_multiline.expect\n+++ b/tests/queries/0_stateless/01293_client_interactive_vertical_multiline.expect\n@@ -27,6 +27,11 @@ expect \"Row 1:\"\n expect \"1: 1\"\n expect \":) \"\n \n+send -- \"SELECT 1\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \":) \"\n+\n send -- \"SELECT 1\\\\\\r\"\n expect \":-] \"\n send -- \", 2\\r\"\n@@ -41,6 +46,14 @@ expect \"1: 1\"\n expect \"2: 2\"\n expect \":) \"\n \n+send -- \"SELECT 1\\\\\\r\"\n+expect \":-] \"\n+send -- \", 2\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \"2: 2\"\n+expect \":) \"\n+\n send -- \"\u0004\"\n expect eof\n \n@@ -56,6 +69,11 @@ expect \"Row 1:\"\n expect \"1: 1\"\n expect \":) \"\n \n+send -- \"SELECT 1\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \":) \"\n+\n send -- \"SELECT 1; \\r\"\n expect \"\u2502 1 \u2502\"\n expect \":) \"\n@@ -65,6 +83,11 @@ expect \"Row 1:\"\n expect \"1: 1\"\n expect \":) \"\n \n+send -- \"SELECT 1\\\\G; \\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \":) \"\n+\n send -- \"SELECT 1\\r\"\n expect \":-] \"\n send -- \";\\r\"\n@@ -78,6 +101,13 @@ expect \"Row 1:\"\n expect \"1: 1\"\n expect \":) \"\n \n+send -- \"SELECT 1\\r\"\n+expect \":-] \"\n+send -- \"\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \":) \"\n+\n send -- \"SELECT 1\\r\"\n expect \":-] \"\n send -- \", 2;\\r\"\n@@ -92,5 +122,14 @@ expect \"1: 1\"\n expect \"2: 2\"\n expect \":) \"\n \n+\n+send -- \"SELECT 1\\r\"\n+expect \":-] \"\n+send -- \", 2\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \"2: 2\"\n+expect \":) \"\n+\n send -- \"\u0004\"\n expect eof\ndiff --git a/tests/queries/0_stateless/01293_client_interactive_vertical_singleline.expect b/tests/queries/0_stateless/01293_client_interactive_vertical_singleline.expect\nindex 2f871ab46d80..085a11407538 100755\n--- a/tests/queries/0_stateless/01293_client_interactive_vertical_singleline.expect\n+++ b/tests/queries/0_stateless/01293_client_interactive_vertical_singleline.expect\n@@ -23,6 +23,12 @@ expect \"Row 1:\"\n expect \"1: 1\"\n expect \":) \"\n \n+\n+send -- \"SELECT 1\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \":) \"\n+\n send -- \"SELECT 1\\\\\\r\"\n expect \":-] \"\n send -- \", 2\\r\"\n@@ -37,5 +43,14 @@ expect \"1: 1\"\n expect \"2: 2\"\n expect \":) \"\n \n+\n+send -- \"SELECT 1\\\\\\r\"\n+expect \":-] \"\n+send -- \", 2\\\\G;\\r\"\n+expect \"Row 1:\"\n+expect \"1: 1\"\n+expect \"2: 2\"\n+expect \":) \"\n+\n send -- \"\u0004\"\n expect eof\n",
  "problem_statement": "Supporting \\G and semicolon after query in clickhouse-client to enable Vertical format\nCurrently executing queries like: \r\n\r\n```\r\nSELECT * FROM system.tables LIMIT 10;\\G \r\nSELECT * FROM system.tables LIMIT 10\\G;\r\n```\r\n\r\nEnds up with a syntax error.\r\n\r\nFrom the documentation, it should not be an error:\r\n\r\n> You can specify \\G instead of or after the semicolon.\r\n\r\n\n",
  "hints_text": "@melvynator Your issue description is incorrect.\r\n\r\nThis query works perfectly as per documentation:\r\n```\r\nSELECT * FROM system.tables LIMIT 10;\\G\r\n```\nPeople asked about the following query:\r\n\r\n```\r\nSELECT * FROM system.tables LIMIT 10\\G;\r\n```\r\n\r\nWhich is not supposed to work but can be implemented as a bonus feature.\nOk thanks, I will update the the description\nAlready updated.\nI will pull request  ASAP. ;)",
  "created_at": "2022-04-11T12:56:26Z"
}