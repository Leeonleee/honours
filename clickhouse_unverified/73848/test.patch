diff --git a/tests/queries/0_stateless/02141_clickhouse_local_interactive_table.reference b/tests/queries/0_stateless/02141_clickhouse_local_interactive_table.reference
index 0e74c0a083ec..277f4df04ab0 100644
--- a/tests/queries/0_stateless/02141_clickhouse_local_interactive_table.reference
+++ b/tests/queries/0_stateless/02141_clickhouse_local_interactive_table.reference
@@ -1,2 +1,2 @@
-CREATE TEMPORARY TABLE `table`
(
    `key` String
)
ENGINE = File(TSVWithNamesAndTypes, \'/dev/null\')
-CREATE TEMPORARY TABLE `table`
(
    `key` String
)
ENGINE = File(TSVWithNamesAndTypes, \'/dev/null\')
+CREATE TEMPORARY TABLE `table`
(
    `key` String
)
ENGINE = File(TSVWithNamesAndTypes, \'/dev/null\', auto)
+CREATE TEMPORARY TABLE `table`
(
    `key` String
)
ENGINE = File(TSVWithNamesAndTypes, \'/dev/null\', auto)
diff --git a/tests/queries/0_stateless/03297_input_compression_autodetect.reference b/tests/queries/0_stateless/03297_input_compression_autodetect.reference
new file mode 100644
index 000000000000..50edeb1fd436
--- /dev/null
+++ b/tests/queries/0_stateless/03297_input_compression_autodetect.reference
@@ -0,0 +1,51 @@
+0
+1
+2
+3
+4
+5
+6
+7
+8
+9
+0
+1
+2
+3
+4
+5
+6
+7
+8
+9
+---
+0
+1
+2
+3
+4
+5
+6
+7
+8
+9
+0
+1
+2
+3
+4
+5
+6
+7
+8
+9
+0
+1
+2
+3
+4
+5
+6
+7
+8
+9
diff --git a/tests/queries/0_stateless/03297_input_compression_autodetect.sh b/tests/queries/0_stateless/03297_input_compression_autodetect.sh
new file mode 100755
index 000000000000..81b4c160395f
--- /dev/null
+++ b/tests/queries/0_stateless/03297_input_compression_autodetect.sh
@@ -0,0 +1,22 @@
+#!/usr/bin/env bash
+# Tags: no-fasttest
+
+CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
+# shellcheck source=../shell_config.sh
+. "$CUR_DIR"/../shell_config.sh
+
+$CLICKHOUSE_LOCAL --query "SELECT number FROM numbers(10)" > "${CLICKHOUSE_TMP}/numbers.jsonl.gz"
+$CLICKHOUSE_LOCAL --query "SELECT * FROM table" < "${CLICKHOUSE_TMP}/numbers.jsonl.gz"
+$CLICKHOUSE_LOCAL --query "SELECT * FROM table" < "${CLICKHOUSE_TMP}/numbers.jsonl.gz" > "${CLICKHOUSE_TMP}/numbers.csv.bz2"
+$CLICKHOUSE_LOCAL --copy < "${CLICKHOUSE_TMP}/numbers.csv.bz2" > "${CLICKHOUSE_TMP}/numbers.parquet"
+$CLICKHOUSE_LOCAL --copy < "${CLICKHOUSE_TMP}/numbers.parquet"
+
+echo '---'
+
+$CLICKHOUSE_CLIENT --query "DROP TABLE IF EXISTS test"
+$CLICKHOUSE_CLIENT --query "CREATE TABLE test (number UInt64) ENGINE = Memory"
+$CLICKHOUSE_CLIENT --query "INSERT INTO test FORMAT JSONLines" < "${CLICKHOUSE_TMP}/numbers.jsonl.gz"
+$CLICKHOUSE_CLIENT --query "INSERT INTO test FORMAT CSV" < "${CLICKHOUSE_TMP}/numbers.csv.bz2"
+$CLICKHOUSE_CLIENT --query "INSERT INTO test SELECT c1 FROM input() FORMAT Parquet" < "${CLICKHOUSE_TMP}/numbers.parquet"
+$CLICKHOUSE_CLIENT --query "SELECT * FROM test"
+$CLICKHOUSE_CLIENT --query "DROP TABLE test"
