diff --git a/tests/queries/1_stateful/00175_obfuscator_schema_inference.reference b/tests/queries/1_stateful/00175_obfuscator_schema_inference.reference
new file mode 100644
index 000000000000..bd7f726bffdf
--- /dev/null
+++ b/tests/queries/1_stateful/00175_obfuscator_schema_inference.reference
@@ -0,0 +1,4 @@
+403489
+1000	320	171	23
+2500	597	332	14
+2500	597	332	14
diff --git a/tests/queries/1_stateful/00175_obfuscator_schema_inference.sh b/tests/queries/1_stateful/00175_obfuscator_schema_inference.sh
new file mode 100755
index 000000000000..8ff0d2fa648d
--- /dev/null
+++ b/tests/queries/1_stateful/00175_obfuscator_schema_inference.sh
@@ -0,0 +1,28 @@
+#!/usr/bin/env bash
+
+CURDIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
+# shellcheck source=../shell_config.sh
+. "$CURDIR"/../shell_config.sh
+
+# Compared to explicitly specifying the structure of the input,
+#  schema inference adds Nullable(T) to all types, so the model and the results
+#  are a bit different from test '00175_obfuscator_schema_inference.sh'
+
+$CLICKHOUSE_CLIENT --max_threads 1 --query="SELECT URL, Title, SearchPhrase FROM test.hits LIMIT 1000" > "${CLICKHOUSE_TMP}"/data.tsv
+
+# Test obfuscator without saving the model
+$CLICKHOUSE_OBFUSCATOR --input-format TSV --output-format TSV --seed hello --limit 2500 < "${CLICKHOUSE_TMP}"/data.tsv > "${CLICKHOUSE_TMP}"/data2500.tsv 2>/dev/null
+
+# Test obfuscator with saving the model
+$CLICKHOUSE_OBFUSCATOR --input-format TSV --output-format TSV --seed hello --limit 0 --save "${CLICKHOUSE_TMP}"/model.bin < "${CLICKHOUSE_TMP}"/data.tsv 2>/dev/null
+wc -c < "${CLICKHOUSE_TMP}"/model.bin
+$CLICKHOUSE_OBFUSCATOR --input-format TSV --output-format TSV --seed hello --limit 2500 --load "${CLICKHOUSE_TMP}"/model.bin < "${CLICKHOUSE_TMP}"/data.tsv > "${CLICKHOUSE_TMP}"/data2500_load_from_model.tsv 2>/dev/null
+rm "${CLICKHOUSE_TMP}"/model.bin
+
+$CLICKHOUSE_LOCAL --structure "URL String, Title String, SearchPhrase String" --input-format TSV --output-format TSV --query "SELECT count(), uniq(URL), uniq(Title), uniq(SearchPhrase) FROM table" < "${CLICKHOUSE_TMP}"/data.tsv
+$CLICKHOUSE_LOCAL --structure "URL String, Title String, SearchPhrase String" --input-format TSV --output-format TSV --query "SELECT count(), uniq(URL), uniq(Title), uniq(SearchPhrase) FROM table" < "${CLICKHOUSE_TMP}"/data2500.tsv
+$CLICKHOUSE_LOCAL --structure "URL String, Title String, SearchPhrase String" --input-format TSV --output-format TSV --query "SELECT count(), uniq(URL), uniq(Title), uniq(SearchPhrase) FROM table" < "${CLICKHOUSE_TMP}"/data2500_load_from_model.tsv
+
+rm "${CLICKHOUSE_TMP}"/data.tsv
+rm "${CLICKHOUSE_TMP}"/data2500.tsv
+rm "${CLICKHOUSE_TMP}"/data2500_load_from_model.tsv
