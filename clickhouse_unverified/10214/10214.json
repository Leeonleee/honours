{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 10214,
  "instance_id": "ClickHouse__ClickHouse-10214",
  "issue_numbers": [
    "10082"
  ],
  "base_commit": "8cb4dd275a1554f2f995dd27472f42f7b4359b53",
  "patch": "diff --git a/src/IO/parseDateTimeBestEffort.cpp b/src/IO/parseDateTimeBestEffort.cpp\nindex 2924ad88506e..7e40909226cd 100644\n--- a/src/IO/parseDateTimeBestEffort.cpp\n+++ b/src/IO/parseDateTimeBestEffort.cpp\n@@ -371,7 +371,10 @@ ReturnType parseDateTimeBestEffortImpl(\n         {\n             char c = *in.position();\n \n-            if (c == ' ' || c == 'T')\n+            /// 'T' is a separator between date and time according to ISO 8601.\n+            /// But don't skip it if we didn't read the date part yet, because 'T' is also a prefix for 'Tue' and 'Thu'.\n+\n+            if (c == ' ' || (c == 'T' && year && !has_time))\n             {\n                 ++in.position();\n             }\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.reference b/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.reference\nnew file mode 100644\nindex 000000000000..558ba34abcdb\n--- /dev/null\n+++ b/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.reference\n@@ -0,0 +1,2 @@\n+2018-08-18 07:22:16\n+2018-08-16 07:22:16\ndiff --git a/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.sql b/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.sql\nnew file mode 100644\nindex 000000000000..a4f6f1734026\n--- /dev/null\n+++ b/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.sql\n@@ -0,0 +1,2 @@\n+SELECT toTimeZone(parseDateTimeBestEffort('Thu, 18 Aug 2018 07:22:16 GMT'), 'UTC');\n+SELECT toTimeZone(parseDateTimeBestEffort('Tue, 16 Aug 2018 07:22:16 GMT'), 'UTC');\n",
  "problem_statement": "Error when using parseDateTimeBestEffort()\n\r\nWhen using parseDateTimeBestEffort() with strings which contains Tuesday (Tue) or Thursday (Thu) there is following error:\r\nCode: 41. DB::Exception: Received from 10.50.9.150:9000. DB::Exception: Cannot parse datetime: Cannot parse DateTime from String. \r\nWith strings which contains other weekdays (Mon, Wed etc.) it's work's like a charm\r\n\r\nquery:\r\nSELECT parseDateTimeBestEffort('Thu, 18 Aug 2018 07:22:16 GMT')\r\nversion: \r\nClickHouse server version 20.1.5.26 (official build).\r\ninterface:\r\nclickhouse-client\r\n\r\n**Expected behavior**\r\nSame as when you use other Weekdays \r\n\u250c\u2500parseDateTimeBestEffort('Mon, 18 Aug 2018 07:22:16 GMT')\u2500\u2510\r\n\u2502                                      2018-08-18 07:22:16                                \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\n\n",
  "hints_text": "",
  "created_at": "2020-04-12T19:35:09Z",
  "modified_files": [
    "src/IO/parseDateTimeBestEffort.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.reference",
    "b/tests/queries/0_stateless/01123_parse_date_time_best_effort_even_more.sql"
  ]
}