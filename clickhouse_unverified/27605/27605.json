{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 27605,
  "instance_id": "ClickHouse__ClickHouse-27605",
  "issue_numbers": [
    "27193"
  ],
  "base_commit": "c5250196a31d72bccd70d772ee2fe6b847459f8d",
  "patch": "diff --git a/base/common/DateLUTImpl.h b/base/common/DateLUTImpl.h\nindex 202eb88a361c..f2530c13f41d 100644\n--- a/base/common/DateLUTImpl.h\n+++ b/base/common/DateLUTImpl.h\n@@ -955,7 +955,7 @@ class DateLUTImpl\n     inline Time makeDateTime(Int16 year, UInt8 month, UInt8 day_of_month, UInt8 hour, UInt8 minute, UInt8 second) const\n     {\n         size_t index = makeLUTIndex(year, month, day_of_month);\n-        UInt32 time_offset = hour * 3600 + minute * 60 + second;\n+        Time time_offset = hour * 3600 + minute * 60 + second;\n \n         if (time_offset >= lut[index].time_at_offset_change())\n             time_offset -= lut[index].amount_of_offset_change();\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02006_todatetime64_from_string.reference b/tests/queries/0_stateless/02006_todatetime64_from_string.reference\nnew file mode 100644\nindex 000000000000..e95351fe8152\n--- /dev/null\n+++ b/tests/queries/0_stateless/02006_todatetime64_from_string.reference\n@@ -0,0 +1,1 @@\n+2021-03-21 23:00:00.000\ndiff --git a/tests/queries/0_stateless/02006_todatetime64_from_string.sql b/tests/queries/0_stateless/02006_todatetime64_from_string.sql\nnew file mode 100644\nindex 000000000000..305dd49f70ea\n--- /dev/null\n+++ b/tests/queries/0_stateless/02006_todatetime64_from_string.sql\n@@ -0,0 +1,1 @@\n+SELECT toDateTime64('2021-03-22', 3, 'Asia/Tehran');\n",
  "problem_statement": "Wrong conversion with `toDateTime64` and timezone.\nReproduces on master.\r\n\r\n```\r\nSELECT toDateTime64('2021-03-22', 3, 'Asia/Tehran')\r\n\r\nQuery id: 26f7c373-f473-4209-8976-6ada79a8627f\r\n\r\n\u250c\u2500toDateTime64('2021-03-22', 3, 'Asia/Tehran')\u2500\u2510\r\n\u2502                      2157-04-28 06:28:16.000 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\n",
  "hints_text": "",
  "created_at": "2021-08-12T07:43:54Z"
}