diff --git a/tests/integration/test_multiple_disks/test.py b/tests/integration/test_multiple_disks/test.py
index adf5d15ef314..e2b30b8f90ed 100644
--- a/tests/integration/test_multiple_disks/test.py
+++ b/tests/integration/test_multiple_disks/test.py
@@ -382,12 +382,18 @@ def test_round_robin(start_cluster, name, engine):
         used_disk = get_used_disks_for_table(node1, name)
         assert len(used_disk) == 1, 'More than one disk used for single insert'
 
+        # sleep is required because we order disks by their modification time, and if insert will be fast
+        # modification time of two disks will be equal, then sort will not provide deterministic results
+        time.sleep(5)
+
         node1.query_with_retry("insert into {} select * from numbers(10000, 10000)".format(name))
         used_disks = get_used_disks_for_table(node1, name)
 
         assert len(used_disks) == 2, 'Two disks should be used for two parts'
         assert used_disks[0] != used_disks[1], "Should write to different disks"
 
+        time.sleep(5)
+
         node1.query_with_retry("insert into {} select * from numbers(20000, 10000)".format(name))
         used_disks = get_used_disks_for_table(node1, name)
 
diff --git a/tests/integration/test_role/test.py b/tests/integration/test_role/test.py
index 1e253a937375..7600bc73b166 100644
--- a/tests/integration/test_role/test.py
+++ b/tests/integration/test_role/test.py
@@ -225,11 +225,11 @@ def test_introspection():
                 ["R2", "local directory"]])
 
     assert instance.query(
-        "SELECT * from system.grants WHERE user_name IN ('A', 'B') OR role_name IN ('R1', 'R2') ORDER BY user_name, role_name, access_type, grant_option") == \
+        "SELECT * from system.grants WHERE user_name IN ('A', 'B') OR role_name IN ('R1', 'R2') ORDER BY user_name, role_name, access_type, database, table, column, is_partial_revoke, grant_option") == \
            TSV([["A", "\\N", "SELECT", "test", "table", "\\N", 0, 0],
                 ["B", "\\N", "CREATE", "\\N", "\\N", "\\N", 0, 1],
-                ["\\N", "R2", "SELECT", "test", "table", "\\N", 0, 0],
-                ["\\N", "R2", "SELECT", "test", "table", "x", 1, 0]])
+                ["\\N", "R2", "SELECT", "test", "table", "x", 1, 0],
+                ["\\N", "R2", "SELECT", "test", "table", "\\N", 0, 0]])
 
     assert instance.query(
         "SELECT * from system.role_grants WHERE user_name IN ('A', 'B') OR role_name IN ('R1', 'R2') ORDER BY user_name, role_name, granted_role_name") == \
diff --git a/tests/queries/0_stateless/00301_csv.sh b/tests/queries/0_stateless/00301_csv.sh
index e10e98a123d6..50c64b312a7b 100755
--- a/tests/queries/0_stateless/00301_csv.sh
+++ b/tests/queries/0_stateless/00301_csv.sh
@@ -15,7 +15,7 @@ Hello "world", 789 ,2016-01-03
  default,,
  default-eof,,' | $CLICKHOUSE_CLIENT --input_format_defaults_for_omitted_fields=1 --input_format_csv_empty_as_default=1 --query="INSERT INTO csv FORMAT CSV";
 
-$CLICKHOUSE_CLIENT --query="SELECT * FROM csv ORDER BY d";
+$CLICKHOUSE_CLIENT --query="SELECT * FROM csv ORDER BY d, s";
 $CLICKHOUSE_CLIENT --query="DROP TABLE csv";
 
 $CLICKHOUSE_CLIENT --query="CREATE TABLE csv (t DateTime('Europe/Moscow'), s String) ENGINE = Memory";
diff --git a/tests/queries/0_stateless/00327_summing_composite_nested.reference b/tests/queries/0_stateless/00327_summing_composite_nested.reference
index b42332024476..38c96d85524d 100644
--- a/tests/queries/0_stateless/00327_summing_composite_nested.reference
+++ b/tests/queries/0_stateless/00327_summing_composite_nested.reference
@@ -1,8 +1,8 @@
 2000-01-01	1	[1,2]	[3,4]	[10,11]	[0,1,2]	['3','4','5']	[-1,-2,-3]	[1,10,100]
 2000-01-01	1	[2,1]	[4,3]	[20,22]	[2,2,1]	['5','5','0']	[-3,-3,-33]	[10,100,1000]
 2000-01-01	2	[1,2]	[3,4]	[10,11]	[0,1,2]	['3','4','5']	[-1,-2,-3]	[1,10,100]
-2000-01-01	2	[2,1,1]	[4,3,3]	[20,22,33]	[2,2]	['5','5']	[-3,-3]	[10,100]
 2000-01-01	2	[1,2]	[3,4]	[10,11]	[0,1,2]	['3','4','5']	[-1,-2,-3]	[1,10,100]
+2000-01-01	2	[2,1,1]	[4,3,3]	[20,22,33]	[2,2]	['5','5']	[-3,-3]	[10,100]
 2000-01-01	1	1	3	10
 2000-01-01	1	1	3	22
 2000-01-01	1	2	4	11
diff --git a/tests/queries/0_stateless/00327_summing_composite_nested.sql b/tests/queries/0_stateless/00327_summing_composite_nested.sql
index 9be21e87abfc..f9b251ebd8fa 100644
--- a/tests/queries/0_stateless/00327_summing_composite_nested.sql
+++ b/tests/queries/0_stateless/00327_summing_composite_nested.sql
@@ -5,11 +5,11 @@ CREATE TABLE summing_composite_key (d Date, k UInt64, FirstMap Nested(k1 UInt32,
 
 INSERT INTO summing_composite_key VALUES ('2000-01-01', 1, [1,2], ['3','4'], [10,11], [0,1,2], [3,4,5], [-1,-2,-3], [1,10,100]), ('2000-01-01', 1, [2,1], ['4','3'], [20,22], [2,2,1], [5,5,0], [-3,-3,-33], [10,100,1000]), ('2000-01-01', 2, [1,2], ['3','4'], [10,11], [0,1,2], [3,4,5], [-1,-2,-3], [1,10,100]), ('2000-01-01', 2, [2,1,1], ['4','3','3'], [20,22,33], [2,2], [5,5], [-3,-3], [10,100]), ('2000-01-01', 2, [1,2], ['3','4'], [10,11], [0,1,2], [3,4,5], [-1,-2,-3], [1,10,100]);
 
-SELECT * FROM summing_composite_key ORDER BY d, k, _part_index;
+SELECT * FROM summing_composite_key ORDER BY d, k, FirstMap.k1, FirstMap.k2ID, FirstMap.s, SecondMap.k1ID, SecondMap.k2Key, SecondMap.k3Type, SecondMap.s;
 
-SELECT d, k, m.k1, m.k2ID, m.s FROM summing_composite_key ARRAY JOIN FirstMap AS m ORDER BY d, k, m.k1, m.k2ID, m.s;
+SELECT d, k, m.k1, m.k2ID, m.s FROM summing_composite_key ARRAY JOIN FirstMap AS m ORDER BY d, k, m.k1, m.k2ID, m.s, SecondMap.k1ID, SecondMap.k2Key, SecondMap.k3Type, SecondMap.s;
 SELECT d, k, m.k1, m.k2ID, sum(m.s) FROM summing_composite_key ARRAY JOIN FirstMap AS m GROUP BY d, k, m.k1, m.k2ID ORDER BY d, k, m.k1, m.k2ID;
-SELECT d, k, m.k1, m.k2ID,m. s FROM summing_composite_key FINAL ARRAY JOIN FirstMap AS m ORDER BY d, k, m.k1, m.k2ID, m.s;
+SELECT d, k, m.k1, m.k2ID, m.s FROM summing_composite_key FINAL ARRAY JOIN FirstMap AS m ORDER BY d, k, m.k1, m.k2ID, m.s;
 
 SELECT d, k, m.k1ID, m.k2Key, m.k3Type, m.s FROM summing_composite_key ARRAY JOIN SecondMap AS m ORDER BY d, k, m.k1ID, m.k2Key, m.k3Type, m.s;
 SELECT d, k, m.k1ID, m.k2Key, m.k3Type, sum(m.s) FROM summing_composite_key ARRAY JOIN SecondMap AS m GROUP BY d, k, m.k1ID, m.k2Key, m.k3Type ORDER BY d, k, m.k1ID, m.k2Key, m.k3Type;
@@ -17,7 +17,7 @@ SELECT d, k, m.k1ID, m.k2Key, m.k3Type, m.s FROM summing_composite_key FINAL ARR
 
 OPTIMIZE TABLE summing_composite_key PARTITION 200001 FINAL;
 
-SELECT * FROM summing_composite_key ORDER BY d, k, _part_index;
+SELECT * FROM summing_composite_key ORDER BY d, k, FirstMap.k1, FirstMap.k2ID, FirstMap.s, SecondMap.k1ID, SecondMap.k2Key, SecondMap.k3Type, SecondMap.s;;
 
 SELECT d, k, m.k1, m.k2ID, m.s FROM summing_composite_key ARRAY JOIN FirstMap AS m ORDER BY d, k, m.k1, m.k2ID, m.s;
 SELECT d, k, m.k1, m.k2ID, sum(m.s) FROM summing_composite_key ARRAY JOIN FirstMap AS m GROUP BY d, k, m.k1, m.k2ID ORDER BY d, k, m.k1, m.k2ID;
diff --git a/tests/queries/0_stateless/00502_sum_map.sql b/tests/queries/0_stateless/00502_sum_map.sql
index 51007a9c78a4..3ceb5b82952b 100644
--- a/tests/queries/0_stateless/00502_sum_map.sql
+++ b/tests/queries/0_stateless/00502_sum_map.sql
@@ -5,7 +5,7 @@ CREATE TABLE sum_map(date Date, timeslot DateTime, statusMap Nested(status UInt1
 
 INSERT INTO sum_map VALUES ('2000-01-01', '2000-01-01 00:00:00', [1, 2, 3], [10, 10, 10]), ('2000-01-01', '2000-01-01 00:00:00', [3, 4, 5], [10, 10, 10]), ('2000-01-01', '2000-01-01 00:01:00', [4, 5, 6], [10, 10, 10]), ('2000-01-01', '2000-01-01 00:01:00', [6, 7, 8], [10, 10, 10]);
 
-SELECT * FROM sum_map ORDER BY timeslot;
+SELECT * FROM sum_map ORDER BY timeslot, statusMap.status, statusMap.requests;
 SELECT sumMap(statusMap.status, statusMap.requests) FROM sum_map;
 SELECT sumMap((statusMap.status, statusMap.requests)) FROM sum_map;
 SELECT sumMapMerge(s) FROM (SELECT sumMapState(statusMap.status, statusMap.requests) AS s FROM sum_map);
diff --git a/tests/queries/0_stateless/00628_in_lambda_on_merge_table_bug.sql b/tests/queries/0_stateless/00628_in_lambda_on_merge_table_bug.sql
index 48a90e6fe775..ddf98149c3b7 100644
--- a/tests/queries/0_stateless/00628_in_lambda_on_merge_table_bug.sql
+++ b/tests/queries/0_stateless/00628_in_lambda_on_merge_table_bug.sql
@@ -8,11 +8,11 @@ create table test_in_tuple as test_in_tuple_1 engine = Merge(currentDatabase(),
 
 insert into test_in_tuple_1 values (1, 1, [1, 2], [1, 2]);
 insert into test_in_tuple_2 values (2, 1, [1, 2], [1, 2]);
-select key, arr_x, arr_y, _table from test_in_tuple left array join x as arr_x, y as arr_y order by _table;
+select key, arr_x, arr_y, _table from test_in_tuple left array join x as arr_x, y as arr_y order by _table, arr_x, arr_y;
 select '-';
-select key, arr_x, arr_y, _table from test_in_tuple left array join x as arr_x, y as arr_y where (key_2, arr_x, arr_y) in (1, 1, 1) order by _table;
+select key, arr_x, arr_y, _table from test_in_tuple left array join x as arr_x, y as arr_y where (key_2, arr_x, arr_y) in (1, 1, 1) order by _table, arr_x, arr_y;
 select '-';
-select key, arr_x, arr_y, _table from test_in_tuple left array join arrayFilter((t, x_0, x_1) -> (key_2, x_0, x_1) in (1, 1, 1), x, x ,y) as arr_x, arrayFilter((t, x_0, x_1) -> (key_2, x_0, x_1) in (1, 1, 1), y, x ,y) as arr_y where (key_2, arr_x, arr_y) in (1, 1, 1) order by _table;
+select key, arr_x, arr_y, _table from test_in_tuple left array join arrayFilter((t, x_0, x_1) -> (key_2, x_0, x_1) in (1, 1, 1), x, x ,y) as arr_x, arrayFilter((t, x_0, x_1) -> (key_2, x_0, x_1) in (1, 1, 1), y, x ,y) as arr_y where (key_2, arr_x, arr_y) in (1, 1, 1) order by _table, arr_x, arr_y;
 
 drop table if exists test_in_tuple_1;
 drop table if exists test_in_tuple_2;
diff --git a/tests/queries/0_stateless/00702_join_on_dups.sql b/tests/queries/0_stateless/00702_join_on_dups.sql
index 852378f543ff..48c80446f835 100644
--- a/tests/queries/0_stateless/00702_join_on_dups.sql
+++ b/tests/queries/0_stateless/00702_join_on_dups.sql
@@ -10,68 +10,68 @@ insert into Y (id, y_a) values      (1, 'r1'), (1, 'r2'), (2, 'r3'), (3, 'r4'),
 insert into Y (id, y_a, y_b) values (4, 'r6', 'nr6'), (6, 'r7', 'nr7'), (7, 'r8', 'nr8'), (9, 'r9', 'nr9');
 
 select 'inner';
-select X.*, Y.* from X inner join Y on X.id = Y.id order by id;
+select X.*, Y.* from X inner join Y on X.id = Y.id order by X.id, X.x_a, X.x_b, Y.id, Y.y_a, Y.y_b;
 select 'inner subs';
-select s.*, j.* from (select * from X) as s inner join (select * from Y) as j on s.id = j.id order by id;
+select s.*, j.* from (select * from X) as s inner join (select * from Y) as j on s.id = j.id order by s.id, s.x_a, s.x_b, j.id, j.y_a, j.y_b;
 select 'inner expr';
-select X.*, Y.* from X inner join Y on (X.id + 1) = (Y.id + 1) order by id;
+select X.*, Y.* from X inner join Y on (X.id + 1) = (Y.id + 1) order by X.id, X.x_a, X.x_b, Y.id, Y.y_a, Y.y_b;
 
 select 'left';
-select X.*, Y.* from X left join Y on X.id = Y.id order by id;
+select X.*, Y.* from X left join Y on X.id = Y.id order by X.id, X.x_a, X.x_b, Y.id, Y.y_a, Y.y_b;
 select 'left subs';
-select s.*, j.* from (select * from X) as s left join (select * from Y) as j on s.id = j.id order by id;
+select s.*, j.* from (select * from X) as s left join (select * from Y) as j on s.id = j.id order by s.id, s.x_a, s.x_b, j.id, j.y_a, j.y_b;
 select 'left expr';
-select X.*, Y.* from X left join Y on (X.id + 1) = (Y.id + 1) order by id;
+select X.*, Y.* from X left join Y on (X.id + 1) = (Y.id + 1) order by X.id, X.x_a, X.x_b, Y.id, Y.y_a, Y.y_b;
 
 select 'right';
-select X.*, Y.* from X right join Y on X.id = Y.id order by id;
+select X.*, Y.* from X right join Y on X.id = Y.id order by X.id, X.x_a, X.x_b, Y.id, Y.y_a, Y.y_b;
 select 'right subs';
-select s.*, j.* from (select * from X) as s right join (select * from Y) as j on s.id = j.id order by id;
+select s.*, j.* from (select * from X) as s right join (select * from Y) as j on s.id = j.id order by s.id, s.x_a, s.x_b, j.id, j.y_a, j.y_b;
 --select 'right expr';
 --select X.*, Y.* from X right join Y on (X.id + 1) = (Y.id + 1) order by id;
 
 select 'full';
-select X.*, Y.* from X full join Y on X.id = Y.id order by id;
+select X.*, Y.* from X full join Y on X.id = Y.id order by X.id, X.x_a, X.x_b, Y.id, Y.y_a, Y.y_b;
 select 'full subs';
-select s.*, j.* from (select * from X) as s full join (select * from Y) as j on s.id = j.id order by id;
+select s.*, j.* from (select * from X) as s full join (select * from Y) as j on s.id = j.id order by s.id, s.x_a;
 --select 'full expr';
 --select X.*, Y.* from X full join Y on (X.id + 1) = (Y.id + 1) order by id;
 
 select 'self inner';
-select X.*, s.* from X inner join (select * from X) as s on X.id = s.id order by X.id, X.x_a, s.x_a;
+select X.*, s.* from X inner join (select * from X) as s on X.id = s.id order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 select 'self inner nullable';
-select X.*, s.* from X inner join (select * from X) as s on X.x_b = s.x_b order by X.id;
+select X.*, s.* from X inner join (select * from X) as s on X.x_b = s.x_b order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 select 'self inner nullable vs not nullable';
-select X.*, s.* from X inner join (select * from X) as s on X.id = s.x_b order by X.id;
+select X.*, s.* from X inner join (select * from X) as s on X.id = s.x_b order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 -- TODO: s.y_b == '' instead of NULL
 select 'self inner nullable vs not nullable 2';
-select Y.*, s.* from Y inner join (select * from Y) as s on concat('n', Y.y_a) = s.y_b order by id;
+select Y.*, s.* from Y inner join (select * from Y) as s on concat('n', Y.y_a) = s.y_b order by Y.id, Y.y_a, Y.y_b, s.id, s.y_a, s.y_b;
 
 select 'self left';
 select X.*, s.* from X left join (select * from X) as s on X.id = s.id order by X.id, X.x_a, s.x_a;
 select 'self left nullable';
-select X.*, s.* from X left join (select * from X) as s on X.x_b = s.x_b order by X.id;
+select X.*, s.* from X left join (select * from X) as s on X.x_b = s.x_b order by X.id, X.x_a;
 select 'self left nullable vs not nullable';
-select X.*, s.* from X left join (select * from X) as s on X.id = s.x_b order by X.id;
+select X.*, s.* from X left join (select * from X) as s on X.id = s.x_b order by X.id, X.x_a;
 -- TODO: s.y_b == '' instead of NULL
 select 'self left nullable vs not nullable 2';
-select Y.*, s.* from Y left join (select * from Y) as s on concat('n', Y.y_a) = s.y_b order by id;
+select Y.*, s.* from Y left join (select * from Y) as s on concat('n', Y.y_a) = s.y_b order by Y.id, Y.y_a;
 
 select 'self right';
-select X.*, s.* from X right join (select * from X) as s on X.id = s.id order by X.id, X.x_a, s.x_a;
+select X.*, s.* from X right join (select * from X) as s on X.id = s.id order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 select 'self right nullable';
-select X.*, s.* from X right join (select * from X) as s on X.x_b = s.x_b order by X.id;
+select X.*, s.* from X right join (select * from X) as s on X.x_b = s.x_b order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 select 'self right nullable vs not nullable';
-select X.*, s.* from X right join (select * from X) as s on X.id = s.x_b order by X.id;
+select X.*, s.* from X right join (select * from X) as s on X.id = s.x_b order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 --select 'self right nullable vs not nullable 2';
 --select Y.*, s.* from Y right join (select * from Y) as s on concat('n', Y.y_a) = s.y_b order by id;
 
 select 'self full';
-select X.*, s.* from X full join (select * from X) as s on X.id = s.id order by X.id, X.x_a, s.x_a;
+select X.*, s.* from X full join (select * from X) as s on X.id = s.id order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 select 'self full nullable';
-select X.*, s.* from X full join (select * from X) as s on X.x_b = s.x_b order by X.id;
+select X.*, s.* from X full join (select * from X) as s on X.x_b = s.x_b order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 select 'self full nullable vs not nullable';
-select X.*, s.* from X full join (select * from X) as s on X.id = s.x_b order by X.id;
+select X.*, s.* from X full join (select * from X) as s on X.id = s.x_b order by X.id, X.x_a, X.x_b, s.id, s.x_a, s.x_b;
 --select 'self full nullable vs not nullable 2';
 --select Y.*, s.* from Y full join (select * from Y) as s on concat('n', Y.y_a) = s.y_b order by id;
 
diff --git a/tests/queries/0_stateless/00702_join_with_using_dups.sql b/tests/queries/0_stateless/00702_join_with_using_dups.sql
index d45c6628b9a1..cf0c053a1443 100644
--- a/tests/queries/0_stateless/00702_join_with_using_dups.sql
+++ b/tests/queries/0_stateless/00702_join_with_using_dups.sql
@@ -8,24 +8,24 @@ insert into X (id, x_name) values (1, 'A'), (2, 'B'), (2, 'C'), (3, 'D'), (4, 'E
 insert into Y (id, y_name) values (1, 'a'), (1, 'b'), (2, 'c'), (3, 'd'), (3, 'e'), (4, 'f'), (6, 'g'), (7, 'h'), (9, 'i');
 
 select 'inner';
-select X.*, Y.* from X inner join Y using id;
+select X.*, Y.* from X inner join Y using id order by X.id, Y.id, X.x_name, Y.y_name;
 select 'inner subs';
-select s.*, j.* from (select * from X) as s inner join (select * from Y) as j using id;
+select s.*, j.* from (select * from X) as s inner join (select * from Y) as j using id order by s.id, s.id, s.x_name, j.y_name;
 
 select 'left';
-select X.*, Y.* from X left join Y using id;
+select X.*, Y.* from X left join Y using id order by X.id, Y.id, X.x_name, Y.y_name;
 select 'left subs';
-select s.*, j.* from (select * from X) as s left join (select * from Y) as j using id;
+select s.*, j.* from (select * from X) as s left join (select * from Y) as j using id order by s.id, j.id, s.x_name, j.y_name;
 
 select 'right';
-select X.*, Y.* from X right join Y using id order by id;
+select X.*, Y.* from X right join Y using id order by X.id, Y.id, X.x_name, Y.y_name;
 select 'right subs';
-select s.*, j.* from (select * from X) as s right join (select * from Y) as j using id order by id;
+select s.*, j.* from (select * from X) as s right join (select * from Y) as j using id order by s.id, j.id, s.x_name, j.y_name;
 
 select 'full';
-select X.*, Y.* from X full join Y using id order by id;
+select X.*, Y.* from X full join Y using id order by X.id, Y.id;
 select 'full subs';
-select s.*, j.* from (select * from X) as s full join (select * from Y) as j using id order by id;
+select s.*, j.* from (select * from X) as s full join (select * from Y) as j using id order by s.id, j.id, s.x_name, j.y_name;
 
 drop table X;
 drop table Y;
diff --git a/tests/queries/0_stateless/00754_alter_modify_order_by.reference b/tests/queries/0_stateless/00754_alter_modify_order_by.reference
index 0279e5ca11b2..bcbf66e824d9 100644
--- a/tests/queries/0_stateless/00754_alter_modify_order_by.reference
+++ b/tests/queries/0_stateless/00754_alter_modify_order_by.reference
@@ -1,9 +1,7 @@
 *** Check that the parts are sorted according to the new key. ***
-1	2	0	10
-1	2	0	20
 1	2	2	40
-1	2	2	50
 1	2	1	30
+1	2	0	10
 *** Check that the rows are collapsed according to the new key. ***
 1	2	0	30
 1	2	1	30
diff --git a/tests/queries/0_stateless/00754_alter_modify_order_by.sql b/tests/queries/0_stateless/00754_alter_modify_order_by.sql
index a09d824c928e..cb81f868e7b4 100644
--- a/tests/queries/0_stateless/00754_alter_modify_order_by.sql
+++ b/tests/queries/0_stateless/00754_alter_modify_order_by.sql
@@ -21,14 +21,14 @@ ALTER TABLE summing MODIFY ORDER BY (x, y, nonexistent); -- { serverError 47}
 /* Can't modyfy ORDER BY so that it is no longer a prefix of the PRIMARY KEY. */
 ALTER TABLE summing MODIFY ORDER BY x; -- { serverError 36}
 
-INSERT INTO summing(x, y, val) VALUES (1, 2, 10), (1, 2, 20);
-
 ALTER TABLE summing ADD COLUMN z UInt32 AFTER y, MODIFY ORDER BY (x, y, -z);
 
-INSERT INTO summing(x, y, z, val) values (1, 2, 1, 30), (1, 2, 2, 40), (1, 2, 2, 50);
+INSERT INTO summing(x, y, z, val) values (1, 2, 0, 10), (1, 2, 1, 30), (1, 2, 2, 40);
 
 SELECT '*** Check that the parts are sorted according to the new key. ***';
-SELECT * FROM summing ORDER BY _part;
+SELECT * FROM summing;
+
+INSERT INTO summing(x, y, z, val) values (1, 2, 0, 20), (1, 2, 2, 50);
 
 SELECT '*** Check that the rows are collapsed according to the new key. ***';
 SELECT * FROM summing FINAL ORDER BY x, y, z;
diff --git a/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.reference b/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.reference
index a1fecd72e30c..6d8a3f181e41 100644
--- a/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.reference
+++ b/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.reference
@@ -1,9 +1,7 @@
 *** Check that the parts are sorted according to the new key. ***
-1	2	0	10
-1	2	0	20
 1	2	2	40
-1	2	2	50
 1	2	1	30
+1	2	0	10
 *** Check that the rows are collapsed according to the new key. ***
 1	2	0	30
 1	2	1	30
diff --git a/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.sql b/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.sql
index 8c19e30249f4..c859c7b99212 100644
--- a/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.sql
+++ b/tests/queries/0_stateless/00754_alter_modify_order_by_replicated_zookeeper_long.sql
@@ -27,16 +27,16 @@ ALTER TABLE summing_r1 MODIFY ORDER BY (x, y, nonexistent); -- { serverError 47
 /* Can't modyfy ORDER BY so that it is no longer a prefix of the PRIMARY KEY. */
 ALTER TABLE summing_r1 MODIFY ORDER BY x; -- { serverError 36 }
 
-INSERT INTO summing_r1(x, y, val) VALUES (1, 2, 10), (1, 2, 20);
-SYSTEM SYNC REPLICA summing_r2;
-
 ALTER TABLE summing_r1 ADD COLUMN z UInt32 AFTER y, MODIFY ORDER BY (x, y, -z);
 
-INSERT INTO summing_r1(x, y, z, val) values (1, 2, 1, 30), (1, 2, 2, 40), (1, 2, 2, 50);
+INSERT INTO summing_r1(x, y, z, val) values (1, 2, 0, 10), (1, 2, 1, 30), (1, 2, 2, 40);
 SYSTEM SYNC REPLICA summing_r2;
 
 SELECT '*** Check that the parts are sorted according to the new key. ***';
-SELECT * FROM summing_r2 ORDER BY _part;
+SELECT * FROM summing_r2;
+
+INSERT INTO summing_r1(x, y, z, val) values (1, 2, 0, 20), (1, 2, 2, 50);
+SYSTEM SYNC REPLICA summing_r2;
 
 SELECT '*** Check that the rows are collapsed according to the new key. ***';
 SELECT * FROM summing_r2 FINAL ORDER BY x, y, z;
diff --git a/tests/queries/0_stateless/00799_function_dry_run.reference b/tests/queries/0_stateless/00799_function_dry_run.reference
index 35cebe7569a8..8f855bb582d0 100644
--- a/tests/queries/0_stateless/00799_function_dry_run.reference
+++ b/tests/queries/0_stateless/00799_function_dry_run.reference
@@ -2,8 +2,8 @@
 0.3	2018-11-19 13:05:00	\N
 0.4	2018-11-19 13:10:00	1
 0.5	2018-11-19 13:15:00	1.2
-0.6	2018-11-19 13:15:00	1.5
-0.7	2018-11-19 13:20:00	1.8
-0.8	2018-11-19 13:25:00	2.1
-0.9	2018-11-19 13:25:00	2.4
-0.5	2018-11-19 13:30:00	2.2
+0.6	2018-11-19 13:20:00	1.5
+0.7	2018-11-19 13:25:00	1.8
+0.8	2018-11-19 13:30:00	2.1
+0.9	2018-11-19 13:45:00	2.4
+0.5	2018-11-19 13:50:00	2.2
diff --git a/tests/queries/0_stateless/00799_function_dry_run.sql b/tests/queries/0_stateless/00799_function_dry_run.sql
index 4f3df6a0ff85..bf6fb3de3956 100644
--- a/tests/queries/0_stateless/00799_function_dry_run.sql
+++ b/tests/queries/0_stateless/00799_function_dry_run.sql
@@ -4,7 +4,7 @@ DROP TABLE IF EXISTS bm;
 
 CREATE TABLE bm (amount float, business_dttm DateTime) engine Log;
 
-INSERT INTO bm VALUES (0.3,'2018-11-19 13:00:00'), (0.3,'2018-11-19 13:05:00'), (0.4,'2018-11-19 13:10:00'), (0.5,'2018-11-19 13:15:00'), (0.6,'2018-11-19 13:15:00'), (0.7,'2018-11-19 13:20:00'), (0.8,'2018-11-19 13:25:00'), (0.9,'2018-11-19 13:25:00'), (0.5,'2018-11-19 13:30:00');
+INSERT INTO bm VALUES (0.3,'2018-11-19 13:00:00'), (0.3,'2018-11-19 13:05:00'), (0.4,'2018-11-19 13:10:00'), (0.5,'2018-11-19 13:15:00'), (0.6,'2018-11-19 13:20:00'), (0.7,'2018-11-19 13:25:00'), (0.8,'2018-11-19 13:30:00'), (0.9,'2018-11-19 13:45:00'), (0.5,'2018-11-19 13:50:00');
 
 WITH
     (
@@ -30,6 +30,6 @@ FROM
         business_dttm
     FROM bm
     ORDER BY business_dttm
-);
+) ORDER BY business_dttm;
 
 DROP TABLE bm;
diff --git a/tests/queries/0_stateless/00818_inner_join_bug_3567.sql b/tests/queries/0_stateless/00818_inner_join_bug_3567.sql
index 2058d2309e43..1c851d40f475 100644
--- a/tests/queries/0_stateless/00818_inner_join_bug_3567.sql
+++ b/tests/queries/0_stateless/00818_inner_join_bug_3567.sql
@@ -9,8 +9,8 @@ INSERT INTO table2 VALUES ('D', 'd', '2018-01-01') ('B', 'b', '2018-01-01') ('C'
 
 SELECT * FROM table1 t1 FORMAT PrettyCompact;
 SELECT *, c as a, d as b FROM table2 FORMAT PrettyCompact;
-SELECT * FROM table1 t1 ALL LEFT JOIN (SELECT *, c, d as b FROM table2) t2 USING (a, b) ORDER BY d FORMAT PrettyCompact;
-SELECT * FROM table1 t1 ALL INNER JOIN (SELECT *, c, d as b FROM table2) t2 USING (a, b) ORDER BY d FORMAT PrettyCompact;
+SELECT * FROM table1 t1 ALL LEFT JOIN (SELECT *, c, d as b FROM table2) t2 USING (a, b) ORDER BY d, t1.a FORMAT PrettyCompact;
+SELECT * FROM table1 t1 ALL INNER JOIN (SELECT *, c, d as b FROM table2) t2 USING (a, b) ORDER BY d, t1.a FORMAT PrettyCompact;
 
 DROP TABLE table1;
 DROP TABLE table2;
diff --git a/tests/queries/0_stateless/00853_join_with_nulls_crash.sql b/tests/queries/0_stateless/00853_join_with_nulls_crash.sql
index 464ddbb1990e..c63c2d99cbaf 100644
--- a/tests/queries/0_stateless/00853_join_with_nulls_crash.sql
+++ b/tests/queries/0_stateless/00853_join_with_nulls_crash.sql
@@ -21,37 +21,37 @@ SELECT s1.other, s2.other, count_a, count_b, toTypeName(s1.other), toTypeName(s2
 ALL FULL JOIN
     ( SELECT other, count() AS count_b FROM table_b GROUP BY other ) s2
 ON s1.other = s2.other
-ORDER BY s2.other DESC, count_a;
+ORDER BY s2.other DESC, count_a, s1.other;
 
 SELECT s1.other, s2.other, count_a, count_b, toTypeName(s1.other), toTypeName(s2.other) FROM
     ( SELECT other, count() AS count_a FROM table_a GROUP BY other ) s1
 ALL FULL JOIN
     ( SELECT other, count() AS count_b FROM table_b GROUP BY other ) s2
 USING other
-ORDER BY s2.other DESC, count_a;
+ORDER BY s2.other DESC, count_a, s1.other;
 
 SELECT s1.something, s2.something, count_a, count_b, toTypeName(s1.something), toTypeName(s2.something) FROM
     ( SELECT something, count() AS count_a FROM table_a GROUP BY something ) s1
 ALL FULL JOIN
     ( SELECT something, count() AS count_b FROM table_b GROUP BY something ) s2
 ON s1.something = s2.something
-ORDER BY count_a DESC;
+ORDER BY count_a DESC, something, s2.something;
 
 SELECT s1.something, s2.something, count_a, count_b, toTypeName(s1.something), toTypeName(s2.something) FROM
     ( SELECT something, count() AS count_a FROM table_a GROUP BY something ) s1
 ALL RIGHT JOIN
     ( SELECT something, count() AS count_b FROM table_b GROUP BY something ) s2
 USING (something)
-ORDER BY count_a DESC;
+ORDER BY count_a DESC, s1.something, s2.something;
 
 SET joined_subquery_requires_alias = 0;
 
 SELECT something, count_a, count_b, toTypeName(something) FROM
-    ( SELECT something, count() AS count_a FROM table_a GROUP BY something )
+    ( SELECT something, count() AS count_a FROM table_a GROUP BY something ) as s1
 ALL FULL JOIN
-    ( SELECT something, count() AS count_b FROM table_b GROUP BY something )
+    ( SELECT something, count() AS count_b FROM table_b GROUP BY something ) as s2
 USING (something)
-ORDER BY count_a DESC;
+ORDER BY count_a DESC, something DESC;
 
 DROP TABLE table_a;
 DROP TABLE table_b;
diff --git a/tests/queries/0_stateless/00909_ngram_distance.reference b/tests/queries/0_stateless/00909_ngram_distance.reference
index 52fb462a9ed7..290e24faac5c 100644
--- a/tests/queries/0_stateless/00909_ngram_distance.reference
+++ b/tests/queries/0_stateless/00909_ngram_distance.reference
@@ -110,116 +110,116 @@
 77
 636
 1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
-пап привет как дела - Яндекс.Видео	0
-привет братан как дела - Яндекс.Видео	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+пап привет как дела - Яндекс.Видео	0
+привет	0
+привет братан как дела - Яндекс.Видео	0
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 	0
 привет как дела?... Херсон	600
 пап привет как дела - Яндекс.Видео	684
 привет как дела клип - Яндекс.Видео	692
 привет братан как дела - Яндекс.Видео	707
-привет	1000
-http://metric.ru/	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
+http://metris.ru/	1000
+привет	1000
 	0
 http://metric.ru/	765
 http://metris.ru/	765
 http://metrika.ru/	778
 http://autometric.ru/	810
 http://metrica.yandex.com/	846
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 привет как дела?... Херсон	297
 пап привет как дела - Яндекс.Видео	422
 привет как дела клип - Яндекс.Видео	435
 привет братан как дела - Яндекс.Видео	500
 привет	529
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 привет как дела?... Херсон	459
 пап привет как дела - Яндекс.Видео	511
 привет	529
 привет как дела клип - Яндекс.Видео	565
 привет братан как дела - Яндекс.Видео	583
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 http://metrika.ru/	524
 http://metric.ru/	700
 http://metris.ru/	700
 http://autometric.ru/	750
 http://metrica.yandex.com/	793
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	600
 http://metrica.yandex.com/	655
 http://autometric.ru/	667
 http://metris.ru/	700
 http://metrika.ru/	714
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metrika.ru/	619
 http://metric.ru/	700
 http://metris.ru/	700
 http://autometric.ru/	750
 http://metrica.yandex.com/	793
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	600
 http://autometric.ru/	667
 http://metris.ru/	700
 http://metrika.ru/	714
 http://metrica.yandex.com/	724
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
-пап привет как дела - Яндекс.Видео	1000
-привет братан как дела - Яндекс.Видео	1000
 	1000
-http://metrica.yandex.com/	714
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+http://metrica.yandex.com/	714
+	1000
 http://autometric.ru/	1000
-http://metris.ru/	1000
+http://metric.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
+пап привет как дела - Яндекс.Видео	1000
+привет	1000
+привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 0
 0
 0
@@ -332,138 +332,138 @@ http://metrika.ru/	1000
 77
 636
 1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
-пап привет как дела - Яндекс.Видео	0
-привет братан как дела - Яндекс.Видео	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+пап привет как дела - Яндекс.Видео	0
+привет	0
+привет братан как дела - Яндекс.Видео	0
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 	0
 привет как дела?... Херсон	600
 пап привет как дела - Яндекс.Видео	684
 привет как дела клип - Яндекс.Видео	692
 привет братан как дела - Яндекс.Видео	707
-привет	1000
-http://metric.ru/	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
+http://metris.ru/	1000
+привет	1000
 	0
 http://metric.ru/	765
 http://metris.ru/	765
 http://metrika.ru/	778
 http://autometric.ru/	810
 http://metrica.yandex.com/	846
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 привет как дела?... Херсон	297
 пап привет как дела - Яндекс.Видео	422
 привет как дела клип - Яндекс.Видео	435
 привет братан как дела - Яндекс.Видео	500
 привет	529
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 привет как дела?... Херсон	459
 пап привет как дела - Яндекс.Видео	511
 привет	529
 привет как дела клип - Яндекс.Видео	565
 привет братан как дела - Яндекс.Видео	583
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 http://metrika.ru/	524
 http://metric.ru/	700
 http://metris.ru/	700
 http://autometric.ru/	750
 http://metrica.yandex.com/	793
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metrika.ru/	524
 http://metric.ru/	700
 http://metris.ru/	700
 http://autometric.ru/	750
 http://metrica.yandex.com/	793
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	600
 http://metrica.yandex.com/	655
 http://autometric.ru/	667
 http://metris.ru/	700
 http://metrika.ru/	714
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metrika.ru/	619
 http://metric.ru/	700
 http://metris.ru/	700
 http://autometric.ru/	750
 http://metrica.yandex.com/	793
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	600
 http://autometric.ru/	667
 http://metris.ru/	700
 http://metrika.ru/	714
 http://metrica.yandex.com/	724
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
-пап привет как дела - Яндекс.Видео	1000
-привет братан как дела - Яндекс.Видео	1000
 	1000
-http://metrica.yandex.com/	714
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+http://metrica.yandex.com/	714
+	1000
 http://autometric.ru/	1000
-http://metris.ru/	1000
+http://metric.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
+пап привет как дела - Яндекс.Видео	1000
+привет	1000
+привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 привет как дела клип - Яндекс.Видео	0
 пап привет как дела - Яндекс.Видео	169
 привет братан как дела - Яндекс.Видео	235
 привет как дела?... Херсон	544
 привет	784
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 0
 0
 0
@@ -581,78 +581,78 @@ http://metrika.ru/	1000
 привет как дела клип - Яндекс.Видео	412
 привет братан как дела - Яндекс.Видео	461
 привет	471
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 привет как дела?... Херсон	343
 пап привет как дела - Яндекс.Видео	446
 привет	471
 привет как дела клип - Яндекс.Видео	482
 привет братан как дела - Яндекс.Видео	506
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
 http://metrika.ru/	579
 http://metric.ru/	778
 http://metris.ru/	778
 http://autometric.ru/	818
 http://metrica.yandex.com/	852
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	667
 http://metrica.yandex.com/	704
 http://autometric.ru/	727
 http://metris.ru/	778
 http://metrika.ru/	789
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metrika.ru/	684
 http://metric.ru/	778
 http://metris.ru/	778
 http://autometric.ru/	818
 http://metrica.yandex.com/	852
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	667
 http://autometric.ru/	727
 http://metrica.yandex.com/	778
 http://metris.ru/	778
 http://metrika.ru/	789
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
-пап привет как дела - Яндекс.Видео	1000
-привет братан как дела - Яндекс.Видео	1000
 	1000
-http://metrica.yandex.com/	769
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+http://metrica.yandex.com/	769
+	1000
 http://autometric.ru/	1000
-http://metris.ru/	1000
+http://metric.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
+пап привет как дела - Яндекс.Видео	1000
+привет	1000
+привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 0
 0
 0
@@ -769,87 +769,87 @@ http://metrika.ru/	1000
 пап привет как дела - Яндекс.Видео	928
 привет как дела клип - Яндекс.Видео	929
 привет братан как дела - Яндекс.Видео	955
-привет	1000
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
+привет	1000
 привет как дела?... Херсон	672
 пап привет как дела - Яндекс.Видео	735
 привет как дела клип - Яндекс.Видео	741
 привет братан как дела - Яндекс.Видео	753
-привет	1000
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
+привет	1000
 http://metrika.ru/	579
 http://metric.ru/	778
 http://metris.ru/	778
 http://autometric.ru/	818
 http://metrica.yandex.com/	852
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metrika.ru/	579
 http://metric.ru/	778
 http://metris.ru/	778
 http://autometric.ru/	818
 http://metrica.yandex.com/	852
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	667
 http://metrica.yandex.com/	704
 http://autometric.ru/	727
 http://metris.ru/	778
 http://metrika.ru/	789
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metrika.ru/	684
 http://metric.ru/	778
 http://metris.ru/	778
 http://autometric.ru/	818
 http://metrica.yandex.com/	852
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
 http://metric.ru/	667
 http://autometric.ru/	727
 http://metrica.yandex.com/	778
 http://metris.ru/	778
 http://metrika.ru/	789
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
-пап привет как дела - Яндекс.Видео	1000
-привет братан как дела - Яндекс.Видео	1000
 	1000
-http://metrica.yandex.com/	769
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+http://metrica.yandex.com/	769
+	1000
 http://autometric.ru/	1000
-http://metris.ru/	1000
+http://metric.ru/	1000
 http://metrika.ru/	1000
-	1000
+http://metris.ru/	1000
+пап привет как дела - Яндекс.Видео	1000
+привет	1000
+привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
diff --git a/tests/queries/0_stateless/00909_ngram_distance.sql b/tests/queries/0_stateless/00909_ngram_distance.sql
index ed800bf6c971..b2f403c415ab 100644
--- a/tests/queries/0_stateless/00909_ngram_distance.sql
+++ b/tests/queries/0_stateless/00909_ngram_distance.sql
@@ -34,17 +34,17 @@ drop table if exists test_distance;
 create table test_distance (Title String) engine = Memory;
 insert into test_distance values ('привет как дела?... Херсон'), ('привет как дела клип - Яндекс.Видео'), ('привет'), ('пап привет как дела - Яндекс.Видео'), ('привет братан как дела - Яндекс.Видео'), ('http://metric.ru/'), ('http://autometric.ru/'), ('http://metrica.yandex.com/'), ('http://metris.ru/'), ('http://metrika.ru/'), ('');
 
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, Title) as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, extract(Title, 'как дела')) as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, extract(Title, 'metr')) as distance;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, Title) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, extract(Title, 'как дела')) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, extract(Title, 'metr')) as distance, Title;
 
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'привет как дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'как привет дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metriks') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'yandex') as distance;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'привет как дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'как привет дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metriks') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceUTF8(Title, 'yandex') as distance, Title;
 
 
 select round(1000 * ngramDistanceCaseInsensitiveUTF8(materialize(''), '')) from system.numbers limit 5;
@@ -80,19 +80,19 @@ select round(1000 * ngramDistanceCaseInsensitiveUTF8('аБВГдеёЖз', 'Аб
 select round(1000 * ngramDistanceCaseInsensitiveUTF8('абвгдеёжз', 'гдеёЗД'));
 select round(1000 * ngramDistanceCaseInsensitiveUTF8('АБВГДеёжз', 'ЁЁЁЁЁЁЁЁ'));
 
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, Title) as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, extract(Title, 'как дела')) as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, extract(Title, 'metr')) as distance;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, Title) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, extract(Title, 'как дела')) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, extract(Title, 'metr')) as distance, Title;
 
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'ПрИвЕт кАК ДЕЛа') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'как ПРИВЕТ дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'Metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'mEtrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'metriKS') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'YanDEX') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'приВЕТ КАк ДеЛа КлИп - яндеКс.видео') as distance;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'ПрИвЕт кАК ДЕЛа') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'как ПРИВЕТ дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'Metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'mEtrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'metriKS') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'YanDEX') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitiveUTF8(Title, 'приВЕТ КАк ДеЛа КлИп - яндеКс.видео') as distance, Title;
 
 
 select round(1000 * ngramDistance(materialize(''), '')) from system.numbers limit 5;
@@ -128,13 +128,13 @@ select round(1000 * ngramDistance('abcdefgh', 'abcdefg'));
 select round(1000 * ngramDistance('abcdefgh', 'defgh'));
 select round(1000 * ngramDistance('abcdefgh', 'aaaaaaaa'));
 
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'привет как дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'как привет дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metriks') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'yandex') as distance;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'привет как дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'как привет дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metriks') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistance(Title, 'yandex') as distance, Title;
 
 select round(1000 * ngramDistanceCaseInsensitive(materialize(''), '')) from system.numbers limit 5;
 select round(1000 * ngramDistanceCaseInsensitive(materialize('abc'), '')) from system.numbers limit 5;
@@ -168,13 +168,13 @@ select round(1000 * ngramDistanceCaseInsensitive('abcdefgh', 'abcdeFG'));
 select round(1000 * ngramDistanceCaseInsensitive('AAAAbcdefgh', 'defgh'));
 select round(1000 * ngramDistanceCaseInsensitive('ABCdefgH', 'aaaaaaaa'));
 
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'ПрИвЕт кАК ДЕЛа') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'как ПРИВЕТ дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'Metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'mEtrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'metriKS') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'YanDEX') as distance;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'ПрИвЕт кАК ДЕЛа') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'как ПРИВЕТ дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'Metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'mEtrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'metriKS') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_distance ORDER BY ngramDistanceCaseInsensitive(Title, 'YanDEX') as distance, Title;
 
 drop table if exists test_distance;
diff --git a/tests/queries/0_stateless/00933_alter_ttl.sql b/tests/queries/0_stateless/00933_alter_ttl.sql
index 4f586bb20fa3..934d33660dea 100644
--- a/tests/queries/0_stateless/00933_alter_ttl.sql
+++ b/tests/queries/0_stateless/00933_alter_ttl.sql
@@ -13,7 +13,7 @@ insert into ttl values (toDateTime('2100-10-10 00:00:00'), 3);
 insert into ttl values (toDateTime('2100-10-10 00:00:00'), 4);
 optimize table ttl partition 10 final;
 
-select * from ttl order by d;
+select * from ttl order by d, a;
 
 alter table ttl modify ttl a; -- { serverError 450 }
 
diff --git a/tests/queries/0_stateless/00951_ngram_search.reference b/tests/queries/0_stateless/00951_ngram_search.reference
index 1b845b6015d3..a98f63a198a8 100644
--- a/tests/queries/0_stateless/00951_ngram_search.reference
+++ b/tests/queries/0_stateless/00951_ngram_search.reference
@@ -110,115 +110,115 @@
 1000
 500
 0
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
-пап привет как дела - Яндекс.Видео	1000
-привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+http://metris.ru/	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+http://metris.ru/	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
-http://metric.ru/	0
+http://metris.ru/	1000
+пап привет как дела - Яндекс.Видео	1000
+привет	1000
+привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	308
 привет братан как дела - Яндекс.Видео	923
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
 пап привет как дела - Яндекс.Видео	1000
-http://metric.ru/	0
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	308
-привет как дела?... Херсон	769
-привет как дела клип - Яндекс.Видео	769
 привет братан как дела - Яндекс.Видео	769
+привет как дела клип - Яндекс.Видео	769
+привет как дела?... Херсон	769
 пап привет как дела - Яндекс.Видео	846
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	600
+http://metric.ru/	600
 http://metrica.yandex.com/	600
 http://metris.ru/	600
 http://metrika.ru/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	600
-http://metric.ru/	800
+http://metris.ru/	600
 http://autometric.ru/	800
+http://metric.ru/	800
 http://metrica.yandex.com/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	600
+http://metric.ru/	600
 http://metrica.yandex.com/	600
 http://metris.ru/	600
 http://metrika.ru/	800
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	600
-http://metric.ru/	800
+http://metris.ru/	600
 http://autometric.ru/	800
+http://metric.ru/	800
 http://metrica.yandex.com/	800
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
-пап привет как дела - Яндекс.Видео	0
-привет братан как дела - Яндекс.Видео	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
-http://metris.ru/	0
+http://metric.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+пап привет как дела - Яндекс.Видео	0
+привет	0
+привет братан как дела - Яндекс.Видео	0
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrica.yandex.com/	1000
 1000
 1000
@@ -332,133 +332,133 @@ http://metrica.yandex.com/	1000
 1000
 500
 0
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
-пап привет как дела - Яндекс.Видео	1000
-привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+http://metris.ru/	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
-привет	1000
+http://metris.ru/	1000
 пап привет как дела - Яндекс.Видео	1000
+привет	1000
 привет братан как дела - Яндекс.Видео	1000
-http://metric.ru/	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	1000
 http://autometric.ru/	1000
+http://metric.ru/	1000
 http://metrica.yandex.com/	1000
-http://metris.ru/	1000
 http://metrika.ru/	1000
-	1000
-http://metric.ru/	0
+http://metris.ru/	1000
+пап привет как дела - Яндекс.Видео	1000
+привет	1000
+привет братан как дела - Яндекс.Видео	1000
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	308
 привет братан как дела - Яндекс.Видео	923
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
 пап привет как дела - Яндекс.Видео	1000
-http://metric.ru/	0
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	308
-привет как дела?... Херсон	769
-привет как дела клип - Яндекс.Видео	769
 привет братан как дела - Яндекс.Видео	769
+привет как дела клип - Яндекс.Видео	769
+привет как дела?... Херсон	769
 пап привет как дела - Яндекс.Видео	846
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	600
+http://metric.ru/	600
 http://metrica.yandex.com/	600
 http://metris.ru/	600
 http://metrika.ru/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	600
+http://metric.ru/	600
 http://metrica.yandex.com/	600
 http://metris.ru/	600
 http://metrika.ru/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	600
-http://metric.ru/	800
+http://metris.ru/	600
 http://autometric.ru/	800
+http://metric.ru/	800
 http://metrica.yandex.com/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	600
+http://metric.ru/	600
 http://metrica.yandex.com/	600
 http://metris.ru/	600
 http://metrika.ru/	800
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	600
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	600
-http://metric.ru/	800
+http://metris.ru/	600
 http://autometric.ru/	800
+http://metric.ru/	800
 http://metrica.yandex.com/	800
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
-пап привет как дела - Яндекс.Видео	0
-привет братан как дела - Яндекс.Видео	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
-http://metris.ru/	0
+http://metric.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+пап привет как дела - Яндекс.Видео	0
+привет	0
+привет братан как дела - Яндекс.Видео	0
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrica.yandex.com/	1000
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	121
 привет как дела?... Херсон	394
 привет братан как дела - Яндекс.Видео	788
@@ -576,82 +576,82 @@ http://metrika.ru/	0
 1000
 1000
 1000
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	360
 привет братан как дела - Яндекс.Видео	960
-привет как дела?... Херсон	1000
-привет как дела клип - Яндекс.Видео	1000
 пап привет как дела - Яндекс.Видео	1000
-http://metric.ru/	0
+привет как дела клип - Яндекс.Видео	1000
+привет как дела?... Херсон	1000
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
 привет	360
-привет как дела?... Херсон	880
-привет как дела клип - Яндекс.Видео	880
 привет братан как дела - Яндекс.Видео	880
+привет как дела клип - Яндекс.Видео	880
+привет как дела?... Херсон	880
 пап привет как дела - Яндекс.Видео	920
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	500
+http://metric.ru/	500
 http://metrica.yandex.com/	500
 http://metris.ru/	500
 http://metrika.ru/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	500
-http://metric.ru/	750
+http://metris.ru/	500
 http://autometric.ru/	750
+http://metric.ru/	750
 http://metrica.yandex.com/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	500
+http://metric.ru/	500
 http://metrica.yandex.com/	500
 http://metris.ru/	500
 http://metrika.ru/	750
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	500
-http://metric.ru/	750
+http://metris.ru/	500
 http://autometric.ru/	750
+http://metric.ru/	750
 http://metrica.yandex.com/	750
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
-пап привет как дела - Яндекс.Видео	0
-привет братан как дела - Яндекс.Видео	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
-http://metris.ru/	0
+http://metric.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+пап привет как дела - Яндекс.Видео	0
+привет	0
+привет братан как дела - Яндекс.Видео	0
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrica.yandex.com/	1000
 1000
 1000
@@ -765,91 +765,91 @@ http://metrica.yandex.com/	1000
 1000
 1000
 1000
-привет	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+привет	0
 привет братан как дела - Яндекс.Видео	80
-привет как дела?... Херсон	120
-привет как дела клип - Яндекс.Видео	120
 пап привет как дела - Яндекс.Видео	120
-привет	0
-http://metric.ru/	0
+привет как дела клип - Яндекс.Видео	120
+привет как дела?... Херсон	120
+	0
 http://autometric.ru/	0
+http://metric.ru/	0
 http://metrica.yandex.com/	0
-http://metris.ru/	0
 http://metrika.ru/	0
-	0
-привет как дела?... Херсон	440
-привет как дела клип - Яндекс.Видео	440
+http://metris.ru/	0
+привет	0
 пап привет как дела - Яндекс.Видео	440
 привет братан как дела - Яндекс.Видео	440
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+привет как дела клип - Яндекс.Видео	440
+привет как дела?... Херсон	440
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	500
+http://metric.ru/	500
 http://metrica.yandex.com/	500
 http://metris.ru/	500
 http://metrika.ru/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	500
+http://metric.ru/	500
 http://metrica.yandex.com/	500
 http://metris.ru/	500
 http://metrika.ru/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	500
-http://metric.ru/	750
+http://metris.ru/	500
 http://autometric.ru/	750
+http://metric.ru/	750
 http://metrica.yandex.com/	1000
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metric.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://autometric.ru/	500
+http://metric.ru/	500
 http://metrica.yandex.com/	500
 http://metris.ru/	500
 http://metrika.ru/	750
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
+	0
 пап привет как дела - Яндекс.Видео	0
+привет	0
 привет братан как дела - Яндекс.Видео	0
-	0
-http://metris.ru/	500
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrika.ru/	500
-http://metric.ru/	750
+http://metris.ru/	500
 http://autometric.ru/	750
+http://metric.ru/	750
 http://metrica.yandex.com/	750
-привет как дела?... Херсон	0
-привет как дела клип - Яндекс.Видео	0
-привет	0
-пап привет как дела - Яндекс.Видео	0
-привет братан как дела - Яндекс.Видео	0
-http://metric.ru/	0
+	0
 http://autometric.ru/	0
-http://metris.ru/	0
+http://metric.ru/	0
 http://metrika.ru/	0
-	0
+http://metris.ru/	0
+пап привет как дела - Яндекс.Видео	0
+привет	0
+привет братан как дела - Яндекс.Видео	0
+привет как дела клип - Яндекс.Видео	0
+привет как дела?... Херсон	0
 http://metrica.yandex.com/	1000
diff --git a/tests/queries/0_stateless/00951_ngram_search.sql b/tests/queries/0_stateless/00951_ngram_search.sql
index ea98e89964ce..f1a37605ebca 100644
--- a/tests/queries/0_stateless/00951_ngram_search.sql
+++ b/tests/queries/0_stateless/00951_ngram_search.sql
@@ -34,17 +34,17 @@ drop table if exists test_entry_distance;
 create table test_entry_distance (Title String) engine = Memory;
 insert into test_entry_distance values ('привет как дела?... Херсон'), ('привет как дела клип - Яндекс.Видео'), ('привет'), ('пап привет как дела - Яндекс.Видео'), ('привет братан как дела - Яндекс.Видео'), ('http://metric.ru/'), ('http://autometric.ru/'), ('http://metrica.yandex.com/'), ('http://metris.ru/'), ('http://metrika.ru/'), ('');
 
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, Title) as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, extract(Title, 'как дела')) as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, extract(Title, 'metr')) as distance;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, Title) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, extract(Title, 'как дела')) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, extract(Title, 'metr')) as distance, Title;
 
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'привет как дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'как привет дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metriks') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'yandex') as distance;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'привет как дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'как привет дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metriks') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchUTF8(Title, 'yandex') as distance, Title;
 
 
 select round(1000 * ngramSearchCaseInsensitiveUTF8(materialize(''), '')) from system.numbers limit 5;
@@ -80,19 +80,19 @@ select round(1000 * ngramSearchCaseInsensitiveUTF8('аБВГдеёЖз', 'Абв
 select round(1000 * ngramSearchCaseInsensitiveUTF8('абвгдеёжз', 'гдеёЗД'));
 select round(1000 * ngramSearchCaseInsensitiveUTF8('АБВГДеёжз', 'ЁЁЁЁЁЁЁЁ'));
 
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, Title) as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, extract(Title, 'как дела')) as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, extract(Title, 'metr')) as distance;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, Title) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, extract(Title, 'как дела')) as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, extract(Title, 'metr')) as distance, Title;
 
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'ПрИвЕт кАК ДЕЛа') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'как ПРИВЕТ дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'Metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'mEtrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'metriKS') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'YanDEX') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'приВЕТ КАк ДеЛа КлИп - яндеКс.видео') as distance;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'ПрИвЕт кАК ДЕЛа') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'как ПРИВЕТ дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'Metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'mEtrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'metriKS') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'YanDEX') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitiveUTF8(Title, 'приВЕТ КАк ДеЛа КлИп - яндеКс.видео') as distance, Title;
 
 
 select round(1000 * ngramSearch(materialize(''), '')) from system.numbers limit 5;
@@ -128,13 +128,13 @@ select round(1000 * ngramSearch('abcdefgh', 'abcdefg'));
 select round(1000 * ngramSearch('abcdefgh', 'defgh'));
 select round(1000 * ngramSearch('abcdefghaaaaaaaaaa', 'aaaaaaaa'));
 
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'привет как дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'как привет дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metriks') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'yandex') as distance;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'привет как дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'как привет дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metriks') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearch(Title, 'yandex') as distance, Title;
 
 select round(1000 * ngramSearchCaseInsensitive(materialize(''), '')) from system.numbers limit 5;
 select round(1000 * ngramSearchCaseInsensitive(materialize('abc'), '')) from system.numbers limit 5;
@@ -168,13 +168,13 @@ select round(1000 * ngramSearchCaseInsensitive('abcdefgh', 'abcdeFG'));
 select round(1000 * ngramSearchCaseInsensitive('AAAAbcdefgh', 'defgh'));
 select round(1000 * ngramSearchCaseInsensitive('ABCdefgHaAaaaAaaaAA', 'aaaaaaaa'));
 
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'ПрИвЕт кАК ДЕЛа') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'как ПРИВЕТ дела') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'Metrika') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'mEtrica') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'metriKS') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'metrics') as distance;
-SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'YanDEX') as distance;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'ПрИвЕт кАК ДЕЛа') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'как ПРИВЕТ дела') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'Metrika') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'mEtrica') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'metriKS') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'metrics') as distance, Title;
+SELECT Title, round(1000 * distance) FROM test_entry_distance ORDER BY ngramSearchCaseInsensitive(Title, 'YanDEX') as distance, Title;
 
 drop table if exists test_entry_distance;
diff --git a/tests/queries/0_stateless/00976_ttl_with_old_parts.sql b/tests/queries/0_stateless/00976_ttl_with_old_parts.sql
index 8473a69aedd1..c224ca30a3cc 100644
--- a/tests/queries/0_stateless/00976_ttl_with_old_parts.sql
+++ b/tests/queries/0_stateless/00976_ttl_with_old_parts.sql
@@ -13,6 +13,6 @@ alter table ttl modify ttl d + interval 1 day;
 select sleep(1) format Null; -- wait if very fast merge happen
 optimize table ttl partition 10 final;
 
-select * from ttl order by d;
+select * from ttl order by d, a;
 
 drop table if exists ttl;
diff --git a/tests/queries/0_stateless/01030_limit_by_with_ties_error.sh b/tests/queries/0_stateless/01030_limit_by_with_ties_error.sh
index 2f2b17072c3b..938eeff5b67f 100755
--- a/tests/queries/0_stateless/01030_limit_by_with_ties_error.sh
+++ b/tests/queries/0_stateless/01030_limit_by_with_ties_error.sh
@@ -6,10 +6,36 @@ CURDIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
 
 CLICKHOUSE_CLIENT=$(echo ${CLICKHOUSE_CLIENT} | sed 's/'"--send_logs_level=${CLICKHOUSE_CLIENT_SERVER_LOGS_LEVEL}"'/--send_logs_level=none/g')
 
-$CLICKHOUSE_CLIENT --query="SELECT * FROM (SELECT number % 5 AS a, count() AS b, c FROM numbers(10) ARRAY JOIN [1,2] AS c GROUP BY a,c) AS table ORDER BY a LIMIT 3 WITH TIES BY a" 2>&1 | grep -q "Code: 498." && echo 'OK' || echo 'FAIL' ||:
+$CLICKHOUSE_CLIENT --query="""
+	SELECT * FROM (SELECT number % 5 AS a, count() AS b, c FROM numbers(10)
+		ARRAY JOIN [1,2] AS c GROUP BY a,c) AS table
+	ORDER BY a LIMIT 3 WITH TIES BY a""" 2>&1 | grep -q "Code: 498." && echo 'OK' || echo 'FAIL' ||:
 
-$CLICKHOUSE_CLIENT --query="SELECT * FROM VALUES('Phrase String, Payload String', ('hello', 'x'), ('world', 'x'), ('hello', 'z'), ('upyachka', 'a'), ('test', 'b'), ('foo', 'c'), ('bar', 'd')) ORDER BY Payload LIMIT 1 WITH TIES BY Phrase LIMIT 5;" 2>&1 | grep -q "Code: 498." && echo 'OK' || echo 'FAIL' ||:
+$CLICKHOUSE_CLIENT --query="""
+	SELECT * FROM VALUES('Phrase String, Payload String',
+		('hello', 'x'), ('world', 'x'), ('hello', 'z'),
+		('upyachka', 'a'), ('test', 'b'), ('foo', 'c'),
+		('bar', 'd'))
+	ORDER BY Payload LIMIT 1 WITH TIES BY Phrase LIMIT 5;""" 2>&1 | grep -q "Code: 498." && echo 'OK' || echo 'FAIL' ||:
 
-$CLICKHOUSE_CLIENT --query="SELECT * FROM VALUES('Phrase String, Payload String', ('hello', 'x'), ('world', 'x'), ('hello', 'z'), ('upyachka', 'a'), ('test', 'b'), ('foo', 'c'), ('bar', 'd')) ORDER BY Payload LIMIT 1 BY Phrase LIMIT 5 WITH TIES"
+$CLICKHOUSE_CLIENT --query="""
+	SELECT * FROM
+	(
+		SELECT * FROM VALUES('Phrase String, Payload String',
+				('hello', 'x'), ('world', 'x'), ('hello', 'z'),
+				('upyachka', 'a'), ('test', 'b'), ('foo', 'c'),
+				('bar', 'd'))
+		ORDER BY Payload LIMIT 1 BY Phrase LIMIT 5 WITH TIES
+	) ORDER BY Payload, Phrase
+	"""
 
-$CLICKHOUSE_CLIENT --query="SELECT TOP 5 WITH TIES * FROM VALUES('Phrase String, Payload String', ('hello', 'x'), ('world', 'x'), ('hello', 'z'), ('upyachka', 'a'), ('test', 'b'), ('foo', 'c'), ('bar', 'd')) ORDER BY Payload LIMIT 1 BY Phrase"
+$CLICKHOUSE_CLIENT --query="""
+	SELECT * FROM
+	(
+		SELECT TOP 5 WITH TIES * FROM VALUES('Phrase String, Payload String',
+				('hello', 'x'), ('world', 'x'), ('hello', 'z'),
+				('upyachka', 'a'), ('test', 'b'), ('foo', 'c'),
+				('bar', 'd'))
+		ORDER BY Payload LIMIT 1 BY Phrase
+	) ORDER BY Payload, Payload
+	"""
diff --git a/tests/queries/0_stateless/01031_new_any_join.reference b/tests/queries/0_stateless/01031_new_any_join.reference
index 1fd9a5352e3b..7b08703e422d 100644
--- a/tests/queries/0_stateless/01031_new_any_join.reference
+++ b/tests/queries/0_stateless/01031_new_any_join.reference
@@ -7,10 +7,7 @@ any left
 any left (rev)
 0		5	b6
 2	a3	2	b1
-2	a3	2	b2
 4	a5	4	b3
-4	a5	4	b4
-4	a5	4	b5
 any inner
 2	a3	2	b1
 4	a5	4	b3
@@ -20,10 +17,7 @@ any inner (rev)
 any right
 0		5	b6
 2	a3	2	b1
-2	a3	2	b2
 4	a5	4	b3
-4	a5	4	b4
-4	a5	4	b5
 any right (rev)
 0	a1	0	
 1	a2	0	
diff --git a/tests/queries/0_stateless/01031_new_any_join.sql b/tests/queries/0_stateless/01031_new_any_join.sql
index de86d8eebc52..2f2a8b2ad1d4 100644
--- a/tests/queries/0_stateless/01031_new_any_join.sql
+++ b/tests/queries/0_stateless/01031_new_any_join.sql
@@ -5,7 +5,7 @@ CREATE TABLE t1 (x UInt32, s String) engine = Memory;
 CREATE TABLE t2 (x UInt32, s String) engine = Memory;
 
 INSERT INTO t1 (x, s) VALUES (0, 'a1'), (1, 'a2'), (2, 'a3'), (3, 'a4'), (4, 'a5');
-INSERT INTO t2 (x, s) VALUES (2, 'b1'), (2, 'b2'), (4, 'b3'), (4, 'b4'), (4, 'b5'), (5, 'b6');
+INSERT INTO t2 (x, s) VALUES (2, 'b1'), (4, 'b3'), (5, 'b6');
 
 SET join_use_nulls = 0;
 SET any_join_distinct_right_table_keys = 0;
diff --git a/tests/queries/0_stateless/01031_pmj_new_any_semi_join.reference b/tests/queries/0_stateless/01031_pmj_new_any_semi_join.reference
index 78763e63f3f9..b48b20942c64 100644
--- a/tests/queries/0_stateless/01031_pmj_new_any_semi_join.reference
+++ b/tests/queries/0_stateless/01031_pmj_new_any_semi_join.reference
@@ -3,45 +3,36 @@ any left
 1	a2	0	
 2	a3	2	b1
 3	a4	0	
-4	a5	4	b3
+4	a5	4	b2
 any left (rev)
-0		5	b6
+0		5	b4
 2	a3	2	b1
-2	a3	2	b2
-4	a5	4	b3
-4	a5	4	b4
-4	a5	4	b5
+4	a5	4	b2
 any inner
 2	a3	2	b1
-4	a5	4	b3
+4	a5	4	b2
 any inner (rev)
 2	a3	2	b1
-4	a5	4	b3
+4	a5	4	b2
 any right
-0		5	b6
+0		5	b4
 2	a3	2	b1
-2	a3	2	b2
-4	a5	4	b3
-4	a5	4	b4
-4	a5	4	b5
+4	a5	4	b2
 any right (rev)
 0	a1	0	
 1	a2	0	
 2	a3	2	b1
 3	a4	0	
-4	a5	4	b3
+4	a5	4	b2
 semi left
 2	a3	2	b1
-4	a5	4	b3
+4	a5	4	b2
 semi right
 2	a3	2	b1
-2	a3	2	b2
-4	a5	4	b3
-4	a5	4	b4
-4	a5	4	b5
+4	a5	4	b2
 anti left
 0	a1	0	
 1	a2	1	
 3	a4	3	
 anti right
-0		5	b6
+0		5	b4
diff --git a/tests/queries/0_stateless/01031_pmj_new_any_semi_join.sql b/tests/queries/0_stateless/01031_pmj_new_any_semi_join.sql
index 4c306828bb85..0a593b3cfa97 100644
--- a/tests/queries/0_stateless/01031_pmj_new_any_semi_join.sql
+++ b/tests/queries/0_stateless/01031_pmj_new_any_semi_join.sql
@@ -5,7 +5,7 @@ CREATE TABLE t1 (x UInt32, s String) engine = Memory;
 CREATE TABLE t2 (x UInt32, s String) engine = Memory;
 
 INSERT INTO t1 (x, s) VALUES (0, 'a1'), (1, 'a2'), (2, 'a3'), (3, 'a4'), (4, 'a5');
-INSERT INTO t2 (x, s) VALUES (2, 'b1'), (2, 'b2'), (4, 'b3'), (4, 'b4'), (4, 'b5'), (5, 'b6');
+INSERT INTO t2 (x, s) VALUES (2, 'b1'), (4, 'b2'), (5, 'b4');
 
 SET join_algorithm = 'prefer_partial_merge';
 SET join_use_nulls = 0;
diff --git a/tests/queries/0_stateless/01142_with_ties_and_aliases.sql b/tests/queries/0_stateless/01142_with_ties_and_aliases.sql
index f086cb9d907c..de4a9281a082 100644
--- a/tests/queries/0_stateless/01142_with_ties_and_aliases.sql
+++ b/tests/queries/0_stateless/01142_with_ties_and_aliases.sql
@@ -1,12 +1,12 @@
-select number, intDiv(number,5) value from numbers(20) order by value limit 3 with ties;
+select * from (select number, intDiv(number,5) value from numbers(20) order by value limit 3 with ties) ORDER BY number, value;
 
 drop table if exists wt;
 create table wt (a Int, b Int) engine = Memory;
 insert into wt select 0, number from numbers(5);
 
 select 1 from wt order by a limit 3 with ties;
-select b from wt order by a limit 3 with ties;
-with a * 2 as c select a, b from wt order by c limit 3 with ties;
-select a * 2 as c, b from wt order by c limit 3 with ties;
+select b from (select b from wt order by a limit 3 with ties) order by b;
+select * from (select * from (with a * 2 as c select a, b from wt order by c limit 3 with ties) order by a, b);
+select * from (select * from (select a * 2 as c, b from wt order by c limit 3 with ties) order by c, b);
 
 drop table if exists wt;
diff --git a/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.reference b/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.reference
index cf2935a40bf8..186e6565ffe1 100644
--- a/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.reference
+++ b/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.reference
@@ -11,8 +11,8 @@
 2
 1	3	3
 1	4	3
-2	5	4
 2	2	4
+2	5	4
 2
 1	4	3
 1	3	3
@@ -27,6 +27,6 @@
 2
 1	3	3
 1	4	3
-2	5	4
 2	2	4
+2	5	4
 2
diff --git a/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.sql b/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.sql
index 6fda42cbed17..87f0f462ab9d 100644
--- a/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.sql
+++ b/tests/queries/0_stateless/01322_monotonous_order_by_with_different_variables.sql
@@ -7,7 +7,7 @@ SELECT * FROM test ORDER BY toFloat32(x), -y, -z DESC;
 SELECT * FROM test ORDER BY toFloat32(x), -(-y), -z DESC;
 SELECT max(x) as k FROM test ORDER BY k;
 SELECT roundToExp2(x) as k FROM test GROUP BY k ORDER BY k;
-SELECT roundToExp2(x) as k, y, z FROM test WHERE k >= 1 ORDER BY k;
+SELECT roundToExp2(x) as k, y, z FROM test WHERE k >= 1 ORDER BY k, y, z;
 SELECT max(x) as k FROM test HAVING k > 0 ORDER BY k;
 
 SET optimize_monotonous_functions_in_order_by = 0;
@@ -15,7 +15,7 @@ SELECT * FROM test ORDER BY toFloat32(x), -y, -z DESC;
 SELECT * FROM test ORDER BY toFloat32(x), -(-y), -z DESC;
 SELECT max(x) as k FROM test ORDER BY k;
 SELECT roundToExp2(x) as k From test GROUP BY k ORDER BY k;
-SELECT roundToExp2(x) as k, y, z FROM test WHERE k >= 1 ORDER BY k;
+SELECT roundToExp2(x) as k, y, z FROM test WHERE k >= 1 ORDER BY k, y, z;
 SELECT max(x) as k FROM test HAVING k > 0 ORDER BY k;
 
 DROP TABLE test;
diff --git a/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.reference b/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.reference
index 422a076b0cb4..19a1b0f2ec06 100644
--- a/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.reference
+++ b/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.reference
@@ -6,5 +6,5 @@
 3	3
 1	1
 2	1
-3	4
 3	3
+3	4
diff --git a/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.sql b/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.sql
index fce7dd753d2b..3b6f77336fe9 100644
--- a/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.sql
+++ b/tests/queries/0_stateless/01525_select_with_offset_fetch_clause.sql
@@ -4,5 +4,5 @@ DROP TABLE IF EXISTS test_fetch;
 CREATE TABLE test_fetch(a Int32, b Int32) Engine = Memory;
 INSERT INTO test_fetch VALUES(1, 1), (2, 1), (3, 4), (3, 3), (5, 4), (0, 6), (5, 7);
 SELECT * FROM test_fetch ORDER BY a OFFSET 1 ROW FETCH FIRST 3 ROWS ONLY;
-SELECT * FROM test_fetch ORDER BY a OFFSET 1 ROW FETCH FIRST 3 ROWS WITH TIES;
+SELECT * FROM (SELECT * FROM test_fetch ORDER BY a OFFSET 1 ROW FETCH FIRST 3 ROWS WITH TIES) ORDER BY a, b;
 DROP TABLE test_fetch;
diff --git a/tests/queries/0_stateless/01533_collate_in_nullable.sql b/tests/queries/0_stateless/01533_collate_in_nullable.sql
index 9e54581bc545..9664a8efdb3e 100644
--- a/tests/queries/0_stateless/01533_collate_in_nullable.sql
+++ b/tests/queries/0_stateless/01533_collate_in_nullable.sql
@@ -7,9 +7,9 @@ CREATE TABLE test_collate (x UInt32, s Nullable(String)) ENGINE=Memory();
 INSERT INTO test_collate VALUES (1, 'Ё'), (1, 'ё'), (1, 'а'), (1, null), (2, 'А'), (2, 'я'), (2, 'Я'), (2, null);
 
 SELECT 'Order by without collate';
-SELECT * FROM test_collate ORDER BY s;
+SELECT * FROM test_collate ORDER BY s, x;
 SELECT 'Order by with collate';
-SELECT * FROM test_collate ORDER BY s COLLATE 'ru';
+SELECT * FROM test_collate ORDER BY s COLLATE 'ru', x;
 
 SELECT 'Order by tuple without collate';
 SELECT * FROM test_collate ORDER BY x, s;
diff --git a/tests/queries/0_stateless/01591_window_functions.reference b/tests/queries/0_stateless/01591_window_functions.reference
index 4811d0a02adf..2f6077fceb36 100644
--- a/tests/queries/0_stateless/01591_window_functions.reference
+++ b/tests/queries/0_stateless/01591_window_functions.reference
@@ -39,7 +39,7 @@ select number, avg(number) over (order by number rows unbounded preceding) from
 8	4
 9	4.5
 -- no order by
-select number, quantileExact(number) over (partition by intDiv(number, 3) rows unbounded preceding) from numbers(10);
+select number, quantileExact(number) over (partition by intDiv(number, 3) AS value order by value rows unbounded preceding) from numbers(10);
 0	0
 1	1
 2	1
@@ -51,7 +51,7 @@ select number, quantileExact(number) over (partition by intDiv(number, 3) rows u
 8	7
 9	9
 -- can add an alias after window spec
-select number, quantileExact(number) over (partition by intDiv(number, 3) rows unbounded preceding) q from numbers(10);
+select number, quantileExact(number) over (partition by intDiv(number, 3) AS value order by value rows unbounded preceding) q from numbers(10);
 0	0
 1	1
 2	1
@@ -198,7 +198,7 @@ select sum(number) over w1, sum(number) over w2
 from numbers(10)
 window
     w1 as (rows unbounded preceding),
-    w2 as (partition by intDiv(number, 3) rows unbounded preceding)
+    w2 as (partition by intDiv(number, 3) as value order by value rows unbounded preceding)
 ;
 0	0
 1	1
@@ -214,7 +214,7 @@ window
 -- EXPLAIN test for this.
 select
     sum(number) over w1,
-    sum(number) over (partition by intDiv(number, 3) rows unbounded preceding)
+    sum(number) over (partition by intDiv(number, 3) as value order by value rows unbounded preceding)
 from numbers(10)
 window
     w1 as (partition by intDiv(number, 3) rows unbounded preceding)
diff --git a/tests/queries/0_stateless/01591_window_functions.sql b/tests/queries/0_stateless/01591_window_functions.sql
index aa9bd9795e71..eb8c28de719c 100644
--- a/tests/queries/0_stateless/01591_window_functions.sql
+++ b/tests/queries/0_stateless/01591_window_functions.sql
@@ -13,10 +13,10 @@ select number, abs(number) over (partition by toString(intDiv(number, 3)) rows u
 select number, avg(number) over (order by number rows unbounded preceding) from numbers(10);
 
 -- no order by
-select number, quantileExact(number) over (partition by intDiv(number, 3) rows unbounded preceding) from numbers(10);
+select number, quantileExact(number) over (partition by intDiv(number, 3) AS value order by value rows unbounded preceding) from numbers(10);
 
 -- can add an alias after window spec
-select number, quantileExact(number) over (partition by intDiv(number, 3) rows unbounded preceding) q from numbers(10);
+select number, quantileExact(number) over (partition by intDiv(number, 3) AS value order by value rows unbounded preceding) q from numbers(10);
 
 -- can't reference it yet -- the window functions are calculated at the
 -- last stage of select, after all other functions.
@@ -81,14 +81,14 @@ select sum(number) over w1, sum(number) over w2
 from numbers(10)
 window
     w1 as (rows unbounded preceding),
-    w2 as (partition by intDiv(number, 3) rows unbounded preceding)
+    w2 as (partition by intDiv(number, 3) as value order by value rows unbounded preceding)
 ;
 
 -- FIXME both functions should use the same window, but they don't. Add an
 -- EXPLAIN test for this.
 select
     sum(number) over w1,
-    sum(number) over (partition by intDiv(number, 3) rows unbounded preceding)
+    sum(number) over (partition by intDiv(number, 3) as value order by value rows unbounded preceding)
 from numbers(10)
 window
     w1 as (partition by intDiv(number, 3) rows unbounded preceding)
diff --git a/tests/queries/0_stateless/01592_window_functions.sql b/tests/queries/0_stateless/01592_window_functions.sql
index b05b04628d21..1ef416aaa78b 100644
--- a/tests/queries/0_stateless/01592_window_functions.sql
+++ b/tests/queries/0_stateless/01592_window_functions.sql
@@ -43,7 +43,7 @@ SELECT
 	product_name,
 	group_name,
 	price,
-	row_number() OVER (PARTITION BY group_name ORDER BY price desc) rn
+	row_number() OVER (PARTITION BY group_name ORDER BY price desc, product_name asc) rn
 FROM products INNER JOIN product_groups USING (group_id)
 ORDER BY group_name, rn;
 
diff --git a/tests/queries/0_stateless/01670_neighbor_lc_bug.sql b/tests/queries/0_stateless/01670_neighbor_lc_bug.sql
index 2d99225aa893..9de544b111d6 100644
--- a/tests/queries/0_stateless/01670_neighbor_lc_bug.sql
+++ b/tests/queries/0_stateless/01670_neighbor_lc_bug.sql
@@ -38,6 +38,8 @@ FROM
     SELECT *
     FROM neighbor_test
     ORDER BY val_string ASC
-) format PrettyCompact;
+)
+ORDER BY rowNr, val_string, str_m1, str_p1, val_low, low_m1, low_p1
+format PrettyCompact;
 
 drop table if exists neighbor_test;
diff --git a/tests/queries/0_stateless/01671_merge_join_and_constants.sql b/tests/queries/0_stateless/01671_merge_join_and_constants.sql
index c34f8e6705d0..e9a60f118755 100644
--- a/tests/queries/0_stateless/01671_merge_join_and_constants.sql
+++ b/tests/queries/0_stateless/01671_merge_join_and_constants.sql
@@ -9,7 +9,7 @@ INSERT INTO table2 VALUES ('D', 'd', '2018-01-01') ('B', 'b', '2018-01-01') ('C'
 
 set join_algorithm = 'partial_merge';
 
-SELECT * FROM table1 AS t1 ALL LEFT JOIN (SELECT *, '0.10', c, d AS b FROM table2) AS t2 USING (a, b) ORDER BY d ASC FORMAT PrettyCompact settings max_rows_in_join = 1;
+SELECT * FROM table1 AS t1 ALL LEFT JOIN (SELECT *, '0.10', c, d AS b FROM table2) AS t2 USING (a, b) ORDER BY d, t1.a ASC FORMAT PrettyCompact settings max_rows_in_join = 1;
 
 SELECT pow('0.0000000257', NULL), pow(pow(NULL, NULL), NULL) - NULL, (val + NULL) = (rval * 0), * FROM (SELECT (val + 256) = (NULL * NULL), toLowCardinality(toNullable(dummy)) AS val FROM system.one) AS s1 ANY LEFT JOIN (SELECT toLowCardinality(dummy) AS rval FROM system.one) AS s2 ON (val + 0) = (rval * 255) settings max_rows_in_join = 1;
 
diff --git a/tests/queries/0_stateless/01700_deltasum.sql b/tests/queries/0_stateless/01700_deltasum.sql
index 83d5e0439d28..9f1404c6845a 100644
--- a/tests/queries/0_stateless/01700_deltasum.sql
+++ b/tests/queries/0_stateless/01700_deltasum.sql
@@ -3,8 +3,42 @@ select deltaSum(arrayJoin([1, 2, 3, 0, 3, 4]));
 select deltaSum(arrayJoin([1, 2, 3, 0, 3, 4, 2, 3]));
 select deltaSum(arrayJoin([1, 2, 3, 0, 3, 3, 3, 3, 3, 4, 2, 3]));
 select deltaSum(arrayJoin([1, 2, 3, 0, 0, 0, 0, 3, 3, 3, 3, 3, 4, 2, 3]));
-select deltaSumMerge(rows) from (select deltaSumState(arrayJoin([0, 1])) as rows union all select deltaSumState(arrayJoin([4, 5])) as rows);
-select deltaSumMerge(rows) from (select deltaSumState(arrayJoin([4, 5])) as rows union all select deltaSumState(arrayJoin([0, 1])) as rows);
+select deltaSumMerge(rows) from
+(
+    select * from
+    (
+        select deltaSumState(arrayJoin([0, 1])) as rows
+        union all
+        select deltaSumState(arrayJoin([4, 5])) as rows
+    ) order by rows
+);
+select deltaSumMerge(rows) from
+(
+    select * from
+    (
+        select deltaSumState(arrayJoin([4, 5])) as rows
+        union all
+        select deltaSumState(arrayJoin([0, 1])) as rows
+    ) order by rows
+);
 select deltaSum(arrayJoin([2.25, 3, 4.5]));
-select deltaSumMerge(rows) from (select deltaSumState(arrayJoin([0.1, 0.3, 0.5])) as rows union all select deltaSumState(arrayJoin([4.1, 5.1, 6.6])) as rows);
-select deltaSumMerge(rows) from (select deltaSumState(arrayJoin([3, 5])) as rows union all select deltaSumState(arrayJoin([1, 2])) as rows union all select deltaSumState(arrayJoin([4, 6])) as rows);
+select deltaSumMerge(rows) from
+(
+    select * from
+    (
+        select deltaSumState(arrayJoin([0.1, 0.3, 0.5])) as rows
+        union all
+        select deltaSumState(arrayJoin([4.1, 5.1, 6.6])) as rows
+    ) order by rows
+);
+select deltaSumMerge(rows) from
+(
+    select * from
+    (
+        select deltaSumState(arrayJoin([3, 5])) as rows
+        union all
+        select deltaSumState(arrayJoin([1, 2])) as rows
+        union all
+        select deltaSumState(arrayJoin([4, 6])) as rows
+    ) order by rows
+);
diff --git a/tests/queries/0_stateless/01780_column_sparse.reference b/tests/queries/0_stateless/01780_column_sparse.reference
index 08aef4331722..1cbcf715d7ff 100644
--- a/tests/queries/0_stateless/01780_column_sparse.reference
+++ b/tests/queries/0_stateless/01780_column_sparse.reference
@@ -142,7 +142,7 @@ CREATE TABLE t_sparse_1 (id UInt64, v Int64)
 ENGINE = MergeTree ORDER BY tuple()
 SETTINGS ratio_of_defaults_for_sparse_serialization = 0;
 INSERT INTO t_sparse_1 VALUES (1, 6), (2, 1), (3, 0), (4, -1), (5, 0), (6, 0), (7, -2), (8, 0), (9, 0), (10, 4), (11, 0);
-SELECT * FROM t_sparse_1 ORDER BY v;
+SELECT * FROM t_sparse_1 ORDER BY v, id;
 7	-2
 4	-1
 3	0
@@ -154,7 +154,7 @@ SELECT * FROM t_sparse_1 ORDER BY v;
 2	1
 10	4
 1	6
-SELECT * FROM t_sparse_1 ORDER BY v DESC;
+SELECT * FROM t_sparse_1 ORDER BY v DESC, id;
 1	6
 10	4
 2	1
diff --git a/tests/queries/0_stateless/01780_column_sparse.sql b/tests/queries/0_stateless/01780_column_sparse.sql
index 480321c6d144..25cb2845322e 100644
--- a/tests/queries/0_stateless/01780_column_sparse.sql
+++ b/tests/queries/0_stateless/01780_column_sparse.sql
@@ -35,8 +35,8 @@ SETTINGS ratio_of_defaults_for_sparse_serialization = 0;
 
 INSERT INTO t_sparse_1 VALUES (1, 6), (2, 1), (3, 0), (4, -1), (5, 0), (6, 0), (7, -2), (8, 0), (9, 0), (10, 4), (11, 0);
 
-SELECT * FROM t_sparse_1 ORDER BY v;
-SELECT * FROM t_sparse_1 ORDER BY v DESC;
+SELECT * FROM t_sparse_1 ORDER BY v, id;
+SELECT * FROM t_sparse_1 ORDER BY v DESC, id;
 SELECT * FROM t_sparse_1 ORDER BY v, id LIMIT 5;
 SELECT * FROM t_sparse_1 ORDER BY v DESC, id LIMIT 5;
 
diff --git a/tests/queries/0_stateless/01780_column_sparse_alter.reference b/tests/queries/0_stateless/01780_column_sparse_alter.reference
index cec7af647b31..4fb0122db96b 100644
--- a/tests/queries/0_stateless/01780_column_sparse_alter.reference
+++ b/tests/queries/0_stateless/01780_column_sparse_alter.reference
@@ -1,6 +1,6 @@
 id	Default
-u	Sparse
 s	Sparse
+u	Sparse
 182	155
 id	Default
 t	Sparse
diff --git a/tests/queries/0_stateless/01780_column_sparse_alter.sql b/tests/queries/0_stateless/01780_column_sparse_alter.sql
index 444a1f9cf433..7f9558bfc18e 100644
--- a/tests/queries/0_stateless/01780_column_sparse_alter.sql
+++ b/tests/queries/0_stateless/01780_column_sparse_alter.sql
@@ -12,14 +12,14 @@ INSERT INTO t_sparse_alter SELECT
     if (number % 13 = 0, toString(number), '')
 FROM numbers(2000);
 
-SELECT column, serialization_kind FROM system.parts_columns WHERE database = currentDatabase() AND table = 't_sparse_alter' AND active ORDER BY name;
+SELECT column, serialization_kind FROM system.parts_columns WHERE database = currentDatabase() AND table = 't_sparse_alter' AND active ORDER BY column;
 
 SELECT uniqExact(u), uniqExact(s) FROM t_sparse_alter;
 
 ALTER TABLE t_sparse_alter DROP COLUMN s, RENAME COLUMN u TO t;
 ALTER TABLE t_sparse_alter MODIFY COLUMN t UInt16;
 
-SELECT column, serialization_kind FROM system.parts_columns WHERE database = currentDatabase() AND table = 't_sparse_alter' AND active ORDER BY name;
+SELECT column, serialization_kind FROM system.parts_columns WHERE database = currentDatabase() AND table = 't_sparse_alter' AND active ORDER BY column;
 
 SELECT uniqExact(t) FROM t_sparse_alter;
 
diff --git a/tests/queries/0_stateless/01852_map_combinator.sql b/tests/queries/0_stateless/01852_map_combinator.sql
index 20923460eb6a..3036e2e0ea42 100644
--- a/tests/queries/0_stateless/01852_map_combinator.sql
+++ b/tests/queries/0_stateless/01852_map_combinator.sql
@@ -6,7 +6,7 @@ CREATE TABLE map_comb(a int, statusMap Map(UInt16, UInt32)) ENGINE = Log;
 
 INSERT INTO map_comb VALUES (1, map(1, 10, 2, 10, 3, 10)),(1, map(3, 10, 4, 10, 5, 10)),(2, map(4, 10, 5, 10, 6, 10)),(2, map(6, 10, 7, 10, 8, 10)),(3, map(1, 10, 2, 10, 3, 10)),(4, map(3, 10, 4, 10, 5, 10)),(5, map(4, 10, 5, 10, 6, 10)),(5, map(6, 10, 7, 10, 8, 10));
 
-SELECT * FROM map_comb ORDER BY a;
+SELECT * FROM map_comb ORDER BY a, statusMap;
 SELECT toTypeName(res), sumMap(statusMap) as res FROM map_comb;
 SELECT toTypeName(res), sumWithOverflowMap(statusMap) as res FROM map_comb;
 SELECT toTypeName(res), sumMapMerge(s) as res FROM (SELECT sumMapState(statusMap) AS s FROM map_comb);
diff --git a/tests/queries/0_stateless/02006_test_positional_arguments.reference b/tests/queries/0_stateless/02006_test_positional_arguments.reference
index 5fc070ffd0bf..c5c5f115b0a7 100644
--- a/tests/queries/0_stateless/02006_test_positional_arguments.reference
+++ b/tests/queries/0_stateless/02006_test_positional_arguments.reference
@@ -15,29 +15,23 @@ select x3, x2, x1 from test order by x3 desc;
 100	10	1
 10	1	10
 1	100	100
-insert into test values (1, 10, 200), (10, 1, 200), (100, 100, 1);
+insert into test values (1, 10, 100), (10, 1, 10), (100, 100, 1);
 select x3, x2 from test group by x3, x2;
-200	1
 10	1
-200	10
 1	100
 100	10
 select x3, x2 from test group by 1, 2;
-200	1
 10	1
-200	10
 1	100
 100	10
 select x1, x2, x3 from test order by x3 limit 1 by x3;
 100	100	1
 10	1	10
 1	10	100
-1	10	200
 select x1, x2, x3 from test order by 3 limit 1 by 3;
 100	100	1
 10	1	10
 1	10	100
-1	10	200
 select x1, x2, x3 from test order by x3 limit 1 by x1;
 100	100	1
 10	1	10
diff --git a/tests/queries/0_stateless/02006_test_positional_arguments.sql b/tests/queries/0_stateless/02006_test_positional_arguments.sql
index 3a2cf76f6c45..54b55c4a9f87 100644
--- a/tests/queries/0_stateless/02006_test_positional_arguments.sql
+++ b/tests/queries/0_stateless/02006_test_positional_arguments.sql
@@ -13,7 +13,7 @@ select x3, x2, x1 from test order by x3;
 select x3, x2, x1 from test order by 1 desc;
 select x3, x2, x1 from test order by x3 desc;
 
-insert into test values (1, 10, 200), (10, 1, 200), (100, 100, 1);
+insert into test values (1, 10, 100), (10, 1, 10), (100, 100, 1);
 select x3, x2 from test group by x3, x2;
 select x3, x2 from test group by 1, 2;
 
diff --git a/tests/queries/0_stateless/02006_use_constants_in_with_and_select.sql b/tests/queries/0_stateless/02006_use_constants_in_with_and_select.sql
index 91171c9ab7b9..daca6c5d0c79 100644
--- a/tests/queries/0_stateless/02006_use_constants_in_with_and_select.sql
+++ b/tests/queries/0_stateless/02006_use_constants_in_with_and_select.sql
@@ -2,20 +2,20 @@ SELECT
     1 AS max_size,
     groupArray(max_size)(col)
 FROM
-    (
+    (SELECT col FROM (
         SELECT 1 AS col
         UNION ALL
         SELECT 2
-    );
+    ) ORDER BY col);
 
 WITH 1 AS max_size
 SELECT groupArray(max_size)(col)
 FROM
-     (
+     (SELECT col FROM (
          SELECT 1 as col
          UNION ALL
          SELECT 2
-     );
+     ) ORDER BY col);
 
 WITH 0.1 AS level
 SELECT quantile(level)(number)
diff --git a/tests/queries/0_stateless/02117_show_create_table_system.reference b/tests/queries/0_stateless/02117_show_create_table_system.reference
index 234804f1078c..2be7f65e227d 100644
--- a/tests/queries/0_stateless/02117_show_create_table_system.reference
+++ b/tests/queries/0_stateless/02117_show_create_table_system.reference
@@ -20,7 +20,7 @@ CREATE TABLE system.errors
(
    `name` String,
    `code` Int32,
    `value
 CREATE TABLE system.events
(
    `event` String,
    `value` UInt64,
    `description` String
)
ENGINE = SystemEvents()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.formats
(
    `name` String,
    `is_input` UInt8,
    `is_output` UInt8
)
ENGINE = SystemFormats()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.functions
(
    `name` String,
    `is_aggregate` UInt8,
    `case_insensitive` UInt8,
    `alias_to` String,
    `create_query` String,
    `origin` Enum8(\'System\' = 0, \'SQLUserDefined\' = 1, \'ExecutableUserDefined\' = 2)
)
ENGINE = SystemFunctions()
COMMENT \'SYSTEM TABLE is built on the fly.\'
-CREATE TABLE system.grants
(
    `user_name` Nullable(String),
    `role_name` Nullable(String),
    `access_type` Enum8(\'POSTGRES\' = -128, \'SQLITE\' = -127, \'ODBC\' = -126, \'JDBC\' = -125, \'HDFS\' = -124, \'S3\' = -123, \'SOURCES\' = -122, \'ALL\' = -121, \'NONE\' = -120, \'SHOW DATABASES\' = 0, \'SHOW TABLES\' = 1, \'SHOW COLUMNS\' = 2, \'SHOW DICTIONARIES\' = 3, \'SHOW\' = 4, \'SELECT\' = 5, \'INSERT\' = 6, \'ALTER UPDATE\' = 7, \'ALTER DELETE\' = 8, \'ALTER ADD COLUMN\' = 9, \'ALTER MODIFY COLUMN\' = 10, \'ALTER DROP COLUMN\' = 11, \'ALTER COMMENT COLUMN\' = 12, \'ALTER CLEAR COLUMN\' = 13, \'ALTER RENAME COLUMN\' = 14, \'ALTER MATERIALIZE COLUMN\' = 15, \'ALTER COLUMN\' = 16, \'ALTER MODIFY COMMENT\' = 17, \'ALTER ORDER BY\' = 18, \'ALTER SAMPLE BY\' = 19, \'ALTER ADD INDEX\' = 20, \'ALTER DROP INDEX\' = 21, \'ALTER MATERIALIZE INDEX\' = 22, \'ALTER CLEAR INDEX\' = 23, \'ALTER INDEX\' = 24, \'ALTER ADD PROJECTION\' = 25, \'ALTER DROP PROJECTION\' = 26, \'ALTER MATERIALIZE PROJECTION\' = 27, \'ALTER CLEAR PROJECTION\' = 28, \'ALTER PROJECTION\' = 29, \'ALTER ADD CONSTRAINT\' = 30, \'ALTER DROP CONSTRAINT\' = 31, \'ALTER CONSTRAINT\' = 32, \'ALTER TTL\' = 33, \'ALTER MATERIALIZE TTL\' = 34, \'ALTER SETTINGS\' = 35, \'ALTER MOVE PARTITION\' = 36, \'ALTER FETCH PARTITION\' = 37, \'ALTER FREEZE PARTITION\' = 38, \'ALTER DATABASE SETTINGS\' = 39, \'ALTER TABLE\' = 40, \'ALTER DATABASE\' = 41, \'ALTER VIEW REFRESH\' = 42, \'ALTER VIEW MODIFY QUERY\' = 43, \'ALTER VIEW\' = 44, \'ALTER\' = 45, \'CREATE DATABASE\' = 46, \'CREATE TABLE\' = 47, \'CREATE VIEW\' = 48, \'CREATE DICTIONARY\' = 49, \'CREATE TEMPORARY TABLE\' = 50, \'CREATE FUNCTION\' = 51, \'CREATE\' = 52, \'DROP DATABASE\' = 53, \'DROP TABLE\' = 54, \'DROP VIEW\' = 55, \'DROP DICTIONARY\' = 56, \'DROP FUNCTION\' = 57, \'DROP\' = 58, \'TRUNCATE\' = 59, \'OPTIMIZE\' = 60, \'KILL QUERY\' = 61, \'MOVE PARTITION BETWEEN SHARDS\' = 62, \'CREATE USER\' = 63, \'ALTER USER\' = 64, \'DROP USER\' = 65, \'CREATE ROLE\' = 66, \'ALTER ROLE\' = 67, \'DROP ROLE\' = 68, \'ROLE ADMIN\' = 69, \'CREATE ROW POLICY\' = 70, \'ALTER ROW POLICY\' = 71, \'DROP ROW POLICY\' = 72, \'CREATE QUOTA\' = 73, \'ALTER QUOTA\' = 74, \'DROP QUOTA\' = 75, \'CREATE SETTINGS PROFILE\' = 76, \'ALTER SETTINGS PROFILE\' = 77, \'DROP SETTINGS PROFILE\' = 78, \'SHOW USERS\' = 79, \'SHOW ROLES\' = 80, \'SHOW ROW POLICIES\' = 81, \'SHOW QUOTAS\' = 82, \'SHOW SETTINGS PROFILES\' = 83, \'SHOW ACCESS\' = 84, \'ACCESS MANAGEMENT\' = 85, \'SYSTEM SHUTDOWN\' = 86, \'SYSTEM DROP DNS CACHE\' = 87, \'SYSTEM DROP MARK CACHE\' = 88, \'SYSTEM DROP UNCOMPRESSED CACHE\' = 89, \'SYSTEM DROP MMAP CACHE\' = 90, \'SYSTEM DROP COMPILED EXPRESSION CACHE\' = 91, \'SYSTEM DROP CACHE\' = 92, \'SYSTEM RELOAD CONFIG\' = 93, \'SYSTEM RELOAD SYMBOLS\' = 94, \'SYSTEM RELOAD DICTIONARY\' = 95, \'SYSTEM RELOAD MODEL\' = 96, \'SYSTEM RELOAD FUNCTION\' = 97, \'SYSTEM RELOAD EMBEDDED DICTIONARIES\' = 98, \'SYSTEM RELOAD\' = 99, \'SYSTEM RESTART DISK\' = 100, \'SYSTEM MERGES\' = 101, \'SYSTEM TTL MERGES\' = 102, \'SYSTEM FETCHES\' = 103, \'SYSTEM MOVES\' = 104, \'SYSTEM DISTRIBUTED SENDS\' = 105, \'SYSTEM REPLICATED SENDS\' = 106, \'SYSTEM SENDS\' = 107, \'SYSTEM REPLICATION QUEUES\' = 108, \'SYSTEM DROP REPLICA\' = 109, \'SYSTEM SYNC REPLICA\' = 110, \'SYSTEM RESTART REPLICA\' = 111, \'SYSTEM RESTORE REPLICA\' = 112, \'SYSTEM FLUSH DISTRIBUTED\' = 113, \'SYSTEM FLUSH LOGS\' = 114, \'SYSTEM FLUSH\' = 115, \'SYSTEM THREAD FUZZER\' = 116, \'SYSTEM\' = 117, \'dictGet\' = 118, \'addressToLine\' = 119, \'addressToSymbol\' = 120, \'demangle\' = 121, \'INTROSPECTION\' = 122, \'FILE\' = 123, \'URL\' = 124, \'REMOTE\' = 125, \'MONGO\' = 126, \'MYSQL\' = 127),
    `database` Nullable(String),
    `table` Nullable(String),
    `column` Nullable(String),
    `is_partial_revoke` UInt8,
    `grant_option` UInt8
)
ENGINE = SystemGrants()
COMMENT \'SYSTEM TABLE is built on the fly.\'
+CREATE TABLE system.grants
(
    `user_name` Nullable(String),
    `role_name` Nullable(String),
    `access_type` Enum16(\'SHOW DATABASES\' = 0, \'SHOW TABLES\' = 1, \'SHOW COLUMNS\' = 2, \'SHOW DICTIONARIES\' = 3, \'SHOW\' = 4, \'SELECT\' = 5, \'INSERT\' = 6, \'ALTER UPDATE\' = 7, \'ALTER DELETE\' = 8, \'ALTER ADD COLUMN\' = 9, \'ALTER MODIFY COLUMN\' = 10, \'ALTER DROP COLUMN\' = 11, \'ALTER COMMENT COLUMN\' = 12, \'ALTER CLEAR COLUMN\' = 13, \'ALTER RENAME COLUMN\' = 14, \'ALTER MATERIALIZE COLUMN\' = 15, \'ALTER COLUMN\' = 16, \'ALTER MODIFY COMMENT\' = 17, \'ALTER ORDER BY\' = 18, \'ALTER SAMPLE BY\' = 19, \'ALTER ADD INDEX\' = 20, \'ALTER DROP INDEX\' = 21, \'ALTER MATERIALIZE INDEX\' = 22, \'ALTER CLEAR INDEX\' = 23, \'ALTER INDEX\' = 24, \'ALTER ADD PROJECTION\' = 25, \'ALTER DROP PROJECTION\' = 26, \'ALTER MATERIALIZE PROJECTION\' = 27, \'ALTER CLEAR PROJECTION\' = 28, \'ALTER PROJECTION\' = 29, \'ALTER ADD CONSTRAINT\' = 30, \'ALTER DROP CONSTRAINT\' = 31, \'ALTER CONSTRAINT\' = 32, \'ALTER TTL\' = 33, \'ALTER MATERIALIZE TTL\' = 34, \'ALTER SETTINGS\' = 35, \'ALTER MOVE PARTITION\' = 36, \'ALTER FETCH PARTITION\' = 37, \'ALTER FREEZE PARTITION\' = 38, \'ALTER DATABASE SETTINGS\' = 39, \'ALTER TABLE\' = 40, \'ALTER DATABASE\' = 41, \'ALTER VIEW REFRESH\' = 42, \'ALTER VIEW MODIFY QUERY\' = 43, \'ALTER VIEW\' = 44, \'ALTER\' = 45, \'CREATE DATABASE\' = 46, \'CREATE TABLE\' = 47, \'CREATE VIEW\' = 48, \'CREATE DICTIONARY\' = 49, \'CREATE TEMPORARY TABLE\' = 50, \'CREATE FUNCTION\' = 51, \'CREATE\' = 52, \'DROP DATABASE\' = 53, \'DROP TABLE\' = 54, \'DROP VIEW\' = 55, \'DROP DICTIONARY\' = 56, \'DROP FUNCTION\' = 57, \'DROP\' = 58, \'TRUNCATE\' = 59, \'OPTIMIZE\' = 60, \'KILL QUERY\' = 61, \'MOVE PARTITION BETWEEN SHARDS\' = 62, \'CREATE USER\' = 63, \'ALTER USER\' = 64, \'DROP USER\' = 65, \'CREATE ROLE\' = 66, \'ALTER ROLE\' = 67, \'DROP ROLE\' = 68, \'ROLE ADMIN\' = 69, \'CREATE ROW POLICY\' = 70, \'ALTER ROW POLICY\' = 71, \'DROP ROW POLICY\' = 72, \'CREATE QUOTA\' = 73, \'ALTER QUOTA\' = 74, \'DROP QUOTA\' = 75, \'CREATE SETTINGS PROFILE\' = 76, \'ALTER SETTINGS PROFILE\' = 77, \'DROP SETTINGS PROFILE\' = 78, \'SHOW USERS\' = 79, \'SHOW ROLES\' = 80, \'SHOW ROW POLICIES\' = 81, \'SHOW QUOTAS\' = 82, \'SHOW SETTINGS PROFILES\' = 83, \'SHOW ACCESS\' = 84, \'ACCESS MANAGEMENT\' = 85, \'SYSTEM SHUTDOWN\' = 86, \'SYSTEM DROP DNS CACHE\' = 87, \'SYSTEM DROP MARK CACHE\' = 88, \'SYSTEM DROP UNCOMPRESSED CACHE\' = 89, \'SYSTEM DROP MMAP CACHE\' = 90, \'SYSTEM DROP COMPILED EXPRESSION CACHE\' = 91, \'SYSTEM DROP CACHE\' = 92, \'SYSTEM RELOAD CONFIG\' = 93, \'SYSTEM RELOAD SYMBOLS\' = 94, \'SYSTEM RELOAD DICTIONARY\' = 95, \'SYSTEM RELOAD MODEL\' = 96, \'SYSTEM RELOAD FUNCTION\' = 97, \'SYSTEM RELOAD EMBEDDED DICTIONARIES\' = 98, \'SYSTEM RELOAD\' = 99, \'SYSTEM RESTART DISK\' = 100, \'SYSTEM MERGES\' = 101, \'SYSTEM TTL MERGES\' = 102, \'SYSTEM FETCHES\' = 103, \'SYSTEM MOVES\' = 104, \'SYSTEM DISTRIBUTED SENDS\' = 105, \'SYSTEM REPLICATED SENDS\' = 106, \'SYSTEM SENDS\' = 107, \'SYSTEM REPLICATION QUEUES\' = 108, \'SYSTEM DROP REPLICA\' = 109, \'SYSTEM SYNC REPLICA\' = 110, \'SYSTEM RESTART REPLICA\' = 111, \'SYSTEM RESTORE REPLICA\' = 112, \'SYSTEM FLUSH DISTRIBUTED\' = 113, \'SYSTEM FLUSH LOGS\' = 114, \'SYSTEM FLUSH\' = 115, \'SYSTEM THREAD FUZZER\' = 116, \'SYSTEM\' = 117, \'dictGet\' = 118, \'addressToLine\' = 119, \'addressToSymbol\' = 120, \'demangle\' = 121, \'INTROSPECTION\' = 122, \'FILE\' = 123, \'URL\' = 124, \'REMOTE\' = 125, \'MONGO\' = 126, \'MYSQL\' = 127, \'POSTGRES\' = 128, \'SQLITE\' = 129, \'ODBC\' = 130, \'JDBC\' = 131, \'HDFS\' = 132, \'S3\' = 133, \'SOURCES\' = 134, \'ALL\' = 135, \'NONE\' = 136),
    `database` Nullable(String),
    `table` Nullable(String),
    `column` Nullable(String),
    `is_partial_revoke` UInt8,
    `grant_option` UInt8
)
ENGINE = SystemGrants()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.graphite_retentions
(
    `config_name` String,
    `rule_type` String,
    `regexp` String,
    `function` String,
    `age` UInt64,
    `precision` UInt64,
    `priority` UInt16,
    `is_default` UInt8,
    `Tables.database` Array(String),
    `Tables.table` Array(String)
)
ENGINE = SystemGraphite()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.licenses
(
    `library_name` String,
    `license_type` String,
    `license_path` String,
    `license_text` String
)
ENGINE = SystemLicenses()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.macros
(
    `macro` String,
    `substitution` String
)
ENGINE = SystemMacros()
COMMENT \'SYSTEM TABLE is built on the fly.\'
@@ -35,7 +35,7 @@ CREATE TABLE system.one
(
    `dummy` UInt8
)
ENGINE = SystemOne()
COMMENT
 CREATE TABLE system.part_moves_between_shards
(
    `database` String,
    `table` String,
    `task_name` String,
    `task_uuid` UUID,
    `create_time` DateTime,
    `part_name` String,
    `part_uuid` UUID,
    `to_shard` String,
    `dst_part_name` String,
    `update_time` DateTime,
    `state` String,
    `rollback` UInt8,
    `num_tries` UInt32,
    `last_exception` String
)
ENGINE = SystemShardMoves()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.parts
(
    `partition` String,
    `name` String,
    `uuid` UUID,
    `part_type` String,
    `active` UInt8,
    `marks` UInt64,
    `rows` UInt64,
    `bytes_on_disk` UInt64,
    `data_compressed_bytes` UInt64,
    `data_uncompressed_bytes` UInt64,
    `marks_bytes` UInt64,
    `secondary_indices_compressed_bytes` UInt64,
    `secondary_indices_uncompressed_bytes` UInt64,
    `secondary_indices_marks_bytes` UInt64,
    `modification_time` DateTime,
    `remove_time` DateTime,
    `refcount` UInt32,
    `min_date` Date,
    `max_date` Date,
    `min_time` DateTime,
    `max_time` DateTime,
    `partition_id` String,
    `min_block_number` Int64,
    `max_block_number` Int64,
    `level` UInt32,
    `data_version` UInt64,
    `primary_key_bytes_in_memory` UInt64,
    `primary_key_bytes_in_memory_allocated` UInt64,
    `is_frozen` UInt8,
    `database` String,
    `table` String,
    `engine` String,
    `disk_name` String,
    `path` String,
    `hash_of_all_files` String,
    `hash_of_uncompressed_files` String,
    `uncompressed_hash_of_compressed_files` String,
    `delete_ttl_info_min` DateTime,
    `delete_ttl_info_max` DateTime,
    `move_ttl_info.expression` Array(String),
    `move_ttl_info.min` Array(DateTime),
    `move_ttl_info.max` Array(DateTime),
    `default_compression_codec` String,
    `recompression_ttl_info.expression` Array(String),
    `recompression_ttl_info.min` Array(DateTime),
    `recompression_ttl_info.max` Array(DateTime),
    `group_by_ttl_info.expression` Array(String),
    `group_by_ttl_info.min` Array(DateTime),
    `group_by_ttl_info.max` Array(DateTime),
    `rows_where_ttl_info.expression` Array(String),
    `rows_where_ttl_info.min` Array(DateTime),
    `rows_where_ttl_info.max` Array(DateTime),
    `projections` Array(String),
    `bytes` UInt64,
    `marks_size` UInt64
)
ENGINE = SystemParts()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.parts_columns
(
    `partition` String,
    `name` String,
    `uuid` UUID,
    `part_type` String,
    `active` UInt8,
    `marks` UInt64,
    `rows` UInt64,
    `bytes_on_disk` UInt64,
    `data_compressed_bytes` UInt64,
    `data_uncompressed_bytes` UInt64,
    `marks_bytes` UInt64,
    `modification_time` DateTime,
    `remove_time` DateTime,
    `refcount` UInt32,
    `min_date` Date,
    `max_date` Date,
    `min_time` DateTime,
    `max_time` DateTime,
    `partition_id` String,
    `min_block_number` Int64,
    `max_block_number` Int64,
    `level` UInt32,
    `data_version` UInt64,
    `primary_key_bytes_in_memory` UInt64,
    `primary_key_bytes_in_memory_allocated` UInt64,
    `database` String,
    `table` String,
    `engine` String,
    `disk_name` String,
    `path` String,
    `column` String,
    `type` String,
    `column_position` UInt64,
    `default_kind` String,
    `default_expression` String,
    `column_bytes_on_disk` UInt64,
    `column_data_compressed_bytes` UInt64,
    `column_data_uncompressed_bytes` UInt64,
    `column_marks_bytes` UInt64,
    `serialization_kind` String,
    `subcolumns.names` Array(String),
    `subcolumns.types` Array(String),
    `subcolumns.serializations` Array(String),
    `bytes` UInt64,
    `marks_size` UInt64
)
ENGINE = SystemPartsColumns()
COMMENT \'SYSTEM TABLE is built on the fly.\'
-CREATE TABLE system.privileges
(
    `privilege` Enum8(\'POSTGRES\' = -128, \'SQLITE\' = -127, \'ODBC\' = -126, \'JDBC\' = -125, \'HDFS\' = -124, \'S3\' = -123, \'SOURCES\' = -122, \'ALL\' = -121, \'NONE\' = -120, \'SHOW DATABASES\' = 0, \'SHOW TABLES\' = 1, \'SHOW COLUMNS\' = 2, \'SHOW DICTIONARIES\' = 3, \'SHOW\' = 4, \'SELECT\' = 5, \'INSERT\' = 6, \'ALTER UPDATE\' = 7, \'ALTER DELETE\' = 8, \'ALTER ADD COLUMN\' = 9, \'ALTER MODIFY COLUMN\' = 10, \'ALTER DROP COLUMN\' = 11, \'ALTER COMMENT COLUMN\' = 12, \'ALTER CLEAR COLUMN\' = 13, \'ALTER RENAME COLUMN\' = 14, \'ALTER MATERIALIZE COLUMN\' = 15, \'ALTER COLUMN\' = 16, \'ALTER MODIFY COMMENT\' = 17, \'ALTER ORDER BY\' = 18, \'ALTER SAMPLE BY\' = 19, \'ALTER ADD INDEX\' = 20, \'ALTER DROP INDEX\' = 21, \'ALTER MATERIALIZE INDEX\' = 22, \'ALTER CLEAR INDEX\' = 23, \'ALTER INDEX\' = 24, \'ALTER ADD PROJECTION\' = 25, \'ALTER DROP PROJECTION\' = 26, \'ALTER MATERIALIZE PROJECTION\' = 27, \'ALTER CLEAR PROJECTION\' = 28, \'ALTER PROJECTION\' = 29, \'ALTER ADD CONSTRAINT\' = 30, \'ALTER DROP CONSTRAINT\' = 31, \'ALTER CONSTRAINT\' = 32, \'ALTER TTL\' = 33, \'ALTER MATERIALIZE TTL\' = 34, \'ALTER SETTINGS\' = 35, \'ALTER MOVE PARTITION\' = 36, \'ALTER FETCH PARTITION\' = 37, \'ALTER FREEZE PARTITION\' = 38, \'ALTER DATABASE SETTINGS\' = 39, \'ALTER TABLE\' = 40, \'ALTER DATABASE\' = 41, \'ALTER VIEW REFRESH\' = 42, \'ALTER VIEW MODIFY QUERY\' = 43, \'ALTER VIEW\' = 44, \'ALTER\' = 45, \'CREATE DATABASE\' = 46, \'CREATE TABLE\' = 47, \'CREATE VIEW\' = 48, \'CREATE DICTIONARY\' = 49, \'CREATE TEMPORARY TABLE\' = 50, \'CREATE FUNCTION\' = 51, \'CREATE\' = 52, \'DROP DATABASE\' = 53, \'DROP TABLE\' = 54, \'DROP VIEW\' = 55, \'DROP DICTIONARY\' = 56, \'DROP FUNCTION\' = 57, \'DROP\' = 58, \'TRUNCATE\' = 59, \'OPTIMIZE\' = 60, \'KILL QUERY\' = 61, \'MOVE PARTITION BETWEEN SHARDS\' = 62, \'CREATE USER\' = 63, \'ALTER USER\' = 64, \'DROP USER\' = 65, \'CREATE ROLE\' = 66, \'ALTER ROLE\' = 67, \'DROP ROLE\' = 68, \'ROLE ADMIN\' = 69, \'CREATE ROW POLICY\' = 70, \'ALTER ROW POLICY\' = 71, \'DROP ROW POLICY\' = 72, \'CREATE QUOTA\' = 73, \'ALTER QUOTA\' = 74, \'DROP QUOTA\' = 75, \'CREATE SETTINGS PROFILE\' = 76, \'ALTER SETTINGS PROFILE\' = 77, \'DROP SETTINGS PROFILE\' = 78, \'SHOW USERS\' = 79, \'SHOW ROLES\' = 80, \'SHOW ROW POLICIES\' = 81, \'SHOW QUOTAS\' = 82, \'SHOW SETTINGS PROFILES\' = 83, \'SHOW ACCESS\' = 84, \'ACCESS MANAGEMENT\' = 85, \'SYSTEM SHUTDOWN\' = 86, \'SYSTEM DROP DNS CACHE\' = 87, \'SYSTEM DROP MARK CACHE\' = 88, \'SYSTEM DROP UNCOMPRESSED CACHE\' = 89, \'SYSTEM DROP MMAP CACHE\' = 90, \'SYSTEM DROP COMPILED EXPRESSION CACHE\' = 91, \'SYSTEM DROP CACHE\' = 92, \'SYSTEM RELOAD CONFIG\' = 93, \'SYSTEM RELOAD SYMBOLS\' = 94, \'SYSTEM RELOAD DICTIONARY\' = 95, \'SYSTEM RELOAD MODEL\' = 96, \'SYSTEM RELOAD FUNCTION\' = 97, \'SYSTEM RELOAD EMBEDDED DICTIONARIES\' = 98, \'SYSTEM RELOAD\' = 99, \'SYSTEM RESTART DISK\' = 100, \'SYSTEM MERGES\' = 101, \'SYSTEM TTL MERGES\' = 102, \'SYSTEM FETCHES\' = 103, \'SYSTEM MOVES\' = 104, \'SYSTEM DISTRIBUTED SENDS\' = 105, \'SYSTEM REPLICATED SENDS\' = 106, \'SYSTEM SENDS\' = 107, \'SYSTEM REPLICATION QUEUES\' = 108, \'SYSTEM DROP REPLICA\' = 109, \'SYSTEM SYNC REPLICA\' = 110, \'SYSTEM RESTART REPLICA\' = 111, \'SYSTEM RESTORE REPLICA\' = 112, \'SYSTEM FLUSH DISTRIBUTED\' = 113, \'SYSTEM FLUSH LOGS\' = 114, \'SYSTEM FLUSH\' = 115, \'SYSTEM THREAD FUZZER\' = 116, \'SYSTEM\' = 117, \'dictGet\' = 118, \'addressToLine\' = 119, \'addressToSymbol\' = 120, \'demangle\' = 121, \'INTROSPECTION\' = 122, \'FILE\' = 123, \'URL\' = 124, \'REMOTE\' = 125, \'MONGO\' = 126, \'MYSQL\' = 127),
    `aliases` Array(String),
    `level` Nullable(Enum8(\'GLOBAL\' = 0, \'DATABASE\' = 1, \'TABLE\' = 2, \'DICTIONARY\' = 3, \'VIEW\' = 4, \'COLUMN\' = 5)),
    `parent_group` Nullable(Enum8(\'POSTGRES\' = -128, \'SQLITE\' = -127, \'ODBC\' = -126, \'JDBC\' = -125, \'HDFS\' = -124, \'S3\' = -123, \'SOURCES\' = -122, \'ALL\' = -121, \'NONE\' = -120, \'SHOW DATABASES\' = 0, \'SHOW TABLES\' = 1, \'SHOW COLUMNS\' = 2, \'SHOW DICTIONARIES\' = 3, \'SHOW\' = 4, \'SELECT\' = 5, \'INSERT\' = 6, \'ALTER UPDATE\' = 7, \'ALTER DELETE\' = 8, \'ALTER ADD COLUMN\' = 9, \'ALTER MODIFY COLUMN\' = 10, \'ALTER DROP COLUMN\' = 11, \'ALTER COMMENT COLUMN\' = 12, \'ALTER CLEAR COLUMN\' = 13, \'ALTER RENAME COLUMN\' = 14, \'ALTER MATERIALIZE COLUMN\' = 15, \'ALTER COLUMN\' = 16, \'ALTER MODIFY COMMENT\' = 17, \'ALTER ORDER BY\' = 18, \'ALTER SAMPLE BY\' = 19, \'ALTER ADD INDEX\' = 20, \'ALTER DROP INDEX\' = 21, \'ALTER MATERIALIZE INDEX\' = 22, \'ALTER CLEAR INDEX\' = 23, \'ALTER INDEX\' = 24, \'ALTER ADD PROJECTION\' = 25, \'ALTER DROP PROJECTION\' = 26, \'ALTER MATERIALIZE PROJECTION\' = 27, \'ALTER CLEAR PROJECTION\' = 28, \'ALTER PROJECTION\' = 29, \'ALTER ADD CONSTRAINT\' = 30, \'ALTER DROP CONSTRAINT\' = 31, \'ALTER CONSTRAINT\' = 32, \'ALTER TTL\' = 33, \'ALTER MATERIALIZE TTL\' = 34, \'ALTER SETTINGS\' = 35, \'ALTER MOVE PARTITION\' = 36, \'ALTER FETCH PARTITION\' = 37, \'ALTER FREEZE PARTITION\' = 38, \'ALTER DATABASE SETTINGS\' = 39, \'ALTER TABLE\' = 40, \'ALTER DATABASE\' = 41, \'ALTER VIEW REFRESH\' = 42, \'ALTER VIEW MODIFY QUERY\' = 43, \'ALTER VIEW\' = 44, \'ALTER\' = 45, \'CREATE DATABASE\' = 46, \'CREATE TABLE\' = 47, \'CREATE VIEW\' = 48, \'CREATE DICTIONARY\' = 49, \'CREATE TEMPORARY TABLE\' = 50, \'CREATE FUNCTION\' = 51, \'CREATE\' = 52, \'DROP DATABASE\' = 53, \'DROP TABLE\' = 54, \'DROP VIEW\' = 55, \'DROP DICTIONARY\' = 56, \'DROP FUNCTION\' = 57, \'DROP\' = 58, \'TRUNCATE\' = 59, \'OPTIMIZE\' = 60, \'KILL QUERY\' = 61, \'MOVE PARTITION BETWEEN SHARDS\' = 62, \'CREATE USER\' = 63, \'ALTER USER\' = 64, \'DROP USER\' = 65, \'CREATE ROLE\' = 66, \'ALTER ROLE\' = 67, \'DROP ROLE\' = 68, \'ROLE ADMIN\' = 69, \'CREATE ROW POLICY\' = 70, \'ALTER ROW POLICY\' = 71, \'DROP ROW POLICY\' = 72, \'CREATE QUOTA\' = 73, \'ALTER QUOTA\' = 74, \'DROP QUOTA\' = 75, \'CREATE SETTINGS PROFILE\' = 76, \'ALTER SETTINGS PROFILE\' = 77, \'DROP SETTINGS PROFILE\' = 78, \'SHOW USERS\' = 79, \'SHOW ROLES\' = 80, \'SHOW ROW POLICIES\' = 81, \'SHOW QUOTAS\' = 82, \'SHOW SETTINGS PROFILES\' = 83, \'SHOW ACCESS\' = 84, \'ACCESS MANAGEMENT\' = 85, \'SYSTEM SHUTDOWN\' = 86, \'SYSTEM DROP DNS CACHE\' = 87, \'SYSTEM DROP MARK CACHE\' = 88, \'SYSTEM DROP UNCOMPRESSED CACHE\' = 89, \'SYSTEM DROP MMAP CACHE\' = 90, \'SYSTEM DROP COMPILED EXPRESSION CACHE\' = 91, \'SYSTEM DROP CACHE\' = 92, \'SYSTEM RELOAD CONFIG\' = 93, \'SYSTEM RELOAD SYMBOLS\' = 94, \'SYSTEM RELOAD DICTIONARY\' = 95, \'SYSTEM RELOAD MODEL\' = 96, \'SYSTEM RELOAD FUNCTION\' = 97, \'SYSTEM RELOAD EMBEDDED DICTIONARIES\' = 98, \'SYSTEM RELOAD\' = 99, \'SYSTEM RESTART DISK\' = 100, \'SYSTEM MERGES\' = 101, \'SYSTEM TTL MERGES\' = 102, \'SYSTEM FETCHES\' = 103, \'SYSTEM MOVES\' = 104, \'SYSTEM DISTRIBUTED SENDS\' = 105, \'SYSTEM REPLICATED SENDS\' = 106, \'SYSTEM SENDS\' = 107, \'SYSTEM REPLICATION QUEUES\' = 108, \'SYSTEM DROP REPLICA\' = 109, \'SYSTEM SYNC REPLICA\' = 110, \'SYSTEM RESTART REPLICA\' = 111, \'SYSTEM RESTORE REPLICA\' = 112, \'SYSTEM FLUSH DISTRIBUTED\' = 113, \'SYSTEM FLUSH LOGS\' = 114, \'SYSTEM FLUSH\' = 115, \'SYSTEM THREAD FUZZER\' = 116, \'SYSTEM\' = 117, \'dictGet\' = 118, \'addressToLine\' = 119, \'addressToSymbol\' = 120, \'demangle\' = 121, \'INTROSPECTION\' = 122, \'FILE\' = 123, \'URL\' = 124, \'REMOTE\' = 125, \'MONGO\' = 126, \'MYSQL\' = 127))
)
ENGINE = SystemPrivileges()
COMMENT \'SYSTEM TABLE is built on the fly.\'
+CREATE TABLE system.privileges
(
    `privilege` Enum16(\'SHOW DATABASES\' = 0, \'SHOW TABLES\' = 1, \'SHOW COLUMNS\' = 2, \'SHOW DICTIONARIES\' = 3, \'SHOW\' = 4, \'SELECT\' = 5, \'INSERT\' = 6, \'ALTER UPDATE\' = 7, \'ALTER DELETE\' = 8, \'ALTER ADD COLUMN\' = 9, \'ALTER MODIFY COLUMN\' = 10, \'ALTER DROP COLUMN\' = 11, \'ALTER COMMENT COLUMN\' = 12, \'ALTER CLEAR COLUMN\' = 13, \'ALTER RENAME COLUMN\' = 14, \'ALTER MATERIALIZE COLUMN\' = 15, \'ALTER COLUMN\' = 16, \'ALTER MODIFY COMMENT\' = 17, \'ALTER ORDER BY\' = 18, \'ALTER SAMPLE BY\' = 19, \'ALTER ADD INDEX\' = 20, \'ALTER DROP INDEX\' = 21, \'ALTER MATERIALIZE INDEX\' = 22, \'ALTER CLEAR INDEX\' = 23, \'ALTER INDEX\' = 24, \'ALTER ADD PROJECTION\' = 25, \'ALTER DROP PROJECTION\' = 26, \'ALTER MATERIALIZE PROJECTION\' = 27, \'ALTER CLEAR PROJECTION\' = 28, \'ALTER PROJECTION\' = 29, \'ALTER ADD CONSTRAINT\' = 30, \'ALTER DROP CONSTRAINT\' = 31, \'ALTER CONSTRAINT\' = 32, \'ALTER TTL\' = 33, \'ALTER MATERIALIZE TTL\' = 34, \'ALTER SETTINGS\' = 35, \'ALTER MOVE PARTITION\' = 36, \'ALTER FETCH PARTITION\' = 37, \'ALTER FREEZE PARTITION\' = 38, \'ALTER DATABASE SETTINGS\' = 39, \'ALTER TABLE\' = 40, \'ALTER DATABASE\' = 41, \'ALTER VIEW REFRESH\' = 42, \'ALTER VIEW MODIFY QUERY\' = 43, \'ALTER VIEW\' = 44, \'ALTER\' = 45, \'CREATE DATABASE\' = 46, \'CREATE TABLE\' = 47, \'CREATE VIEW\' = 48, \'CREATE DICTIONARY\' = 49, \'CREATE TEMPORARY TABLE\' = 50, \'CREATE FUNCTION\' = 51, \'CREATE\' = 52, \'DROP DATABASE\' = 53, \'DROP TABLE\' = 54, \'DROP VIEW\' = 55, \'DROP DICTIONARY\' = 56, \'DROP FUNCTION\' = 57, \'DROP\' = 58, \'TRUNCATE\' = 59, \'OPTIMIZE\' = 60, \'KILL QUERY\' = 61, \'MOVE PARTITION BETWEEN SHARDS\' = 62, \'CREATE USER\' = 63, \'ALTER USER\' = 64, \'DROP USER\' = 65, \'CREATE ROLE\' = 66, \'ALTER ROLE\' = 67, \'DROP ROLE\' = 68, \'ROLE ADMIN\' = 69, \'CREATE ROW POLICY\' = 70, \'ALTER ROW POLICY\' = 71, \'DROP ROW POLICY\' = 72, \'CREATE QUOTA\' = 73, \'ALTER QUOTA\' = 74, \'DROP QUOTA\' = 75, \'CREATE SETTINGS PROFILE\' = 76, \'ALTER SETTINGS PROFILE\' = 77, \'DROP SETTINGS PROFILE\' = 78, \'SHOW USERS\' = 79, \'SHOW ROLES\' = 80, \'SHOW ROW POLICIES\' = 81, \'SHOW QUOTAS\' = 82, \'SHOW SETTINGS PROFILES\' = 83, \'SHOW ACCESS\' = 84, \'ACCESS MANAGEMENT\' = 85, \'SYSTEM SHUTDOWN\' = 86, \'SYSTEM DROP DNS CACHE\' = 87, \'SYSTEM DROP MARK CACHE\' = 88, \'SYSTEM DROP UNCOMPRESSED CACHE\' = 89, \'SYSTEM DROP MMAP CACHE\' = 90, \'SYSTEM DROP COMPILED EXPRESSION CACHE\' = 91, \'SYSTEM DROP CACHE\' = 92, \'SYSTEM RELOAD CONFIG\' = 93, \'SYSTEM RELOAD SYMBOLS\' = 94, \'SYSTEM RELOAD DICTIONARY\' = 95, \'SYSTEM RELOAD MODEL\' = 96, \'SYSTEM RELOAD FUNCTION\' = 97, \'SYSTEM RELOAD EMBEDDED DICTIONARIES\' = 98, \'SYSTEM RELOAD\' = 99, \'SYSTEM RESTART DISK\' = 100, \'SYSTEM MERGES\' = 101, \'SYSTEM TTL MERGES\' = 102, \'SYSTEM FETCHES\' = 103, \'SYSTEM MOVES\' = 104, \'SYSTEM DISTRIBUTED SENDS\' = 105, \'SYSTEM REPLICATED SENDS\' = 106, \'SYSTEM SENDS\' = 107, \'SYSTEM REPLICATION QUEUES\' = 108, \'SYSTEM DROP REPLICA\' = 109, \'SYSTEM SYNC REPLICA\' = 110, \'SYSTEM RESTART REPLICA\' = 111, \'SYSTEM RESTORE REPLICA\' = 112, \'SYSTEM FLUSH DISTRIBUTED\' = 113, \'SYSTEM FLUSH LOGS\' = 114, \'SYSTEM FLUSH\' = 115, \'SYSTEM THREAD FUZZER\' = 116, \'SYSTEM\' = 117, \'dictGet\' = 118, \'addressToLine\' = 119, \'addressToSymbol\' = 120, \'demangle\' = 121, \'INTROSPECTION\' = 122, \'FILE\' = 123, \'URL\' = 124, \'REMOTE\' = 125, \'MONGO\' = 126, \'MYSQL\' = 127, \'POSTGRES\' = 128, \'SQLITE\' = 129, \'ODBC\' = 130, \'JDBC\' = 131, \'HDFS\' = 132, \'S3\' = 133, \'SOURCES\' = 134, \'ALL\' = 135, \'NONE\' = 136),
    `aliases` Array(String),
    `level` Nullable(Enum8(\'GLOBAL\' = 0, \'DATABASE\' = 1, \'TABLE\' = 2, \'DICTIONARY\' = 3, \'VIEW\' = 4, \'COLUMN\' = 5)),
    `parent_group` Nullable(Enum16(\'SHOW DATABASES\' = 0, \'SHOW TABLES\' = 1, \'SHOW COLUMNS\' = 2, \'SHOW DICTIONARIES\' = 3, \'SHOW\' = 4, \'SELECT\' = 5, \'INSERT\' = 6, \'ALTER UPDATE\' = 7, \'ALTER DELETE\' = 8, \'ALTER ADD COLUMN\' = 9, \'ALTER MODIFY COLUMN\' = 10, \'ALTER DROP COLUMN\' = 11, \'ALTER COMMENT COLUMN\' = 12, \'ALTER CLEAR COLUMN\' = 13, \'ALTER RENAME COLUMN\' = 14, \'ALTER MATERIALIZE COLUMN\' = 15, \'ALTER COLUMN\' = 16, \'ALTER MODIFY COMMENT\' = 17, \'ALTER ORDER BY\' = 18, \'ALTER SAMPLE BY\' = 19, \'ALTER ADD INDEX\' = 20, \'ALTER DROP INDEX\' = 21, \'ALTER MATERIALIZE INDEX\' = 22, \'ALTER CLEAR INDEX\' = 23, \'ALTER INDEX\' = 24, \'ALTER ADD PROJECTION\' = 25, \'ALTER DROP PROJECTION\' = 26, \'ALTER MATERIALIZE PROJECTION\' = 27, \'ALTER CLEAR PROJECTION\' = 28, \'ALTER PROJECTION\' = 29, \'ALTER ADD CONSTRAINT\' = 30, \'ALTER DROP CONSTRAINT\' = 31, \'ALTER CONSTRAINT\' = 32, \'ALTER TTL\' = 33, \'ALTER MATERIALIZE TTL\' = 34, \'ALTER SETTINGS\' = 35, \'ALTER MOVE PARTITION\' = 36, \'ALTER FETCH PARTITION\' = 37, \'ALTER FREEZE PARTITION\' = 38, \'ALTER DATABASE SETTINGS\' = 39, \'ALTER TABLE\' = 40, \'ALTER DATABASE\' = 41, \'ALTER VIEW REFRESH\' = 42, \'ALTER VIEW MODIFY QUERY\' = 43, \'ALTER VIEW\' = 44, \'ALTER\' = 45, \'CREATE DATABASE\' = 46, \'CREATE TABLE\' = 47, \'CREATE VIEW\' = 48, \'CREATE DICTIONARY\' = 49, \'CREATE TEMPORARY TABLE\' = 50, \'CREATE FUNCTION\' = 51, \'CREATE\' = 52, \'DROP DATABASE\' = 53, \'DROP TABLE\' = 54, \'DROP VIEW\' = 55, \'DROP DICTIONARY\' = 56, \'DROP FUNCTION\' = 57, \'DROP\' = 58, \'TRUNCATE\' = 59, \'OPTIMIZE\' = 60, \'KILL QUERY\' = 61, \'MOVE PARTITION BETWEEN SHARDS\' = 62, \'CREATE USER\' = 63, \'ALTER USER\' = 64, \'DROP USER\' = 65, \'CREATE ROLE\' = 66, \'ALTER ROLE\' = 67, \'DROP ROLE\' = 68, \'ROLE ADMIN\' = 69, \'CREATE ROW POLICY\' = 70, \'ALTER ROW POLICY\' = 71, \'DROP ROW POLICY\' = 72, \'CREATE QUOTA\' = 73, \'ALTER QUOTA\' = 74, \'DROP QUOTA\' = 75, \'CREATE SETTINGS PROFILE\' = 76, \'ALTER SETTINGS PROFILE\' = 77, \'DROP SETTINGS PROFILE\' = 78, \'SHOW USERS\' = 79, \'SHOW ROLES\' = 80, \'SHOW ROW POLICIES\' = 81, \'SHOW QUOTAS\' = 82, \'SHOW SETTINGS PROFILES\' = 83, \'SHOW ACCESS\' = 84, \'ACCESS MANAGEMENT\' = 85, \'SYSTEM SHUTDOWN\' = 86, \'SYSTEM DROP DNS CACHE\' = 87, \'SYSTEM DROP MARK CACHE\' = 88, \'SYSTEM DROP UNCOMPRESSED CACHE\' = 89, \'SYSTEM DROP MMAP CACHE\' = 90, \'SYSTEM DROP COMPILED EXPRESSION CACHE\' = 91, \'SYSTEM DROP CACHE\' = 92, \'SYSTEM RELOAD CONFIG\' = 93, \'SYSTEM RELOAD SYMBOLS\' = 94, \'SYSTEM RELOAD DICTIONARY\' = 95, \'SYSTEM RELOAD MODEL\' = 96, \'SYSTEM RELOAD FUNCTION\' = 97, \'SYSTEM RELOAD EMBEDDED DICTIONARIES\' = 98, \'SYSTEM RELOAD\' = 99, \'SYSTEM RESTART DISK\' = 100, \'SYSTEM MERGES\' = 101, \'SYSTEM TTL MERGES\' = 102, \'SYSTEM FETCHES\' = 103, \'SYSTEM MOVES\' = 104, \'SYSTEM DISTRIBUTED SENDS\' = 105, \'SYSTEM REPLICATED SENDS\' = 106, \'SYSTEM SENDS\' = 107, \'SYSTEM REPLICATION QUEUES\' = 108, \'SYSTEM DROP REPLICA\' = 109, \'SYSTEM SYNC REPLICA\' = 110, \'SYSTEM RESTART REPLICA\' = 111, \'SYSTEM RESTORE REPLICA\' = 112, \'SYSTEM FLUSH DISTRIBUTED\' = 113, \'SYSTEM FLUSH LOGS\' = 114, \'SYSTEM FLUSH\' = 115, \'SYSTEM THREAD FUZZER\' = 116, \'SYSTEM\' = 117, \'dictGet\' = 118, \'addressToLine\' = 119, \'addressToSymbol\' = 120, \'demangle\' = 121, \'INTROSPECTION\' = 122, \'FILE\' = 123, \'URL\' = 124, \'REMOTE\' = 125, \'MONGO\' = 126, \'MYSQL\' = 127, \'POSTGRES\' = 128, \'SQLITE\' = 129, \'ODBC\' = 130, \'JDBC\' = 131, \'HDFS\' = 132, \'S3\' = 133, \'SOURCES\' = 134, \'ALL\' = 135, \'NONE\' = 136))
)
ENGINE = SystemPrivileges()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.processes
(
    `is_initial_query` UInt8,
    `user` String,
    `query_id` String,
    `address` IPv6,
    `port` UInt16,
    `initial_user` String,
    `initial_query_id` String,
    `initial_address` IPv6,
    `initial_port` UInt16,
    `interface` UInt8,
    `os_user` String,
    `client_hostname` String,
    `client_name` String,
    `client_revision` UInt64,
    `client_version_major` UInt64,
    `client_version_minor` UInt64,
    `client_version_patch` UInt64,
    `http_method` UInt8,
    `http_user_agent` String,
    `http_referer` String,
    `forwarded_for` String,
    `quota_key` String,
    `elapsed` Float64,
    `is_cancelled` UInt8,
    `read_rows` UInt64,
    `read_bytes` UInt64,
    `total_rows_approx` UInt64,
    `written_rows` UInt64,
    `written_bytes` UInt64,
    `memory_usage` Int64,
    `peak_memory_usage` Int64,
    `query` String,
    `thread_ids` Array(UInt64),
    `ProfileEvents` Map(String, UInt64),
    `Settings` Map(String, String),
    `current_database` String,
    `ProfileEvents.Names` Array(String),
    `ProfileEvents.Values` Array(UInt64),
    `Settings.Names` Array(String),
    `Settings.Values` Array(String)
)
ENGINE = SystemProcesses()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.projection_parts
(
    `partition` String,
    `name` String,
    `part_type` String,
    `parent_name` String,
    `parent_uuid` UUID,
    `parent_part_type` String,
    `active` UInt8,
    `marks` UInt64,
    `rows` UInt64,
    `bytes_on_disk` UInt64,
    `data_compressed_bytes` UInt64,
    `data_uncompressed_bytes` UInt64,
    `marks_bytes` UInt64,
    `parent_marks` UInt64,
    `parent_rows` UInt64,
    `parent_bytes_on_disk` UInt64,
    `parent_data_compressed_bytes` UInt64,
    `parent_data_uncompressed_bytes` UInt64,
    `parent_marks_bytes` UInt64,
    `modification_time` DateTime,
    `remove_time` DateTime,
    `refcount` UInt32,
    `min_date` Date,
    `max_date` Date,
    `min_time` DateTime,
    `max_time` DateTime,
    `partition_id` String,
    `min_block_number` Int64,
    `max_block_number` Int64,
    `level` UInt32,
    `data_version` UInt64,
    `primary_key_bytes_in_memory` UInt64,
    `primary_key_bytes_in_memory_allocated` UInt64,
    `is_frozen` UInt8,
    `database` String,
    `table` String,
    `engine` String,
    `disk_name` String,
    `path` String,
    `hash_of_all_files` String,
    `hash_of_uncompressed_files` String,
    `uncompressed_hash_of_compressed_files` String,
    `delete_ttl_info_min` DateTime,
    `delete_ttl_info_max` DateTime,
    `move_ttl_info.expression` Array(String),
    `move_ttl_info.min` Array(DateTime),
    `move_ttl_info.max` Array(DateTime),
    `default_compression_codec` String,
    `recompression_ttl_info.expression` Array(String),
    `recompression_ttl_info.min` Array(DateTime),
    `recompression_ttl_info.max` Array(DateTime),
    `group_by_ttl_info.expression` Array(String),
    `group_by_ttl_info.min` Array(DateTime),
    `group_by_ttl_info.max` Array(DateTime),
    `rows_where_ttl_info.expression` Array(String),
    `rows_where_ttl_info.min` Array(DateTime),
    `rows_where_ttl_info.max` Array(DateTime),
    `bytes` UInt64,
    `marks_size` UInt64
)
ENGINE = SystemProjectionParts()
COMMENT \'SYSTEM TABLE is built on the fly.\'
 CREATE TABLE system.projection_parts_columns
(
    `partition` String,
    `name` String,
    `part_type` String,
    `parent_name` String,
    `parent_uuid` UUID,
    `parent_part_type` String,
    `active` UInt8,
    `marks` UInt64,
    `rows` UInt64,
    `bytes_on_disk` UInt64,
    `data_compressed_bytes` UInt64,
    `data_uncompressed_bytes` UInt64,
    `marks_bytes` UInt64,
    `parent_marks` UInt64,
    `parent_rows` UInt64,
    `parent_bytes_on_disk` UInt64,
    `parent_data_compressed_bytes` UInt64,
    `parent_data_uncompressed_bytes` UInt64,
    `parent_marks_bytes` UInt64,
    `modification_time` DateTime,
    `remove_time` DateTime,
    `refcount` UInt32,
    `min_date` Date,
    `max_date` Date,
    `min_time` DateTime,
    `max_time` DateTime,
    `partition_id` String,
    `min_block_number` Int64,
    `max_block_number` Int64,
    `level` UInt32,
    `data_version` UInt64,
    `primary_key_bytes_in_memory` UInt64,
    `primary_key_bytes_in_memory_allocated` UInt64,
    `database` String,
    `table` String,
    `engine` String,
    `disk_name` String,
    `path` String,
    `column` String,
    `type` String,
    `column_position` UInt64,
    `default_kind` String,
    `default_expression` String,
    `column_bytes_on_disk` UInt64,
    `column_data_compressed_bytes` UInt64,
    `column_data_uncompressed_bytes` UInt64,
    `column_marks_bytes` UInt64,
    `bytes` UInt64,
    `marks_size` UInt64
)
ENGINE = SystemProjectionPartsColumns()
COMMENT \'SYSTEM TABLE is built on the fly.\'
diff --git a/tests/queries/0_stateless/02119_sumcount.reference b/tests/queries/0_stateless/02119_sumcount.reference
index 4adda0e10be2..437c52c899a1 100644
--- a/tests/queries/0_stateless/02119_sumcount.reference
+++ b/tests/queries/0_stateless/02119_sumcount.reference
@@ -2,10 +2,10 @@ Tuple(UInt64, UInt64)	(9007199254740994,3)
 Tuple(UInt64, UInt64)	(9007199254740994,3)
 Tuple(UInt64, UInt64)	(9007199254740994,3)
 Tuple(UInt64, UInt64)	(9007199254740994,3)
-Tuple(Float64, UInt64)	(9007199254740992,3)
-Tuple(Float64, UInt64)	(9007199254740992,3)
-Tuple(Float64, UInt64)	(9007199254740992,3)
-Tuple(Float64, UInt64)	(9007199254740992,3)
+Tuple(Float64, UInt64)	(9007199254740994,3)
+Tuple(Float64, UInt64)	(9007199254740994,3)
+Tuple(Float64, UInt64)	(9007199254740994,3)
+Tuple(Float64, UInt64)	(9007199254740994,3)
 Tuple(Float64, UInt64)	(16777218,3)
 Tuple(Float64, UInt64)	(16777218,3)
 Tuple(Float64, UInt64)	(16777218,3)
diff --git a/tests/queries/0_stateless/02119_sumcount.sql b/tests/queries/0_stateless/02119_sumcount.sql
index 9189efd08ac1..22cb8b657da0 100644
--- a/tests/queries/0_stateless/02119_sumcount.sql
+++ b/tests/queries/0_stateless/02119_sumcount.sql
@@ -1,20 +1,150 @@
 -- Integer types are added as integers
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::UInt64 AS v UNION ALL SELECT '1'::UInt64 AS v UNION ALL SELECT '1'::UInt64 AS v);
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::Nullable(UInt64) AS v UNION ALL SELECT '1'::Nullable(UInt64) AS v UNION ALL SELECT '1'::Nullable(UInt64) AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::LowCardinality(UInt64) AS v UNION ALL SELECT '1'::LowCardinality(UInt64) AS v UNION ALL SELECT '1'::LowCardinality(UInt64) AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::LowCardinality(Nullable(UInt64)) AS v UNION ALL SELECT '1'::LowCardinality(Nullable(UInt64)) AS v UNION ALL SELECT '1'::LowCardinality(Nullable(UInt64)) AS v );
-
--- Float64 types are added as Float64
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::Float64 AS v UNION ALL SELECT '1'::Float64 AS v UNION ALL SELECT '1'::Float64 AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::Nullable(Float64) AS v UNION ALL SELECT '1'::Nullable(Float64) AS v UNION ALL SELECT '1'::Nullable(Float64) AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::LowCardinality(Float64) AS v UNION ALL SELECT '1'::LowCardinality(Float64) AS v UNION ALL SELECT '1'::LowCardinality(Float64) AS v);
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '9007199254740992'::LowCardinality(Nullable(Float64)) AS v UNION ALL SELECT '1'::LowCardinality(Nullable(Float64)) AS v UNION ALL SELECT '1'::LowCardinality(Nullable(Float64)) AS v );
-
--- Float32 are added as Float64
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '16777216'::Float32 AS v UNION ALL SELECT '1'::Float32 AS v UNION ALL SELECT '1'::Float32 AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '16777216'::Nullable(Float32) AS v UNION ALL SELECT '1'::Nullable(Float32) AS v UNION ALL SELECT '1'::Nullable(Float32) AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '16777216'::LowCardinality(Float32) AS v UNION ALL SELECT '1'::LowCardinality(Float32) AS v UNION ALL SELECT '1'::LowCardinality(Float32) AS v );
-SELECT toTypeName(sumCount(v)), sumCount(v) FROM (SELECT '16777216'::LowCardinality(Nullable(Float32)) AS v UNION ALL SELECT '1'::LowCardinality(Nullable(Float32)) AS v UNION ALL SELECT '1'::LowCardinality(Nullable(Float32)) AS v );
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::UInt64 AS v
+        UNION ALL
+        SELECT '1'::UInt64 AS v
+        UNION ALL SELECT '1'::UInt64 AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::Nullable(UInt64) AS v
+        UNION ALL
+        SELECT '1'::Nullable(UInt64) AS v
+        UNION ALL
+        SELECT '1'::Nullable(UInt64) AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+	(
+        SELECT '9007199254740992'::LowCardinality(UInt64) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(UInt64) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(UInt64) AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::LowCardinality(Nullable(UInt64)) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Nullable(UInt64)) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Nullable(UInt64)) AS v
+    )
+    ORDER BY v
+);
+
+-- -- Float64 types are added as Float64
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::Float64 AS v
+        UNION ALL
+        SELECT '1'::Float64 AS v
+        UNION ALL SELECT '1'::Float64 AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::Nullable(Float64) AS v
+        UNION ALL
+        SELECT '1'::Nullable(Float64) AS v
+        UNION ALL
+        SELECT '1'::Nullable(Float64) AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::LowCardinality(Float64) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Float64) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Float64) AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '9007199254740992'::LowCardinality(Nullable(Float64)) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Nullable(Float64)) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Nullable(Float64)) AS v
+    )
+    ORDER BY v
+);
+
+-- -- Float32 are added as Float64
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '16777216'::Float32 AS v
+        UNION ALL
+        SELECT '1'::Float32 AS v
+        UNION ALL
+        SELECT '1'::Float32 AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '16777216'::Nullable(Float32) AS v
+        UNION ALL
+        SELECT '1'::Nullable(Float32) AS v
+        UNION ALL
+        SELECT '1'::Nullable(Float32) AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '16777216'::LowCardinality(Float32) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Float32) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Float32) AS v
+    )
+    ORDER BY v
+);
+SELECT toTypeName(sumCount(v)), sumCount(v) FROM
+(
+    SELECT v FROM
+    (
+        SELECT '16777216'::LowCardinality(Nullable(Float32)) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Nullable(Float32)) AS v
+        UNION ALL
+        SELECT '1'::LowCardinality(Nullable(Float32)) AS v
+    )
+    ORDER BY v
+);
 
 -- Small integer types use their sign/unsigned 64 byte supertype
 SELECT toTypeName(sumCount(number::Int8)), sumCount(number::Int8) FROM numbers(120);
