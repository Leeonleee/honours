{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 51796,
  "instance_id": "ClickHouse__ClickHouse-51796",
  "issue_numbers": [
    "51782"
  ],
  "base_commit": "db1b17277021be053475c34c5e988aa156d837a1",
  "patch": "diff --git a/docs/en/sql-reference/statements/show.md b/docs/en/sql-reference/statements/show.md\nindex 336b93db9d50..1c399d2072b4 100644\n--- a/docs/en/sql-reference/statements/show.md\n+++ b/docs/en/sql-reference/statements/show.md\n@@ -205,7 +205,7 @@ The optional keyword `EXTENDED` currently has no effect, it only exists for MySQ\n \n The optional keyword `FULL` causes the output to include the collation, comment and privilege columns.\n \n-`SHOW COLUMNS` produces a result table with the following structure:\n+The statement produces a result table with the following structure:\n - field - The name of the column (String)\n - type - The column data type (String)\n - null - If the column data type is Nullable (UInt8)\n@@ -272,6 +272,10 @@ SHOW DICTIONARIES FROM db LIKE '%reg%' LIMIT 2\n \n Displays a list of primary and data skipping indexes of a table.\n \n+This statement mostly exists for compatibility with MySQL. System tables [system.tables](../../operations/system-tables/tables.md) (for\n+primary keys) and [system.data_skipping_indices](../../operations/system-tables/data_skipping_indices.md) (for data skipping indices)\n+provide equivalent information but in a fashion more native to ClickHouse.\n+\n ```sql\n SHOW [EXTENDED] {INDEX | INDEXES | INDICES | KEYS } {FROM | IN} <table> [{FROM | IN} <db>] [WHERE <expr>] [INTO OUTFILE <filename>] [FORMAT <format>]\n ```\n@@ -281,22 +285,22 @@ equivalent. If no database is specified, the query assumes the current database\n \n The optional keyword `EXTENDED` currently has no effect, it only exists for MySQL compatibility.\n \n-`SHOW INDEX` produces a result table with the following structure:\n-- table - The name of the table (String)\n-- non_unique - 0 if the index cannot contain duplicates, 1 otherwise (UInt8)\n-- key_name - The name of the index, `PRIMARY` if the index is a primary key index (String)\n-- seq_in_index - Currently unused\n-- column_name - Currently unused\n-- collation - The sorting of the column in the index, `A` if ascending, `D` if descending, `NULL` if unsorted (Nullable(String))\n-- cardinality - Currently unused\n-- sub_part - Currently unused\n-- packed - Currently unused\n+The statement produces a result table with the following structure:\n+- table - The name of the table. (String)\n+- non_unique - Always `1` as ClickHouse does not support uniqueness constraints. (UInt8)\n+- key_name - The name of the index, `PRIMARY` if the index is a primary key index. (String)\n+- seq_in_index - For a primary key index, the position of the column starting from `1`. For a data skipping index: always `1`. (UInt8)\n+- column_name - For a primary key index, the name of the column. For a data skipping index: `''` (empty string), see field \"expression\". (String)\n+- collation - The sorting of the column in the index: `A` if ascending, `D` if descending, `NULL` if unsorted. (Nullable(String))\n+- cardinality - An estimation of the index cardinality (number of unique values in the index). Currently always 0. (UInt64)\n+- sub_part - Always `NULL` because ClickHouse does not support index prefixes like MySQL. (Nullable(String))\n+- packed - Always `NULL` because ClickHouse does not support packed indexes (like MySQL). (Nullable(String))\n - null - Currently unused\n-- index_type - The index type, e.g. `primary`, `minmax`, `bloom_filter` etc. (String)\n-- comment - Currently unused\n-- index_comment - Currently unused\n-- visible - If the index is visible to the optimizer, always `YES` (String)\n-- expression - The index expression (String)\n+- index_type - The index type, e.g. `PRIMARY`, `MINMAX`, `BLOOM_FILTER` etc. (String)\n+- comment - Additional information about the index, currently always `''` (empty string). (String)\n+- index_comment - `''` (empty string) because indexes in ClickHouse cannot have a `COMMENT` field (like in MySQL). (String)\n+- visible - If the index is visible to the optimizer, always `YES`. (String)\n+- expression - For a data skipping index, the index expression. For a primary key index: `''` (empty string). (String)\n \n **Examples**\n \n@@ -310,11 +314,12 @@ Result:\n \n ``` text\n \u250c\u2500table\u2500\u252c\u2500non_unique\u2500\u252c\u2500key_name\u2500\u252c\u2500seq_in_index\u2500\u252c\u2500column_name\u2500\u252c\u2500collation\u2500\u252c\u2500cardinality\u2500\u252c\u2500sub_part\u2500\u252c\u2500packed\u2500\u252c\u2500null\u2500\u252c\u2500index_type\u2500\u2500\u2500\u252c\u2500comment\u2500\u252c\u2500index_comment\u2500\u252c\u2500visible\u2500\u252c\u2500expression\u2500\u2510\n-\u2502 tbl   \u2502          0 \u2502 blf_idx  \u2502 \u1d3a\u1d41\u1d38\u1d38         \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 bloom_filter \u2502 \u1d3a\u1d41\u1d38\u1d38    \u2502 \u1d3a\u1d41\u1d38\u1d38          \u2502 YES     \u2502 d, b       \u2502\n-\u2502 tbl   \u2502          0 \u2502 mm1_idx  \u2502 \u1d3a\u1d41\u1d38\u1d38         \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 minmax       \u2502 \u1d3a\u1d41\u1d38\u1d38    \u2502 \u1d3a\u1d41\u1d38\u1d38          \u2502 YES     \u2502 a, c, d    \u2502\n-\u2502 tbl   \u2502          0 \u2502 mm2_idx  \u2502 \u1d3a\u1d41\u1d38\u1d38         \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 minmax       \u2502 \u1d3a\u1d41\u1d38\u1d38    \u2502 \u1d3a\u1d41\u1d38\u1d38          \u2502 YES     \u2502 c, d, e    \u2502\n-\u2502 tbl   \u2502          0 \u2502 PRIMARY  \u2502 \u1d3a\u1d41\u1d38\u1d38         \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 A         \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 primary      \u2502 \u1d3a\u1d41\u1d38\u1d38    \u2502 \u1d3a\u1d41\u1d38\u1d38          \u2502 YES     \u2502 c, a       \u2502\n-\u2502 tbl   \u2502          0 \u2502 set_idx  \u2502 \u1d3a\u1d41\u1d38\u1d38         \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 \u1d3a\u1d41\u1d38\u1d38        \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 set          \u2502 \u1d3a\u1d41\u1d38\u1d38    \u2502 \u1d3a\u1d41\u1d38\u1d38          \u2502 YES     \u2502 e          \u2502\n+\u2502 tbl   \u2502          1 \u2502 blf_idx  \u2502 1            \u2502 1           \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 0           \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 BLOOM_FILTER \u2502         \u2502               \u2502 YES     \u2502 d, b       \u2502\n+\u2502 tbl   \u2502          1 \u2502 mm1_idx  \u2502 1            \u2502 1           \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 0           \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 MINMAX       \u2502         \u2502               \u2502 YES     \u2502 a, c, d    \u2502\n+\u2502 tbl   \u2502          1 \u2502 mm2_idx  \u2502 1            \u2502 1           \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 0           \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 MINMAX       \u2502         \u2502               \u2502 YES     \u2502 c, d, e    \u2502\n+\u2502 tbl   \u2502          1 \u2502 PRIMARY  \u2502 1            \u2502 c           \u2502 A         \u2502 0           \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 PRIMARY      \u2502         \u2502               \u2502 YES     \u2502            \u2502\n+\u2502 tbl   \u2502          1 \u2502 PRIMARY  \u2502 2            \u2502 a           \u2502 A         \u2502 0           \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 PRIMARY      \u2502         \u2502               \u2502 YES     \u2502            \u2502\n+\u2502 tbl   \u2502          1 \u2502 set_idx  \u2502 1            \u2502 1           \u2502 \u1d3a\u1d41\u1d38\u1d38      \u2502 0           \u2502 \u1d3a\u1d41\u1d38\u1d38     \u2502 \u1d3a\u1d41\u1d38\u1d38   \u2502 \u1d3a\u1d41\u1d38\u1d38 \u2502 SET          \u2502         \u2502               \u2502 YES     \u2502 e          \u2502\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n ```\n \ndiff --git a/src/Interpreters/InterpreterShowIndexesQuery.cpp b/src/Interpreters/InterpreterShowIndexesQuery.cpp\nindex 51311c82eebc..149420006fb7 100644\n--- a/src/Interpreters/InterpreterShowIndexesQuery.cpp\n+++ b/src/Interpreters/InterpreterShowIndexesQuery.cpp\n@@ -40,20 +40,20 @@ SELECT *\n FROM (\n         (SELECT\n             name AS table,\n-            0 AS non_unique,\n+            1 AS non_unique,\n             'PRIMARY' AS key_name,\n-            NULL AS seq_in_index,\n-            NULL AS column_name,\n+            row_number() over (order by column_name) AS seq_in_index,\n+            arrayJoin(splitByString(', ', primary_key)) AS column_name,\n             'A' AS collation,\n-            NULL AS cardinality,\n+            0 AS cardinality,\n             NULL AS sub_part,\n             NULL AS packed,\n             NULL AS null,\n-            'primary' AS index_type,\n-            NULL AS comment,\n-            NULL AS index_comment,\n+            'PRIMARY' AS index_type,\n+            '' AS comment,\n+            '' AS index_comment,\n             'YES' AS visible,\n-            primary_key AS expression\n+            '' AS expression\n         FROM system.tables\n         WHERE\n             database = '{0}'\n@@ -61,18 +61,18 @@ FROM (\n     UNION ALL (\n         SELECT\n             table AS table,\n-            0 AS non_unique,\n+            1 AS non_unique,\n             name AS key_name,\n-            NULL AS seq_in_index,\n-            NULL AS column_name,\n+            1 AS seq_in_index,\n+            '' AS column_name,\n             NULL AS collation,\n-            NULL AS cardinality,\n+            0 AS cardinality,\n             NULL AS sub_part,\n             NULL AS packed,\n             NULL AS null,\n-            type AS index_type,\n-            NULL AS comment,\n-            NULL AS index_comment,\n+            upper(type) AS index_type,\n+            '' AS comment,\n+            '' AS index_comment,\n             'YES' AS visible,\n             expr AS expression\n         FROM system.data_skipping_indices\n@@ -80,12 +80,27 @@ FROM (\n             database = '{0}'\n             AND table = '{1}'))\n {2}\n-ORDER BY index_type, expression;)\", database, table, where_expression);\n+ORDER BY index_type, expression, column_name, seq_in_index;)\", database, table, where_expression);\n \n     /// Sorting is strictly speaking not necessary but 1. it is convenient for users, 2. SQL currently does not allow to\n     /// sort the output of SHOW INDEXES otherwise (SELECT * FROM (SHOW INDEXES ...) ORDER BY ...) is rejected) and 3. some\n     /// SQL tests can take advantage of this.\n \n+    /// Note about compatibility of fields 'column_name', 'seq_in_index' and 'expression' with MySQL:\n+    /// MySQL has non-functional and functional indexes.\n+    /// - Non-functional indexes only reference columns, e.g. 'col1, col2'. In this case, `SHOW INDEX` produces as many result rows as there\n+    ///   are indexed columns. 'column_name' and 'seq_in_index' (an ascending integer 1, 2, ...) are filled, 'expression' is empty.\n+    /// - Functional indexes can reference arbitrary expressions, e.g. 'col1 + 1, concat(col2, col3)'. 'SHOW INDEX' produces a single row\n+    ///   with `column_name` and `seq_in_index` empty and `expression` filled with the entire index expression. Only non-primary-key indexes\n+    ///   can be functional indexes.\n+    /// Above SELECT tries to emulate that. Caveats:\n+    /// 1. The primary key index sub-SELECT assumes the primary key expression is non-functional. Non-functional primary key indexes in\n+    ///    ClickHouse are possible but quiete obscure. In MySQL they are not possible at all.\n+    /// 2. Related to 1.: Poor man's tuple parsing with splitByString() in the PK sub-SELECT messes up for functional primary key index\n+    ///    expressions where the comma is not only used as separator between tuple components, e.g. in 'col1 + 1, concat(col2, col3)'.\n+    /// 3. The data skipping index sub-SELECT assumes the index expression is functional. 3rd party tools that expect MySQL semantics from\n+    ///    SHOW INDEX will probably not care as MySQL has no skipping indexes and they only use the result to figure out the primary key.\n+\n     return rewritten_query;\n }\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02724_show_indexes.reference b/tests/queries/0_stateless/02724_show_indexes.reference\nindex 8365ade32314..e41f2521f5c8 100644\n--- a/tests/queries/0_stateless/02724_show_indexes.reference\n+++ b/tests/queries/0_stateless/02724_show_indexes.reference\n@@ -1,47 +1,51 @@\n --- Aliases of SHOW INDEX\n-tbl\t0\tblf_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tbloom_filter\t\\N\t\\N\tYES\td, b\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc, a\n-tbl\t0\tset_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tset\t\\N\t\\N\tYES\te\n-tbl\t0\tblf_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tbloom_filter\t\\N\t\\N\tYES\td, b\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc, a\n-tbl\t0\tset_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tset\t\\N\t\\N\tYES\te\n-tbl\t0\tblf_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tbloom_filter\t\\N\t\\N\tYES\td, b\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc, a\n-tbl\t0\tset_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tset\t\\N\t\\N\tYES\te\n-tbl\t0\tblf_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tbloom_filter\t\\N\t\\N\tYES\td, b\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc, a\n-tbl\t0\tset_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tset\t\\N\t\\N\tYES\te\n+tbl\t1\tblf_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tBLOOM_FILTER\t\t\tYES\td, b\n+tbl\t1\tmm1_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\ta, c, d\n+tbl\t1\tmm2_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tc, d, e\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tPRIMARY\t2\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tset_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tSET\t\t\tYES\te\n+tbl\t1\tblf_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tBLOOM_FILTER\t\t\tYES\td, b\n+tbl\t1\tmm1_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\ta, c, d\n+tbl\t1\tmm2_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tc, d, e\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tPRIMARY\t2\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tset_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tSET\t\t\tYES\te\n+tbl\t1\tblf_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tBLOOM_FILTER\t\t\tYES\td, b\n+tbl\t1\tmm1_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\ta, c, d\n+tbl\t1\tmm2_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tc, d, e\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tPRIMARY\t2\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tset_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tSET\t\t\tYES\te\n+tbl\t1\tblf_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tBLOOM_FILTER\t\t\tYES\td, b\n+tbl\t1\tmm1_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\ta, c, d\n+tbl\t1\tmm2_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tc, d, e\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tPRIMARY\t2\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tset_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tSET\t\t\tYES\te\n --- EXTENDED\n-tbl\t0\tblf_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tbloom_filter\t\\N\t\\N\tYES\td, b\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc, a\n-tbl\t0\tset_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tset\t\\N\t\\N\tYES\te\n+tbl\t1\tblf_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tBLOOM_FILTER\t\t\tYES\td, b\n+tbl\t1\tmm1_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\ta, c, d\n+tbl\t1\tmm2_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tc, d, e\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tPRIMARY\t2\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tset_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tSET\t\t\tYES\te\n --- WHERE\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n --- Check with weird table names\n-$4@^7\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc\n-NULL\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc\n-\\'\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc\n-\\'\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc\n+$4@^7\t1\tPRIMARY\t1\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+NULL\t1\tPRIMARY\t1\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+\\'\t1\tPRIMARY\t1\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+\\'\t1\tPRIMARY\t1\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n --- Original table\n-tbl\t0\tblf_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tbloom_filter\t\\N\t\\N\tYES\td, b\n-tbl\t0\tmm1_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\ta, c, d\n-tbl\t0\tmm2_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tc, d, e\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\tc, a\n-tbl\t0\tset_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tset\t\\N\t\\N\tYES\te\n+tbl\t1\tblf_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tBLOOM_FILTER\t\t\tYES\td, b\n+tbl\t1\tmm1_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\ta, c, d\n+tbl\t1\tmm2_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tc, d, e\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tPRIMARY\t2\tc\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n+tbl\t1\tset_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tSET\t\t\tYES\te\n --- Equally named table in other database\n-tbl\t0\tmmi_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tb\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\ta\n+tbl\t1\tmmi_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tb\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n --- Short form\n-tbl\t0\tmmi_idx\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\t\\N\tminmax\t\\N\t\\N\tYES\tb\n-tbl\t0\tPRIMARY\t\\N\t\\N\tA\t\\N\t\\N\t\\N\t\\N\tprimary\t\\N\t\\N\tYES\ta\n+tbl\t1\tmmi_idx\t1\t\t\\N\t0\t\\N\t\\N\t\\N\tMINMAX\t\t\tYES\tb\n+tbl\t1\tPRIMARY\t1\ta\tA\t0\t\\N\t\\N\t\\N\tPRIMARY\t\t\tYES\t\n",
  "problem_statement": "MySQL compatibility: SHOW KEYS output\n**Describe the unexpected behaviour**\r\n\r\nBI tools such as QuickSight use `SHOW KEYS` queries to determine the primary keys of the dataset.\r\nThe output of the `SHOW KEYS` command is different from a real MySQL server.\r\n\r\n\"Real\" MySQL:\r\n\r\n```\r\nmysql> SHOW KEYS FROM `cell_towers` FROM `mysql`;\r\n+-------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\r\n| Table       | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |\r\n+-------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\r\n| cell_towers |          0 | PRIMARY  |            1 | radio       | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |\r\n| cell_towers |          0 | PRIMARY  |            2 | mcc         | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |\r\n| cell_towers |          0 | PRIMARY  |            3 | net         | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |\r\n| cell_towers |          0 | PRIMARY  |            4 | created     | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |\r\n+-------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\r\n```\r\n\r\nClickHouse via MySQL interface:\r\n\r\n```\r\nmysql> SHOW KEYS FROM `cell_towers` FROM `default`;\r\n+-------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+--------------------------+\r\n| table       | non_unique | key_name | seq_in_index | column_name | collation | cardinality | sub_part | packed | null | index_type | comment | index_comment | visible | expression               |\r\n+-------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+--------------------------+\r\n| cell_towers |          0 | PRIMARY  | NULL         | NULL        | A         | NULL        | NULL     | NULL   | NULL | primary    | NULL    | NULL          | YES     | radio, mcc, net, created |\r\n+-------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+--------------------------+\r\n```\r\n\r\n**How to reproduce**\r\n* Which ClickHouse server version to use: 23.6\r\n* Which interface to use, if it matters: MySQL\r\n* Non-default settings, if any: I added `use_mysql_types_in_show_columns` to the default profile.\r\n\r\n```xml\r\n  <profiles>\r\n    <default>\r\n      <load_balancing>random</load_balancing>\r\n      <use_mysql_types_in_show_columns>1</use_mysql_types_in_show_columns>\r\n    </default>\r\n  </profiles>\r\n```\r\n\r\n* `CREATE TABLE` statements for all tables involved: [cell towers dataset](https://clickhouse.com/docs/en/getting-started/example-datasets/cell-towers) for ClickHouse, and a simple table like\r\n```\r\ncreate table cell_towers (radio TEXT, mcc INTEGER, net INTEGER, created DATETIME, PRIMARY KEY (radio, mcc, net, created));\r\n```\r\nfor MySQL\r\n\r\n* Queries to run that lead to unexpected result\r\n\r\n```\r\nSHOW KEYS FROM `cell_towers` FROM `default`;\r\n```\r\n\r\n**Expected behavior**\r\n* The primary key is reported as a single row, whereas a composite key in MySQL is reported as 1 row per column\r\n* There are NULLs in the output instead of numbers and/or empty strings in a real MySQL, and that supposedly causes QuickSight errors.\r\n\r\nCC @tpanetti \n",
  "hints_text": "",
  "created_at": "2023-07-04T16:13:25Z",
  "modified_files": [
    "docs/en/sql-reference/statements/show.md",
    "src/Interpreters/InterpreterShowIndexesQuery.cpp"
  ],
  "modified_test_files": [
    "tests/queries/0_stateless/02724_show_indexes.reference"
  ]
}