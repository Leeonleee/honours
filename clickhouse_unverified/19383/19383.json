{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 19383,
  "instance_id": "ClickHouse__ClickHouse-19383",
  "issue_numbers": [
    "19219"
  ],
  "base_commit": "dca0cbf4ebf7bb7a6a480c487c00aa4a8317a89e",
  "patch": "diff --git a/.gitmodules b/.gitmodules\nindex c7ff7cea7db9..ecccf0633e22 100644\n--- a/.gitmodules\n+++ b/.gitmodules\n@@ -84,7 +84,7 @@\n \turl = https://github.com/google/brotli.git\n [submodule \"contrib/h3\"]\n \tpath = contrib/h3\n-\turl = https://github.com/uber/h3\n+\turl = https://github.com/ClickHouse-Extras/h3\n [submodule \"contrib/hyperscan\"]\n \tpath = contrib/hyperscan\n \turl = https://github.com/ClickHouse-Extras/hyperscan.git\ndiff --git a/contrib/h3 b/contrib/h3\nindex 6cfd649e8c0d..e209086ae1b5 160000\n--- a/contrib/h3\n+++ b/contrib/h3\n@@ -1,1 +1,1 @@\n-Subproject commit 6cfd649e8c0d3ed913e8aae928a669fc3b8a2365\n+Subproject commit e209086ae1b5477307f545a0f6111780edc59940\ndiff --git a/contrib/h3-cmake/CMakeLists.txt b/contrib/h3-cmake/CMakeLists.txt\nindex 80e76311f704..2911d7283f02 100644\n--- a/contrib/h3-cmake/CMakeLists.txt\n+++ b/contrib/h3-cmake/CMakeLists.txt\n@@ -16,6 +16,7 @@ ${H3_SOURCE_DIR}/lib/mathExtensions.c\n ${H3_SOURCE_DIR}/lib/polygon.c\n ${H3_SOURCE_DIR}/lib/vec2d.c\n ${H3_SOURCE_DIR}/lib/vec3d.c\n+${H3_SOURCE_DIR}/lib/vertex.c\n ${H3_SOURCE_DIR}/lib/vertexGraph.c\n )\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01659_h3_buffer_overflow.reference b/tests/queries/0_stateless/01659_h3_buffer_overflow.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/01659_h3_buffer_overflow.sql b/tests/queries/0_stateless/01659_h3_buffer_overflow.sql\nnew file mode 100644\nindex 000000000000..b752059da48a\n--- /dev/null\n+++ b/tests/queries/0_stateless/01659_h3_buffer_overflow.sql\n@@ -0,0 +1,9 @@\n+-- the behaviour on overflow can be implementation specific\n+-- and we don't care about the results, but no buffer overflow should be possible.\n+SELECT length(h3kRing(9223372036854775807, 1000)) FORMAT Null;\n+SELECT h3kRing(toUInt64(0xFFFFFFFF), 1000) FORMAT Null;\n+SELECT h3kRing(0xFFFFFFFFF, 1000) FORMAT Null;\n+SELECT h3kRing(0xFFFFFFFFFFFFFF, 1000) FORMAT Null;\n+SELECT h3GetBaseCell(0xFFFFFFFFFFFFFF) FORMAT Null;\n+SELECT h3GetResolution(0xFFFFFFFFFFFFFF) FORMAT Null;\n+SELECT h3kRing(0xFFFFFFFFFFFFFF, 10) FORMAT Null;\ndiff --git a/tests/queries/0_stateless/arcadia_skip_list.txt b/tests/queries/0_stateless/arcadia_skip_list.txt\nindex 6315fa4b1269..8df25c9dccf3 100644\n--- a/tests/queries/0_stateless/arcadia_skip_list.txt\n+++ b/tests/queries/0_stateless/arcadia_skip_list.txt\n@@ -25,6 +25,7 @@\n 00877_memory_limit_for_new_delete\n 00921_datetime64_basic\n 00926_geo_to_h3\n+01659_h3_buffer_overflow\n 00926_multimatch\n 00929_multi_match_edit_distance\n 00952_insert_into_distributed_with_materialized_column\n",
  "problem_statement": "Buffer overflow is possible in \"h3\" library\n**Describe the bug**\r\n`SELECT length(h3kRing(9223372036854775807, 1000))`\r\n\r\nhttps://clickhouse-test-reports.s3.yandex.net/19214/98a8a20b7066852ff559bd9eb660cc0d03abbe5e/fuzzer/server.log\n",
  "hints_text": "Reference: https://github.com/uber/h3/issues/392",
  "created_at": "2021-01-21T18:46:43Z"
}