You will be provided with a partial code base and an issue statement explaining a problem to resolve.

<issue>
Logical error: Invalid number of rows in Chunk
https://s3.amazonaws.com/clickhouse-test-reports/0/4dc5a629c349dd88cd7728621223a62e9ed87a4a/fuzzer_astfuzzerdebug/report.html

```
dell9510 :) set group_by_use_nulls=1

SET group_by_use_nulls = 1

Query id: 2069b36a-fe74-48ff-a0ed-934b6a6dd57e

Ok.

0 rows in set. Elapsed: 0.003 sec. 

dell9510 :) SELECT count([NULL, NULL]), count([2147483646, -2147483647, 3, 3]), uniqExact(if(number >= 1048577, number, NULL), NULL) FROM numbers(1048577) GROUP BY if(number >= 2., number, NULL) format Null

SELECT
    count([NULL, NULL]),
    count([2147483646, -2147483647, 3, 3]),
    uniqExact(if(number >= 1048577, number, NULL), NULL)
FROM numbers(1048577)
GROUP BY if(number >= 2., number, NULL)
FORMAT `Null`

Query id: 749df7d1-2e9a-4ea8-a92b-295464433591

[dell9510] 2023.03.22 14:23:52.856923 [ 246980 ] {749df7d1-2e9a-4ea8-a92b-295464433591} <Fatal> : Logical error: 'Invalid number of rows in Chunk column UInt64 position 1: expected 65409, got 65410'.
[dell9510] 2023.03.22 14:23:52.858093 [ 246986 ] <Fatal> BaseDaemon: ########################################
[dell9510] 2023.03.22 14:23:52.858298 [ 246986 ] <Fatal> BaseDaemon: (version 23.3.1.2537, build id: 3018790D95A6AA08FB81899667D886CA8AA05445) (from thread 246980) (query_id: 749df7d1-2e9a-4ea8-a92b-295464433591) (query: SELECT count([NULL, NULL]), count([2147483646, -2147483647, 3, 3]), uniqExact(if(number >= 1048577, number, NULL), NULL) FROM numbers(1048577) GROUP BY if(number >= 2., number, NULL) format Null) Received signal Aborted (6)
[dell9510] 2023.03.22 14:23:52.858458 [ 246986 ] <Fatal> BaseDaemon: 
[dell9510] 2023.03.22 14:23:52.858626 [ 246986 ] <Fatal> BaseDaemon: Stack trace: 0x7efdba5928ec 0x7efdba543ea8 0x7efdba52d53d 0x22f756c3 0x22f75735 0x22f75b6c 0x19934d57 0x1a239a6e 0x2dda5f88 0x2dda5d5f 0x2e23e081 0x2e24d8b7 0x2e2498af 0x2ddfe250 0x2ddfdf40 0x2ddd967e 0x2ddd9a04 0x2dddb267 0x2dddb1b5 0x2dddb199 0x2dddb0fd 0x2dddaff0 0x2dddaf35 0x2dddaf15 0x2dddaef5 0x2dddaec0 0x22fcdcd6 0x22fcd115 0x230d23dc 0x230d9bd1 0x230d9b75 0x230d9a9d 0x230d954f 0x7efdba590bb5 0x7efdba612d90
[dell9510] 2023.03.22 14:23:52.858820 [ 246986 ] <Fatal> BaseDaemon: 4. ? @ 0x7efdba5928ec in ?
[dell9510] 2023.03.22 14:23:52.858944 [ 246986 ] <Fatal> BaseDaemon: 5. gsignal @ 0x7efdba543ea8 in ?
[dell9510] 2023.03.22 14:23:52.859086 [ 246986 ] <Fatal> BaseDaemon: 6. abort @ 0x7efdba52d53d in ?
[dell9510] 2023.03.22 14:23:52.925055 [ 246986 ] <Fatal> BaseDaemon: 7. /home/tavplubix/ch/ClickHouse/src/Common/Exception.cpp:41: DB::abortOnFailedAssertion(String const&) @ 0x22f756c3 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:52.989157 [ 246986 ] <Fatal> BaseDaemon: 8. /home/tavplubix/ch/ClickHouse/src/Common/Exception.cpp:64: DB::handle_error_code(String const&, int, bool, std::vector<void*, std::allocator<void*>> const&) @ 0x22f75735 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.047296 [ 246986 ] <Fatal> BaseDaemon: 9. /home/tavplubix/ch/ClickHouse/src/Common/Exception.cpp:92: DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x22f75b6c in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.113924 [ 246986 ] <Fatal> BaseDaemon: 10. /home/tavplubix/ch/ClickHouse/src/Common/Exception.h:55: DB::Exception::Exception(String&&, int, bool) @ 0x19934d57 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.259355 [ 246986 ] <Fatal> BaseDaemon: 11. /home/tavplubix/ch/ClickHouse/src/Common/Exception.h:82: DB::Exception::Exception<String, String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&, String&&) @ 0x1a239a6e in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.308614 [ 246986 ] <Fatal> BaseDaemon: 12. /home/tavplubix/ch/ClickHouse/src/Processors/Chunk.cpp:73: DB::Chunk::checkNumRowsIsConsistent() @ 0x2dda5f88 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.344894 [ 246986 ] <Fatal> BaseDaemon: 13. /home/tavplubix/ch/ClickHouse/src/Processors/Chunk.cpp:17: DB::Chunk::Chunk(std::vector<COW<DB::IColumn>::immutable_ptr<DB::IColumn>, std::allocator<COW<DB::IColumn>::immutable_ptr<DB::IColumn>>>, unsigned long) @ 0x2dda5d5f in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.574894 [ 246986 ] <Fatal> BaseDaemon: 14. /home/tavplubix/ch/ClickHouse/src/Processors/Transforms/AggregatingTransform.cpp:33: DB::convertToChunk(DB::Block const&) @ 0x2e23e081 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.747205 [ 246986 ] <Fatal> BaseDaemon: 15. /home/tavplubix/ch/ClickHouse/src/Processors/Transforms/AggregatingTransform.cpp:487: DB::ConvertingAggregatedToChunksTransform::mergeSingleLevel() @ 0x2e24d8b7 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.917161 [ 246986 ] <Fatal> BaseDaemon: 16. /home/tavplubix/ch/ClickHouse/src/Processors/Transforms/AggregatingTransform.cpp:307: DB::ConvertingAggregatedToChunksTransform::work() @ 0x2e2498af in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.946018 [ 246986 ] <Fatal> BaseDaemon: 17. /home/tavplubix/ch/ClickHouse/src/Processors/Executors/ExecutionThreadContext.cpp:47: DB::executeJob(DB::ExecutingGraph::Node*, DB::ReadProgressCallback*) @ 0x2ddfe250 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:53.969305 [ 246986 ] <Fatal> BaseDaemon: 18. /home/tavplubix/ch/ClickHouse/src/Processors/Executors/ExecutionThreadContext.cpp:92: DB::ExecutionThreadContext::executeTask() @ 0x2ddfdf40 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.056526 [ 246986 ] <Fatal> BaseDaemon: 19. /home/tavplubix/ch/ClickHouse/src/Processors/Executors/PipelineExecutor.cpp:229: DB::PipelineExecutor::executeStepImpl(unsigned long, std::atomic<bool>*) @ 0x2ddd967e in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.131419 [ 246986 ] <Fatal> BaseDaemon: 20. /home/tavplubix/ch/ClickHouse/src/Processors/Executors/PipelineExecutor.cpp:195: DB::PipelineExecutor::executeSingleThread(unsigned long) @ 0x2ddd9a04 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.200003 [ 246986 ] <Fatal> BaseDaemon: 21. /home/tavplubix/ch/ClickHouse/src/Processors/Executors/PipelineExecutor.cpp:320: DB::PipelineExecutor::spawnThreads()::$_0::operator()() const @ 0x2dddb267 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.288523 [ 246986 ] <Fatal> BaseDaemon: 22. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/invoke.h:394: decltype(std::declval<DB::PipelineExecutor::spawnThreads()::$_0&>()()) std::__invoke[abi:v15000]<DB::PipelineExecutor::spawnThreads()::$_0&>(DB::PipelineExecutor::spawnThreads()::$_0&) @ 0x2dddb1b5 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.378734 [ 246986 ] <Fatal> BaseDaemon: 23. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/tuple:1789: decltype(auto) std::__apply_tuple_impl[abi:v15000]<DB::PipelineExecutor::spawnThreads()::$_0&, std::tuple<>&>(DB::PipelineExecutor::spawnThreads()::$_0&, std::tuple<>&, std::__tuple_indices<>) @ 0x2dddb199 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.473525 [ 246986 ] <Fatal> BaseDaemon: 24. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/tuple:1798: decltype(auto) std::apply[abi:v15000]<DB::PipelineExecutor::spawnThreads()::$_0&, std::tuple<>&>(DB::PipelineExecutor::spawnThreads()::$_0&, std::tuple<>&) @ 0x2dddb0fd in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.547306 [ 246986 ] <Fatal> BaseDaemon: 25. /home/tavplubix/ch/ClickHouse/src/Common/ThreadPool.h:210: ThreadFromGlobalPoolImpl<true>::ThreadFromGlobalPoolImpl<DB::PipelineExecutor::spawnThreads()::$_0>(DB::PipelineExecutor::spawnThreads()::$_0&&)::'lambda'()::operator()() @ 0x2dddaff0 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.654999 [ 246986 ] <Fatal> BaseDaemon: 26. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/invoke.h:394: decltype(std::declval<DB::PipelineExecutor::spawnThreads()::$_0>()()) std::__invoke[abi:v15000]<ThreadFromGlobalPoolImpl<true>::ThreadFromGlobalPoolImpl<DB::PipelineExecutor::spawnThreads()::$_0>(DB::PipelineExecutor::spawnThreads()::$_0&&)::'lambda'()&>(DB::PipelineExecutor::spawnThreads()::$_0&&) @ 0x2dddaf35 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.754550 [ 246986 ] <Fatal> BaseDaemon: 27. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/invoke.h:480: void std::__invoke_void_return_wrapper<void, true>::__call<ThreadFromGlobalPoolImpl<true>::ThreadFromGlobalPoolImpl<DB::PipelineExecutor::spawnThreads()::$_0>(DB::PipelineExecutor::spawnThreads()::$_0&&)::'lambda'()&>(ThreadFromGlobalPoolImpl<true>::ThreadFromGlobalPoolImpl<DB::PipelineExecutor::spawnThreads()::$_0>(DB::PipelineExecutor::spawnThreads()::$_0&&)::'lambda'()&) @ 0x2dddaf15 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.851812 [ 246986 ] <Fatal> BaseDaemon: 28. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/function.h:235: std::__function::__default_alloc_func<ThreadFromGlobalPoolImpl<true>::ThreadFromGlobalPoolImpl<DB::PipelineExecutor::spawnThreads()::$_0>(DB::PipelineExecutor::spawnThreads()::$_0&&)::'lambda'(), void ()>::operator()[abi:v15000]() @ 0x2dddaef5 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.948638 [ 246986 ] <Fatal> BaseDaemon: 29. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/function.h:716: void std::__function::__policy_invoker<void ()>::__call_impl<std::__function::__default_alloc_func<ThreadFromGlobalPoolImpl<true>::ThreadFromGlobalPoolImpl<DB::PipelineExecutor::spawnThreads()::$_0>(DB::PipelineExecutor::spawnThreads()::$_0&&)::'lambda'(), void ()>>(std::__function::__policy_storage const*) @ 0x2dddaec0 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:54.992659 [ 246986 ] <Fatal> BaseDaemon: 30. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/function.h:848: std::__function::__policy_func<void ()>::operator()[abi:v15000]() const @ 0x22fcdcd6 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.035135 [ 246986 ] <Fatal> BaseDaemon: 31. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/function.h:1187: std::function<void ()>::operator()() const @ 0x22fcd115 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.088978 [ 246986 ] <Fatal> BaseDaemon: 32. /home/tavplubix/ch/ClickHouse/src/Common/ThreadPool.cpp:315: ThreadPoolImpl<std::thread>::worker(std::__list_iterator<std::thread, void*>) @ 0x230d23dc in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.152437 [ 246986 ] <Fatal> BaseDaemon: 33. /home/tavplubix/ch/ClickHouse/src/Common/ThreadPool.cpp:145: void ThreadPoolImpl<std::thread>::scheduleImpl<void>(std::function<void ()>, long, std::optional<unsigned long>, bool)::'lambda0'()::operator()() const @ 0x230d9bd1 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.217272 [ 246986 ] <Fatal> BaseDaemon: 34. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/__functional/invoke.h:394: decltype(std::declval<void>()()) std::__invoke[abi:v15000]<void ThreadPoolImpl<std::thread>::scheduleImpl<void>(std::function<void ()>, long, std::optional<unsigned long>, bool)::'lambda0'()>(void&&) @ 0x230d9b75 in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.280495 [ 246986 ] <Fatal> BaseDaemon: 35. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/thread:285: void std::__thread_execute[abi:v15000]<std::unique_ptr<std::__thread_struct, std::default_delete<std::__thread_struct>>, void ThreadPoolImpl<std::thread>::scheduleImpl<void>(std::function<void ()>, long, std::optional<unsigned long>, bool)::'lambda0'()>(std::tuple<void, void ThreadPoolImpl<std::thread>::scheduleImpl<void>(std::function<void ()>, long, std::optional<unsigned long>, bool)::'lambda0'()>&, std::__tuple_indices<>) @ 0x230d9a9d in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.344584 [ 246986 ] <Fatal> BaseDaemon: 36. /home/tavplubix/ch/ClickHouse/contrib/llvm-project/libcxx/include/thread:295: void* std::__thread_proxy[abi:v15000]<std::tuple<std::unique_ptr<std::__thread_struct, std::default_delete<std::__thread_struct>>, void ThreadPoolImpl<std::thread>::scheduleImpl<void>(std::function<void ()>, long, std::optional<unsigned long>, bool)::'lambda0'()>>(void*) @ 0x230d954f in /home/tavplubix/ch/ClickHouse/cmake-build-debug/programs/clickhouse
[dell9510] 2023.03.22 14:23:55.344808 [ 246986 ] <Fatal> BaseDaemon: 37. ? @ 0x7efdba590bb5 in ?
[dell9510] 2023.03.22 14:23:55.344941 [ 246986 ] <Fatal> BaseDaemon: 38. ? @ 0x7efdba612d90 in ?
[dell9510] 2023.03.22 14:23:55.345093 [ 246986 ] <Fatal> BaseDaemon: Integrity check of the executable skipped because the reference checksum could not be read.
â†’ Progress: 1.11 million rows, 8.90 MB (203.62 thousand rows/s., 1.63 MB/s.)  99%Exception on client:
Code: 32. DB::Exception: Attempt to read after eof: while receiving packet from localhost:9000. (ATTEMPT_TO_READ_AFTER_EOF)

```
</issue>

I need you to solve the provided issue by generating a code fix that can be applied directly to the repository

Respond below:
