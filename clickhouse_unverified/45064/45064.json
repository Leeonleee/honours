{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 45064,
  "instance_id": "ClickHouse__ClickHouse-45064",
  "issue_numbers": [
    "44528"
  ],
  "base_commit": "b22b51213fa785e94d3f076734e23b1a5b126e05",
  "patch": "diff --git a/src/Analyzer/Passes/QueryAnalysisPass.cpp b/src/Analyzer/Passes/QueryAnalysisPass.cpp\nindex e93548d34ede..71041f88152d 100644\n--- a/src/Analyzer/Passes/QueryAnalysisPass.cpp\n+++ b/src/Analyzer/Passes/QueryAnalysisPass.cpp\n@@ -4155,10 +4155,7 @@ ProjectionNames QueryAnalyzer::resolveFunction(QueryTreeNodePtr & node, Identifi\n             argument_column.type = std::make_shared<DataTypeFunction>(DataTypes(lambda_arguments_size, nullptr), nullptr);\n             function_lambda_arguments_indexes.push_back(function_argument_index);\n         }\n-        else if (is_special_function_in &&\n-            (function_argument->getNodeType() == QueryTreeNodeType::TABLE ||\n-            function_argument->getNodeType() == QueryTreeNodeType::QUERY ||\n-            function_argument->getNodeType() == QueryTreeNodeType::UNION))\n+        else if (is_special_function_in && function_argument_index == 1)\n         {\n             argument_column.type = std::make_shared<DataTypeSet>();\n         }\n@@ -4534,16 +4531,15 @@ ProjectionNames QueryAnalyzer::resolveFunction(QueryTreeNodePtr & node, Identifi\n             auto column_set = ColumnSet::create(1, std::move(set));\n             argument_columns[1].column = ColumnConst::create(std::move(column_set), 1);\n         }\n+\n+        argument_columns[1].type = std::make_shared<DataTypeSet>();\n     }\n \n     std::shared_ptr<ConstantValue> constant_value;\n \n-    DataTypePtr result_type;\n-\n     try\n     {\n         auto function_base = function->build(argument_columns);\n-        result_type = function_base->getResultType();\n \n         /** If function is suitable for constant folding try to convert it to constant.\n           * Example: SELECT plus(1, 1);\n@@ -4551,6 +4547,7 @@ ProjectionNames QueryAnalyzer::resolveFunction(QueryTreeNodePtr & node, Identifi\n           */\n         if (function_base->isSuitableForConstantFolding())\n         {\n+            auto result_type = function_base->getResultType();\n             auto executable_function = function_base->prepare(argument_columns);\n \n             ColumnPtr column;\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.reference b/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.reference\nnew file mode 100644\nindex 000000000000..aa47d0d46d47\n--- /dev/null\n+++ b/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.reference\n@@ -0,0 +1,2 @@\n+0\n+0\ndiff --git a/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.sql b/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.sql\nnew file mode 100644\nindex 000000000000..95b896d38aba\n--- /dev/null\n+++ b/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.sql\n@@ -0,0 +1,14 @@\n+SET allow_experimental_analyzer = 1;\n+\n+DROP TABLE IF EXISTS test_table;\n+CREATE TABLE test_table\n+(\n+    id UInt8,\n+    value Nullable(Decimal(38, 2))\n+) ENGINE = MergeTree ORDER BY id;\n+\n+INSERT INTO test_table VALUES (1, '22.5'), (2, Null);\n+\n+SELECT id IN toDecimal64(257, NULL) FROM test_table;\n+\n+DROP TABLE test_table;\n",
  "problem_statement": "NativeWriter/SerializationNullable: downcast of address which does not point to an object of type ColumnNullable\nhttps://s3.amazonaws.com/clickhouse-test-reports/44466/45f9fa48c80a54da54323a6bf00e65160fd3e360/fuzzer_astfuzzerubsan//report.html\r\n```\r\n../src/Common/assert_cast.h:50:12: runtime error: downcast of address 0x7f45d40aed70 which does not point to an object of type 'const DB::ColumnNullable'\r\n0x7f45d40aed70: note: object is of type 'DB::ColumnVector<char8_t>'\r\n 00 00 00 00  20 4c 2a 11 00 00 00 00  03 00 00 00 00 00 00 00  c0 04 06 c0 45 7f 00 00  c3 04 06 c0\r\n              ^~~~~~~~~~~~~~~~~~~~~~~\r\n              vptr for 'DB::ColumnVector<char8_t>'\r\n    #0 0x2c387ab7 in DB::ColumnNullable const& assert_cast<DB::ColumnNullable const&, DB::IColumn const&>(DB::IColumn const&) build_docker/../src/Common/assert_cast.h:50:12\r\n    #1 0x2c387ab7 in DB::SerializationNullable::serializeBinaryBulkStatePrefix(DB::IColumn const&, DB::ISerialization::SerializeBinaryBulkSettings&, std::__1::shared_ptr<DB::ISerialization::SerializeBinaryBulkState>&) const build_docker/../src/DataTypes/Serializations/SerializationNullable.cpp:78:36\r\n    #2 0x2ebfa5e8 in DB::writeData(DB::ISerialization const&, COW<DB::IColumn>::immutable_ptr<DB::IColumn> const&, DB::WriteBuffer&, unsigned long, unsigned long) build_docker/../src/Formats/NativeWriter.cpp:61:19\r\n    #3 0x2ebfa5e8 in DB::NativeWriter::write(DB::Block const&) build_docker/../src/Formats/NativeWriter.cpp:151:13\r\n    #4 0x2ebb5df4 in DB::TCPHandler::sendData(DB::Block const&) build_docker/../src/Server/TCPHandler.cpp:1796:26\r\n    #5 0x2ebb1fa9 in DB::TCPHandler::processOrdinaryQueryWithProcessors() build_docker/../src/Server/TCPHandler.cpp:788:21\r\n    #6 0x2eba3309 in DB::TCPHandler::runImpl() build_docker/../src/Server/TCPHandler.cpp:389:17\r\n    #7 0x2ebc4179 in DB::TCPHandler::run() build_docker/../src/Server/TCPHandler.cpp:1920:9\r\n    #8 0x2fe389eb in Poco::Net::TCPServerConnection::start() build_docker/../contrib/poco/Net/src/TCPServerConnection.cpp:43:3\r\n    #9 0x2fe38ed9 in Poco::Net::TCPServerDispatcher::run() build_docker/../contrib/poco/Net/src/TCPServerDispatcher.cpp:115:20\r\n    #10 0x2ffb06e6 in Poco::PooledThread::run() build_docker/../contrib/poco/Foundation/src/ThreadPool.cpp:199:14\r\n    #11 0x2ffae1ce in Poco::ThreadImpl::runnableEntry(void*) build_docker/../contrib/poco/Foundation/src/Thread_POSIX.cpp:345:27\r\n    #12 0x7f46aa4db608 in start_thread /build/glibc-SzIz7B/glibc-2.31/nptl/pthread_create.c:477:8\r\n    #13 0x7f46aa400132 in __clone /build/glibc-SzIz7B/glibc-2.31/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior ../src/Common/assert_cast.h:50:12 in \r\n```\r\n\r\n```\r\n2022.12.23 05:37:16.902357 [ 437 ] {} <Fatal> BaseDaemon: ########################################\r\n2022.12.23 05:37:16.902443 [ 437 ] {} <Fatal> BaseDaemon: (version 22.13.1.1, build id: 8B6135E4FED74CD732EE252D0D4322430D65EB75) (from thread 148) (query_id: d67f210f-3c15-4aca-a064-b656d9140238) (query: SELECT x IN toDecimal64(257, NULL), * FROM temp__fuzz_0) Received signal sanitizer trap (-3)\r\n2022.12.23 05:37:16.902476 [ 437 ] {} <Fatal> BaseDaemon: Sanitizer trap.\r\n2022.12.23 05:37:16.902531 [ 437 ] {} <Fatal> BaseDaemon: Stack trace: 0x21656fe3 0x2193b556 0x16dfa976 0x16e0f3cd 0x2c387ab8 0x2ebfa5e9 0x2ebb5df5 0x2ebb1faa 0x2eba330a 0x2ebc417a 0x2fe389ec 0x2fe38eda 0x2ffb06e7 0x2ffae1cf 0x7f46aa4db609 0x7f46aa400133\r\n2022.12.23 05:37:16.916228 [ 437 ] {} <Fatal> BaseDaemon: 0.1. inlined from ./build_docker/../src/Common/StackTrace.cpp:334: StackTrace::tryCapture()\r\n2022.12.23 05:37:16.916254 [ 437 ] {} <Fatal> BaseDaemon: 0. ./build_docker/../src/Common/StackTrace.cpp:295: StackTrace::StackTrace() @ 0x21656fe3 in /workspace/clickhouse\r\n2022.12.23 05:37:16.941078 [ 437 ] {} <Fatal> BaseDaemon: 1. ./build_docker/../src/Daemon/BaseDaemon.cpp:0: sanitizerDeathCallback() @ 0x2193b556 in /workspace/clickhouse\r\n2022.12.23 05:37:18.062820 [ 437 ] {} <Fatal> BaseDaemon: 2. __sanitizer::Die() @ 0x16dfa976 in /workspace/clickhouse\r\n2022.12.23 05:37:19.161725 [ 437 ] {} <Fatal> BaseDaemon: 3. ? @ 0x16e0f3cd in /workspace/clickhouse\r\n2022.12.23 05:37:19.179785 [ 437 ] {} <Fatal> BaseDaemon: 4.1. inlined from ./build_docker/../src/Common/assert_cast.h:0: DB::ColumnNullable const& assert_cast<DB::ColumnNullable const&, DB::IColumn const&>(DB::IColumn const&)\r\n2022.12.23 05:37:19.179813 [ 437 ] {} <Fatal> BaseDaemon: 4. ./build_docker/../src/DataTypes/Serializations/SerializationNullable.cpp:78: DB::SerializationNullable::serializeBinaryBulkStatePrefix(DB::IColumn const&, DB::ISerialization::SerializeBinaryBulkSettings&, std::__1::shared_ptr<DB::ISerialization::SerializeBinaryBulkState>&) const @ 0x2c387ab8 in /workspace/clickhouse\r\n2022.12.23 05:37:19.194153 [ 437 ] {} <Fatal> BaseDaemon: 5.1. inlined from ./build_docker/../src/Formats/NativeWriter.cpp:62: DB::writeData(DB::ISerialization const&, COW<DB::IColumn>::immutable_ptr<DB::IColumn> const&, DB::WriteBuffer&, unsigned long, unsigned long)\r\n2022.12.23 05:37:19.194178 [ 437 ] {} <Fatal> BaseDaemon: 5. ./build_docker/../src/Formats/NativeWriter.cpp:151: DB::NativeWriter::write(DB::Block const&) @ 0x2ebfa5e9 in /workspace/clickhouse\r\n2022.12.23 05:37:19.257647 [ 437 ] {} <Fatal> BaseDaemon: 6. ./build_docker/../src/Server/TCPHandler.cpp:1797: DB::TCPHandler::sendData(DB::Block const&) @ 0x2ebb5df5 in /workspace/clickhouse\r\n2022.12.23 05:37:19.317627 [ 437 ] {} <Fatal> BaseDaemon: 7.1. inlined from ./build_docker/../src/Server/TCPHandler.cpp:788: ~unique_lock\r\n2022.12.23 05:37:19.317655 [ 437 ] {} <Fatal> BaseDaemon: 7. ./build_docker/../src/Server/TCPHandler.cpp:790: DB::TCPHandler::processOrdinaryQueryWithProcessors() @ 0x2ebb1faa in /workspace/clickhouse\r\n2022.12.23 05:37:19.371034 [ 437 ] {} <Fatal> BaseDaemon: 8. ./build_docker/../src/Server/TCPHandler.cpp:390: DB::TCPHandler::runImpl() @ 0x2eba330a in /workspace/clickhouse\r\n2022.12.23 05:37:19.437423 [ 437 ] {} <Fatal> BaseDaemon: 9. ./build_docker/../src/Server/TCPHandler.cpp:1922: DB::TCPHandler::run() @ 0x2ebc417a in /workspace/clickhouse\r\n2022.12.23 05:37:19.443035 [ 437 ] {} <Fatal> BaseDaemon: 10. ./build_docker/../contrib/poco/Net/src/TCPServerConnection.cpp:57: Poco::Net::TCPServerConnection::start() @ 0x2fe389ec in /workspace/clickhouse\r\n2022.12.23 05:37:19.450523 [ 437 ] {} <Fatal> BaseDaemon: 11.1. inlined from ./build_docker/../contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:48: std::__1::default_delete<Poco::Net::TCPServerConnection>::operator()[abi:v15000](Poco::Net::TCPServerConnection*) const\r\n2022.12.23 05:37:19.450549 [ 437 ] {} <Fatal> BaseDaemon: 11.2. inlined from ./build_docker/../contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:305: std::__1::unique_ptr<Poco::Net::TCPServerConnection, std::__1::default_delete<Poco::Net::TCPServerConnection>>::reset[abi:v15000](Poco::Net::TCPServerConnection*)\r\n2022.12.23 05:37:19.450586 [ 437 ] {} <Fatal> BaseDaemon: 11.3. inlined from ./build_docker/../contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:259: ~unique_ptr\r\n2022.12.23 05:37:19.450623 [ 437 ] {} <Fatal> BaseDaemon: 11. ./build_docker/../contrib/poco/Net/src/TCPServerDispatcher.cpp:116: Poco::Net::TCPServerDispatcher::run() @ 0x2fe38eda in /workspace/clickhouse\r\n2022.12.23 05:37:19.459029 [ 437 ] {} <Fatal> BaseDaemon: 12. ./build_docker/../contrib/poco/Foundation/src/ThreadPool.cpp:213: Poco::PooledThread::run() @ 0x2ffb06e7 in /workspace/clickhouse\r\n2022.12.23 05:37:19.466592 [ 437 ] {} <Fatal> BaseDaemon: 13.1. inlined from ./build_docker/../contrib/poco/Foundation/include/Poco/SharedPtr.h:156: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::assign(Poco::Runnable*)\r\n2022.12.23 05:37:19.466616 [ 437 ] {} <Fatal> BaseDaemon: 13.2. inlined from ./build_docker/../contrib/poco/Foundation/include/Poco/SharedPtr.h:208: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::operator=(Poco::Runnable*)\r\n2022.12.23 05:37:19.466646 [ 437 ] {} <Fatal> BaseDaemon: 13. ./build_docker/../contrib/poco/Foundation/src/Thread_POSIX.cpp:360: Poco::ThreadImpl::runnableEntry(void*) @ 0x2ffae1cf in /workspace/clickhouse\r\n2022.12.23 05:37:19.466689 [ 437 ] {} <Fatal> BaseDaemon: 14. ? @ 0x7f46aa4db609 in ?\r\n2022.12.23 05:37:19.466730 [ 437 ] {} <Fatal> BaseDaemon: 15. __clone @ 0x7f46aa400133 in ?\r\n2022.12.23 05:37:19.466767 [ 437 ] {} <Fatal> BaseDaemon: Integrity check of the executable skipped because the reference checksum could not be read.\r\n```\r\n\r\n```\r\n2022.12.23 05:36:48.963652 [ 148 ] {c00f5859-3f76-4979-8c8f-31c8d192468f} <Debug> executeQuery: (from [::ffff:127.0.0.1]:35574) CREATE TABLE temp__fuzz_0 (`x` UInt8, `y` Nullable(Decimal(38, 2))) ENGINE = Memory (stage: Complete)\r\n```\r\n\n",
  "hints_text": "Reproduces with analyzer\r\n```\r\nCREATE TABLE temp__fuzz_0 (`x` UInt8, `y` Nullable(Decimal(38, 2))) ENGINE = Memory;\r\ninsert into temp__fuzz_0 values (1, '22.5'), (2, Null);\r\nset allow_experimental_analyzer=1;\r\nSELECT x IN toDecimal64(257, NULL), * FROM temp__fuzz_0;\r\n```\r\n\r\nrelease:\r\n```\r\n2023.01.09 12:58:05.241243 [ 4174896 ] {} <Trace> BaseDaemon: Received signal 11\r\n2023.01.09 12:58:05.241562 [ 4175800 ] {} <Fatal> BaseDaemon: ########################################\r\n2023.01.09 12:58:05.241714 [ 4175800 ] {} <Fatal> BaseDaemon: (version 22.13.1.1, build id: F7F1DAA78E3CC44E549D2E88FF8BFF200A086D2A) (from thread 4174897) (query_id: d7c4d59c-c958-4a61-ad3b-e6e7f02b6a64) (query: SELECT x IN toDecimal64(257, NULL), * FROM temp__fuzz_0) Received signal Segmentation fault (11)\r\n2023.01.09 12:58:05.241787 [ 4175800 ] {} <Fatal> BaseDaemon: Address: NULL pointer. Access: read. Unknown si_code.\r\n2023.01.09 12:58:05.241850 [ 4175800 ] {} <Fatal> BaseDaemon: Stack trace: 0x334fa814 0x2fe6babb 0x35603f84 0x35589d9c 0x35584b01 0x35570683 0x3559eb06 0x3cf16f4f 0x3cf17ce5 0x3d3e8cfc 0x3d3e1fad 0x7f8796aa4609 0x7f87969c9133\r\n2023.01.09 12:58:05.298154 [ 4175800 ] {} <Fatal> BaseDaemon: 3. ./build-asan/./src/Columns/ColumnNullable.cpp:756: DB::ColumnNullable::checkConsistency() const @ 0x334fa814 in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:05.354921 [ 4175800 ] {} <Fatal> BaseDaemon: 4.1. inlined from ./build-asan/./src/DataTypes/Serializations/ISerialization.h:175: Substream\r\n2023.01.09 12:58:05.355033 [ 4175800 ] {} <Fatal> BaseDaemon: 4. ./build-asan/./src/DataTypes/Serializations/SerializationNullable.cpp:115: DB::SerializationNullable::serializeBinaryBulkWithMultipleStreams(DB::IColumn const&, unsigned long, unsigned long, DB::ISerialization::SerializeBinaryBulkSettings&, std::__1::shared_ptr<DB::ISerialization::SerializeBinaryBulkState>&) const @ 0x2fe6babb in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:05.388360 [ 4175800 ] {} <Fatal> BaseDaemon: 5.1. inlined from ./build-asan/./src/Formats/NativeWriter.cpp:63: DB::writeData(DB::ISerialization const&, COW<DB::IColumn>::immutable_ptr<DB::IColumn> const&, DB::WriteBuffer&, unsigned long, unsigned long)\r\n2023.01.09 12:58:05.388449 [ 4175800 ] {} <Fatal> BaseDaemon: 5. ./build-asan/./src/Formats/NativeWriter.cpp:153: DB::NativeWriter::write(DB::Block const&) @ 0x35603f84 in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:05.589313 [ 4175800 ] {} <Fatal> BaseDaemon: 6. ./build-asan/./src/Server/TCPHandler.cpp:0: DB::TCPHandler::sendData(DB::Block const&) @ 0x35589d9c in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:05.770678 [ 4175800 ] {} <Fatal> BaseDaemon: 7. ./build-asan/./src/Server/TCPHandler.cpp:0: DB::TCPHandler::processOrdinaryQueryWithProcessors() @ 0x35584b01 in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:05.911324 [ 4175800 ] {} <Fatal> BaseDaemon: 8. ./build-asan/./src/Server/TCPHandler.cpp:0: DB::TCPHandler::runImpl() @ 0x35570683 in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:06.000105 [ 4175137 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 1.32 GiB, peak 1.46 GiB, free memory in arenas 0.00 B, will set to 1.39 GiB (RSS), difference: 71.04 MiB\r\n2023.01.09 12:58:06.148394 [ 4175800 ] {} <Fatal> BaseDaemon: 9. ./build-asan/./src/Server/TCPHandler.cpp:1933: DB::TCPHandler::run() @ 0x3559eb06 in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:06.155252 [ 4175800 ] {} <Fatal> BaseDaemon: 10. ./build-asan/./contrib/poco/Net/src/TCPServerConnection.cpp:57: Poco::Net::TCPServerConnection::start() @ 0x3cf16f4f in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:06.167024 [ 4175800 ] {} <Fatal> BaseDaemon: 11.1. inlined from ./build-asan/./contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:48: std::__1::default_delete<Poco::Net::TCPServerConnection>::operator()[abi:v15000](Poco::Net::TCPServerConnection*) const\r\n2023.01.09 12:58:06.167114 [ 4175800 ] {} <Fatal> BaseDaemon: 11.2. inlined from ./build-asan/./contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:305: std::__1::unique_ptr<Poco::Net::TCPServerConnection, std::__1::default_delete<Poco::Net::TCPServerConnection>>::reset[abi:v15000](Poco::Net::TCPServerConnection*)\r\n2023.01.09 12:58:06.167166 [ 4175800 ] {} <Fatal> BaseDaemon: 11.3. inlined from ./build-asan/./contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:259: ~unique_ptr\r\n2023.01.09 12:58:06.167209 [ 4175800 ] {} <Fatal> BaseDaemon: 11. ./build-asan/./contrib/poco/Net/src/TCPServerDispatcher.cpp:116: Poco::Net::TCPServerDispatcher::run() @ 0x3cf17ce5 in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:06.181288 [ 4175800 ] {} <Fatal> BaseDaemon: 12. ./build-asan/./contrib/poco/Foundation/src/ThreadPool.cpp:0: Poco::PooledThread::run() @ 0x3d3e8cfc in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:06.193041 [ 4175800 ] {} <Fatal> BaseDaemon: 13.1. inlined from ./build-asan/./contrib/poco/Foundation/include/Poco/SharedPtr.h:277: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::get()\r\n2023.01.09 12:58:06.193119 [ 4175800 ] {} <Fatal> BaseDaemon: 13.2. inlined from ./build-asan/./contrib/poco/Foundation/include/Poco/SharedPtr.h:156: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::assign(Poco::Runnable*)\r\n2023.01.09 12:58:06.193171 [ 4175800 ] {} <Fatal> BaseDaemon: 13.3. inlined from ./build-asan/./contrib/poco/Foundation/include/Poco/SharedPtr.h:208: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::operator=(Poco::Runnable*)\r\n2023.01.09 12:58:06.193216 [ 4175800 ] {} <Fatal> BaseDaemon: 13. ./build-asan/./contrib/poco/Foundation/src/Thread_POSIX.cpp:360: Poco::ThreadImpl::runnableEntry(void*) @ 0x3d3e1fad in /home/ubuntu/dev/ClickHouse/build-asan/programs/clickhouse\r\n2023.01.09 12:58:06.193263 [ 4175800 ] {} <Fatal> BaseDaemon: 14. ? @ 0x7f8796aa4609 in ?\r\n2023.01.09 12:58:06.193306 [ 4175800 ] {} <Fatal> BaseDaemon: 15. clone @ 0x7f87969c9133 in ?\r\n2023.01.09 12:58:06.193350 [ 4175800 ] {} <Fatal> BaseDaemon: Integrity check of the executable skipped because the reference checksum could not be read.\r\n\r\n```\r\n\r\nubsan:\r\n```\r\n../src/Common/assert_cast.h:50:12: runtime error: downcast of address 0x7f6f5804cb00 which does not point to an object of type 'const DB::ColumnNullable'\r\n0x7f6f5804cb00: note: object is of type 'DB::ColumnVector<char8_t>'\r\n 00 00 00 00  20 4c 2a 11 00 00 00 00  03 00 00 00 00 00 00 00  20 39 05 58 6f 7f 00 00  22 39 05 58\r\n              ^~~~~~~~~~~~~~~~~~~~~~~\r\n              vptr for 'DB::ColumnVector<char8_t>'\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior ../src/Common/assert_cast.h:50:12 in \r\n2023.01.09 12:55:17.662436 [ 4164565 ] {} <Trace> BaseDaemon: Received signal -3\r\n2023.01.09 12:55:17.662658 [ 4165470 ] {} <Fatal> BaseDaemon: ########################################\r\n2023.01.09 12:55:17.662756 [ 4165470 ] {} <Fatal> BaseDaemon: (version 22.13.1.1, build id: 8B6135E4FED74CD732EE252D0D4322430D65EB75) (from thread 4164572) (query_id: b3925f02-9c86-4641-8472-018366109919) (query: SELECT x IN toDecimal64(257, NULL), * FROM temp__fuzz_0) Received signal sanitizer trap (-3)\r\n2023.01.09 12:55:17.662799 [ 4165470 ] {} <Fatal> BaseDaemon: Sanitizer trap.\r\n2023.01.09 12:55:17.662850 [ 4165470 ] {} <Fatal> BaseDaemon: Stack trace: 0x21656fe3 0x2193b556 0x16dfa976 0x16e0f3cd 0x2c387ab8 0x2ebfa5e9 0x2ebb5df5 0x2ebb1faa 0x2eba330a 0x2ebc417a 0x2fe389ec 0x2fe38eda 0x2ffb06e7 0x2ffae1cf 0x7f744dfd8609 0x7f744defd133\r\n2023.01.09 12:55:17.675418 [ 4165470 ] {} <Fatal> BaseDaemon: 0.1. inlined from ./build_docker/../src/Common/StackTrace.cpp:334: StackTrace::tryCapture()\r\n2023.01.09 12:55:17.675457 [ 4165470 ] {} <Fatal> BaseDaemon: 0. ./build_docker/../src/Common/StackTrace.cpp:295: StackTrace::StackTrace() @ 0x21656fe3 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:17.698214 [ 4165470 ] {} <Fatal> BaseDaemon: 1. ./build_docker/../src/Daemon/BaseDaemon.cpp:0: sanitizerDeathCallback() @ 0x2193b556 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:18.000093 [ 4164788 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 806.59 MiB, peak 994.17 MiB, free memory in arenas 0.00 B, will set to 913.75 MiB (RSS), difference: 107.16 MiB\r\n2023.01.09 12:55:18.732003 [ 4165470 ] {} <Fatal> BaseDaemon: 2. __sanitizer::Die() @ 0x16dfa976 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.000093 [ 4164788 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 913.75 MiB, peak 994.17 MiB, free memory in arenas 0.00 B, will set to 1.28 GiB (RSS), difference: 391.88 MiB\r\n2023.01.09 12:55:19.000149 [ 4164788 ] {} <Debug> MemoryTracker: Current memory usage (total): 1.28 GiB.\r\n2023.01.09 12:55:19.738695 [ 4165470 ] {} <Fatal> BaseDaemon: 3. ? @ 0x16e0f3cd in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.755418 [ 4165470 ] {} <Fatal> BaseDaemon: 4.1. inlined from ./build_docker/../src/Common/assert_cast.h:0: DB::ColumnNullable const& assert_cast<DB::ColumnNullable const&, DB::IColumn const&>(DB::IColumn const&)\r\n2023.01.09 12:55:19.755489 [ 4165470 ] {} <Fatal> BaseDaemon: 4. ./build_docker/../src/DataTypes/Serializations/SerializationNullable.cpp:78: DB::SerializationNullable::serializeBinaryBulkStatePrefix(DB::IColumn const&, DB::ISerialization::SerializeBinaryBulkSettings&, std::__1::shared_ptr<DB::ISerialization::SerializeBinaryBulkState>&) const @ 0x2c387ab8 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.769169 [ 4165470 ] {} <Fatal> BaseDaemon: 5.1. inlined from ./build_docker/../src/Formats/NativeWriter.cpp:62: DB::writeData(DB::ISerialization const&, COW<DB::IColumn>::immutable_ptr<DB::IColumn> const&, DB::WriteBuffer&, unsigned long, unsigned long)\r\n2023.01.09 12:55:19.769229 [ 4165470 ] {} <Fatal> BaseDaemon: 5. ./build_docker/../src/Formats/NativeWriter.cpp:151: DB::NativeWriter::write(DB::Block const&) @ 0x2ebfa5e9 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.828543 [ 4165470 ] {} <Fatal> BaseDaemon: 6. ./build_docker/../src/Server/TCPHandler.cpp:1797: DB::TCPHandler::sendData(DB::Block const&) @ 0x2ebb5df5 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.883732 [ 4165470 ] {} <Fatal> BaseDaemon: 7.1. inlined from ./build_docker/../src/Server/TCPHandler.cpp:788: ~unique_lock\r\n2023.01.09 12:55:19.883800 [ 4165470 ] {} <Fatal> BaseDaemon: 7. ./build_docker/../src/Server/TCPHandler.cpp:790: DB::TCPHandler::processOrdinaryQueryWithProcessors() @ 0x2ebb1faa in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.932964 [ 4165470 ] {} <Fatal> BaseDaemon: 8. ./build_docker/../src/Server/TCPHandler.cpp:390: DB::TCPHandler::runImpl() @ 0x2eba330a in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.993442 [ 4165470 ] {} <Fatal> BaseDaemon: 9. ./build_docker/../src/Server/TCPHandler.cpp:1922: DB::TCPHandler::run() @ 0x2ebc417a in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:19.998694 [ 4165470 ] {} <Fatal> BaseDaemon: 10. ./build_docker/../contrib/poco/Net/src/TCPServerConnection.cpp:57: Poco::Net::TCPServerConnection::start() @ 0x2fe389ec in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:20.000092 [ 4164788 ] {} <Trace> AsynchronousMetrics: MemoryTracking: was 1.28 GiB, peak 1.28 GiB, free memory in arenas 0.00 B, will set to 1.30 GiB (RSS), difference: 29.68 MiB\r\n2023.01.09 12:55:20.005598 [ 4165470 ] {} <Fatal> BaseDaemon: 11.1. inlined from ./build_docker/../contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:48: std::__1::default_delete<Poco::Net::TCPServerConnection>::operator()[abi:v15000](Poco::Net::TCPServerConnection*) const\r\n2023.01.09 12:55:20.005658 [ 4165470 ] {} <Fatal> BaseDaemon: 11.2. inlined from ./build_docker/../contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:305: std::__1::unique_ptr<Poco::Net::TCPServerConnection, std::__1::default_delete<Poco::Net::TCPServerConnection>>::reset[abi:v15000](Poco::Net::TCPServerConnection*)\r\n2023.01.09 12:55:20.005701 [ 4165470 ] {} <Fatal> BaseDaemon: 11.3. inlined from ./build_docker/../contrib/llvm-project/libcxx/include/__memory/unique_ptr.h:259: ~unique_ptr\r\n2023.01.09 12:55:20.005742 [ 4165470 ] {} <Fatal> BaseDaemon: 11. ./build_docker/../contrib/poco/Net/src/TCPServerDispatcher.cpp:116: Poco::Net::TCPServerDispatcher::run() @ 0x2fe38eda in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:20.013507 [ 4165470 ] {} <Fatal> BaseDaemon: 12. ./build_docker/../contrib/poco/Foundation/src/ThreadPool.cpp:213: Poco::PooledThread::run() @ 0x2ffb06e7 in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:20.020729 [ 4165470 ] {} <Fatal> BaseDaemon: 13.1. inlined from ./build_docker/../contrib/poco/Foundation/include/Poco/SharedPtr.h:156: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::assign(Poco::Runnable*)\r\n2023.01.09 12:55:20.020774 [ 4165470 ] {} <Fatal> BaseDaemon: 13.2. inlined from ./build_docker/../contrib/poco/Foundation/include/Poco/SharedPtr.h:208: Poco::SharedPtr<Poco::Runnable, Poco::ReferenceCounter, Poco::ReleasePolicy<Poco::Runnable>>::operator=(Poco::Runnable*)\r\n2023.01.09 12:55:20.020816 [ 4165470 ] {} <Fatal> BaseDaemon: 13. ./build_docker/../contrib/poco/Foundation/src/Thread_POSIX.cpp:360: Poco::ThreadImpl::runnableEntry(void*) @ 0x2ffae1cf in /home/ubuntu/test/22.13.1.1+ubsan/usr/bin/clickhouse\r\n2023.01.09 12:55:20.020861 [ 4165470 ] {} <Fatal> BaseDaemon: 14. ? @ 0x7f744dfd8609 in ?\r\n2023.01.09 12:55:20.020905 [ 4165470 ] {} <Fatal> BaseDaemon: 15. __clone @ 0x7f744defd133 in ?\r\n2023.01.09 12:55:20.020953 [ 4165470 ] {} <Fatal> BaseDaemon: Integrity check of the executable skipped because the reference checksum could not be read.\r\n\r\n```",
  "created_at": "2023-01-09T14:36:08Z",
  "modified_files": [
    "src/Analyzer/Passes/QueryAnalysisPass.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.reference",
    "b/tests/queries/0_stateless/02525_analyzer_function_in_crash_fix.sql"
  ]
}