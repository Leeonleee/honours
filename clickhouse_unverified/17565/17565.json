{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 17565,
  "instance_id": "ClickHouse__ClickHouse-17565",
  "issue_numbers": [
    "13654"
  ],
  "base_commit": "00da5148a105f9306b6d15492090453e96988d39",
  "patch": "diff --git a/base/common/LineReader.cpp b/base/common/LineReader.cpp\nindex b2bc929a1df9..a32906dd5a58 100644\n--- a/base/common/LineReader.cpp\n+++ b/base/common/LineReader.cpp\n@@ -127,7 +127,7 @@ String LineReader::readLine(const String & first_prompt, const String & second_p\n         }\n #endif\n \n-        line += (line.empty() ? \"\" : \" \") + input;\n+        line += (line.empty() ? \"\" : \"\\n\") + input;\n \n         if (!need_next_line)\n             break;\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01599_multiline_input_and_singleline_comments.reference b/tests/queries/0_stateless/01599_multiline_input_and_singleline_comments.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\ndiff --git a/tests/queries/0_stateless/01599_multiline_input_and_singleline_comments.sh b/tests/queries/0_stateless/01599_multiline_input_and_singleline_comments.sh\nnew file mode 100755\nindex 000000000000..5b7d1356dc6e\n--- /dev/null\n+++ b/tests/queries/0_stateless/01599_multiline_input_and_singleline_comments.sh\n@@ -0,0 +1,25 @@\n+#!/usr/bin/expect -f\n+\n+log_user 0\n+set timeout 5\n+match_max 100000\n+\n+if ![info exists env(CLICKHOUSE_PORT_TCP)] {set env(CLICKHOUSE_PORT_TCP) 9000}\n+\n+spawn clickhouse-client --multiline --port \"$env(CLICKHOUSE_PORT_TCP)\"\n+expect \":) \"\n+\n+# Make a query\n+send -- \"SELECT 1\\r\"\n+expect \":-] \"\n+send -- \"-- xxx\\r\"\n+expect \":-] \"\n+send -- \", 2\\r\"\n+expect \":-] \"\n+send -- \";\\r\"\n+\n+expect \"\u2502 1 \u2502 2 \u2502\"\n+expect \":) \"\n+\n+send -- \"\\4\"\n+expect eof\n",
  "problem_statement": "client interactive mode line comments (-- ) does not work anymore.\n20.7.1.4189\r\n\r\n```\r\nclickhouse-client -m\r\n\r\n:) select 1\r\n:-] ---abbbb\r\n:-] , 2 b\r\n:-] ;\r\n\r\nSELECT 1\r\n\r\n\u250c\u25001\u2500\u2510\r\n\u2502 1 \u2502\r\n\u2514\u2500\u2500\u2500\u2518\r\n```\r\n\r\n19.13.7.57\r\n```\r\nclickhouse-client -m\r\nselect 1\r\n:-] --xxxx\r\n:-] ,2 b\r\n:-] ;\r\n\r\nSELECT\r\n    1,\r\n    2 AS b\r\n\r\n\u250c\u25001\u2500\u252c\u2500b\u2500\u2510\r\n\u2502 1 \u2502 2 \u2502\r\n\u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518\r\n```\n",
  "hints_text": "Fixed.\nThe only remaining issue is that the query is not correctly written to the history.\n```\r\n$ clickhouse-client -m\r\nClickHouse client version 20.12.1.1.\r\nConnecting to localhost:9000 as user default.\r\nConnected to ClickHouse server version 20.12.1 revision 54442.\r\n\r\nmilovidov-desktop :) select 1\r\n:-] --xxxx\r\n:-] ,2 b\r\n:-] ;\r\n\r\nSELECT 1\r\n\r\nQuery id: e6198702-9c9d-41a6-94b6-e1af31129147\r\n\r\n\u250c\u25001\u2500\u2510\r\n\u2502 1 \u2502\r\n\u2514\u2500\u2500\u2500\u2518\r\n```\nTest needed.\nNo, the expected result\r\n```\r\n\u250c\u25001\u2500\u252c\u2500b\u2500\u2510\r\n\u2502 1 \u2502 2 \u2502\r\n\u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518\r\n\r\nselect 1\r\n--xxxx\r\n,2 b\r\n;\r\n\r\n```",
  "created_at": "2020-11-29T14:52:27Z"
}