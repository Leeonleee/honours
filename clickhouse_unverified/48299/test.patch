diff --git a/tests/performance/set_disable_skip_index.xml b/tests/performance/set_disable_skip_index.xml
new file mode 100644
index 000000000000..5769f30eac93
--- /dev/null
+++ b/tests/performance/set_disable_skip_index.xml
@@ -0,0 +1,17 @@
+<test>
+    <create_query>
+        CREATE TABLE test_in_skip_idx
+        (
+            a UInt64,
+            s String,
+            INDEX idx s TYPE bloom_filter GRANULARITY 1
+        )
+        ENGINE = MergeTree() ORDER BY a
+    </create_query>
+
+    <fill_query>INSERT INTO test_in_skip_idx SELECT number, number FROM numbers(10000000)</fill_query>
+    <fill_query>OPTIMIZE TABLE test_in_skip_idx FINAL</fill_query>
+
+    <query>SELECT count() FROM test_in_skip_idx WHERE s IN (SELECT toString(number + 10000000) FROM numbers(100000)) SETTINGS use_skip_indexes = 0</query>
+    <drop_query>DROP TABLE IF EXISTS test_in_skip_idx</drop_query>
+</test>
diff --git a/tests/queries/0_stateless/02707_skip_index_with_in.reference b/tests/queries/0_stateless/02707_skip_index_with_in.reference
new file mode 100644
index 000000000000..e69de29bb2d1
diff --git a/tests/queries/0_stateless/02707_skip_index_with_in.sql b/tests/queries/0_stateless/02707_skip_index_with_in.sql
new file mode 100644
index 000000000000..4767619cee19
--- /dev/null
+++ b/tests/queries/0_stateless/02707_skip_index_with_in.sql
@@ -0,0 +1,20 @@
+DROP TABLE IF EXISTS t_skip_index_in;
+
+CREATE TABLE t_skip_index_in
+(
+    a String,
+    b String,
+    c String,
+    INDEX idx_c c TYPE bloom_filter GRANULARITY 1
+)
+ENGINE = MergeTree
+ORDER BY (a, b);
+
+INSERT INTO t_skip_index_in VALUES ('a', 'b', 'c');
+
+-- This query checks that set is not being built if indexes are not used,
+-- because with EXPLAIN the set will be built only for analysis of indexes.
+EXPLAIN SELECT count() FROM t_skip_index_in WHERE c IN (SELECT throwIf(1)) SETTINGS use_skip_indexes = 0 FORMAT Null;
+EXPLAIN SELECT count() FROM t_skip_index_in WHERE c IN (SELECT throwIf(1)) SETTINGS use_skip_indexes = 1; -- { serverError FUNCTION_THROW_IF_VALUE_IS_NON_ZERO }
+
+DROP TABLE t_skip_index_in;
