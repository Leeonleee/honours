{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 37775,
  "instance_id": "ClickHouse__ClickHouse-37775",
  "issue_numbers": [
    "31924"
  ],
  "base_commit": "8c40f05d4cba0583339b10c98537307329df942e",
  "patch": "diff --git a/src/Functions/FunctionsConversion.h b/src/Functions/FunctionsConversion.h\nindex bffc15cdc577..419c45ce6df1 100644\n--- a/src/Functions/FunctionsConversion.h\n+++ b/src/Functions/FunctionsConversion.h\n@@ -705,7 +705,7 @@ template <>\n struct FormatImpl<DataTypeDate32>\n {\n     template <typename ReturnType = void>\n-    static ReturnType execute(const DataTypeDate::FieldType x, WriteBuffer & wb, const DataTypeDate32 *, const DateLUTImpl *)\n+    static ReturnType execute(const DataTypeDate32::FieldType x, WriteBuffer & wb, const DataTypeDate32 *, const DateLUTImpl *)\n     {\n         writeDateText(ExtendedDayNum(x), wb);\n         return ReturnType(true);\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01921_datatype_date32.reference b/tests/queries/0_stateless/01921_datatype_date32.reference\nindex a6b03123b33c..70eebc76c01e 100644\n--- a/tests/queries/0_stateless/01921_datatype_date32.reference\n+++ b/tests/queries/0_stateless/01921_datatype_date32.reference\n@@ -283,3 +283,9 @@\n 1925-01-01\t\\N\n 1925-01-01\n \\N\n+1925-01-01\n+1969-12-31\n+1970-01-01\n+2149-06-06\n+2149-06-07\n+2283-11-11\ndiff --git a/tests/queries/0_stateless/01921_datatype_date32.sql b/tests/queries/0_stateless/01921_datatype_date32.sql\nindex 0805b94a9fe4..ef6e3e5ee899 100644\n--- a/tests/queries/0_stateless/01921_datatype_date32.sql\n+++ b/tests/queries/0_stateless/01921_datatype_date32.sql\n@@ -118,4 +118,15 @@ select toDate32OrZero('1924-01-01'), toDate32OrNull('1924-01-01');\n select toDate32OrZero(''), toDate32OrNull('');\n select (select toDate32OrZero(''));\n select (select toDate32OrNull(''));\n+SELECT toString(T.d) dateStr\n+FROM\n+    (\n+    SELECT '1925-01-01'::Date32 d\n+    UNION ALL SELECT '1969-12-31'::Date32\n+    UNION ALL SELECT '1970-01-01'::Date32\n+    UNION ALL SELECT '2149-06-06'::Date32\n+    UNION ALL SELECT '2149-06-07'::Date32\n+    UNION ALL SELECT '2283-11-11'::Date32\n+    ) AS T\n+ORDER BY T.d\n \n",
  "problem_statement": "toString(Date32) works correctly only with the limited range of values\nThe function `toSting` doesn't work correctly with an argument of the type `Date32` if the value of the argument is outside of the range [1970-01-01, 2149-06-06].\r\n\r\n**How to reproduce**\r\n\r\nClickHouse server version 21.11.3 revision 54450.\r\nClickHouse client version 21.11.3.6 (official build).\r\n\r\nRun the query:\r\n```SQL\r\nSELECT T.d date, toString(T.d) dateStr\r\nFROM\r\n(\r\n  SELECT '1925-01-01'::Date32 d\r\n  UNION ALL SELECT '1969-12-31'::Date32\r\n  UNION ALL SELECT '1970-01-01'::Date32\r\n  UNION ALL SELECT '2149-06-06'::Date32\r\n  UNION ALL SELECT '2149-06-07'::Date32\r\n  UNION ALL SELECT '2283-11-11'::Date32\r\n ) AS T\r\n ORDER BY T.d\r\n```\r\n\r\nRows returned by the query:\r\n```\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500date\u2500\u252c\u2500dateStr\u2500\u2500\u2500\u2500\u2510\r\n\u2502 1925-01-01 \u2502 2104-06-07 \u2502\r\n\u2502 1969-12-31 \u2502 2149-06-06 \u2502\r\n\u2502 1970-01-01 \u2502 1970-01-01 \u2502\r\n\u2502 2149-06-06 \u2502 2149-06-06 \u2502\r\n\u2502 2149-06-07 \u2502 1970-01-01 \u2502\r\n\u2502 2283-11-11 \u2502 2104-06-06 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n\r\n**Expected behavior**\r\n\r\nValues in the columns **date** and **dateStr** should be the same.\r\nFor example, `toString('1969-12-31'::Date32)` should return the string \"1969-12-31\", but it returns \"2149-06-06\".\r\n\n",
  "hints_text": "Help wanted from @liuneng1994\n@alexey-milovidov assign it to me\nSorry, I just saw this notice, I checked, the problem still seems to exist, I will spend time to fix the problem.",
  "created_at": "2022-06-02T08:59:40Z",
  "modified_files": [
    "src/Functions/FunctionsConversion.h"
  ],
  "modified_test_files": [
    "tests/queries/0_stateless/01921_datatype_date32.reference",
    "tests/queries/0_stateless/01921_datatype_date32.sql"
  ]
}