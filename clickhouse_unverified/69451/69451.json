{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 69451,
  "instance_id": "ClickHouse__ClickHouse-69451",
  "issue_numbers": [
    "69450"
  ],
  "base_commit": "a34a544f4a8cc94283ba1e134cf02eabd0052954",
  "patch": "diff --git a/src/Functions/sqid.cpp b/src/Functions/sqid.cpp\nindex 0e133590b84d..074a34bd0838 100644\n--- a/src/Functions/sqid.cpp\n+++ b/src/Functions/sqid.cpp\n@@ -124,7 +124,7 @@ class FunctionSqidDecode : public IFunction\n                 std::string_view sqid = col_non_const->getDataAt(i).toView();\n                 std::vector<UInt64> integers = sqids.decode(String(sqid));\n                 res_nested_data.insert(integers.begin(), integers.end());\n-                res_offsets_data.push_back(integers.size());\n+                res_offsets_data.push_back(res_offsets_data.back() + integers.size());\n             }\n         }\n         else\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02933_sqid.reference b/tests/queries/0_stateless/02933_sqid.reference\nindex a559bacb0ac2..4597e2347e3b 100644\n--- a/tests/queries/0_stateless/02933_sqid.reference\n+++ b/tests/queries/0_stateless/02933_sqid.reference\n@@ -13,5 +13,6 @@ Td1EnWQo\t[1,2,3,4]\n XMbT\n -- invalid sqid\n []\n+-- bug 69450\n -- alias\n XMbT\ndiff --git a/tests/queries/0_stateless/02933_sqid.sql b/tests/queries/0_stateless/02933_sqid.sql\nindex 81d4b2bc35cb..822fe33df518 100644\n--- a/tests/queries/0_stateless/02933_sqid.sql\n+++ b/tests/queries/0_stateless/02933_sqid.sql\n@@ -25,5 +25,12 @@ SELECT sqidEncode(toNullable(materialize(1)), toLowCardinality(materialize(2)));\n SELECT '-- invalid sqid';\n SELECT sqidDecode('invalid sqid');\n \n+SELECT '-- bug 69450';\n+DROP TABLE IF EXISTS tab;\n+CREATE TABLE tab (id String) ENGINE = MergeTree ORDER BY id;\n+INSERT INTO tab SELECT * FROM generateRandom() LIMIT 1000000;\n+SELECT sqidDecode(id) FROM tab FORMAT Null;\n+DROP TABLE tab;\n+\n SELECT '-- alias';\n SELECT sqid(1, 2);\n",
  "problem_statement": "`LOGICAL_ERROR` in `sqidDecode` function\n```sql\r\ncreate table test (id String) engine=MergeTree order by id;\r\ninsert into test select * from generateRandom() limit 1000000;\r\nselect sqidDecode(id) from test;\r\n-- Boom.\r\n```\n",
  "hints_text": "",
  "created_at": "2024-09-10T15:38:16Z"
}