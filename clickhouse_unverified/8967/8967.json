{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 8967,
  "instance_id": "ClickHouse__ClickHouse-8967",
  "issue_numbers": [
    "8930"
  ],
  "base_commit": "9feb848e843a339b394794f5db4771bf7649a73b",
  "patch": "diff --git a/dbms/src/Interpreters/InterpreterCreateQuery.cpp b/dbms/src/Interpreters/InterpreterCreateQuery.cpp\nindex daffdfd71f8f..93b53f9eaad9 100644\n--- a/dbms/src/Interpreters/InterpreterCreateQuery.cpp\n+++ b/dbms/src/Interpreters/InterpreterCreateQuery.cpp\n@@ -555,10 +555,12 @@ BlockIO InterpreterCreateQuery::createTable(ASTCreateQuery & create)\n     // If this is a stub ATTACH query, read the query definition from the database\n     if (create.attach && !create.storage && !create.columns_list)\n     {\n+        bool if_not_exists = create.if_not_exists;\n         // Table SQL definition is available even if the table is detached\n         auto query = context.getDatabase(create.database)->getCreateTableQuery(context, create.table);\n         create = query->as<ASTCreateQuery &>(); // Copy the saved create query, but use ATTACH instead of CREATE\n         create.attach = true;\n+        create.if_not_exists = if_not_exists;\n     }\n \n     String current_database = context.getCurrentDatabase();\n",
  "test_patch": "diff --git a/dbms/tests/queries/0_stateless/01073_attach_if_not_exists.reference b/dbms/tests/queries/0_stateless/01073_attach_if_not_exists.reference\nnew file mode 100644\nindex 000000000000..d00491fd7e5b\n--- /dev/null\n+++ b/dbms/tests/queries/0_stateless/01073_attach_if_not_exists.reference\n@@ -0,0 +1,1 @@\n+1\ndiff --git a/dbms/tests/queries/0_stateless/01073_attach_if_not_exists.sql b/dbms/tests/queries/0_stateless/01073_attach_if_not_exists.sql\nnew file mode 100644\nindex 000000000000..e9411577d568\n--- /dev/null\n+++ b/dbms/tests/queries/0_stateless/01073_attach_if_not_exists.sql\n@@ -0,0 +1,6 @@\n+CREATE TABLE t (a Int) ENGINE = Log;\n+ATTACH TABLE t; -- { serverError 57 }\n+ATTACH TABLE IF NOT EXISTS t;\n+DETACH TABLE t;\n+ATTACH TABLE IF NOT EXISTS t;\n+EXISTS TABLE t;\n",
  "problem_statement": "'ATTACH TABLE IF NOT EXISTS' not working properly.\n**Describe the bug or unexpected behaviour**\r\n`ATTACH TABLE` query throws an exception even if `IF NOT EXISTS` clause is specified.\r\n\r\n**How to reproduce**\r\n```\r\nap11-nix :) create table t(a Int) engine = Log\r\n\r\nap11-nix :) attach table if not exists t\r\n\r\nATTACH TABLE IF NOT EXISTS t\r\n\r\nReceived exception from server (version 20.2.1):\r\nCode: 57. DB::Exception: Received from localhost:9000. DB::Exception: Table default.t already exists.. \r\n\r\n0 rows in set. Elapsed: 0.005 sec. \r\n```\n",
  "hints_text": "",
  "created_at": "2020-02-03T10:40:00Z"
}