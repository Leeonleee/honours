{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 895,
  "instance_id": "ClickHouse__ClickHouse-895",
  "issue_numbers": [
    "891"
  ],
  "base_commit": "1cd217ba561536c8130b44e3fba956c1fd0832ff",
  "patch": "diff --git a/dbms/src/Interpreters/ExpressionAnalyzer.cpp b/dbms/src/Interpreters/ExpressionAnalyzer.cpp\nindex 5704ca669f8a..a06184adb976 100644\n--- a/dbms/src/Interpreters/ExpressionAnalyzer.cpp\n+++ b/dbms/src/Interpreters/ExpressionAnalyzer.cpp\n@@ -1146,7 +1146,9 @@ void ExpressionAnalyzer::executeScalarSubqueriesImpl(ASTPtr & ast)\n             if (!block)\n             {\n                 /// Interpret subquery with empty result as Null literal\n-                ast = std::make_unique<ASTLiteral>(ast->range, Null());\n+                auto ast_new = std::make_unique<ASTLiteral>(ast->range, Null());\n+                ast_new->setAlias(ast->tryGetAlias());\n+                ast = std::move(ast_new);\n                 return;\n             }\n \n",
  "test_patch": "diff --git a/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.reference b/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.reference\nindex e4076fb6ab0a..167d32f88425 100644\n--- a/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.reference\n+++ b/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.reference\n@@ -5,3 +5,5 @@\n \\N\n \\N\n \\N\n+a\tb\n+\\N\t1\ndiff --git a/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.sql b/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.sql\nindex 77f3fb51b303..4bfa8dc4ecb1 100644\n--- a/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.sql\n+++ b/dbms/tests/queries/0_stateless/00420_null_in_scalar_subqueries.sql\n@@ -5,3 +5,4 @@ SELECT (SELECT Null WHERE nuLL IS NOT NULL);\n SELECT (SELECT Null WHERE 1);\n SELECT CAST(NULL as Null);\n SELECT (SELECT CAST(NULL as Null) WHERE 0);\n+SELECT (SELECT 1 WHERE 0) AS a, (SELECT 1 WHERE 1) AS b FORMAT TSVWithNames;\n",
  "problem_statement": "Column aliases are lost with empty scalar subqueries\n`select (select 1 where 0) a, (select 1 where 1) b;`\r\n\r\n    \u250c\u2500NULL\u2500\u252c\u2500b\u2500\u2510\r\n    \u2502   \\N \u2502 1 \u2502\r\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518\r\n\r\nColumn should be 'a', not 'NULL'. This is a problem when it appears as a part of UNION.\n",
  "hints_text": "",
  "created_at": "2017-06-19T16:44:46Z"
}