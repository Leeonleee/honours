diff --git a/tests/queries/1_stateful/00171_grouping_aggregated_transform_bug.reference b/tests/queries/1_stateful/00171_grouping_aggregated_transform_bug.reference
new file mode 100644
index 000000000000..e31a1e90d876
--- /dev/null
+++ b/tests/queries/1_stateful/00171_grouping_aggregated_transform_bug.reference
@@ -0,0 +1,2 @@
+10726001768429413598
+10726001768429413598
diff --git a/tests/queries/1_stateful/00171_grouping_aggregated_transform_bug.sql b/tests/queries/1_stateful/00171_grouping_aggregated_transform_bug.sql
new file mode 100644
index 000000000000..7068780a1b1c
--- /dev/null
+++ b/tests/queries/1_stateful/00171_grouping_aggregated_transform_bug.sql
@@ -0,0 +1,4 @@
+-- Tags: distributed
+
+SELECT sum(cityHash64(*)) FROM (SELECT CounterID, quantileTiming(0.5)(SendTiming), count() FROM remote('127.0.0.{1,2,3,4,5,6,7,8,9,10}', test.hits) WHERE SendTiming != -1 GROUP BY CounterID) SETTINGS max_block_size = 63169;
+SELECT sum(cityHash64(*)) FROM (SELECT CounterID, quantileTiming(0.5)(SendTiming), count() FROM remote('127.0.0.{1,2,3,4,5,6,7,8,9,10}', test.hits) WHERE SendTiming != -1 GROUP BY CounterID) SETTINGS optimize_aggregation_in_order = 1, max_block_size = 63169;
