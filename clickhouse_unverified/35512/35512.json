{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 35512,
  "instance_id": "ClickHouse__ClickHouse-35512",
  "issue_numbers": [
    "35505"
  ],
  "base_commit": "71fb04ea4ad17432baba7934a10217f5f6a1bde3",
  "patch": "diff --git a/src/Interpreters/InterpreterSelectQuery.cpp b/src/Interpreters/InterpreterSelectQuery.cpp\nindex ce0929f9c6e8..042cc41ef541 100644\n--- a/src/Interpreters/InterpreterSelectQuery.cpp\n+++ b/src/Interpreters/InterpreterSelectQuery.cpp\n@@ -359,6 +359,7 @@ InterpreterSelectQuery::InterpreterSelectQuery(\n             table_lock.reset();\n             table_id = StorageID::createEmpty();\n             metadata_snapshot = nullptr;\n+            storage_snapshot = nullptr;\n         }\n     }\n \n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02242_optimize_to_subcolumns_no_storage.reference b/tests/queries/0_stateless/02242_optimize_to_subcolumns_no_storage.reference\nnew file mode 100644\nindex 000000000000..0cfbf08886fc\n--- /dev/null\n+++ b/tests/queries/0_stateless/02242_optimize_to_subcolumns_no_storage.reference\n@@ -0,0 +1,1 @@\n+2\ndiff --git a/tests/queries/0_stateless/02242_optimize_to_subcolumns_no_storage.sql b/tests/queries/0_stateless/02242_optimize_to_subcolumns_no_storage.sql\nnew file mode 100644\nindex 000000000000..e6e4663c5aaf\n--- /dev/null\n+++ b/tests/queries/0_stateless/02242_optimize_to_subcolumns_no_storage.sql\n@@ -0,0 +1,3 @@\n+SET optimize_functions_to_subcolumns = 1;\n+SELECT count(*) FROM numbers(2) AS n1, numbers(3) AS n2, numbers(4) AS n3\n+WHERE (n1.number = n2.number) AND (n2.number = n3.number);\n",
  "problem_statement": "The fuzzer error\n(you don't have to strictly follow this form)\r\n\r\n**Describe the bug**\r\nA link to the report: https://s3.amazonaws.com/clickhouse-test-reports/35466/d81c58b5d9be45ac69c3859b5cbe97080711f6d9/fuzzer_astfuzzerubsan,actions//report.html\r\nThe commit: https://github.com/ClickHouse/ClickHouse/commit/d81c58b5d9be45ac69c3859b5cbe97080711f6d9\n",
  "hints_text": "",
  "created_at": "2022-03-22T23:51:52Z"
}