{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 79338,
  "instance_id": "ClickHouse__ClickHouse-79338",
  "issue_numbers": [
    "79334"
  ],
  "base_commit": "75ec9df90e1fd7917791de43ffb51f9ad95e8582",
  "patch": "diff --git a/src/Formats/PrettyFormatHelpers.cpp b/src/Formats/PrettyFormatHelpers.cpp\nindex a56e0d5ca6da..acd9ce000870 100644\n--- a/src/Formats/PrettyFormatHelpers.cpp\n+++ b/src/Formats/PrettyFormatHelpers.cpp\n@@ -5,7 +5,6 @@\n #include <Processors/Chunk.h>\n #include <Common/formatReadable.h>\n #include <Common/UTF8Helpers.h>\n-#include <base/find_symbols.h>\n \n \n static constexpr const char * GRAY_COLOR = \"\\033[90m\";\n@@ -29,9 +28,12 @@ void writeReadableNumberTip(WriteBuffer & out, const IColumn & column, size_t ro\n         return;\n \n     auto value = column.getFloat64(row);\n+    auto abs_value = abs(value);\n     auto threshold = settings.pretty.single_large_number_tip_threshold;\n \n-    if (threshold && isFinite(value) && abs(value) > threshold)\n+    if (threshold && isFinite(value) && abs_value > threshold\n+        /// Most (~99.5%) of 64-bit hash values are in this range, and it is not necessarily to highlight them:\n+        && !(abs_value > 1e17 && abs_value < 1.844675e19))\n     {\n         if (color)\n             writeCString(GRAY_COLOR, out);\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/03268_vertical_pretty_numbers.reference b/tests/queries/0_stateless/03268_vertical_pretty_numbers.reference\nindex 62d0a3af7d6a..8205599142a2 100644\n--- a/tests/queries/0_stateless/03268_vertical_pretty_numbers.reference\n+++ b/tests/queries/0_stateless/03268_vertical_pretty_numbers.reference\n@@ -109,13 +109,13 @@ Row 18:\n Row 19:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \u001b[1mexp2(number):\u001b[0m           26\u001b[4m2\u001b[0m144\u001b[90m -- 262.14 thousand\u001b[0m\n-\u001b[1mexp10(number):\u001b[0m          \u001b[4m1\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m000\u001b[90m -- 1.00 quintillion\u001b[0m\n+\u001b[1mexp10(number):\u001b[0m          \u001b[4m1\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m000\n \u001b[1mconcat('test', number):\u001b[0m test18\n \n Row 20:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \u001b[1mexp2(number):\u001b[0m           52\u001b[4m4\u001b[0m288\u001b[90m -- 524.29 thousand\u001b[0m\n-\u001b[1mexp10(number):\u001b[0m          1\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m000\u001b[90m -- 10.00 quintillion\u001b[0m\n+\u001b[1mexp10(number):\u001b[0m          1\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m00\u001b[4m0\u001b[0m000\n \u001b[1mconcat('test', number):\u001b[0m test19\n \n Row 21:\n@@ -342,43 +342,43 @@ Row 57:\n \n Row 58:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           14\u001b[4m4\u001b[0m11\u001b[4m5\u001b[0m18\u001b[4m8\u001b[0m07\u001b[4m5\u001b[0m85\u001b[4m5\u001b[0m870\u001b[90m -- 144.12 quadrillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           14\u001b[4m4\u001b[0m11\u001b[4m5\u001b[0m18\u001b[4m8\u001b[0m07\u001b[4m5\u001b[0m85\u001b[4m5\u001b[0m870\n \u001b[1mexp10(number):\u001b[0m          1e57\u001b[90m -- 1.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test57\n \n Row 59:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           28\u001b[4m8\u001b[0m23\u001b[4m0\u001b[0m37\u001b[4m6\u001b[0m15\u001b[4m1\u001b[0m71\u001b[4m1\u001b[0m740\u001b[90m -- 288.23 quadrillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           28\u001b[4m8\u001b[0m23\u001b[4m0\u001b[0m37\u001b[4m6\u001b[0m15\u001b[4m1\u001b[0m71\u001b[4m1\u001b[0m740\n \u001b[1mexp10(number):\u001b[0m          1e58\u001b[90m -- 10.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test58\n \n Row 60:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           57\u001b[4m6\u001b[0m46\u001b[4m0\u001b[0m75\u001b[4m2\u001b[0m30\u001b[4m3\u001b[0m42\u001b[4m3\u001b[0m500\u001b[90m -- 576.46 quadrillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           57\u001b[4m6\u001b[0m46\u001b[4m0\u001b[0m75\u001b[4m2\u001b[0m30\u001b[4m3\u001b[0m42\u001b[4m3\u001b[0m500\n \u001b[1mexp10(number):\u001b[0m          1e59\u001b[90m -- 100.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test59\n \n Row 61:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           \u001b[4m1\u001b[0m15\u001b[4m2\u001b[0m92\u001b[4m1\u001b[0m50\u001b[4m4\u001b[0m60\u001b[4m6\u001b[0m84\u001b[4m7\u001b[0m000\u001b[90m -- 1.15 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           \u001b[4m1\u001b[0m15\u001b[4m2\u001b[0m92\u001b[4m1\u001b[0m50\u001b[4m4\u001b[0m60\u001b[4m6\u001b[0m84\u001b[4m7\u001b[0m000\n \u001b[1mexp10(number):\u001b[0m          1e60\u001b[90m -- 1000.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test60\n \n Row 62:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           \u001b[4m2\u001b[0m30\u001b[4m5\u001b[0m84\u001b[4m3\u001b[0m00\u001b[4m9\u001b[0m21\u001b[4m3\u001b[0m69\u001b[4m4\u001b[0m000\u001b[90m -- 2.31 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           \u001b[4m2\u001b[0m30\u001b[4m5\u001b[0m84\u001b[4m3\u001b[0m00\u001b[4m9\u001b[0m21\u001b[4m3\u001b[0m69\u001b[4m4\u001b[0m000\n \u001b[1mexp10(number):\u001b[0m          1e61\u001b[90m -- 10.00 novemdecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test61\n \n Row 63:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           \u001b[4m4\u001b[0m61\u001b[4m1\u001b[0m68\u001b[4m6\u001b[0m01\u001b[4m8\u001b[0m42\u001b[4m7\u001b[0m38\u001b[4m8\u001b[0m000\u001b[90m -- 4.61 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           \u001b[4m4\u001b[0m61\u001b[4m1\u001b[0m68\u001b[4m6\u001b[0m01\u001b[4m8\u001b[0m42\u001b[4m7\u001b[0m38\u001b[4m8\u001b[0m000\n \u001b[1mexp10(number):\u001b[0m          1e62\u001b[90m -- 100.00 novemdecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test62\n \n Row 64:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           \u001b[4m9\u001b[0m22\u001b[4m3\u001b[0m37\u001b[4m2\u001b[0m03\u001b[4m6\u001b[0m85\u001b[4m4\u001b[0m77\u001b[4m6\u001b[0m000\u001b[90m -- 9.22 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           \u001b[4m9\u001b[0m22\u001b[4m3\u001b[0m37\u001b[4m2\u001b[0m03\u001b[4m6\u001b[0m85\u001b[4m4\u001b[0m77\u001b[4m6\u001b[0m000\n \u001b[1mexp10(number):\u001b[0m          1e63\u001b[90m -- 1.00 vigintillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test63\n Row 1:\n@@ -492,13 +492,13 @@ concat('test', number): test17\n Row 19:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n exp2(number):           262144 -- 262.14 thousand\n-exp10(number):          1000000000000000000 -- 1.00 quintillion\n+exp10(number):          1000000000000000000\n concat('test', number): test18\n \n Row 20:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n exp2(number):           524288 -- 524.29 thousand\n-exp10(number):          10000000000000000000 -- 10.00 quintillion\n+exp10(number):          10000000000000000000\n concat('test', number): test19\n \n Row 21:\n@@ -725,43 +725,43 @@ concat('test', number): test56\n \n Row 58:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           144115188075855870 -- 144.12 quadrillion\n+exp2(number):           144115188075855870\n exp10(number):          1e57 -- 1.00 octodecillion\n concat('test', number): test57\n \n Row 59:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           288230376151711740 -- 288.23 quadrillion\n+exp2(number):           288230376151711740\n exp10(number):          1e58 -- 10.00 octodecillion\n concat('test', number): test58\n \n Row 60:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           576460752303423500 -- 576.46 quadrillion\n+exp2(number):           576460752303423500\n exp10(number):          1e59 -- 100.00 octodecillion\n concat('test', number): test59\n \n Row 61:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           1152921504606847000 -- 1.15 quintillion\n+exp2(number):           1152921504606847000\n exp10(number):          1e60 -- 1000.00 octodecillion\n concat('test', number): test60\n \n Row 62:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           2305843009213694000 -- 2.31 quintillion\n+exp2(number):           2305843009213694000\n exp10(number):          1e61 -- 10.00 novemdecillion\n concat('test', number): test61\n \n Row 63:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           4611686018427388000 -- 4.61 quintillion\n+exp2(number):           4611686018427388000\n exp10(number):          1e62 -- 100.00 novemdecillion\n concat('test', number): test62\n \n Row 64:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-exp2(number):           9223372036854776000 -- 9.22 quintillion\n+exp2(number):           9223372036854776000\n exp10(number):          1e63 -- 1.00 vigintillion\n concat('test', number): test63\n Row 1:\n@@ -875,13 +875,13 @@ Row 18:\n Row 19:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \u001b[1mexp2(number):\u001b[0m           262144\u001b[90m -- 262.14 thousand\u001b[0m\n-\u001b[1mexp10(number):\u001b[0m          1000000000000000000\u001b[90m -- 1.00 quintillion\u001b[0m\n+\u001b[1mexp10(number):\u001b[0m          1000000000000000000\n \u001b[1mconcat('test', number):\u001b[0m test18\n \n Row 20:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \u001b[1mexp2(number):\u001b[0m           524288\u001b[90m -- 524.29 thousand\u001b[0m\n-\u001b[1mexp10(number):\u001b[0m          10000000000000000000\u001b[90m -- 10.00 quintillion\u001b[0m\n+\u001b[1mexp10(number):\u001b[0m          10000000000000000000\n \u001b[1mconcat('test', number):\u001b[0m test19\n \n Row 21:\n@@ -1108,43 +1108,43 @@ Row 57:\n \n Row 58:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           144115188075855870\u001b[90m -- 144.12 quadrillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           144115188075855870\n \u001b[1mexp10(number):\u001b[0m          1e57\u001b[90m -- 1.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test57\n \n Row 59:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           288230376151711740\u001b[90m -- 288.23 quadrillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           288230376151711740\n \u001b[1mexp10(number):\u001b[0m          1e58\u001b[90m -- 10.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test58\n \n Row 60:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           576460752303423500\u001b[90m -- 576.46 quadrillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           576460752303423500\n \u001b[1mexp10(number):\u001b[0m          1e59\u001b[90m -- 100.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test59\n \n Row 61:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           1152921504606847000\u001b[90m -- 1.15 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           1152921504606847000\n \u001b[1mexp10(number):\u001b[0m          1e60\u001b[90m -- 1000.00 octodecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test60\n \n Row 62:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           2305843009213694000\u001b[90m -- 2.31 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           2305843009213694000\n \u001b[1mexp10(number):\u001b[0m          1e61\u001b[90m -- 10.00 novemdecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test61\n \n Row 63:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           4611686018427388000\u001b[90m -- 4.61 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           4611686018427388000\n \u001b[1mexp10(number):\u001b[0m          1e62\u001b[90m -- 100.00 novemdecillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test62\n \n Row 64:\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\n-\u001b[1mexp2(number):\u001b[0m           9223372036854776000\u001b[90m -- 9.22 quintillion\u001b[0m\n+\u001b[1mexp2(number):\u001b[0m           9223372036854776000\n \u001b[1mexp10(number):\u001b[0m          1e63\u001b[90m -- 1.00 vigintillion\u001b[0m\n \u001b[1mconcat('test', number):\u001b[0m test63\n Row 1:\ndiff --git a/tests/queries/0_stateless/03415_dont_highlight_probable_hashes.reference b/tests/queries/0_stateless/03415_dont_highlight_probable_hashes.reference\nnew file mode 100644\nindex 000000000000..ff45e11ef3c8\n--- /dev/null\n+++ b/tests/queries/0_stateless/03415_dont_highlight_probable_hashes.reference\n@@ -0,0 +1,10 @@\n+   \u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n+   \u2503       cityHash64('') \u2503\n+   \u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n+1. \u2502 11160318154034397263 \u2502\n+   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+   \u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n+   \u2503 123456789 \u2503\n+   \u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n+1. \u2502 123456789 \u2502 -- 123.46 million\n+   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\ndiff --git a/tests/queries/0_stateless/03415_dont_highlight_probable_hashes.sql b/tests/queries/0_stateless/03415_dont_highlight_probable_hashes.sql\nnew file mode 100644\nindex 000000000000..fd5b5283fe57\n--- /dev/null\n+++ b/tests/queries/0_stateless/03415_dont_highlight_probable_hashes.sql\n@@ -0,0 +1,2 @@\n+SELECT cityHash64('') FORMAT Pretty;\n+SELECT 123456789 FORMAT Pretty;\n",
  "problem_statement": "Do not show quintillions\n### Company or project name\n\nClickHouse\n\n### Describe the unexpected behaviour\n\n```\nRow 5:\n\u2500\u2500\u2500\u2500\u2500\u2500\nnormalized_query_hash: 16850821967432020467 -- 16.85 quintillion\nquery:                 SELECT\n    toStartOfMonth(bluesky_ts) AS month,\n    count() AS docs\nFROM bluesky.bluesky\nGROUP BY month\nORDER BY month DESC\nLIMIT 10\nSETTINGS enable_parallel_replicas=1 \nFORMAT JSON\ncount():               243\n```\n\nQuintillions are often just 64-bit hashes. It is pointless to describe them that way.\n\n### How to reproduce\n\n.\n\n### Expected behavior\n\n_No response_\n\n### Error message and/or stacktrace\n\n_No response_\n\n### Additional context\n\n_No response_\n",
  "hints_text": "",
  "created_at": "2025-04-19T00:55:52Z"
}