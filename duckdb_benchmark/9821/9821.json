{
  "repo": "duckdb/duckdb",
  "pull_number": 9821,
  "instance_id": "duckdb__duckdb-9821",
  "issue_numbers": [
    "9732"
  ],
  "base_commit": "2d710dec0c1625298ada10a65d1cdc74a8d5225a",
  "patch": "diff --git a/src/planner/binder/expression/bind_unnest_expression.cpp b/src/planner/binder/expression/bind_unnest_expression.cpp\nindex 03c3dccd242e..6ae23c95ac4e 100644\n--- a/src/planner/binder/expression/bind_unnest_expression.cpp\n+++ b/src/planner/binder/expression/bind_unnest_expression.cpp\n@@ -137,6 +137,7 @@ BindResult SelectBinder::BindUnnest(FunctionExpression &function, idx_t depth, b\n \t\t}\n \t}\n \tif (struct_unnests > 0 && !root_expression) {\n+\t\tchild = std::move(unnest_expr);\n \t\treturn BindResult(binder.FormatError(\n \t\t    function, \"UNNEST() on a struct column can only be applied as the root element of a SELECT expression\"));\n \t}\n",
  "test_patch": "diff --git a/test/sql/function/list/lambdas/incorrect.test b/test/sql/function/list/lambdas/incorrect.test\nindex 799db3e396b4..6fde0eb40686 100644\n--- a/test/sql/function/list/lambdas/incorrect.test\n+++ b/test/sql/function/list/lambdas/incorrect.test\n@@ -192,3 +192,13 @@ CREATE TABLE unit2(\n );\n ----\n Not implemented Error: Lambda functions are currently not supported in generated columns.\n+\n+# issue 9732\n+\n+statement ok\n+CREATE TABLE tbl AS SELECT {'a': 10} AS s;\n+\n+statement error\n+SELECT list_transform(UNNEST(s), x -> UNNEST(x)) FROM tbl;\n+----\n+failed to bind function\n\\ No newline at end of file\n",
  "problem_statement": "Triggered an INTERNAL Error: BoundExpression::GetExpression called on empty bound expression\n### What happens?\n\nWhen trying to query a JSON file and unnesting its contents, I encountered the above error message:\r\n\r\n```sql\r\nselect list_transform(unnest(Item), x -> unnest(x)) from 'https://gist.githubusercontent.com/tobilg/9d7cb9422f3d65fd93fca23e93cb22dc/raw/0df6fbeddad395fb67dc0eac9c87fab6d55e78a3/ddb_export.json';\r\n```\r\n\r\nError message:\r\n`Error: INTERNAL Error: BoundExpression::GetExpression called on empty bound expression`\r\n\r\nAfter that, when I try to run another query in the CLI, e.g. `select 1;`, I see the following error:\r\n\r\n`Error: FATAL Error: Failed: database has been invalidated because of a previous fatal error. The database must be restarted prior to being used again.`\r\n\r\nand have to restart the CLI to continue.\n\n### To Reproduce\n\nSee the queries above.\n\n### OS:\n\nMacOS\n\n### DuckDB Version:\n\n0.9.2\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nTobi M.\n\n### Affiliation:\n\nnone\n\n### Have you tried this on the latest `main` branch?\n\nI have tested with a release build (and could not test with a main build)\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] Yes, I have\n",
  "hints_text": "",
  "created_at": "2023-11-27T18:36:30Z",
  "modified_files": [
    "src/planner/binder/expression/bind_unnest_expression.cpp"
  ],
  "modified_test_files": [
    "test/sql/function/list/lambdas/incorrect.test"
  ]
}