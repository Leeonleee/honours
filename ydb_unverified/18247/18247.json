{
  "repo": "ydb-platform/ydb",
  "pull_number": 18247,
  "instance_id": "ydb-platform__ydb-18247",
  "issue_numbers": [
    "16475"
  ],
  "base_commit": "d456fe92941dee155af25eab54c0e79fc3785463",
  "patch": "diff --git a/ydb/core/kqp/opt/kqp_query_plan.cpp b/ydb/core/kqp/opt/kqp_query_plan.cpp\nindex 86152bcdf838..9b47a4ae6484 100644\n--- a/ydb/core/kqp/opt/kqp_query_plan.cpp\n+++ b/ydb/core/kqp/opt/kqp_query_plan.cpp\n@@ -244,8 +244,8 @@ class TxPlanSerializer {\n                 planNode.TypeName = \"Effect\";\n                 Visit(TExprBase(stage), planNode);\n             } else if (stageBase.Outputs()) { // Sink\n+                AFL_ENSURE(stageBase.Outputs().Cast().Size() == 1);\n                 auto& planNode = AddPlanNode(phaseNode);\n-                planNode.TypeName = \"Sink\";\n                 Visit(TExprBase(stage), planNode);\n             }\n         }\n@@ -960,7 +960,8 @@ class TxPlanSerializer {\n             if (auto outputs = expr.Cast<TDqStageBase>().Outputs()) {\n                 for (auto output : outputs.Cast()) {\n                     if (auto sink = output.Maybe<TDqSink>()) {\n-                        Visit(sink.Cast(), expr.Cast<TDqStageBase>(), stagePlanNode);\n+                        AFL_ENSURE(outputs.Cast().Size() == 1);\n+                        Visit(sink.Cast(), expr.Cast<TDqStageBase>(), planNode);\n                     }\n                 }\n             }\ndiff --git a/ydb/core/kqp/ut/federated_query/s3/kqp_s3_plan_ut.cpp b/ydb/core/kqp/ut/federated_query/s3/kqp_s3_plan_ut.cpp\nindex c839b0f63b88..2ec1aae6f9af 100644\n--- a/ydb/core/kqp/ut/federated_query/s3/kqp_s3_plan_ut.cpp\n+++ b/ydb/core/kqp/ut/federated_query/s3/kqp_s3_plan_ut.cpp\n@@ -143,9 +143,12 @@ Y_UNIT_TEST_SUITE(KqpS3PlanTest) {\n         UNIT_ASSERT(NJson::ReadJsonTree(*queryResult.GetStats()->GetPlan(), &plan));\n \n         const auto& writeStagePlan = plan[\"Plan\"][\"Plans\"][0][\"Plans\"][0];\n-        UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Node Type\"].GetStringSafe(), \"Stage-Sink\");\n-        UNIT_ASSERT(writeStagePlan[\"Operators\"].GetArraySafe().size() >= 1);\n-        const auto& sinkOp = writeStagePlan[\"Operators\"].GetArraySafe()[0];\n+        UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Node Type\"].GetStringSafe(), \"Stage\");\n+\n+        const auto& sinkPlan = plan[\"Plan\"][\"Plans\"][0];\n+        UNIT_ASSERT_VALUES_EQUAL(sinkPlan[\"Node Type\"].GetStringSafe(), \"Sink\");\n+        UNIT_ASSERT(sinkPlan[\"Operators\"].GetArraySafe().size() >= 1);\n+        const auto& sinkOp = sinkPlan[\"Operators\"].GetArraySafe()[0];\n         UNIT_ASSERT_VALUES_EQUAL(sinkOp[\"ExternalDataSource\"].GetStringSafe(), \"write_data_source\");\n         UNIT_ASSERT_VALUES_EQUAL(sinkOp[\"Compression\"].GetStringSafe(), \"gzip\");\n \n@@ -218,9 +221,16 @@ Y_UNIT_TEST_SUITE(KqpS3PlanTest) {\n         UNIT_ASSERT(NJson::ReadJsonTree(*queryResult.GetStats()->GetPlan(), &plan));\n \n         const auto& writeStagePlan = plan[\"Plan\"][\"Plans\"][0][\"Plans\"][0];\n-        UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Node Type\"].GetStringSafe(), \"Stage-Sink\");\n+        UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Node Type\"].GetStringSafe(), \"Stage\");\n         UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Stats\"][\"Tasks\"], 1);\n \n+        const auto& sinkPlan = plan[\"Plan\"][\"Plans\"][0];\n+        UNIT_ASSERT_VALUES_EQUAL(sinkPlan[\"Node Type\"].GetStringSafe(), \"Sink\");\n+        UNIT_ASSERT(sinkPlan[\"Operators\"].GetArraySafe().size() >= 1);\n+        const auto& sinkOp = sinkPlan[\"Operators\"].GetArraySafe()[0];\n+        UNIT_ASSERT_VALUES_EQUAL(sinkOp[\"Name\"].GetStringSafe(), \"FillTable\");\n+        UNIT_ASSERT_VALUES_EQUAL(sinkOp[\"Table\"].GetStringSafe(), \"result_table\");\n+\n         const auto& readStagePlan = plan[\"Plan\"][\"Plans\"][0][\"Plans\"][0][\"Plans\"][0][\"Plans\"][0];\n         UNIT_ASSERT_VALUES_EQUAL(readStagePlan[\"Node Type\"].GetStringSafe(), \"Stage\");\n         UNIT_ASSERT_VALUES_EQUAL(readStagePlan[\"Stats\"][\"Tasks\"], 1);\n@@ -290,9 +300,16 @@ Y_UNIT_TEST_SUITE(KqpS3PlanTest) {\n         UNIT_ASSERT(NJson::ReadJsonTree(*queryResult.GetStats()->GetPlan(), &plan));\n \n         const auto& writeStagePlan = plan[\"Plan\"][\"Plans\"][0][\"Plans\"][0];\n-        UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Node Type\"].GetStringSafe(), \"Stage-Sink\");\n+        UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Node Type\"].GetStringSafe(), \"Stage\");\n         UNIT_ASSERT_VALUES_EQUAL(writeStagePlan[\"Stats\"][\"Tasks\"], 42);\n \n+        const auto& sinkPlan = plan[\"Plan\"][\"Plans\"][0];\n+        UNIT_ASSERT_VALUES_EQUAL(sinkPlan[\"Node Type\"].GetStringSafe(), \"Sink\");\n+        UNIT_ASSERT(sinkPlan[\"Operators\"].GetArraySafe().size() >= 1);\n+        const auto& sinkOp = sinkPlan[\"Operators\"].GetArraySafe()[0];\n+        UNIT_ASSERT_VALUES_EQUAL(sinkOp[\"ExternalDataSource\"].GetStringSafe(), \"insert_data_sink\");\n+        UNIT_ASSERT_VALUES_EQUAL(sinkOp[\"Extension\"].GetStringSafe(), \".parquet\");\n+\n         const auto& readStagePlan = plan[\"Plan\"][\"Plans\"][0][\"Plans\"][0][\"Plans\"][0][\"Plans\"][0];\n         UNIT_ASSERT_VALUES_EQUAL(readStagePlan[\"Node Type\"].GetStringSafe(), \"TableFullScan\");\n         UNIT_ASSERT_VALUES_EQUAL(readStagePlan[\"Stats\"][\"Tasks\"], 42);\ndiff --git a/ydb/core/kqp/ut/query/kqp_stats_ut.cpp b/ydb/core/kqp/ut/query/kqp_stats_ut.cpp\nindex a610a1005b33..ee19d2046fcd 100644\n--- a/ydb/core/kqp/ut/query/kqp_stats_ut.cpp\n+++ b/ydb/core/kqp/ut/query/kqp_stats_ut.cpp\n@@ -279,7 +279,7 @@ Y_UNIT_TEST_TWIN(DataQueryWithEffects, UseSink) {\n     NJson::ReadJsonTree(result.GetQueryPlan(), &plan, true);\n \n     if (UseSink) {\n-        auto node = FindPlanNodeByKv(plan, \"Node Type\", \"Stage-Sink\");\n+        auto node = FindPlanNodeByKv(plan, \"Node Type\", \"Stage\");\n         UNIT_ASSERT_EQUAL(node.GetMap().at(\"Stats\").GetMapSafe().at(\"Tasks\").GetIntegerSafe(), 1);\n     } else {\n         auto node = FindPlanNodeByKv(plan, \"Node Type\", \"Upsert-ConstantExpr\");\n",
  "test_patch": "diff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_explain.script-script_/explain.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_explain.script-script_/explain.script.plan\nindex 0faa53fd98e5..581652f1a138 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_explain.script-script_/explain.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_explain.script-script_/explain.script.plan\n@@ -520,29 +520,31 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Replace\",\n+                                \"Path\": \"/local/base_explain_script_script/ScriptingTest\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_explain_script_script/ScriptingTest\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 2,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"ConstantExpr-Sink\",\n+                                \"Node Type\": \"ConstantExpr\",\n                                 \"Operators\": [\n                                     {\n                                         \"Inputs\": [],\n                                         \"Iterator\": \"[{Key: 3,Value: \\\"Three\\\"},{Key: 4,Value: \\\"Four\\\"}]\",\n                                         \"Name\": \"Iterator\"\n-                                    },\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Replace\",\n-                                        \"Path\": \"/local/base_explain_script_script/ScriptingTest\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_explain_script_script/ScriptingTest\"\n                                     }\n                                 ],\n-                                \"PlanNodeId\": 1,\n-                                \"Tables\": [\n-                                    \"base_explain_script_script/ScriptingTest\"\n-                                ]\n+                                \"PlanNodeId\": 1\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_explain_script_script/ScriptingTest\"\n                         ]\n                     }\n                 ],\n@@ -572,29 +574,31 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Replace\",\n+                                \"Path\": \"/local/base_explain_script_script/ScriptingTest\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_explain_script_script/ScriptingTest\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 2,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"ConstantExpr-Sink\",\n+                                \"Node Type\": \"ConstantExpr\",\n                                 \"Operators\": [\n                                     {\n                                         \"Inputs\": [],\n                                         \"Iterator\": \"[{Key: 1,Value: \\\"One\\\"},{Key: 2,Value: \\\"Two\\\"}]\",\n                                         \"Name\": \"Iterator\"\n-                                    },\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Replace\",\n-                                        \"Path\": \"/local/base_explain_script_script/ScriptingTest\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_explain_script_script/ScriptingTest\"\n                                     }\n                                 ],\n-                                \"PlanNodeId\": 1,\n-                                \"Tables\": [\n-                                    \"base_explain_script_script/ScriptingTest\"\n-                                ]\n+                                \"PlanNodeId\": 1\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_explain_script_script/ScriptingTest\"\n                         ]\n                     }\n                 ],\ndiff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_join_group_by_lookup.script-script_/join_group_by_lookup.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_join_group_by_lookup.script-script_/join_group_by_lookup.script.plan\nindex 67e5fb9fa820..d24bb2c08af4 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_join_group_by_lookup.script-script_/join_group_by_lookup.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_join_group_by_lookup.script-script_/join_group_by_lookup.script.plan\n@@ -282,29 +282,31 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Replace\",\n+                                \"Path\": \"/local/base_join_group_by_lookup_script_script/Temp\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_join_group_by_lookup_script_script/Temp\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 2,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"ConstantExpr-Sink\",\n+                                \"Node Type\": \"ConstantExpr\",\n                                 \"Operators\": [\n                                     {\n                                         \"Inputs\": [],\n                                         \"Iterator\": \"[{Group: 1,Value: \\\"One\\\"},{Group: 3,Value: \\\"Three\\\"}]\",\n                                         \"Name\": \"Iterator\"\n-                                    },\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Replace\",\n-                                        \"Path\": \"/local/base_join_group_by_lookup_script_script/Temp\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_join_group_by_lookup_script_script/Temp\"\n                                     }\n                                 ],\n-                                \"PlanNodeId\": 1,\n-                                \"Tables\": [\n-                                    \"base_join_group_by_lookup_script_script/Temp\"\n-                                ]\n+                                \"PlanNodeId\": 1\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_join_group_by_lookup_script_script/Temp\"\n                         ]\n                     }\n                 ],\ndiff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_simple_ct.script-script_/simple_ct.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_simple_ct.script-script_/simple_ct.script.plan\nindex 10512bcaaa79..a767440d0255 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_simple_ct.script-script_/simple_ct.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_simple_ct.script-script_/simple_ct.script.plan\n@@ -11,29 +11,31 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Upsert\",\n+                                \"Path\": \"/local/base_simple_ct_script_script/Questions\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_simple_ct_script_script/Questions\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 2,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"ConstantExpr-Sink\",\n+                                \"Node Type\": \"ConstantExpr\",\n                                 \"Operators\": [\n                                     {\n                                         \"Inputs\": [],\n                                         \"Iterator\": \"[{idx: 1,text: \\\"to do or not to do\\\"}]\",\n                                         \"Name\": \"Iterator\"\n-                                    },\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Upsert\",\n-                                        \"Path\": \"/local/base_simple_ct_script_script/Questions\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_simple_ct_script_script/Questions\"\n                                     }\n                                 ],\n-                                \"PlanNodeId\": 1,\n-                                \"Tables\": [\n-                                    \"base_simple_ct_script_script/Questions\"\n-                                ]\n+                                \"PlanNodeId\": 1\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_simple_ct_script_script/Questions\"\n                         ]\n                     }\n                 ],\ndiff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_table_types.script-script_/table_types.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_table_types.script-script_/table_types.script.plan\nindex 4f05136f0ad5..56d733d6119f 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_table_types.script-script_/table_types.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_table_types.script-script_/table_types.script.plan\n@@ -136,29 +136,31 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Replace\",\n+                                \"Path\": \"/local/base_table_types_script_script/TableTypes\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_table_types_script_script/TableTypes\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 2,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"ConstantExpr-Sink\",\n+                                \"Node Type\": \"ConstantExpr\",\n                                 \"Operators\": [\n                                     {\n                                         \"Inputs\": [],\n                                         \"Iterator\": \"[{Key: \\\"Key\\\",Value01: \\\"true\\\",Value02: 1,Value03: -1,Value04: 2,Value05: -2,Value06: 3,Value07: \\\"4.5\\\",Value08: Minus,Value09: \\\"3.14\\\",Value10: DyNumber,Value21: \\\"\\\\u041F\\\\u0440\\\\u0438\\\\u0432\\\\u0435\\\\u0442\\\",Value22: \\\"{\\\\\\\"name\\\\\\\": \\\\\\\"George\\\\\\\", \\\\\\\"age\\\\\\\": 23}\\\",Value23: JsonDocument,Value24: \\\"{a=1; b=2}\\\",Value31: Apply,Value32: Apply,Value33: Apply,Value34: Apply}]\",\n                                         \"Name\": \"Iterator\"\n-                                    },\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Replace\",\n-                                        \"Path\": \"/local/base_table_types_script_script/TableTypes\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_table_types_script_script/TableTypes\"\n                                     }\n                                 ],\n-                                \"PlanNodeId\": 1,\n-                                \"Tables\": [\n-                                    \"base_table_types_script_script/TableTypes\"\n-                                ]\n+                                \"PlanNodeId\": 1\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_table_types_script_script/TableTypes\"\n                         ]\n                     }\n                 ],\ndiff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage.script-script_/write_multi_usage.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage.script-script_/write_multi_usage.script.plan\nindex d47da6224a7e..9fa06e2b486e 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage.script-script_/write_multi_usage.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage.script-script_/write_multi_usage.script.plan\n@@ -217,19 +217,19 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Upsert\",\n+                                \"Path\": \"/local/base_write_multi_usage_script_script/Temp\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_write_multi_usage_script_script/Temp\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 7,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"Stage-Sink\",\n-                                \"Operators\": [\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Upsert\",\n-                                        \"Path\": \"/local/base_write_multi_usage_script_script/Temp\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_write_multi_usage_script_script/Temp\"\n-                                    }\n-                                ],\n+                                \"Node Type\": \"Stage\",\n                                 \"PlanNodeId\": 6,\n                                 \"Plans\": [\n                                     {\n@@ -268,38 +268,40 @@\n                                             }\n                                         ]\n                                     }\n-                                ],\n-                                \"Tables\": [\n-                                    \"base_write_multi_usage_script_script/Temp\"\n                                 ]\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_write_multi_usage_script_script/Temp\"\n                         ]\n                     },\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Delete\",\n+                                \"Path\": \"/local/base_write_multi_usage_script_script/Input1\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_write_multi_usage_script_script/Input1\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 2,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"ConstantExpr-Sink\",\n+                                \"Node Type\": \"ConstantExpr\",\n                                 \"Operators\": [\n                                     {\n                                         \"Inputs\": [],\n                                         \"Iterator\": \"[{Group: 1,Name: ToString}]\",\n                                         \"Name\": \"Iterator\"\n-                                    },\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Delete\",\n-                                        \"Path\": \"/local/base_write_multi_usage_script_script/Input1\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_write_multi_usage_script_script/Input1\"\n                                     }\n                                 ],\n-                                \"PlanNodeId\": 1,\n-                                \"Tables\": [\n-                                    \"base_write_multi_usage_script_script/Input1\"\n-                                ]\n+                                \"PlanNodeId\": 1\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_write_multi_usage_script_script/Input1\"\n                         ]\n                     }\n                 ],\ndiff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage_key.script-script_/write_multi_usage_key.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage_key.script-script_/write_multi_usage_key.script.plan\nindex 073b8bb49d0b..2a522bf93955 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage_key.script-script_/write_multi_usage_key.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage_key.script-script_/write_multi_usage_key.script.plan\n@@ -105,19 +105,19 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Upsert\",\n+                                \"Path\": \"/local/base_write_multi_usage_key_script_script/Temp\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_write_multi_usage_key_script_script/Temp\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 5,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"Stage-Sink\",\n-                                \"Operators\": [\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Upsert\",\n-                                        \"Path\": \"/local/base_write_multi_usage_key_script_script/Temp\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_write_multi_usage_key_script_script/Temp\"\n-                                    }\n-                                ],\n+                                \"Node Type\": \"Stage\",\n                                 \"PlanNodeId\": 4,\n                                 \"Plans\": [\n                                     {\n@@ -169,11 +169,11 @@\n                                             }\n                                         ]\n                                     }\n-                                ],\n-                                \"Tables\": [\n-                                    \"base_write_multi_usage_key_script_script/Temp\"\n                                 ]\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_write_multi_usage_key_script_script/Temp\"\n                         ]\n                     }\n                 ],\ndiff --git a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_write_group_by.script-script_/write_write_group_by.script.plan b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_write_group_by.script-script_/write_write_group_by.script.plan\nindex 64e854f08dad..c0f56a9055ec 100644\n--- a/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_write_group_by.script-script_/write_write_group_by.script.plan\n+++ b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_write_group_by.script-script_/write_write_group_by.script.plan\n@@ -107,19 +107,19 @@\n                 \"Plans\": [\n                     {\n                         \"Node Type\": \"Sink\",\n+                        \"Operators\": [\n+                            {\n+                                \"Inputs\": [],\n+                                \"Name\": \"Upsert\",\n+                                \"Path\": \"/local/base_write_write_group_by_script_script/Temp\",\n+                                \"SinkType\": \"KqpTableSink\",\n+                                \"Table\": \"base_write_write_group_by_script_script/Temp\"\n+                            }\n+                        ],\n                         \"PlanNodeId\": 7,\n                         \"Plans\": [\n                             {\n-                                \"Node Type\": \"Stage-Sink\",\n-                                \"Operators\": [\n-                                    {\n-                                        \"Inputs\": [],\n-                                        \"Name\": \"Upsert\",\n-                                        \"Path\": \"/local/base_write_write_group_by_script_script/Temp\",\n-                                        \"SinkType\": \"KqpTableSink\",\n-                                        \"Table\": \"base_write_write_group_by_script_script/Temp\"\n-                                    }\n-                                ],\n+                                \"Node Type\": \"Stage\",\n                                 \"PlanNodeId\": 6,\n                                 \"Plans\": [\n                                     {\n@@ -200,11 +200,11 @@\n                                             }\n                                         ]\n                                     }\n-                                ],\n-                                \"Tables\": [\n-                                    \"base_write_write_group_by_script_script/Temp\"\n                                 ]\n                             }\n+                        ],\n+                        \"Tables\": [\n+                            \"base_write_write_group_by_script_script/Temp\"\n                         ]\n                     }\n                 ],\n",
  "problem_statement": "Improve sinks in UI (explain)\nShow sink information (table and type) in YDB UI (explain: computation graph).\n\n\nHow sink JSON looks\nhttps://github.com/ydb-platform/ydb/blob/38eb729cdac3ddaf06775f9bd400ec9ddcfaa31b/ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_explain.script-script_/explain.script.plan#L537\n\n\nAt current time sink nodes doesn't contain any info. Plan for query ```INSERT INTO new_order (NO_W_ID, NO_D_ID, NO_O_ID) VALUES (0, 0, 0)```  (```main``` branch)\n\n<img width=\"270\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/b2d418bf-eb5c-4c97-bfea-9c5a40a5ff16\" />\n\n\n",
  "hints_text": "Info is in the Iterator node. I didn't notice it. \nMay be move this info to the Sink node instead of the Iterator node?\n\npart of JSON plan\n```\n\"Plans\": [\n            {\n              \"Tables\": [\n                \"new_order\"\n              ],\n              \"PlanNodeId\": 1,\n              \"Operators\": [\n                {\n                  \"Inputs\": [],\n                  \"Iterator\": \"[{NO_D_ID: 0,NO_O_ID: 0,NO_W_ID: 0}]\",\n                  \"Name\": \"Iterator\"\n                },\n                {\n                  \"Inputs\": [],\n                  \"Path\": \"/Root/db1/new_order\",\n                  \"Name\": \"Insert\",\n                  \"SinkType\": \"KqpTableSink\",\n                  \"Table\": \"new_order\"\n                }\n              ],\n              \"Node Type\": \"ConstantExpr-Sink\"\n            }\n          ],\n```",
  "created_at": "2025-05-13T11:24:38Z",
  "modified_files": [
    "ydb/core/kqp/opt/kqp_query_plan.cpp",
    "ydb/core/kqp/ut/federated_query/s3/kqp_s3_plan_ut.cpp",
    "ydb/core/kqp/ut/query/kqp_stats_ut.cpp"
  ],
  "modified_test_files": [
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_explain.script-script_/explain.script.plan",
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_join_group_by_lookup.script-script_/join_group_by_lookup.script.plan",
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_simple_ct.script-script_/simple_ct.script.plan",
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_table_types.script-script_/table_types.script.plan",
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage.script-script_/write_multi_usage.script.plan",
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_multi_usage_key.script-script_/write_multi_usage_key.script.plan",
    "ydb/tests/functional/canonical/canondata/test_sql.TestCanonicalFolder1.test_case_write_write_group_by.script-script_/write_write_group_by.script.plan"
  ]
}