{
  "repo": "duckdb/duckdb",
  "pull_number": 9274,
  "instance_id": "duckdb__duckdb-9274",
  "issue_numbers": [
    "7880",
    "7880"
  ],
  "base_commit": "c9efe88f1421b376adb9beff07da6b3902b4d817",
  "patch": "diff --git a/src/planner/expression_binder/base_select_binder.cpp b/src/planner/expression_binder/base_select_binder.cpp\nindex 542bfa52625d..57cdf68684c4 100644\n--- a/src/planner/expression_binder/base_select_binder.cpp\n+++ b/src/planner/expression_binder/base_select_binder.cpp\n@@ -98,11 +98,8 @@ BindResult BaseSelectBinder::BindColumnRef(unique_ptr<ParsedExpression> &expr_pt\n \t\t\t\t                      \" This is not yet supported.\",\n \t\t\t\t                      colref.column_names[0]);\n \t\t\t}\n-\t\t\tauto result = BindResult(node.select_list[index]->Copy());\n-\t\t\tif (result.expression->type == ExpressionType::BOUND_COLUMN_REF) {\n-\t\t\t\tauto &result_expr = result.expression->Cast<BoundColumnRefExpression>();\n-\t\t\t\tresult_expr.depth = depth;\n-\t\t\t}\n+\t\t\tauto copied_expression = node.original_expressions[index]->Copy();\n+\t\t\tresult = BindExpression(copied_expression, depth, false);\n \t\t\treturn result;\n \t\t}\n \t}\n",
  "test_patch": "diff --git a/test/sql/binder/group_by_incremental_alias.test b/test/sql/binder/group_by_incremental_alias.test\nnew file mode 100644\nindex 000000000000..6efaf96cfeea\n--- /dev/null\n+++ b/test/sql/binder/group_by_incremental_alias.test\n@@ -0,0 +1,18 @@\n+# name: test/sql/binder/group_by_incremental_alias.test\n+# description: Issue #7880: Group By incremental alias issues\n+# group: [binder]\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+statement ok\n+create table my_functions as select 'my_name' as function_name;\n+\n+query II\n+select\n+    function_name as raw,\n+    replace(raw, '_', ' ') as prettier\n+from my_functions\n+group by all;\n+----\n+my_name\tmy name\n",
  "problem_statement": "Group By incremental alias issues\n### What happens?\n\nThere are two seemingly related issues:\r\n1. Group by All does not seem to work when incremental column aliases (reused aliases) are involved\r\n2. A group by with a column that is calculated using an incremental column alias fails\n\n### To Reproduce\n\n1. Group by all:\r\n```sql\r\nselect \r\n    function_name as raw,\r\n    replace(raw, '_', ' ') as prettier \r\nfrom duckdb_functions()\r\ngroup by all;\r\n```\r\n```\r\nError: INTERNAL Error: Failed to bind column reference \"raw\" [0.0] (bindings: [2.0])\r\n```\r\n\r\n2. A group by with a column that includes an incremental column alias\r\n\r\n```sql\r\nselect \r\n    function_name as raw,\r\n    replace(raw, '_', ' ') as prettier \r\nfrom duckdb_functions() \r\ngroup by \r\n    prettier,\r\n    function_name;\r\n```\r\n```\r\nError: Binder Error: Referenced column \"raw\" not found in FROM clause!\r\n```\r\n\r\nHowever, these queries succeed:\r\n\r\n```sql\r\nselect function_name as raw, replace(raw, '_', ' ') as prettier from duckdb_functions() group by function_name;\r\n\r\nselect function_name as raw, replace(raw, '_', ' ') as prettier from duckdb_functions() group by raw;\r\n```\n\n### OS:\n\nWindows 10\n\n### DuckDB Version:\n\n0.8.0 and latest nightly build\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nAlex Monahan\n\n### Affiliation:\n\nDuckDB Foundation\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\nGroup By incremental alias issues\n### What happens?\n\nThere are two seemingly related issues:\r\n1. Group by All does not seem to work when incremental column aliases (reused aliases) are involved\r\n2. A group by with a column that is calculated using an incremental column alias fails\n\n### To Reproduce\n\n1. Group by all:\r\n```sql\r\nselect \r\n    function_name as raw,\r\n    replace(raw, '_', ' ') as prettier \r\nfrom duckdb_functions()\r\ngroup by all;\r\n```\r\n```\r\nError: INTERNAL Error: Failed to bind column reference \"raw\" [0.0] (bindings: [2.0])\r\n```\r\n\r\n2. A group by with a column that includes an incremental column alias\r\n\r\n```sql\r\nselect \r\n    function_name as raw,\r\n    replace(raw, '_', ' ') as prettier \r\nfrom duckdb_functions() \r\ngroup by \r\n    prettier,\r\n    function_name;\r\n```\r\n```\r\nError: Binder Error: Referenced column \"raw\" not found in FROM clause!\r\n```\r\n\r\nHowever, these queries succeed:\r\n\r\n```sql\r\nselect function_name as raw, replace(raw, '_', ' ') as prettier from duckdb_functions() group by function_name;\r\n\r\nselect function_name as raw, replace(raw, '_', ' ') as prettier from duckdb_functions() group by raw;\r\n```\n\n### OS:\n\nWindows 10\n\n### DuckDB Version:\n\n0.8.0 and latest nightly build\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nAlex Monahan\n\n### Affiliation:\n\nDuckDB Foundation\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "This issue is stale because it has been open 90 days with no activity. Remove stale label or comment or this will be closed in 30 days.\nThis issue is stale because it has been open 90 days with no activity. Remove stale label or comment or this will be closed in 30 days.",
  "created_at": "2023-10-09T11:51:41Z"
}