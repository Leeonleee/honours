{
  "repo": "duckdb/duckdb",
  "pull_number": 10243,
  "instance_id": "duckdb__duckdb-10243",
  "issue_numbers": [
    "10241"
  ],
  "base_commit": "f43eaf3ece3594a8bbdab84caa502ed74aa45226",
  "patch": "diff --git a/src/function/table/sniff_csv.cpp b/src/function/table/sniff_csv.cpp\nindex 3f83c3d3ede8..406f3309252a 100644\n--- a/src/function/table/sniff_csv.cpp\n+++ b/src/function/table/sniff_csv.cpp\n@@ -112,7 +112,7 @@ static void CSVSniffFunction(ClientContext &context, TableFunctionInput &data_p,\n \tconst CSVSniffFunctionData &data = data_p.bind_data->Cast<CSVSniffFunctionData>();\n \tauto &fs = duckdb::FileSystem::GetFileSystem(context);\n \n-\tif (fs.HasGlob(data.path)) {\n+\tif (data.path.rfind(\"http://\", 0) != 0 && data.path.rfind(\"https://\", 0) != 0 && fs.HasGlob(data.path)) {\n \t\tthrow NotImplementedException(\"sniff_csv does not operate on globs yet\");\n \t}\n \n",
  "test_patch": "diff --git a/test/sql/copy/csv/test_csv_remote.test b/test/sql/copy/csv/test_csv_remote.test\nindex 0966eeb69951..a05ba1606bca 100644\n--- a/test/sql/copy/csv/test_csv_remote.test\n+++ b/test/sql/copy/csv/test_csv_remote.test\n@@ -21,3 +21,12 @@ SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/duckdb/duckdb/mai\n query IIIIIIIIIIIIIII nosort lineitemcsv\n select * from read_csv_auto('https://raw.githubusercontent.com/duckdb/duckdb/main/test/sql/copy/csv/data/lineitem1k.tbl.gz');\n ----\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+# Test load from url with query string\n+query IIIIIIIIIII\n+FROM sniff_csv('https://github.com/duckdb/duckdb/raw/main/data/csv/customer.csv?v=1')\n+----\n+,\t\"\t\"\t\\n\t0\t0\t{'column00': 'BIGINT', 'column01': 'VARCHAR', 'column02': 'BIGINT', 'column03': 'BIGINT', 'column04': 'BIGINT', 'column05': 'BIGINT', 'column06': 'BIGINT', 'column07': 'VARCHAR', 'column08': 'VARCHAR', 'column09': 'VARCHAR', 'column10': 'VARCHAR', 'column11': 'BIGINT', 'column12': 'BIGINT', 'column13': 'BIGINT', 'column14': 'VARCHAR', 'column15': 'VARCHAR', 'column16': 'VARCHAR', 'column17': 'BIGINT'}\tNULL\tNULL\tNULL\tFROM read_csv('https://github.com/duckdb/duckdb/raw/main/data/csv/customer.csv?v=1', auto_detect=false, delim=',', quote='\"', escape='\"', new_line='\\n', skip=0, header=false, columns={'column00': 'BIGINT', 'column01': 'VARCHAR', 'column02': 'BIGINT', 'column03': 'BIGINT', 'column04': 'BIGINT', 'column05': 'BIGINT', 'column06': 'BIGINT', 'column07': 'VARCHAR', 'column08': 'VARCHAR', 'column09': 'VARCHAR', 'column10': 'VARCHAR', 'column11': 'BIGINT', 'column12': 'BIGINT', 'column13': 'BIGINT', 'column14': 'VARCHAR', 'column15': 'VARCHAR', 'column16': 'VARCHAR', 'column17': 'BIGINT'});\n",
  "problem_statement": "sniff_csv does not accept url with query string\n### What happens?\n\nFor `sniff_csv` function, if you pass an url that has a query string (`https://example.com/file.csv?v=1`) as the file name you will get this error:\r\n```text\r\nError: Not implemented Error: sniff_csv does not operate on globs yet\r\n```\r\nThe error comes from the line 116 of file src/function/table/sniff_csv.cpp (https://github.com/duckdb/duckdb/blob/fefa49c21c080edee0969a8c27d349b031417195/src/function/table/sniff_csv.cpp#L116)\r\n```c++\r\n\tif (fs.HasGlob(data.path)) {\r\n\t\tthrow NotImplementedException(\"sniff_csv does not operate on globs yet\");\r\n\t}\r\n```\r\nwhich does not take into consideration the URL path and query string.\r\nThis is an issue for us as we using signed url to infer files schema from cloud storage.\r\nWithout the glob check the user will get simple `Cannot open file` (tested).\r\nI will do a PR to remove the check if this is acceptable.\r\n\n\n### To Reproduce\n\n```SQL\r\nSELECT * FROM sniff_csv('https://example.com/file.csv?v=1');\r\n```\r\noutput\r\n```text\r\nError: Not implemented Error: sniff_csv does not operate on globs yet\r\n```\n\n### OS:\n\nall\n\n### DuckDB Version:\n\n0.9.3\n\n### DuckDB Client:\n\nall\n\n### Full Name:\n\nGabriel Hodoroaga\n\n### Affiliation:\n\nBobsled\n\n### Have you tried this on the latest `main` branch?\n\nI have tested with a main build\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] Yes, I have\n",
  "hints_text": "",
  "created_at": "2024-01-16T10:02:15Z"
}