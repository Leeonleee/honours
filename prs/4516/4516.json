{
  "repo": "duckdb/duckdb",
  "pull_number": 4516,
  "instance_id": "duckdb__duckdb-4516",
  "issue_numbers": [
    "4455",
    "4455"
  ],
  "base_commit": "76a8cbc383646ee4cbf5fa981fbbd7b4de6b218c",
  "patch": "diff --git a/src/parser/transform/statement/transform_rename.cpp b/src/parser/transform/statement/transform_rename.cpp\nindex 30e9e5982681..4717153db7ad 100644\n--- a/src/parser/transform/statement/transform_rename.cpp\n+++ b/src/parser/transform/statement/transform_rename.cpp\n@@ -35,7 +35,7 @@ unique_ptr<AlterStatement> Transformer::TransformRename(duckdb_libpgquery::PGNod\n \t\t// change table name\n \n \t\t// get the table and schema\n-\t\tstring schema = DEFAULT_SCHEMA;\n+\t\tstring schema = INVALID_SCHEMA;\n \t\tstring table;\n \t\tD_ASSERT(stmt->relation->relname);\n \t\tif (stmt->relation->relname) {\n@@ -53,7 +53,7 @@ unique_ptr<AlterStatement> Transformer::TransformRename(duckdb_libpgquery::PGNod\n \t\t// change view name\n \n \t\t// get the view and schema\n-\t\tstring schema = DEFAULT_SCHEMA;\n+\t\tstring schema = INVALID_SCHEMA;\n \t\tstring view;\n \t\tD_ASSERT(stmt->relation->relname);\n \t\tif (stmt->relation->relname) {\n",
  "test_patch": "diff --git a/test/sql/alter/rename_table/test_rename_bug4455_schema.test b/test/sql/alter/rename_table/test_rename_bug4455_schema.test\nnew file mode 100644\nindex 000000000000..38e9beef8a83\n--- /dev/null\n+++ b/test/sql/alter/rename_table/test_rename_bug4455_schema.test\n@@ -0,0 +1,27 @@\n+# name: test/sql/alter/rename_table/test_rename_bug4455_schema.test\n+# description: Test ALTER TABLE RENAME COLUMN\n+# group: [rename_table]\n+\n+statement ok\n+create schema public;\n+\n+statement ok\n+set schema=public;\n+\n+statement ok\n+create table a1 (c int);\n+\n+statement ok\n+alter table public.a1 rename to a2;\n+\n+statement ok\n+alter table a2 rename to a3;\n+\n+statement ok\n+create view v1 as select 42;\n+\n+statement ok\n+alter view public.v1 rename to v2;\n+\n+statement ok\n+alter view v2 rename to v3;\n",
  "problem_statement": "ALTER TABLE doesn't use default schema\n### What happens?\r\n\r\nWhen I try to run ALTER TABLE on a table that's in the current default schema (not `main`), DuckDB says that the table does not exist. \r\n\r\nALTER TABLE does not look at the default schema at all. ALTER TABLE only works *if I fully specify the table name with the schema name*.\r\n\r\n### To Reproduce\r\n\r\n```\r\ncreate schema public;\r\nset schema=public;\r\ncreate table a1 (c int);\r\n\r\n-- error at this line!\r\nalter table a1 rename to a2;\r\n\r\n-- but this line works\r\nalter table public.a1 rename to a2;\r\n```\r\n\r\nError message: `Error: Catalog Error: Table with name a1 does not exist!\r\nDid you mean \"public.a1\"?`\r\n\r\n\r\n\r\n### OS:\r\n\r\nMac\r\n\r\n### DuckDB Version:\r\n\r\n0.4.0\r\n\r\n### DuckDB Client:\r\n\r\nCLI\r\n\r\n### Full Name:\r\n\r\nHenry Nguyen\r\n\r\n### Affiliation:\r\n\r\nDropbase\r\n\r\n### Have you tried this on the latest `master` branch?\r\n\r\n- [X] I agree\r\n\r\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\r\n\r\n- [X] I agree\nALTER TABLE doesn't use default schema\n### What happens?\r\n\r\nWhen I try to run ALTER TABLE on a table that's in the current default schema (not `main`), DuckDB says that the table does not exist. \r\n\r\nALTER TABLE does not look at the default schema at all. ALTER TABLE only works *if I fully specify the table name with the schema name*.\r\n\r\n### To Reproduce\r\n\r\n```\r\ncreate schema public;\r\nset schema=public;\r\ncreate table a1 (c int);\r\n\r\n-- error at this line!\r\nalter table a1 rename to a2;\r\n\r\n-- but this line works\r\nalter table public.a1 rename to a2;\r\n```\r\n\r\nError message: `Error: Catalog Error: Table with name a1 does not exist!\r\nDid you mean \"public.a1\"?`\r\n\r\n\r\n\r\n### OS:\r\n\r\nMac\r\n\r\n### DuckDB Version:\r\n\r\n0.4.0\r\n\r\n### DuckDB Client:\r\n\r\nCLI\r\n\r\n### Full Name:\r\n\r\nHenry Nguyen\r\n\r\n### Affiliation:\r\n\r\nDropbase\r\n\r\n### Have you tried this on the latest `master` branch?\r\n\r\n- [X] I agree\r\n\r\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\r\n\r\n- [X] I agree\n",
  "hints_text": "\n",
  "created_at": "2022-08-29T07:05:11Z"
}