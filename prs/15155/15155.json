{
  "repo": "duckdb/duckdb",
  "pull_number": 15155,
  "instance_id": "duckdb__duckdb-15155",
  "issue_numbers": [
    "15141"
  ],
  "base_commit": "2d123094bbcc375575a538887bcc863d621ba15c",
  "patch": "diff --git a/src/parser/transform/statement/transform_pivot_stmt.cpp b/src/parser/transform/statement/transform_pivot_stmt.cpp\nindex 8b798a83c9fb..94bafd72f203 100644\n--- a/src/parser/transform/statement/transform_pivot_stmt.cpp\n+++ b/src/parser/transform/statement/transform_pivot_stmt.cpp\n@@ -163,6 +163,8 @@ unique_ptr<QueryNode> Transformer::TransformPivotStatement(duckdb_libpgquery::PG\n \t\tif (pivot->aggrs) {\n \t\t\tTransformExpressionList(*pivot->aggrs, select_node->select_list);\n \t\t}\n+\t\t// transform order by/limit modifiers\n+\t\tTransformModifiers(select, *select_node);\n \t\treturn std::move(select_node);\n \t}\n \n",
  "test_patch": "diff --git a/test/sql/pivot/pivot_15141.test b/test/sql/pivot/pivot_15141.test\nnew file mode 100644\nindex 000000000000..a08deced8197\n--- /dev/null\n+++ b/test/sql/pivot/pivot_15141.test\n@@ -0,0 +1,32 @@\n+# name: test/sql/pivot/pivot_15141.test\n+# description: Test #15141: order by with no pivot columns\n+# group: [pivot]\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+statement ok\n+create table p (col1 timestamp, col2 int);\n+\n+statement ok\n+INSERT INTO p VALUES \n+    ('2024-12-04 09:30:01', 100),\n+    ('2024-12-04 09:30:02', 100),\n+    ('2024-12-04 09:30:03', 100),\n+    ('2024-12-04 09:30:04', 100),\n+    ('2024-12-04 09:30:05', 100),\n+    ('2024-12-04 09:30:06', 100),\n+    ('2024-12-04 09:30:07', 100),\n+    ('2024-12-04 09:30:08', 100);\n+\n+query II\n+pivot p using sum (col2) group by col1 order by col1;\n+----\n+2024-12-04 09:30:01\t100\n+2024-12-04 09:30:02\t100\n+2024-12-04 09:30:03\t100\n+2024-12-04 09:30:04\t100\n+2024-12-04 09:30:05\t100\n+2024-12-04 09:30:06\t100\n+2024-12-04 09:30:07\t100\n+2024-12-04 09:30:08\t100\n",
  "problem_statement": "Inconsistent results when using ORDER BY with PIVOT\n### What happens?\r\n\r\nPIVOT statement does not look to correctly handle ORDER BY clause.\r\nResults sometimes sorted correctly and sometimes not. \r\nRunning PIVOT multiple times produces different results\r\n\r\n### To Reproduce\r\n\r\n```sql\r\ncreate table p (col1 timestamp, col2 int);\r\ninsert into p values ('2024-12-04 09:30:01', 100);\r\ninsert into p values ('2024-12-04 09:30:02', 100);\r\ninsert into p values ('2024-12-04 09:30:03', 100);\r\ninsert into p values ('2024-12-04 09:30:04', 100);\r\n\r\npivot p using sum (col2)\r\ngroup by col1\r\norder by col1;\r\n```\r\n\r\n### OS:\r\n\r\nWindows\r\n\r\n### DuckDB Version:\r\n\r\n1.1.3\r\n\r\n### DuckDB Client:\r\n\r\nbuild from sourcce\r\n\r\n### Hardware:\r\n\r\n_No response_\r\n\r\n### Full Name:\r\n\r\nAlex G\r\n\r\n### Affiliation:\r\n\r\nFintech\r\n\r\n### What is the latest build you tested with? If possible, we recommend testing with the latest nightly build.\r\n\r\nI have tested with a stable release\r\n\r\n### Did you include all relevant data sets for reproducing the issue?\r\n\r\nYes\r\n\r\n### Did you include all code required to reproduce the issue?\r\n\r\n- [X] Yes, I have\r\n\r\n### Did you include all relevant configuration (e.g., CPU architecture, Python version, Linux distribution) to reproduce the issue?\r\n\r\n- [X] Yes, I have\n",
  "hints_text": "",
  "created_at": "2024-12-06T02:59:09Z"
}