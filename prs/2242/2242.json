{
  "repo": "duckdb/duckdb",
  "pull_number": 2242,
  "instance_id": "duckdb__duckdb-2242",
  "issue_numbers": [
    "2240"
  ],
  "base_commit": "33299a4f8583c648a7473e61757fe61f86b5ddbe",
  "patch": "diff --git a/src/storage/local_storage.cpp b/src/storage/local_storage.cpp\nindex fc6ad391a20e..35a5277a4e69 100644\n--- a/src/storage/local_storage.cpp\n+++ b/src/storage/local_storage.cpp\n@@ -294,8 +294,11 @@ static void UpdateChunk(Vector &data, Vector &updates, Vector &row_ids, idx_t co\n \tcase PhysicalType::DOUBLE:\n \t\tTemplatedUpdateLoop<double>(data, updates, row_ids, count, base_index);\n \t\tbreak;\n+\tcase PhysicalType::VARCHAR:\n+\t\tTemplatedUpdateLoop<string_t>(data, updates, row_ids, count, base_index);\n+\t\tbreak;\n \tdefault:\n-\t\tthrow Exception(\"Unsupported type for in-place update\");\n+\t\tthrow Exception(\"Unsupported type for in-place update: \" + TypeIdToString(data.GetType().InternalType()));\n \t}\n }\n \n",
  "test_patch": "diff --git a/test/issues/general/test_2240.test b/test/issues/general/test_2240.test\nnew file mode 100644\nindex 000000000000..50ef589d38bf\n--- /dev/null\n+++ b/test/issues/general/test_2240.test\n@@ -0,0 +1,23 @@\n+# name: test/issues/general/test_2240.test\n+# description: Issue 2240: Exception thrown when inserting and updating a text column in the same row in a transaction\n+# group: [general]\n+\n+statement ok\n+BEGIN TRANSACTION;\n+\n+statement ok\n+CREATE TABLE test (id INTEGER, name TEXT);\n+\n+statement ok\n+INSERT INTO test VALUES (1, 'Bob');\n+\n+statement ok\n+UPDATE test SET name = 'Alice' Where id = 1;\n+\n+statement ok\n+COMMIT;\n+\n+query T\n+select name from test where id = 1;\n+----\n+Alice\n",
  "problem_statement": "Exception thrown when inserting and updating a text column in the same row in a transaction\n**What does happen?**\r\nIf you insert and update a row in the same transaction, it will fail for columns of type 'text' with the error \r\n\"Unsupported type for in-place update\", thrown here: \r\n\r\nhttps://github.com/duckdb/duckdb/blob/33299a4f8583c648a7473e61757fe61f86b5ddbe/src/storage/local_storage.cpp#L274-L300\r\n\r\n**What should happen?**\r\nThe row should be updated.\r\n\r\n**To Reproduce**\r\n\r\n```\r\nBEGIN TRANSACTION;\r\nCREATE TABLE test (id INTEGER, name TEXT);\r\nINSERT INTO test VALUES (1, 'Bob');\r\nUPDATE test SET name = 'Alice' Where id = 1;\r\n```\r\n\r\nNote that this succeeds if you COMMIT before the UPDATE statement.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Linux/Ubuntu 20.04\r\n - DuckDB Version: 0.2.7\r\n\r\nCommand line and JDBC.\r\n\r\n**Before submitting**\r\n- [X] Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\r\n- [ ] Not tried against master, but an inspection of [local_storage.cpp](https://github.com/duckdb/duckdb/blob/33299a4f8583c648a7473e61757fe61f86b5ddbe/src/storage/local_storage.cpp#L298) suggests that this case remains unimplemented for all types except INT8, INT16, INT32, INT64, FLOAT, and DOUBLE.\n",
  "hints_text": "",
  "created_at": "2021-09-03T11:53:41Z"
}