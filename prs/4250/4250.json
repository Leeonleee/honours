{
  "repo": "duckdb/duckdb",
  "pull_number": 4250,
  "instance_id": "duckdb__duckdb-4250",
  "issue_numbers": [
    "4249"
  ],
  "base_commit": "230f0e3e2cca6915ed717b5f73d1dfef80db0cc6",
  "patch": "diff --git a/src/main/capi/appender-c.cpp b/src/main/capi/appender-c.cpp\nindex 959412f70739..0878262507f9 100644\n--- a/src/main/capi/appender-c.cpp\n+++ b/src/main/capi/appender-c.cpp\n@@ -95,6 +95,9 @@ duckdb_state duckdb_append_internal(duckdb_appender appender, T value) {\n \tauto *appender_instance = (AppenderWrapper *)appender;\n \ttry {\n \t\tappender_instance->appender->Append<T>(value);\n+\t} catch (std::exception &ex) {\n+\t\tappender_instance->error = ex.what();\n+\t\treturn DuckDBError;\n \t} catch (...) {\n \t\treturn DuckDBError;\n \t}\n",
  "test_patch": "diff --git a/test/api/capi/test_capi_appender.cpp b/test/api/capi/test_capi_appender.cpp\nindex 54f1c35375ed..23eab8d02b61 100644\n--- a/test/api/capi/test_capi_appender.cpp\n+++ b/test/api/capi/test_capi_appender.cpp\n@@ -405,6 +405,7 @@ TEST_CASE(\"Test append timestamp in C API\", \"[capi]\") {\n \tREQUIRE(status == DuckDBSuccess);\n \tREQUIRE(duckdb_appender_error(appender) == nullptr);\n \n+\t// successful append\n \tstatus = duckdb_appender_begin_row(appender);\n \tREQUIRE(status == DuckDBSuccess);\n \n@@ -415,6 +416,17 @@ TEST_CASE(\"Test append timestamp in C API\", \"[capi]\") {\n \tstatus = duckdb_appender_end_row(appender);\n \tREQUIRE(status == DuckDBSuccess);\n \n+\t// append failure\n+\tstatus = duckdb_appender_begin_row(appender);\n+\tREQUIRE(status == DuckDBSuccess);\n+\n+\tstatus = duckdb_append_varchar(appender, \"XXXXX\");\n+\tREQUIRE(status == DuckDBError);\n+\tREQUIRE(duckdb_appender_error(appender) != nullptr);\n+\n+\tstatus = duckdb_appender_end_row(appender);\n+\tREQUIRE(status == DuckDBError);\n+\n \tstatus = duckdb_appender_flush(appender);\n \tREQUIRE(status == DuckDBSuccess);\n \n",
  "problem_statement": "duckdb_append_blob error without error message\n### What happens?\r\n\r\nThe blob data is \r\n\r\n```sh\r\n[ 10,2,51,57,82,10,158,8,185,41,165,3,180,61,184,18,88,232,132,1,104,251,1,] \r\n```\r\n\r\n\r\n\r\n### To Reproduce\r\n\r\ncall with `duckdb_append_blob(pConn.order_appender, ptr, size);` return 1,  \r\n\r\nbut `duckdb_appender_error(pConn.order_appender),` return null\r\n\r\n\r\n### OS:\r\n\r\nlinux\r\n\r\n### DuckDB Version:\r\n\r\nv0.4.0\r\n\r\n### DuckDB Client:\r\n\r\nc api\r\n\r\n### Full Name:\r\n\r\ncalvin\r\n\r\n### Affiliation:\r\n\r\nself\r\n\r\n### Have you tried this on the latest `master` branch?\r\n\r\nnot yet, can not build it\r\n\r\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\r\n\r\n- [X] I agree\n",
  "hints_text": "",
  "created_at": "2022-07-30T12:35:09Z"
}