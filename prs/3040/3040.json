{
  "repo": "duckdb/duckdb",
  "pull_number": 3040,
  "instance_id": "duckdb__duckdb-3040",
  "issue_numbers": [
    "3015",
    "3015"
  ],
  "base_commit": "d7a24678d7686d7cbeaeda1f67567b63ccd7564c",
  "patch": "diff --git a/src/common/vector_operations/is_distinct_from.cpp b/src/common/vector_operations/is_distinct_from.cpp\nindex edb46bcf9f3d..06bd6f3082ea 100644\n--- a/src/common/vector_operations/is_distinct_from.cpp\n+++ b/src/common/vector_operations/is_distinct_from.cpp\n@@ -129,7 +129,7 @@ DistinctSelectGenericLoopSwitch(LEFT_TYPE *__restrict ldata, RIGHT_TYPE *__restr\n                                 const SelectionVector *__restrict lsel, const SelectionVector *__restrict rsel,\n                                 const SelectionVector *__restrict result_sel, idx_t count, ValidityMask &lmask,\n                                 ValidityMask &rmask, SelectionVector *true_sel, SelectionVector *false_sel) {\n-\tif (!lmask.AllValid() || rmask.AllValid()) {\n+\tif (!lmask.AllValid() || !rmask.AllValid()) {\n \t\treturn DistinctSelectGenericLoopSelSwitch<LEFT_TYPE, RIGHT_TYPE, OP, DENSE, false>(\n \t\t    ldata, rdata, lsel, rsel, result_sel, count, lmask, rmask, true_sel, false_sel);\n \t} else {\ndiff --git a/src/execution/operator/order/physical_top_n.cpp b/src/execution/operator/order/physical_top_n.cpp\nindex 006f1cb99312..4be60a3dc692 100644\n--- a/src/execution/operator/order/physical_top_n.cpp\n+++ b/src/execution/operator/order/physical_top_n.cpp\n@@ -356,6 +356,7 @@ bool TopNHeap::CheckBoundaryValues(DataChunk &sort_chunk, DataChunk &payload) {\n \t\tidx_t false_count = remaining_count - true_count;\n \t\tif (false_count > 0) {\n \t\t\t// check what we should continue to check\n+\t\t\tcompare_chunk.data[i].Slice(sort_chunk.data[i], false_sel, false_count);\n \t\t\tremaining_count = VectorOperations::NotDistinctFrom(compare_chunk.data[i], boundary_values.data[i],\n \t\t\t                                                    &false_sel, false_count, &new_remaining_sel, nullptr);\n \t\t\tif (is_last) {\n",
  "test_patch": "diff --git a/data/parquet-testing/orders_small_parquet.test b/data/parquet-testing/orders_small_parquet.test\nnew file mode 100644\nindex 000000000000..8f57041958e9\nBinary files /dev/null and b/data/parquet-testing/orders_small_parquet.test differ\ndiff --git a/test/sql/order/top_n_nulls.test b/test/sql/order/top_n_nulls.test\nnew file mode 100644\nindex 000000000000..eac9e79dc35d\n--- /dev/null\n+++ b/test/sql/order/top_n_nulls.test\n@@ -0,0 +1,395 @@\n+# name: test/sql/order/top_n_nulls.test\n+# description: Issue #3015: Wrong result on using limit after order by on null data\n+# group: [order]\n+\n+require parquet\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+statement ok\n+CREATE TABLE orders_small AS SELECT * FROM parquet_scan('data/parquet-testing/orders_small_parquet.test');\n+\n+query IIII nosort\n+select o_orderkey, o_clerk, o_orderstatus, o_totalprice from orders_small\n+                    order by o_orderkey NULLS FIRST,\n+                    o_clerk NULLS FIRST, o_orderstatus NULLS FIRST,\n+                    o_totalprice DESC NULLS LAST limit 360\n+----\n+NULL\tNULL\tNULL\t340307.430000\n+NULL\tNULL\tNULL\t328268.960000\n+NULL\tNULL\tNULL\t311077.000000\n+NULL\tNULL\tNULL\t296731.500000\n+NULL\tNULL\tNULL\t287540.740000\n+NULL\tNULL\tNULL\t282895.800000\n+NULL\tNULL\tNULL\t281298.110000\n+NULL\tNULL\tNULL\t280581.420000\n+NULL\tNULL\tNULL\t276437.190000\n+NULL\tNULL\tNULL\t260191.440000\n+NULL\tNULL\tNULL\t255481.810000\n+NULL\tNULL\tNULL\t251755.620000\n+NULL\tNULL\tNULL\t238936.970000\n+NULL\tNULL\tNULL\t235488.940000\n+NULL\tNULL\tNULL\t230766.480000\n+NULL\tNULL\tNULL\t221161.270000\n+NULL\tNULL\tNULL\t219740.510000\n+NULL\tNULL\tNULL\t214573.210000\n+NULL\tNULL\tNULL\t210796.750000\n+NULL\tNULL\tNULL\t206883.430000\n+NULL\tNULL\tNULL\t204126.000000\n+NULL\tNULL\tNULL\t198265.350000\n+NULL\tNULL\tNULL\t193082.890000\n+NULL\tNULL\tNULL\t192187.210000\n+NULL\tNULL\tNULL\t191412.290000\n+NULL\tNULL\tNULL\t189947.500000\n+NULL\tNULL\tNULL\t189469.700000\n+NULL\tNULL\tNULL\t183980.860000\n+NULL\tNULL\tNULL\t181677.640000\n+NULL\tNULL\tNULL\t174652.870000\n+NULL\tNULL\tNULL\t174059.570000\n+NULL\tNULL\tNULL\t173183.720000\n+NULL\tNULL\tNULL\t170431.860000\n+NULL\tNULL\tNULL\t160457.990000\n+NULL\tNULL\tNULL\t160015.960000\n+NULL\tNULL\tNULL\t153975.860000\n+NULL\tNULL\tNULL\t151788.070000\n+NULL\tNULL\tNULL\t150238.370000\n+NULL\tNULL\tNULL\t145402.270000\n+NULL\tNULL\tNULL\t143916.630000\n+NULL\tNULL\tNULL\t136488.480000\n+NULL\tNULL\tNULL\t131805.810000\n+NULL\tNULL\tNULL\t128850.630000\n+NULL\tNULL\tNULL\t123049.400000\n+NULL\tNULL\tNULL\t121868.460000\n+NULL\tNULL\tNULL\t119830.710000\n+NULL\tNULL\tNULL\t117567.130000\n+NULL\tNULL\tNULL\t117093.370000\n+NULL\tNULL\tNULL\t116790.600000\n+NULL\tNULL\tNULL\t114017.090000\n+NULL\tNULL\tNULL\t112280.850000\n+NULL\tNULL\tNULL\t108964.770000\n+NULL\tNULL\tNULL\t105069.160000\n+NULL\tNULL\tNULL\t100327.500000\n+NULL\tNULL\tNULL\t91474.220000\n+NULL\tNULL\tNULL\t91157.110000\n+NULL\tNULL\tNULL\t89944.360000\n+NULL\tNULL\tNULL\t89260.550000\n+NULL\tNULL\tNULL\t81688.190000\n+NULL\tNULL\tNULL\t77790.850000\n+NULL\tNULL\tNULL\t72973.350000\n+NULL\tNULL\tNULL\t72294.020000\n+NULL\tNULL\tNULL\t70595.250000\n+NULL\tNULL\tNULL\t68764.000000\n+NULL\tNULL\tNULL\t66378.020000\n+NULL\tNULL\tNULL\t60710.700000\n+NULL\tNULL\tNULL\t59559.860000\n+NULL\tNULL\tNULL\t56336.190000\n+NULL\tNULL\tNULL\t53129.160000\n+NULL\tNULL\tNULL\t51239.440000\n+NULL\tNULL\tNULL\t50790.560000\n+NULL\tNULL\tNULL\t49809.520000\n+NULL\tNULL\tNULL\t39928.110000\n+NULL\tNULL\tNULL\t37660.850000\n+NULL\tNULL\tNULL\t35837.020000\n+NULL\tNULL\tNULL\t35221.510000\n+NULL\tNULL\tNULL\t33490.570000\n+NULL\tNULL\tNULL\t32591.640000\n+NULL\tNULL\tNULL\t30177.050000\n+NULL\tNULL\tNULL\t29118.170000\n+NULL\tNULL\tNULL\t28303.130000\n+NULL\tNULL\tNULL\t26876.620000\n+NULL\tNULL\tNULL\t26831.140000\n+NULL\tNULL\tNULL\t25872.660000\n+NULL\tNULL\tNULL\t24616.040000\n+NULL\tNULL\tNULL\t16314.050000\n+NULL\tNULL\tNULL\t11312.690000\n+NULL\tNULL\tNULL\t9014.680000\n+NULL\tNULL\tNULL\t7503.460000\n+NULL\tNULL\tNULL\t3871.100000\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tNULL\tNULL\n+NULL\tNULL\tF\t349989.590000\n+NULL\tNULL\tF\t335735.690000\n+NULL\tNULL\tF\t334041.320000\n+NULL\tNULL\tF\t331669.090000\n+NULL\tNULL\tF\t324398.570000\n+NULL\tNULL\tF\t317411.930000\n+NULL\tNULL\tF\t310895.320000\n+NULL\tNULL\tF\t307954.380000\n+NULL\tNULL\tF\t307926.950000\n+NULL\tNULL\tF\t307456.010000\n+NULL\tNULL\tF\t301166.380000\n+NULL\tNULL\tF\t299823.740000\n+NULL\tNULL\tF\t297072.030000\n+NULL\tNULL\tF\t290385.740000\n+NULL\tNULL\tF\t287405.920000\n+NULL\tNULL\tF\t286773.610000\n+NULL\tNULL\tF\t283529.640000\n+NULL\tNULL\tF\t282014.470000\n+NULL\tNULL\tF\t280603.770000\n+NULL\tNULL\tF\t280405.880000\n+NULL\tNULL\tF\t277061.220000\n+NULL\tNULL\tF\t275521.330000\n+NULL\tNULL\tF\t275281.660000\n+NULL\tNULL\tF\t274822.480000\n+NULL\tNULL\tF\t274538.860000\n+NULL\tNULL\tF\t271586.860000\n+NULL\tNULL\tF\t271217.930000\n+NULL\tNULL\tF\t267185.150000\n+NULL\tNULL\tF\t265957.830000\n+NULL\tNULL\tF\t265607.080000\n+NULL\tNULL\tF\t264533.250000\n+NULL\tNULL\tF\t262449.110000\n+NULL\tNULL\tF\t261300.360000\n+NULL\tNULL\tF\t261050.210000\n+NULL\tNULL\tF\t261039.730000\n+NULL\tNULL\tF\t260351.140000\n+NULL\tNULL\tF\t259840.310000\n+NULL\tNULL\tF\t259657.840000\n+NULL\tNULL\tF\t259404.300000\n+NULL\tNULL\tF\t259087.990000\n+NULL\tNULL\tF\t258684.610000\n+NULL\tNULL\tF\t258579.980000\n+NULL\tNULL\tF\t255602.240000\n+NULL\tNULL\tF\t254618.410000\n+NULL\tNULL\tF\t254548.570000\n+NULL\tNULL\tF\t251805.990000\n+NULL\tNULL\tF\t251406.480000\n+NULL\tNULL\tF\t249275.230000\n+NULL\tNULL\tF\t248725.100000\n+NULL\tNULL\tF\t247746.980000\n+NULL\tNULL\tF\t245039.860000\n+NULL\tNULL\tF\t243023.190000\n+NULL\tNULL\tF\t242643.430000\n+NULL\tNULL\tF\t240655.790000\n+NULL\tNULL\tF\t237034.940000\n+NULL\tNULL\tF\t236460.550000\n+NULL\tNULL\tF\t235617.950000\n+NULL\tNULL\tF\t234010.760000\n+NULL\tNULL\tF\t233966.350000\n+NULL\tNULL\tF\t232113.320000\n+NULL\tNULL\tF\t231373.450000\n+NULL\tNULL\tF\t230457.040000\n+NULL\tNULL\tF\t230024.970000\n+NULL\tNULL\tF\t229414.590000\n+NULL\tNULL\tF\t229288.880000\n+NULL\tNULL\tF\t227618.780000\n+NULL\tNULL\tF\t226055.660000\n+NULL\tNULL\tF\t224525.850000\n+NULL\tNULL\tF\t224312.920000\n+NULL\tNULL\tF\t221370.780000\n+NULL\tNULL\tF\t220339.470000\n+NULL\tNULL\tF\t218914.010000\n+NULL\tNULL\tF\t217495.070000\n+NULL\tNULL\tF\t216985.390000\n+NULL\tNULL\tF\t216810.390000\n+NULL\tNULL\tF\t215663.160000\n+NULL\tNULL\tF\t213374.730000\n+NULL\tNULL\tF\t212335.410000\n+NULL\tNULL\tF\t210283.090000\n+NULL\tNULL\tF\t210208.890000\n+NULL\tNULL\tF\t209585.840000\n+NULL\tNULL\tF\t208296.890000\n+NULL\tNULL\tF\t206582.090000\n+NULL\tNULL\tF\t205314.640000\n+NULL\tNULL\tF\t204582.020000\n+NULL\tNULL\tF\t203543.550000\n+NULL\tNULL\tF\t203411.630000\n+NULL\tNULL\tF\t201576.660000\n+NULL\tNULL\tF\t201176.510000\n+NULL\tNULL\tF\t200947.270000\n+NULL\tNULL\tF\t200545.740000\n+NULL\tNULL\tF\t199261.930000\n+NULL\tNULL\tF\t198914.570000\n+NULL\tNULL\tF\t197486.590000\n+NULL\tNULL\tF\t197033.240000\n+NULL\tNULL\tF\t195414.010000\n+NULL\tNULL\tF\t194761.080000\n+NULL\tNULL\tF\t192862.200000\n+NULL\tNULL\tF\t192520.790000\n+NULL\tNULL\tF\t192441.180000\n+NULL\tNULL\tF\t192381.000000\n+NULL\tNULL\tF\t191444.080000\n+NULL\tNULL\tF\t190905.510000\n+NULL\tNULL\tF\t190592.950000\n+NULL\tNULL\tF\t190482.600000\n+NULL\tNULL\tF\t190126.760000\n+NULL\tNULL\tF\t189290.690000\n+NULL\tNULL\tF\t189280.540000\n+NULL\tNULL\tF\t189039.370000\n+NULL\tNULL\tF\t188680.090000\n+NULL\tNULL\tF\t188324.420000\n+NULL\tNULL\tF\t186916.290000\n+NULL\tNULL\tF\t185390.890000\n+NULL\tNULL\tF\t184643.070000\n+NULL\tNULL\tF\t184613.750000\n+NULL\tNULL\tF\t184004.000000\n+NULL\tNULL\tF\t183526.660000\n+NULL\tNULL\tF\t182684.960000\n+NULL\tNULL\tF\t182121.850000\n+NULL\tNULL\tF\t181182.020000\n+NULL\tNULL\tF\t180412.050000\n+NULL\tNULL\tF\t180382.950000\n+NULL\tNULL\tF\t179741.160000\n+NULL\tNULL\tF\t177448.830000\n+NULL\tNULL\tF\t175911.010000\n+NULL\tNULL\tF\t174955.380000\n+NULL\tNULL\tF\t174222.720000\n+NULL\tNULL\tF\t174106.780000\n+NULL\tNULL\tF\t172746.640000\n+NULL\tNULL\tF\t171924.730000\n+NULL\tNULL\tF\t170743.710000\n+NULL\tNULL\tF\t167759.370000\n+NULL\tNULL\tF\t167610.730000\n+NULL\tNULL\tF\t165444.940000\n+NULL\tNULL\tF\t164345.780000\n+NULL\tNULL\tF\t164210.980000\n+NULL\tNULL\tF\t163944.310000\n+NULL\tNULL\tF\t163621.130000\n+NULL\tNULL\tF\t163139.720000\n+NULL\tNULL\tF\t162738.140000\n+NULL\tNULL\tF\t162711.120000\n+NULL\tNULL\tF\t161834.180000\n+NULL\tNULL\tF\t159414.900000\n+NULL\tNULL\tF\t158465.110000\n+NULL\tNULL\tF\t158152.500000\n+NULL\tNULL\tF\t157920.790000\n+NULL\tNULL\tF\t156943.760000\n+NULL\tNULL\tF\t156784.600000\n+NULL\tNULL\tF\t156284.740000\n+NULL\tNULL\tF\t154704.520000\n+NULL\tNULL\tF\t154168.110000\n+NULL\tNULL\tF\t153286.520000\n+NULL\tNULL\tF\t152816.280000\n+NULL\tNULL\tF\t151336.470000\n+NULL\tNULL\tF\t150115.300000\n+NULL\tNULL\tF\t149905.600000\n+NULL\tNULL\tF\t148433.120000\n+NULL\tNULL\tF\t148101.930000\n+NULL\tNULL\tF\t147915.500000\n+NULL\tNULL\tF\t147468.300000\n+NULL\tNULL\tF\t147137.150000\n+NULL\tNULL\tF\t146549.030000\n+NULL\tNULL\tF\t146314.600000\n+NULL\tNULL\tF\t145156.930000\n+NULL\tNULL\tF\t144953.970000\n+NULL\tNULL\tF\t144682.770000\n+NULL\tNULL\tF\t144609.160000\n+NULL\tNULL\tF\t143556.160000\n+NULL\tNULL\tF\t143512.900000\n+NULL\tNULL\tF\t143497.600000\n+NULL\tNULL\tF\t142891.770000\n+NULL\tNULL\tF\t141951.070000\n+NULL\tNULL\tF\t140798.730000\n+NULL\tNULL\tF\t137584.680000\n+NULL\tNULL\tF\t137271.360000\n+NULL\tNULL\tF\t137213.650000\n+NULL\tNULL\tF\t136725.440000\n+NULL\tNULL\tF\t136031.060000\n+NULL\tNULL\tF\t136029.040000\n+NULL\tNULL\tF\t135615.450000\n+\n+query IIII\n+select o_orderkey, o_clerk, o_orderstatus, o_totalprice from orders_small\n+                    order by o_orderkey NULLS FIRST,\n+                    o_clerk NULLS FIRST, o_orderstatus NULLS FIRST,\n+                    o_totalprice DESC NULLS LAST limit 10 offset 440\n+----\n+NULL\tNULL\tF\t74729.940000\n+NULL\tNULL\tF\t73548.220000\n+NULL\tNULL\tF\t71831.320000\n+NULL\tNULL\tF\t71567.380000\n+NULL\tNULL\tF\t71439.220000\n+NULL\tNULL\tF\t71204.140000\n+NULL\tNULL\tF\t71112.310000\n+NULL\tNULL\tF\t71109.080000\n+NULL\tNULL\tF\t70261.720000\n+NULL\tNULL\tF\t68763.210000\n",
  "problem_statement": "Wrong result on using limit after order by on null data\n#### What happens?\r\nSeveral row values are missing (when compared with the same query on other SQL engines) when using limit in the below given query. I'm not a 100% sure whether this is a bug or this is the intended behaviour. Note that this happens on data with null values.\r\n\r\n#### To Reproduce\r\n```\r\n        select o_orderkey, o_clerk, o_orderstatus, o_totalprice from orders\r\n                    order by o_orderkey NULLS FIRST,\r\n                    o_clerk NULLS FIRST, o_orderstatus NULLS FIRST,\r\n                    o_totalprice DESC NULLS LAST limit 540\r\n```\r\nThis gives the wrong result. To get the correct result, I had to change the query to the one given below\r\n```\r\n        WITH result as (\r\n          select o_orderkey, o_clerk, o_orderstatus, o_totalprice from orders\r\n            order by o_orderkey NULLS FIRST,\r\n            o_clerk NULLS FIRST, o_orderstatus NULLS FIRST,\r\n            o_totalprice DESC NULLS LAST\r\n        )\r\n        SELECT * from result limit 540\r\n```\r\n\r\n#### Environment (please complete the following information):\r\n - OS: Ubuntu 20.04\r\n - DuckDB Version: 0.3.1\r\n - DuckDB Client: Python\r\n\r\n#### Before Submitting\r\n\r\n- [ ] **Have you tried this on the latest `master` branch?**\r\n* **Python**: `pip install duckdb --upgrade --pre`\r\n* **R**: `install.packages(\"https://github.com/duckdb/duckdb/releases/download/master-builds/duckdb_r_src.tar.gz\", repos = NULL)`\r\n* **Other Platforms**: You can find binaries [here](https://github.com/duckdb/duckdb/releases/tag/master-builds) or compile from source.\r\n\r\n- [ ] **Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?**\r\n\nWrong result on using limit after order by on null data\n#### What happens?\r\nSeveral row values are missing (when compared with the same query on other SQL engines) when using limit in the below given query. I'm not a 100% sure whether this is a bug or this is the intended behaviour. Note that this happens on data with null values.\r\n\r\n#### To Reproduce\r\n```\r\n        select o_orderkey, o_clerk, o_orderstatus, o_totalprice from orders\r\n                    order by o_orderkey NULLS FIRST,\r\n                    o_clerk NULLS FIRST, o_orderstatus NULLS FIRST,\r\n                    o_totalprice DESC NULLS LAST limit 540\r\n```\r\nThis gives the wrong result. To get the correct result, I had to change the query to the one given below\r\n```\r\n        WITH result as (\r\n          select o_orderkey, o_clerk, o_orderstatus, o_totalprice from orders\r\n            order by o_orderkey NULLS FIRST,\r\n            o_clerk NULLS FIRST, o_orderstatus NULLS FIRST,\r\n            o_totalprice DESC NULLS LAST\r\n        )\r\n        SELECT * from result limit 540\r\n```\r\n\r\n#### Environment (please complete the following information):\r\n - OS: Ubuntu 20.04\r\n - DuckDB Version: 0.3.1\r\n - DuckDB Client: Python\r\n\r\n#### Before Submitting\r\n\r\n- [ ] **Have you tried this on the latest `master` branch?**\r\n* **Python**: `pip install duckdb --upgrade --pre`\r\n* **R**: `install.packages(\"https://github.com/duckdb/duckdb/releases/download/master-builds/duckdb_r_src.tar.gz\", repos = NULL)`\r\n* **Other Platforms**: You can find binaries [here](https://github.com/duckdb/duckdb/releases/tag/master-builds) or compile from source.\r\n\r\n- [ ] **Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?**\r\n\n",
  "hints_text": "> Several row values are missing\r\nDo you mean by this that you are getting an incorrect number of rows , or that some of the values in the rows that are returned are missing, i.e., have become NULL?\r\n\r\nI have tried some stuff to reproduce, but haven't succeeded yet.\r\n\r\nThere is a difference between the two queries: the first one is optimized into a TopN operator, the second one is an Order with a Limit on top. It could be that there is an issue with the TopN operator with NULLS.\n@Jedi18 could you try to make a reproducible example?\nSure, here you go https://drive.google.com/file/d/1exn7shxeXxUQWmIVpXZjSljtZK4cDuhX/view?usp=sharing . I've included the data I encountered this bug on. If you diff the two output files, you'll see they have a few different rows.\n> Several row values are missing\r\nDo you mean by this that you are getting an incorrect number of rows , or that some of the values in the rows that are returned are missing, i.e., have become NULL?\r\n\r\nI have tried some stuff to reproduce, but haven't succeeded yet.\r\n\r\nThere is a difference between the two queries: the first one is optimized into a TopN operator, the second one is an Order with a Limit on top. It could be that there is an issue with the TopN operator with NULLS.\n@Jedi18 could you try to make a reproducible example?\nSure, here you go https://drive.google.com/file/d/1exn7shxeXxUQWmIVpXZjSljtZK4cDuhX/view?usp=sharing . I've included the data I encountered this bug on. If you diff the two output files, you'll see they have a few different rows.",
  "created_at": "2022-02-05T15:50:34Z"
}