{
  "repo": "duckdb/duckdb",
  "pull_number": 15708,
  "instance_id": "duckdb__duckdb-15708",
  "issue_numbers": [
    "15180"
  ],
  "base_commit": "945a96cd3fffc49b1522342f710b9b133f77107b",
  "patch": "diff --git a/extension/autocomplete/grammar/describe.gram b/extension/autocomplete/grammar/describe.gram\nindex d6960a8c2193..84bc6f5bc381 100644\n--- a/extension/autocomplete/grammar/describe.gram\n+++ b/extension/autocomplete/grammar/describe.gram\n@@ -2,7 +2,7 @@ DescribeStatement <- ShowSelect / ShowAllTables / ShowQualifiedName\n \n ShowSelect <- ShowOrDescribeOrSummarize SelectStatement\n ShowAllTables <- ShowOrDescribe 'ALL'i 'TABLES'\n-ShowQualifiedName <- ShowOrDescribeOrSummarize (QualifiedName / StringLiteral)?\n+ShowQualifiedName <- ShowOrDescribeOrSummarize (BaseTableName / StringLiteral)?\n \n ShowOrDescribeOrSummarize <- ShowOrDescribe / 'SUMMARIZE'i\n ShowOrDescribe <- 'SHOW'i / 'DESCRIBE'i / 'DESC'i\ndiff --git a/extension/autocomplete/include/inlined_grammar.hpp b/extension/autocomplete/include/inlined_grammar.hpp\nindex b38d3866ece1..4d0dc96a96a9 100644\n--- a/extension/autocomplete/include/inlined_grammar.hpp\n+++ b/extension/autocomplete/include/inlined_grammar.hpp\n@@ -141,7 +141,7 @@ const char INLINED_PEG_GRAMMAR[] = {\n \t\"DescribeStatement <- ShowSelect / ShowAllTables / ShowQualifiedName\\n\"\n \t\"ShowSelect <- ShowOrDescribeOrSummarize SelectStatement\\n\"\n \t\"ShowAllTables <- ShowOrDescribe 'ALL'i 'TABLES'\\n\"\n-\t\"ShowQualifiedName <- ShowOrDescribeOrSummarize (QualifiedName / StringLiteral)?\\n\"\n+\t\"ShowQualifiedName <- ShowOrDescribeOrSummarize (BaseTableName / StringLiteral)?\\n\"\n \t\"ShowOrDescribeOrSummarize <- ShowOrDescribe / 'SUMMARIZE'i\\n\"\n \t\"ShowOrDescribe <- 'SHOW'i / 'DESCRIBE'i / 'DESC'i\\n\"\n \t\"VacuumStatement <- 'VACUUM'i 'FULL'i? QualifiedName?\\n\"\ndiff --git a/tools/shell/linenoise/linenoise.cpp b/tools/shell/linenoise/linenoise.cpp\nindex ad01d3ffb34a..87cfe49d3911 100644\n--- a/tools/shell/linenoise/linenoise.cpp\n+++ b/tools/shell/linenoise/linenoise.cpp\n@@ -141,10 +141,7 @@ int Linenoise::CompleteLine(EscapeSequence &current_sequence) {\n \t\t\tLinenoise::Log(\"\\nComplete Character %d\\n\", (int)c);\n \t\t\tswitch (c) {\n \t\t\tcase TAB: /* tab */\n-\t\t\t\ti = (i + 1) % (completions.size() + 1);\n-\t\t\t\tif (i == completions.size()) {\n-\t\t\t\t\tTerminal::Beep();\n-\t\t\t\t}\n+\t\t\t\ti = (i + 1) % completions.size();\n \t\t\t\tbreak;\n \t\t\tcase ESC: { /* escape */\n \t\t\t\tauto escape = Terminal::ReadEscapeSequence(ifd);\n@@ -152,16 +149,17 @@ int Linenoise::CompleteLine(EscapeSequence &current_sequence) {\n \t\t\t\tcase EscapeSequence::SHIFT_TAB:\n \t\t\t\t\t// shift-tab: move backwards\n \t\t\t\t\tif (i == 0) {\n-\t\t\t\t\t\tTerminal::Beep();\n+\t\t\t\t\t\t// pressing shift-tab at the first completion cancels completion\n+\t\t\t\t\t\tRefreshLine();\n+\t\t\t\t\t\tcurrent_sequence = escape;\n+\t\t\t\t\t\tstop = true;\n \t\t\t\t\t} else {\n \t\t\t\t\t\ti--;\n \t\t\t\t\t}\n \t\t\t\t\tbreak;\n \t\t\t\tcase EscapeSequence::ESCAPE:\n \t\t\t\t\t/* Re-show original buffer */\n-\t\t\t\t\tif (i < completions.size()) {\n-\t\t\t\t\t\tRefreshLine();\n-\t\t\t\t\t}\n+\t\t\t\t\tRefreshLine();\n \t\t\t\t\tcurrent_sequence = escape;\n \t\t\t\t\tstop = true;\n \t\t\t\t\tbreak;\n",
  "test_patch": "diff --git a/test/sql/function/autocomplete/copy.test b/test/sql/function/autocomplete/copy.test\nindex 40cfccbcf6a4..32641f68b4b4 100644\n--- a/test/sql/function/autocomplete/copy.test\n+++ b/test/sql/function/autocomplete/copy.test\n@@ -18,3 +18,11 @@ query II\n FROM sql_auto_complete('COPY tbl FROM ''file.csv'' HEAD') LIMIT 1;\n ----\n HEADER \t25\n+\n+statement ok\n+CREATE TABLE my_table(my_column INTEGER);\n+\n+query II\n+FROM sql_auto_complete('COPY my_') LIMIT 1;\n+----\n+my_table\t5\ndiff --git a/test/sql/function/autocomplete/drop.test b/test/sql/function/autocomplete/drop.test\nindex e44bcb2f7615..9cbc839331f0 100644\n--- a/test/sql/function/autocomplete/drop.test\n+++ b/test/sql/function/autocomplete/drop.test\n@@ -28,3 +28,27 @@ query II\n FROM sql_auto_complete('DROP TABLE tbl CAS') LIMIT 1;\n ----\n CASCADE \t15\n+\n+statement ok\n+CREATE TABLE my_table(my_column INTEGER);\n+\n+query II\n+FROM sql_auto_complete('DROP TABLE my_') LIMIT 1;\n+----\n+my_table\t11\n+\n+statement ok\n+CREATE SCHEMA my_schema;\n+\n+statement ok\n+CREATE TABLE my_schema.table_in_schema(my_column INTEGER)\n+\n+query II\n+FROM sql_auto_complete('DROP TABLE my_s') LIMIT 1;\n+----\n+my_schema.\t11\n+\n+query II\n+FROM sql_auto_complete('DROP TABLE my_schema.t') LIMIT 1;\n+----\n+table_in_schema\t21\ndiff --git a/test/sql/function/autocomplete/show.test b/test/sql/function/autocomplete/show.test\nnew file mode 100644\nindex 000000000000..c17f241b25d7\n--- /dev/null\n+++ b/test/sql/function/autocomplete/show.test\n@@ -0,0 +1,34 @@\n+# name: test/sql/function/autocomplete/show.test\n+# description: Test sql_auto_complete\n+# group: [autocomplete]\n+\n+require autocomplete\n+\n+query II\n+FROM sql_auto_complete('DESCR') LIMIT 1;\n+----\n+DESCRIBE \t0\n+\n+statement ok\n+CREATE TABLE my_table(my_column INTEGER);\n+\n+query II\n+FROM sql_auto_complete('SHOW my_') LIMIT 1;\n+----\n+my_table\t5\n+\n+statement ok\n+CREATE SCHEMA my_schema;\n+\n+statement ok\n+CREATE TABLE my_schema.table_in_schema(my_column INTEGER)\n+\n+query II\n+FROM sql_auto_complete('SHOW my_s') LIMIT 1;\n+----\n+my_schema.\t5\n+\n+query II\n+FROM sql_auto_complete('DESCRIBE my_schema.t') LIMIT 1;\n+----\n+table_in_schema\t19\n",
  "problem_statement": "CLI tab completion not working on some common commands\n### What happens?\n\nCLI tab completion (which is great) doe not seem to work on a table name in the COPY, SHOW or SUMMARIZE statements\n\n### To Reproduce\n\nSimply try `SHOW a<tab>' where you have a table name that starts with 'a' and <tab> usually gives \"ALTER\"\n\n### OS:\n\nmacOS Sanoma 14.7.1 and Debian bullseye\n\n### DuckDB Version:\n\n1.1.3\n\n### DuckDB Client:\n\nCLI\n\n### Hardware:\n\n_No response_\n\n### Full Name:\n\nMaurice Hickey\n\n### Affiliation:\n\nNisos\n\n### What is the latest build you tested with? If possible, we recommend testing with the latest nightly build.\n\nI have tested with a stable release\n\n### Did you include all relevant data sets for reproducing the issue?\n\nNo - Other reason (please specify in the issue body)\n\n### Did you include all code required to reproduce the issue?\n\n- [X] Yes, I have\n\n### Did you include all relevant configuration (e.g., CPU architecture, Python version, Linux distribution) to reproduce the issue?\n\n- [X] Yes, I have\n",
  "hints_text": "",
  "created_at": "2025-01-14T14:50:12Z"
}