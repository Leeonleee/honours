{
  "repo": "duckdb/duckdb",
  "pull_number": 8597,
  "instance_id": "duckdb__duckdb-8597",
  "issue_numbers": [
    "8585"
  ],
  "base_commit": "dd7f0c0870d89ae152a53191f87490052579d40e",
  "patch": "diff --git a/tools/rpkg/src/types.cpp b/tools/rpkg/src/types.cpp\nindex 2f24dc4bbd5f..42348000935b 100644\n--- a/tools/rpkg/src/types.cpp\n+++ b/tools/rpkg/src/types.cpp\n@@ -166,7 +166,7 @@ date_t RDateType::Convert(double val) {\n }\n \n timestamp_t RTimestampType::Convert(double val) {\n-\treturn Timestamp::FromEpochSeconds(val);\n+\treturn Timestamp::FromEpochMicroSeconds(round(val * Interval::MICROS_PER_SEC));\n }\n \n dtime_t RTimeSecondsType::Convert(double val) {\n",
  "test_patch": "diff --git a/tools/rpkg/tests/testthat/test_timestamp.R b/tools/rpkg/tests/testthat/test_timestamp.R\nnew file mode 100644\nindex 000000000000..340d0312f074\n--- /dev/null\n+++ b/tools/rpkg/tests/testthat/test_timestamp.R\n@@ -0,0 +1,9 @@\n+test_that(\"fractional seconds can be roundtripped\", {\n+  con <- dbConnect(duckdb())\n+  on.exit(dbDisconnect(con, shutdown = TRUE))\n+\n+  df <- data.frame(a = as.POSIXct(1.234567 + (1:100) * 1e-6, tz = \"UTC\"))\n+  dbWriteTable(con, \"df\", df)\n+  df_out <- dbReadTable(con, \"df\")\n+  expect_equal(df_out, df)\n+})\n",
  "problem_statement": "R: Timestamps are ingested with second precision, could be microsecond\n### What happens?\r\n\r\nThe fractional (sub-second) part of `POSIXct` values is lost when ingesting into R.\r\n\r\nFix: https://github.com/duckdb/duckdb/compare/master...krlmlr:duckdb:b-time-ms-prec .\r\n\r\n### To Reproduce\r\n\r\n``` r\r\nlibrary(duckdb)\r\ncon <- DBI::dbConnect(duckdb::duckdb())\r\nexperimental <- FALSE\r\ndf1 <- data.frame(\r\n  time = as.POSIXct(\r\n    c(\r\n      \"2010-01-15 13:55:23.950\",\r\n      \"2010-01-15 13:55:23.975\",\r\n      \"2010-01-15 13:55:24\",\r\n      \"2010-01-15 13:55:24.025\"\r\n    ),\r\n    tz = \"UTC\"\r\n  )\r\n)\r\n\r\nrel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)\r\nrel2 <- duckdb:::rel_distinct(rel1)\r\nrel2\r\n#> DuckDB Relation: \r\n#> ---------------------\r\n#> --- Relation Tree ---\r\n#> ---------------------\r\n#> Distinct\r\n#>   r_dataframe_scan(0x12a043fc8)\r\n#> \r\n#> ---------------------\r\n#> -- Result Columns  --\r\n#> ---------------------\r\n#> - time (TIMESTAMP)\r\nduckdb:::rel_to_altrep(rel2)\r\n#>                  time\r\n#> 1 2010-01-15 13:55:23\r\n#> 2 2010-01-15 13:55:24\r\n```\r\n\r\n<sup>Created on 2023-08-16 with [reprex v2.0.2](https://reprex.tidyverse.org)</sup>\r\n\r\n### OS:\r\n\r\nmacOS aarch64\r\n\r\n### DuckDB Version:\r\n\r\ne2128946ccbb68ef5552c4f709614644236d2ce7\r\n\r\n### DuckDB Client:\r\n\r\nR\r\n\r\n### Full Name:\r\n\r\nKirill M\u00fcller\r\n\r\n### Affiliation:\r\n\r\ncynkra GmbH\r\n\r\n### Have you tried this on the latest `master` branch?\r\n\r\nI have tested with a master build\r\n\r\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\r\n\r\n- [X] Yes, I have\n",
  "hints_text": "",
  "created_at": "2023-08-17T03:28:55Z"
}