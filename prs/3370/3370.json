{
  "repo": "duckdb/duckdb",
  "pull_number": 3370,
  "instance_id": "duckdb__duckdb-3370",
  "issue_numbers": [
    "3366",
    "3366"
  ],
  "base_commit": "4fefffeac3e9b76755bf74319b7a7c06ae404b3e",
  "patch": "diff --git a/src/parallel/pipeline.cpp b/src/parallel/pipeline.cpp\nindex cc1c3a7550b6..55cade87ba16 100644\n--- a/src/parallel/pipeline.cpp\n+++ b/src/parallel/pipeline.cpp\n@@ -84,6 +84,9 @@ bool Pipeline::GetProgressInternal(ClientContext &context, PhysicalOperator *op,\n \t\t\tif (!GetProgressInternal(context, op_child.get(), child_percentage)) {\n \t\t\t\treturn false;\n \t\t\t}\n+\t\t\tif (!Value::DoubleIsFinite(child_percentage)) {\n+\t\t\t\treturn false;\n+\t\t\t}\n \t\t\tprogress.push_back(child_percentage);\n \t\t\tcardinality.push_back(op_child->estimated_cardinality);\n \t\t\ttotal_cardinality += op_child->estimated_cardinality;\n",
  "test_patch": "diff --git a/test/issues/fuzz/nan_progress.test b/test/issues/fuzz/nan_progress.test\nnew file mode 100644\nindex 000000000000..fc752168d3ce\n--- /dev/null\n+++ b/test/issues/fuzz/nan_progress.test\n@@ -0,0 +1,17 @@\n+# name: test/issues/fuzz/nan_progress.test\n+# description: Issue 3366: NaN in progress bar\n+# group: [fuzz]\n+\n+statement ok\n+SET enable_progress_bar=true;\n+\n+statement ok\n+WITH RECURSIVE t AS\n+(\n+\tSELECT 1 AS x\n+UNION\n+\tSELECT t1.x + t2.x + t3.x AS x\n+\tFROM t t1, t t2, t t3\n+\tWHERE t1.x < 100\n+)\n+SELECT * FROM t ORDER BY 1;\n",
  "problem_statement": "Undefined behavior : -nan outside the range at pipeline.cpp:87:23 (maybe not a bug)\n#### What happens?\r\n```\r\n/root/duckdb/src/parallel/pipeline.cpp:87:23: runtime error: -nan is outside the range of representable values of type 'unsigned long'\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /root/duckdb/src/parallel/pipeline.cpp:87:23 in\r\n```\r\n\r\n#### To Reproduce\r\n```sql\r\nSET enable_progress_bar=true;\r\nWITH RECURSIVE t AS\r\n(\r\n\tSELECT 1 AS x\r\nUNION\r\n\tSELECT t1.x + t2.x + t3.x AS x\r\n\tFROM t t1, t t2, t t3\r\n\tWHERE t1.x < 100\r\n)\r\nSELECT * FROM t ORDER BY 1;\r\n```\r\n\r\n#### Environment (please complete the following information):\r\n - OS: linux\r\n - DuckDB Version: v0.3.3-dev1399 7c5ba6c0e\r\n - DuckDB Client: /usr/local/bin/duckdb\r\n\r\n#### Before Submitting\r\n\r\n- [x] **Have you tried this on the latest `master` branch?**\r\n* **Python**: `pip install duckdb --upgrade --pre`\r\n* **R**: `install.packages(\"https://github.com/duckdb/duckdb/releases/download/master-builds/duckdb_r_src.tar.gz\", repos = NULL)`\r\n* **Other Platforms**: You can find binaries [here](https://github.com/duckdb/duckdb/releases/tag/master-builds) or compile from source.\r\n\r\n- [x] **Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?**\r\n\nUndefined behavior : -nan outside the range at pipeline.cpp:87:23 (maybe not a bug)\n#### What happens?\r\n```\r\n/root/duckdb/src/parallel/pipeline.cpp:87:23: runtime error: -nan is outside the range of representable values of type 'unsigned long'\r\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /root/duckdb/src/parallel/pipeline.cpp:87:23 in\r\n```\r\n\r\n#### To Reproduce\r\n```sql\r\nSET enable_progress_bar=true;\r\nWITH RECURSIVE t AS\r\n(\r\n\tSELECT 1 AS x\r\nUNION\r\n\tSELECT t1.x + t2.x + t3.x AS x\r\n\tFROM t t1, t t2, t t3\r\n\tWHERE t1.x < 100\r\n)\r\nSELECT * FROM t ORDER BY 1;\r\n```\r\n\r\n#### Environment (please complete the following information):\r\n - OS: linux\r\n - DuckDB Version: v0.3.3-dev1399 7c5ba6c0e\r\n - DuckDB Client: /usr/local/bin/duckdb\r\n\r\n#### Before Submitting\r\n\r\n- [x] **Have you tried this on the latest `master` branch?**\r\n* **Python**: `pip install duckdb --upgrade --pre`\r\n* **R**: `install.packages(\"https://github.com/duckdb/duckdb/releases/download/master-builds/duckdb_r_src.tar.gz\", repos = NULL)`\r\n* **Other Platforms**: You can find binaries [here](https://github.com/duckdb/duckdb/releases/tag/master-builds) or compile from source.\r\n\r\n- [x] **Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?**\r\n\n",
  "hints_text": "\n",
  "created_at": "2022-04-03T12:00:41Z"
}