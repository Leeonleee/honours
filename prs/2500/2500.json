{
  "repo": "duckdb/duckdb",
  "pull_number": 2500,
  "instance_id": "duckdb__duckdb-2500",
  "issue_numbers": [
    "2496"
  ],
  "base_commit": "66acd324633cfa4339c2fa16c19932fb2e00722d",
  "patch": "diff --git a/src/common/sort/comparators.cpp b/src/common/sort/comparators.cpp\nindex 2279859153aa..2bcf47fbb144 100644\n--- a/src/common/sort/comparators.cpp\n+++ b/src/common/sort/comparators.cpp\n@@ -162,7 +162,7 @@ int Comparators::CompareStringAndAdvance(data_ptr_t &left_ptr, data_ptr_t &right\n \tleft_ptr += sizeof(uint32_t);\n \tright_ptr += sizeof(uint32_t);\n \tstring_t left_val((const char *)left_ptr, left_string_size);\n-\tstring_t right_val((const char *)right_ptr, left_string_size);\n+\tstring_t right_val((const char *)right_ptr, right_string_size);\n \tleft_ptr += left_string_size;\n \tright_ptr += right_string_size;\n \t// Compare\n",
  "test_patch": "diff --git a/test/issues/general/test_2496.test b/test/issues/general/test_2496.test\nnew file mode 100644\nindex 000000000000..c71bb36e5a7d\n--- /dev/null\n+++ b/test/issues/general/test_2496.test\n@@ -0,0 +1,37 @@\n+# name: test/issues/general/test_2496.test\n+# description: Issue 2496: Incorrect Struct Sorting Order on Ties\n+# group: [general]\n+\n+statement ok\n+CREATE TABLE list_str AS\n+SELECT * FROM (VALUES\n+\t({'x': 'duck', 'y': ''}),\n+\t({'x': 'duck', 'y': 'goose'})\n+) tbl(i)\n+\n+query II\n+SELECT lhs.i, rhs.i\n+FROM list_str lhs, list_str rhs\n+ORDER BY lhs.i, rhs.i\n+----\n+{'x': duck, 'y': }\t{'x': duck, 'y': }\n+{'x': duck, 'y': }\t{'x': duck, 'y': goose}\n+{'x': duck, 'y': goose}\t{'x': duck, 'y': }\n+{'x': duck, 'y': goose}\t{'x': duck, 'y': goose}\n+\n+statement ok\n+CREATE TABLE test AS\n+SELECT * FROM (VALUES\n+\t(['duck', '']),\n+\t(['duck', 'goose'])\n+) tbl(i)\n+\n+query II\n+SELECT lhs.i, rhs.i\n+FROM test lhs, test rhs\n+ORDER BY lhs.i, rhs.i\n+----\n+[duck, ]\t[duck, ]\n+[duck, ]\t[duck, goose]\n+[duck, goose]\t[duck, ]\n+[duck, goose]\t[duck, goose]\n",
  "problem_statement": "Incorrect Struct Sorting Order on Ties\n```sql\r\nCREATE TABLE list_str AS\r\nSELECT * FROM (VALUES\r\n\t({'x': 'duck', 'y': ''}),\r\n\t({'x': 'duck', 'y': 'goose'})\r\n) tbl(i);\r\nSELECT lhs.i, rhs.i\r\nFROM list_str lhs, list_str rhs\r\nORDER BY lhs.i, rhs.i;\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502            i            \u2502            i            \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 {'x': duck, 'y': goose} \u2502 {'x': duck, 'y': }      \u2502\r\n\u2502 {'x': duck, 'y': goose} \u2502 {'x': duck, 'y': goose} \u2502\r\n\u2502 {'x': duck, 'y': }      \u2502 {'x': duck, 'y': }      \u2502\r\n\u2502 {'x': duck, 'y': }      \u2502 {'x': duck, 'y': goose} \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n\r\nWithout the `'x': 'duck'` the rows are sorted in the correct order:\r\n\r\n```sql\r\nCREATE TABLE list_str AS\r\nSELECT * FROM (VALUES\r\n\t({'y': ''}),\r\n\t({'y': 'goose'})\r\n) tbl(i);\r\nSELECT lhs.i, rhs.i\r\nFROM list_str lhs, list_str rhs\r\nORDER BY lhs.i, rhs.i;\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502      i       \u2502      i       \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 {'y': }      \u2502 {'y': }      \u2502\r\n\u2502 {'y': }      \u2502 {'y': goose} \u2502\r\n\u2502 {'y': goose} \u2502 {'y': }      \u2502\r\n\u2502 {'y': goose} \u2502 {'y': goose} \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n\n",
  "hints_text": "",
  "created_at": "2021-10-29T09:37:40Z"
}