{
  "repo": "duckdb/duckdb",
  "pull_number": 7234,
  "instance_id": "duckdb__duckdb-7234",
  "issue_numbers": [
    "7219",
    "7219"
  ],
  "base_commit": "094226ff6959a9c5a5c3556b67f97337a6742800",
  "patch": "diff --git a/src/execution/physical_plan/plan_aggregate.cpp b/src/execution/physical_plan/plan_aggregate.cpp\nindex 109b39b91ddf..909711c50da2 100644\n--- a/src/execution/physical_plan/plan_aggregate.cpp\n+++ b/src/execution/physical_plan/plan_aggregate.cpp\n@@ -124,7 +124,7 @@ unique_ptr<PhysicalOperator> PhysicalPlanGenerator::CreatePlan(LogicalAggregate\n \n \tplan = ExtractAggregateExpressions(std::move(plan), op.expressions, op.groups);\n \n-\tif (op.groups.empty()) {\n+\tif (op.groups.empty() && op.grouping_sets.size() <= 1) {\n \t\t// no groups, check if we can use a simple aggregation\n \t\t// special case: aggregate entire columns together\n \t\tbool use_simple_aggregation = true;\n",
  "test_patch": "diff --git a/test/sql/aggregate/grouping_sets/multiple_empty_grouping_sets.test b/test/sql/aggregate/grouping_sets/multiple_empty_grouping_sets.test\nnew file mode 100644\nindex 000000000000..0d50bcf5dd7f\n--- /dev/null\n+++ b/test/sql/aggregate/grouping_sets/multiple_empty_grouping_sets.test\n@@ -0,0 +1,13 @@\n+# name: test/sql/aggregate/grouping_sets/multiple_empty_grouping_sets.test\n+# description: Issue #7219 - Wrong GROUPING SETS implementation when using 2 empty grouping sets\n+# group: [grouping_sets]\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+query I\n+select count(*)\n+group by grouping sets ((), ())\n+----\n+1\n+1\n",
  "problem_statement": "Wrong GROUPING SETS implementation when using 2 empty grouping sets\n### What happens?\n\nDuplicate grouping sets are not respected.\n\n### To Reproduce\n\n```sql\r\nselect count(*)\r\ngroup by grouping sets ((), ())\r\n```\r\n\r\nThis produces:\r\n\r\n```\r\n|count_star()|\r\n|------------|\r\n|1           |\r\n```\r\n\r\nBut it should produce:\r\n\r\n```\r\n|count_star()|\r\n|------------|\r\n|1           |\r\n|1           |\r\n```\n\n### OS:\n\nMicrosoft Windows [Version 10.0.22621.1555]\n\n### DuckDB Version:\n\nv0.7.2-dev2430\n\n### DuckDB Client:\n\nJDBC\n\n### Full Name:\n\nLukas Eder\n\n### Affiliation:\n\nData Geekery / jOOQ\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\nWrong GROUPING SETS implementation when using 2 empty grouping sets\n### What happens?\n\nDuplicate grouping sets are not respected.\n\n### To Reproduce\n\n```sql\r\nselect count(*)\r\ngroup by grouping sets ((), ())\r\n```\r\n\r\nThis produces:\r\n\r\n```\r\n|count_star()|\r\n|------------|\r\n|1           |\r\n```\r\n\r\nBut it should produce:\r\n\r\n```\r\n|count_star()|\r\n|------------|\r\n|1           |\r\n|1           |\r\n```\n\n### OS:\n\nMicrosoft Windows [Version 10.0.22621.1555]\n\n### DuckDB Version:\n\nv0.7.2-dev2430\n\n### DuckDB Client:\n\nJDBC\n\n### Full Name:\n\nLukas Eder\n\n### Affiliation:\n\nData Geekery / jOOQ\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "Note it seems that the problem is related to the empty grouping sets being consecutive without any other grouping sets being present. When adding at least one \"normal\" grouping set, then the problem disappears:\r\n\r\n```sql\r\nselect count(*)\r\nfrom (values (1)) t (a)\r\ngroup by grouping sets ((), (), (a), (), ())\r\n```\r\n\r\nThis results in:\r\n\r\n```\r\n|count_star()|\r\n|------------|\r\n|1           |\r\n|1           |\r\n|1           |\r\n|1           |\r\n|1           |\r\n```\nNote it seems that the problem is related to the empty grouping sets being consecutive without any other grouping sets being present. When adding at least one \"normal\" grouping set, then the problem disappears:\r\n\r\n```sql\r\nselect count(*)\r\nfrom (values (1)) t (a)\r\ngroup by grouping sets ((), (), (a), (), ())\r\n```\r\n\r\nThis results in:\r\n\r\n```\r\n|count_star()|\r\n|------------|\r\n|1           |\r\n|1           |\r\n|1           |\r\n|1           |\r\n|1           |\r\n```",
  "created_at": "2023-04-25T13:51:42Z"
}