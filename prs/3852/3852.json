{
  "repo": "duckdb/duckdb",
  "pull_number": 3852,
  "instance_id": "duckdb__duckdb-3852",
  "issue_numbers": [
    "3851"
  ],
  "base_commit": "cdfb9f92ffb04669d46bd531de5c88e85ade9d43",
  "patch": "diff --git a/src/catalog/catalog_entry/table_catalog_entry.cpp b/src/catalog/catalog_entry/table_catalog_entry.cpp\nindex af5c08a7e2cc..6edad95b0263 100644\n--- a/src/catalog/catalog_entry/table_catalog_entry.cpp\n+++ b/src/catalog/catalog_entry/table_catalog_entry.cpp\n@@ -671,6 +671,9 @@ string TableCatalogEntry::ToSQL() {\n \t\tif (column.DefaultValue()) {\n \t\t\tss << \" DEFAULT(\" << column.DefaultValue()->ToString() << \")\";\n \t\t}\n+\t\tif (column.Generated()) {\n+\t\t\tss << \" GENERATED ALWAYS AS(\" << column.GeneratedExpression().ToString() << \")\";\n+\t\t}\n \t}\n \t// print any extra constraints that still need to be printed\n \tfor (auto &extra_constraint : extra_constraints) {\n",
  "test_patch": "diff --git a/test/sql/export/export_generated_columns.test b/test/sql/export/export_generated_columns.test\nnew file mode 100644\nindex 000000000000..5618028aeb75\n--- /dev/null\n+++ b/test/sql/export/export_generated_columns.test\n@@ -0,0 +1,40 @@\n+# name: test/sql/export/export_generated_columns.test\n+# description: Test export of generated columns\n+# group: [export]\n+\n+statement ok\n+BEGIN TRANSACTION\n+\n+statement ok\n+CREATE TABLE tbl (\n+\tx INTEGER,\n+\tgen_x AS (x + 5)\n+);\n+\n+statement ok\n+INSERT INTO tbl VALUES(5);\n+\n+# Generated columns can not be inserted into directly\n+statement error\n+INSERT INTO tbl VALUES(2,3)\n+\n+# 'x' can not be removed, as 'gen_x' depends on it\n+statement error\n+ALTER TABLE tbl DROP COLUMN x;\n+\n+statement ok\n+EXPORT DATABASE '__TEST_DIR__/export_generated_columns' (FORMAT CSV);\n+\n+statement ok\n+ROLLBACK\n+\n+statement ok\n+IMPORT DATABASE '__TEST_DIR__/export_generated_columns'\n+\n+# Generated columns can not be inserted into directly\n+statement error\n+INSERT INTO tbl VALUES(2,3)\n+\n+# 'x' can not be removed, as 'gen_x' depends on it\n+statement error\n+ALTER TABLE tbl DROP COLUMN x;\n",
  "problem_statement": "Exported database does not include generated column function\n#### What happens?\r\n\r\nThe schema.sql of an exported database includes the name and type of generated columns but not the function itself.\r\n\r\nGenerated columns are brand new (thanks @Tishj!) and not an official release yet, so feel free to close if this issue is premature.\r\n\r\n#### To Reproduce\r\n\r\n```sql\r\nCREATE TABLE t1(x FLOAT, two_x AS (2 * x));\r\nEXPORT DATABASE 'exporttest';\r\n```\r\n\r\n`exportest/schema.sql`\r\n```sql\r\nCREATE TABLE t1(x FLOAT, two_x FLOAT);\r\n```\r\n\r\n#### Environment (please complete the following information):\r\n - OS: Windows\r\n - DuckDB Version: 0.3.5.dev1239\r\n - DuckDB Client: python\r\n\r\n#### Before Submitting\r\n\r\n- [X] **Have you tried this on the latest `master` branch?**\r\n* **Python**: `pip install duckdb --upgrade --pre`\r\n\r\n- [X] **Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?**\r\n\n",
  "hints_text": "Hey! Thanks for making me aware of this issue, definitely not premature, just an oversight on my part \ud83d\udc4d ",
  "created_at": "2022-06-14T15:12:52Z"
}