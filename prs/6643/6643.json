{
  "repo": "duckdb/duckdb",
  "pull_number": 6643,
  "instance_id": "duckdb__duckdb-6643",
  "issue_numbers": [
    "6640",
    "6640"
  ],
  "base_commit": "219bd19e870de78ff06c758a419db6492530b5ab",
  "patch": "diff --git a/src/parser/transform/statement/transform_rename.cpp b/src/parser/transform/statement/transform_rename.cpp\nindex d6f2498552fa..8edcf1f944a3 100644\n--- a/src/parser/transform/statement/transform_rename.cpp\n+++ b/src/parser/transform/statement/transform_rename.cpp\n@@ -6,7 +6,9 @@ namespace duckdb {\n unique_ptr<AlterStatement> Transformer::TransformRename(duckdb_libpgquery::PGNode *node) {\n \tauto stmt = reinterpret_cast<duckdb_libpgquery::PGRenameStmt *>(node);\n \tD_ASSERT(stmt);\n-\tD_ASSERT(stmt->relation);\n+\tif (!stmt->relation) {\n+\t\tthrow NotImplementedException(\"Altering schemas is not yet supported\");\n+\t}\n \n \tunique_ptr<AlterInfo> info;\n \n@@ -17,8 +19,6 @@ unique_ptr<AlterStatement> Transformer::TransformRename(duckdb_libpgquery::PGNod\n \tif (stmt->relation->relname) {\n \t\tdata.name = stmt->relation->relname;\n \t}\n-\tif (stmt->relation->schemaname) {\n-\t}\n \t// first we check the type of ALTER\n \tswitch (stmt->renameType) {\n \tcase duckdb_libpgquery::PG_OBJECT_COLUMN: {\n@@ -36,7 +36,6 @@ unique_ptr<AlterStatement> Transformer::TransformRename(duckdb_libpgquery::PGNod\n \t\tinfo = make_unique<RenameTableInfo>(std::move(data), new_name);\n \t\tbreak;\n \t}\n-\n \tcase duckdb_libpgquery::PG_OBJECT_VIEW: {\n \t\t// change view name\n \t\tstring new_name = stmt->newname;\n",
  "test_patch": "diff --git a/test/sql/alter/rename_schema/rename_schema.test b/test/sql/alter/rename_schema/rename_schema.test\nnew file mode 100644\nindex 000000000000..08261aae49f3\n--- /dev/null\n+++ b/test/sql/alter/rename_schema/rename_schema.test\n@@ -0,0 +1,8 @@\n+# name: test/sql/alter/rename_schema/rename_schema.test\n+# description: Fix #6640: Crash When Altering Schema\n+# group: [rename_schema]\n+\n+statement error\n+ALTER SCHEMA a RENAME TO b;\n+----\n+not yet supported\n",
  "problem_statement": "Crash When Altering Schema\n### What happens?\n\nCrash.\n\n### To Reproduce\n\n```sql\r\nALTER SCHEMA a RENAME TO b; -- segmentation fault\r\n```\n\n### OS:\n\nWSL2-ubuntu22.04 and macOS13.2.1\n\n### DuckDB Version:\n\nduckdb-v0.7.1 b00b93f0b1\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nSuyang Zhong\n\n### Affiliation:\n\nNUS\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\nCrash When Altering Schema\n### What happens?\n\nCrash.\n\n### To Reproduce\n\n```sql\r\nALTER SCHEMA a RENAME TO b; -- segmentation fault\r\n```\n\n### OS:\n\nWSL2-ubuntu22.04 and macOS13.2.1\n\n### DuckDB Version:\n\nduckdb-v0.7.1 b00b93f0b1\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nSuyang Zhong\n\n### Affiliation:\n\nNUS\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "\n",
  "created_at": "2023-03-09T15:49:59Z"
}