{
  "repo": "duckdb/duckdb",
  "pull_number": 2623,
  "instance_id": "duckdb__duckdb-2623",
  "issue_numbers": [
    "2612",
    "2612"
  ],
  "base_commit": "9fd0403b69f768bb6dca03aa5a841a96cd306348",
  "patch": "diff --git a/src/parser/parsed_data/alter_table_info.cpp b/src/parser/parsed_data/alter_table_info.cpp\nindex def8a8fffe65..b6cd24e8b41c 100644\n--- a/src/parser/parsed_data/alter_table_info.cpp\n+++ b/src/parser/parsed_data/alter_table_info.cpp\n@@ -148,7 +148,8 @@ unique_ptr<AlterInfo> ChangeColumnTypeInfo::Deserialize(Deserializer &source, st\n // SetDefaultInfo\n //===--------------------------------------------------------------------===//\n unique_ptr<AlterInfo> SetDefaultInfo::Copy() const {\n-\treturn make_unique_base<AlterInfo, SetDefaultInfo>(schema, name, column_name, expression->Copy());\n+\treturn make_unique_base<AlterInfo, SetDefaultInfo>(schema, name, column_name,\n+\t                                                   expression ? expression->Copy() : nullptr);\n }\n \n void SetDefaultInfo::Serialize(Serializer &serializer) {\n",
  "test_patch": "diff --git a/test/sql/alter/default/drop_default.test b/test/sql/alter/default/drop_default.test\nnew file mode 100644\nindex 000000000000..7e566cf479b1\n--- /dev/null\n+++ b/test/sql/alter/default/drop_default.test\n@@ -0,0 +1,30 @@\n+# name: test/sql/alter/default/drop_default.test\n+# description: Test ALTER TABLE DROP DEFAULT\n+# group: [default]\n+\n+statement ok\n+PRAGMA enable_verification;\n+\n+statement ok\n+CREATE TABLE data(id INTEGER, x INTEGER);\n+\n+statement ok\n+ALTER TABLE data ALTER COLUMN id DROP DEFAULT;\n+\n+statement ok\n+INSERT INTO data VALUES (1, 0), (2, 1);\n+\n+statement ok\n+ALTER TABLE data ALTER COLUMN id DROP DEFAULT;\n+\n+statement ok\n+ALTER TABLE data ALTER COLUMN id DROP DEFAULT;\n+\n+statement ok\n+ALTER TABLE data ALTER COLUMN x DROP DEFAULT;\n+\n+statement ok\n+ALTER TABLE data ALTER COLUMN x DROP DEFAULT;\n+\n+statement error\n+ALTER TABLE data ALTER COLUMN j DROP DEFAULT;\ndiff --git a/test/sql/alter/test_set_default.test b/test/sql/alter/default/test_set_default.test\nsimilarity index 93%\nrename from test/sql/alter/test_set_default.test\nrename to test/sql/alter/default/test_set_default.test\nindex 1d7fedc43a2d..dc7ad9787c71 100644\n--- a/test/sql/alter/test_set_default.test\n+++ b/test/sql/alter/default/test_set_default.test\n@@ -1,6 +1,6 @@\n-# name: test/sql/alter/test_set_default.test\n+# name: test/sql/alter/default/test_set_default.test\n # description: Test ALTER TABLE SET DEFAULT\n-# group: [alter]\n+# group: [default]\n \n statement ok\n CREATE TABLE test(i INTEGER, j INTEGER)\n",
  "problem_statement": "R segfaults on \"DROP DEFAULT\"\n#### What happens?\r\nR segfaults / memory not mapped.\r\n\r\n#### To Reproduce\r\n```r\r\ndf = data.frame(id = 1:2, x = runif(2))\r\npath = tempfile()\r\ncon = DBI::dbConnect(duckdb::duckdb(), dbdir = path, read_only = FALSE)\r\nDBI::dbWriteTable(con, \"data\", df, row.names = FALSE)\r\nDBI::dbExecute(con, 'ALTER TABLE data ALTER COLUMN id DROP DEFAULT')\r\n```\r\n#### Environment\r\n```\r\nR version 4.1.2 (2021-11-01)\r\nPlatform: x86_64-pc-linux-gnu (64-bit)\r\nRunning under: Arch Linux\r\n\r\nMatrix products: default\r\nBLAS/LAPACK: /usr/lib/libopenblas_haswellp-r0.3.18.so\r\n\r\nlocale:\r\n [1] LC_CTYPE=de_DE.utf8       LC_NUMERIC=C\r\n [3] LC_TIME=en_US.UTF-8       LC_COLLATE=en_US.UTF-8\r\n [5] LC_MONETARY=en_US.UTF-8   LC_MESSAGES=de_DE.utf8\r\n [7] LC_PAPER=de_DE.utf8       LC_NAME=C\r\n [9] LC_ADDRESS=C              LC_TELEPHONE=C\r\n[11] LC_MEASUREMENT=de_DE.utf8 LC_IDENTIFICATION=C\r\n\r\nattached base packages:\r\n[1] stats     graphics  grDevices utils     datasets  methods   base\r\n\r\nother attached packages:\r\n[1] nvimcom_0.9-122   data.table_1.14.2\r\n\r\nloaded via a namespace (and not attached):\r\n[1] compiler_4.1.2 duckdb_0.3.1   DBI_1.1.1      tools_4.1.2    parallel_4.1.2\r\n[6] rlang_0.4.12\r\n```\nR segfaults on \"DROP DEFAULT\"\n#### What happens?\r\nR segfaults / memory not mapped.\r\n\r\n#### To Reproduce\r\n```r\r\ndf = data.frame(id = 1:2, x = runif(2))\r\npath = tempfile()\r\ncon = DBI::dbConnect(duckdb::duckdb(), dbdir = path, read_only = FALSE)\r\nDBI::dbWriteTable(con, \"data\", df, row.names = FALSE)\r\nDBI::dbExecute(con, 'ALTER TABLE data ALTER COLUMN id DROP DEFAULT')\r\n```\r\n#### Environment\r\n```\r\nR version 4.1.2 (2021-11-01)\r\nPlatform: x86_64-pc-linux-gnu (64-bit)\r\nRunning under: Arch Linux\r\n\r\nMatrix products: default\r\nBLAS/LAPACK: /usr/lib/libopenblas_haswellp-r0.3.18.so\r\n\r\nlocale:\r\n [1] LC_CTYPE=de_DE.utf8       LC_NUMERIC=C\r\n [3] LC_TIME=en_US.UTF-8       LC_COLLATE=en_US.UTF-8\r\n [5] LC_MONETARY=en_US.UTF-8   LC_MESSAGES=de_DE.utf8\r\n [7] LC_PAPER=de_DE.utf8       LC_NAME=C\r\n [9] LC_ADDRESS=C              LC_TELEPHONE=C\r\n[11] LC_MEASUREMENT=de_DE.utf8 LC_IDENTIFICATION=C\r\n\r\nattached base packages:\r\n[1] stats     graphics  grDevices utils     datasets  methods   base\r\n\r\nother attached packages:\r\n[1] nvimcom_0.9-122   data.table_1.14.2\r\n\r\nloaded via a namespace (and not attached):\r\n[1] compiler_4.1.2 duckdb_0.3.1   DBI_1.1.1      tools_4.1.2    parallel_4.1.2\r\n[6] rlang_0.4.12\r\n```\n",
  "hints_text": "Thanks for the report! I can confirm this crashes. I will have a look.\nThanks for the report! I can confirm this crashes. I will have a look.",
  "created_at": "2021-11-17T19:07:38Z"
}