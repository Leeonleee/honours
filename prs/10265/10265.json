{
  "repo": "duckdb/duckdb",
  "pull_number": 10265,
  "instance_id": "duckdb__duckdb-10265",
  "issue_numbers": [
    "10254"
  ],
  "base_commit": "077e19e969d384bfb7c9eb22f825dbd935c19571",
  "patch": "diff --git a/extension/fts/fts_indexing.cpp b/extension/fts/fts_indexing.cpp\nindex a2bb4b2542ef..5fba04d4831d 100644\n--- a/extension/fts/fts_indexing.cpp\n+++ b/extension/fts/fts_indexing.cpp\n@@ -171,6 +171,20 @@ static string IndexingScript(ClientContext &context, QualifiedName &qname, const\n                 WHERE CASE WHEN fields IS NULL THEN 1 ELSE fieldid IN (SELECT * FROM fieldids) END\n                   AND termid IN (SELECT qtermids.termid FROM qtermids)\n             ),\n+\t\t\tterm_tf AS (\n+\t\t\t\tSELECT termid,\n+\t\t\t\t   \t   docid,\n+                       COUNT(*) AS tf\n+\t\t\t\tFROM qterms\n+\t\t\t\tGROUP BY docid,\n+\t\t\t\t\t\t termid\n+\t\t\t),\n+\t\t\tcdocs AS (\n+\t\t\t\tSELECT docid\n+\t\t\t\tFROM qterms\n+\t\t\t\tGROUP BY docid\n+\t\t\t\tHAVING CASE WHEN conjunctive THEN COUNT(DISTINCT termid) = (SELECT COUNT(*) FROM tokens) ELSE 1 END\n+\t\t\t),\n             subscores AS (\n                 SELECT docs.docid,\n                        len,\n@@ -178,36 +192,25 @@ static string IndexingScript(ClientContext &context, QualifiedName &qname, const\n                        tf,\n                        df,\n                        (log(((SELECT num_docs FROM %fts_schema%.stats) - df + 0.5) / (df + 0.5))* ((tf * (k + 1)/(tf + k * (1 - b + b * (len / (SELECT avgdl FROM %fts_schema%.stats))))))) AS subscore\n-                FROM (\n-                    SELECT termid,\n-                           docid,\n-                           COUNT(*) AS tf\n-                    FROM qterms\n-                    GROUP BY docid,\n-                             termid\n-                ) AS term_tf\n-                JOIN (\n-                    SELECT docid\n-                    FROM qterms\n-                    GROUP BY docid\n-                    HAVING CASE WHEN conjunctive THEN COUNT(DISTINCT termid) = (SELECT COUNT(*) FROM tokens) ELSE 1 END\n-                ) AS cdocs\n-                ON term_tf.docid = cdocs.docid\n-                JOIN %fts_schema%.docs AS docs\n-                ON term_tf.docid = docs.docid\n-                JOIN %fts_schema%.dict AS dict\n-                ON term_tf.termid = dict.termid\n-            )\n+                FROM term_tf,\n+\t\t\t\t\t cdocs,\n+\t\t\t\t\t %fts_schema%.docs AS docs,\n+\t\t\t\t\t %fts_schema%.dict AS dict\n+\t\t\t\tWHERE term_tf.docid = cdocs.docid\n+\t\t\t\t  AND term_tf.docid = docs.docid\n+                  AND term_tf.termid = dict.termid\n+            ),\n+\t\t\tscores AS (\n+\t\t\t\tSELECT docid,\n+\t\t\t\t\t   sum(subscore) AS score\n+\t\t\t\tFROM subscores\n+\t\t\t\tGROUP BY docid\n+\t\t\t)\n             SELECT score\n-            FROM (\n-                SELECT docid,\n-                       sum(subscore) AS score\n-                FROM subscores\n-                GROUP BY docid\n-            ) AS scores\n-            JOIN %fts_schema%.docs AS docs\n-            ON  scores.docid = docs.docid\n-            AND docs.name = docname\n+            FROM scores,\n+\t\t\t\t %fts_schema%.docs AS docs\n+            WHERE scores.docid = docs.docid\n+              AND docs.name = docname\n         );\n     )\";\n \n@@ -266,7 +269,7 @@ string FTSIndexing::CreateFTSIndexQuery(ClientContext &context, const FunctionPa\n \t\t}\n \t}\n \n-\tstring ignore = \"(\\\\\\\\.|[^a-z])+\";\n+\tstring ignore = \"[0-9!@#$%^&*()_+={}\\\\[\\\\]:;<>,.?~\\\\\\\\/\\\\|''\\\"`-]+\";\n \tauto ignore_entry = parameters.named_parameters.find(\"ignore\");\n \tif (ignore_entry != parameters.named_parameters.end()) {\n \t\tignore = StringValue::Get(ignore_entry->second);\ndiff --git a/src/optimizer/join_order/cardinality_estimator.cpp b/src/optimizer/join_order/cardinality_estimator.cpp\nindex 8c56fcc12658..18fd5c858386 100644\n--- a/src/optimizer/join_order/cardinality_estimator.cpp\n+++ b/src/optimizer/join_order/cardinality_estimator.cpp\n@@ -154,7 +154,7 @@ double CardinalityEstimator::EstimateCardinalityWithSet(JoinRelationSet &new_set\n \tfor (idx_t i = 0; i < new_set.count; i++) {\n \t\tauto &single_node_set = set_manager.GetJoinRelation(new_set.relations[i]);\n \t\tauto card_helper = relation_set_2_cardinality[single_node_set.ToString()];\n-\t\tnumerator *= card_helper.cardinality_before_filters;\n+\t\tnumerator *= card_helper.cardinality_before_filters == 0 ? 1 : card_helper.cardinality_before_filters;\n \t\tactual_set.insert(new_set.relations[i]);\n \t}\n \n",
  "test_patch": "diff --git a/test/sql/fts/test_issue_10254.test b/test/sql/fts/test_issue_10254.test\nnew file mode 100644\nindex 000000000000..c24f61bba06b\n--- /dev/null\n+++ b/test/sql/fts/test_issue_10254.test\n@@ -0,0 +1,23 @@\n+# name: test/sql/fts/test_issue_10254.test\n+# description: Test issue #10254: FTS not working with stemmer\n+# group: [fts]\n+\n+require fts\n+\n+statement ok\n+CREATE TABLE data (context VARCHAR, question VARCHAR, id BIGINT)\n+\n+statement ok\n+INSERT INTO data VALUES\n+    ('\u041c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0439 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c \u2014 \u0432\u043d\u0435\u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0436\u0438\u0432\u044b\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432, \u0442\u0435\u043b\u043e \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0438\u0437 \u043c\u043d\u043e\u0433\u0438\u0445 \u043a\u043b\u0435\u0442\u043e\u043a, \u0431\u043e\u043b\u044c\u0448\u0430\u044f \u0447\u0430\u0441\u0442\u044c \u043a\u043e\u0442\u043e\u0440\u044b\u0445 (\u043a\u0440\u043e\u043c\u0435 \u0441\u0442\u0432\u043e\u043b\u043e\u0432\u044b\u0445, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043a\u043b\u0435\u0442\u043e\u043a \u043a\u0430\u043c\u0431\u0438\u044f \u0443 \u0440\u0430\u0441\u0442\u0435\u043d\u0438\u0439) \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u044b, \u0442\u043e \u0435\u0441\u0442\u044c \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u044e\u0442\u0441\u044f \u043f\u043e \u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044e \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u044b\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c. \u0421\u043b\u0435\u0434\u0443\u0435\u0442 \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c. \u0423 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043a\u043b\u0435\u0442\u043a\u0438, \u0430 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e, \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043b\u0430 \u043d\u0430 \u0442\u043a\u0430\u043d\u0438. \u0413\u0440\u0430\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c\u044e \u043d\u0435\u0447\u0451\u0442\u043a\u0430\u044f. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u043e\u043b\u044c\u0432\u043e\u043a\u0441 \u0447\u0430\u0441\u0442\u043e \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u043c \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u0430\u043c, \u0445\u043e\u0442\u044f \u0432 \u0435\u0433\u043e \u043a\u043e\u043b\u043e\u043d\u0438\u044f\u0445 \u0435\u0441\u0442\u044c \u0447\u0451\u0442\u043a\u043e\u0435 \u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043a\u043b\u0435\u0442\u043e\u043a \u043d\u0430 \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u0438 \u0441\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435. \u041a\u0440\u043e\u043c\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0430\u0446\u0438\u0438 \u043a\u043b\u0435\u0442\u043e\u043a, \u0434\u043b\u044f \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0445 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0435\u043d \u0438 \u0431\u043e\u043b\u0435\u0435 \u0432\u044b\u0441\u043e\u043a\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438, \u0447\u0435\u043c \u0434\u043b\u044f \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u0444\u043e\u0440\u043c. \u041c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0435 \u0436\u0438\u0432\u043e\u0442\u043d\u044b\u0435, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043f\u043e\u044f\u0432\u0438\u043b\u0438\u0441\u044c \u043d\u0430 \u0417\u0435\u043c\u043b\u0435 2,1 \u043c\u0438\u043b\u043b\u0438\u0430\u0440\u0434\u0430 \u043b\u0435\u0442 \u043d\u0430\u0437\u0430\u0434, \u0432\u0441\u043a\u043e\u0440\u0435 \u043f\u043e\u0441\u043b\u0435 \u043a\u0438\u0441\u043b\u043e\u0440\u043e\u0434\u043d\u043e\u0439 \u0440\u0435\u0432\u043e\u043b\u044e\u0446\u0438\u0438 .', '\u0423 \u043a\u0430\u043a\u0438\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043a\u043b\u0435\u0442\u043a\u0438?', 0),\n+    ('\u041c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0439 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c \u2014 \u0432\u043d\u0435\u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0436\u0438\u0432\u044b\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432, \u0442\u0435\u043b\u043e \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0438\u0437 \u043c\u043d\u043e\u0433\u0438\u0445 \u043a\u043b\u0435\u0442\u043e\u043a, \u0431\u043e\u043b\u044c\u0448\u0430\u044f \u0447\u0430\u0441\u0442\u044c \u043a\u043e\u0442\u043e\u0440\u044b\u0445 (\u043a\u0440\u043e\u043c\u0435 \u0441\u0442\u0432\u043e\u043b\u043e\u0432\u044b\u0445, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043a\u043b\u0435\u0442\u043e\u043a \u043a\u0430\u043c\u0431\u0438\u044f \u0443 \u0440\u0430\u0441\u0442\u0435\u043d\u0438\u0439) \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u044b, \u0442\u043e \u0435\u0441\u0442\u044c \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u044e\u0442\u0441\u044f \u043f\u043e \u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044e \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u044b\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c. \u0421\u043b\u0435\u0434\u0443\u0435\u0442 \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c. \u0423 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043a\u043b\u0435\u0442\u043a\u0438, \u0430 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e, \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043b\u0430 \u043d\u0430 \u0442\u043a\u0430\u043d\u0438. \u0413\u0440\u0430\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c\u044e \u043d\u0435\u0447\u0451\u0442\u043a\u0430\u044f. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u043e\u043b\u044c\u0432\u043e\u043a\u0441 \u0447\u0430\u0441\u0442\u043e \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u043c \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u0430\u043c, \u0445\u043e\u0442\u044f \u0432 \u0435\u0433\u043e \u043a\u043e\u043b\u043e\u043d\u0438\u044f\u0445 \u0435\u0441\u0442\u044c \u0447\u0451\u0442\u043a\u043e\u0435 \u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043a\u043b\u0435\u0442\u043e\u043a \u043d\u0430 \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u0438 \u0441\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435. \u041a\u0440\u043e\u043c\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0430\u0446\u0438\u0438 \u043a\u043b\u0435\u0442\u043e\u043a, \u0434\u043b\u044f \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0445 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0435\u043d \u0438 \u0431\u043e\u043b\u0435\u0435 \u0432\u044b\u0441\u043e\u043a\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438, \u0447\u0435\u043c \u0434\u043b\u044f \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u0444\u043e\u0440\u043c. \u041c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0435 \u0436\u0438\u0432\u043e\u0442\u043d\u044b\u0435, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043f\u043e\u044f\u0432\u0438\u043b\u0438\u0441\u044c \u043d\u0430 \u0417\u0435\u043c\u043b\u0435 2,1 \u043c\u0438\u043b\u043b\u0438\u0430\u0440\u0434\u0430 \u043b\u0435\u0442 \u043d\u0430\u0437\u0430\u0434, \u0432\u0441\u043a\u043e\u0440\u0435 \u043f\u043e\u0441\u043b\u0435 \u043a\u0438\u0441\u043b\u043e\u0440\u043e\u0434\u043d\u043e\u0439 \u0440\u0435\u0432\u043e\u043b\u044e\u0446\u0438\u0438 .', '\u041a\u0430\u043a\u0438\u0435 \u0436\u0438\u0432\u043e\u0442\u043d\u044b\u0435 \u043f\u043e\u044f\u0432\u0438\u043b\u0438\u0441\u044c \u043d\u0430 \u0417\u0435\u043c\u043b\u0435 2,1 \u043c\u0438\u043b\u043b\u0438\u0430\u0440\u0434\u0430 \u043b\u0435\u0442 \u043d\u0430\u0437\u0430\u0434?', 1),\n+    ('\u041c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0439 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c \u2014 \u0432\u043d\u0435\u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0436\u0438\u0432\u044b\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432, \u0442\u0435\u043b\u043e \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0438\u0437 \u043c\u043d\u043e\u0433\u0438\u0445 \u043a\u043b\u0435\u0442\u043e\u043a, \u0431\u043e\u043b\u044c\u0448\u0430\u044f \u0447\u0430\u0441\u0442\u044c \u043a\u043e\u0442\u043e\u0440\u044b\u0445 (\u043a\u0440\u043e\u043c\u0435 \u0441\u0442\u0432\u043e\u043b\u043e\u0432\u044b\u0445, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043a\u043b\u0435\u0442\u043e\u043a \u043a\u0430\u043c\u0431\u0438\u044f \u0443 \u0440\u0430\u0441\u0442\u0435\u043d\u0438\u0439) \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u044b, \u0442\u043e \u0435\u0441\u0442\u044c \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u044e\u0442\u0441\u044f \u043f\u043e \u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044e \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u044b\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c. \u0421\u043b\u0435\u0434\u0443\u0435\u0442 \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c. \u0423 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u043e\u0432 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043a\u043b\u0435\u0442\u043a\u0438, \u0430 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e, \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043b\u0430 \u043d\u0430 \u0442\u043a\u0430\u043d\u0438. \u0413\u0440\u0430\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c\u044e \u043d\u0435\u0447\u0451\u0442\u043a\u0430\u044f. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u043e\u043b\u044c\u0432\u043e\u043a\u0441 \u0447\u0430\u0441\u0442\u043e \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u043c \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u043c\u0430\u043c, \u0445\u043e\u0442\u044f \u0432 \u0435\u0433\u043e \u043a\u043e\u043b\u043e\u043d\u0438\u044f\u0445 \u0435\u0441\u0442\u044c \u0447\u0451\u0442\u043a\u043e\u0435 \u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043a\u043b\u0435\u0442\u043e\u043a \u043d\u0430 \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u0438 \u0441\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435. \u041a\u0440\u043e\u043c\u0435 \u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0430\u0446\u0438\u0438 \u043a\u043b\u0435\u0442\u043e\u043a, \u0434\u043b\u044f \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0445 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0435\u043d \u0438 \u0431\u043e\u043b\u0435\u0435 \u0432\u044b\u0441\u043e\u043a\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438, \u0447\u0435\u043c \u0434\u043b\u044f \u043a\u043e\u043b\u043e\u043d\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u0444\u043e\u0440\u043c. \u041c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0435 \u0436\u0438\u0432\u043e\u0442\u043d\u044b\u0435, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043f\u043e\u044f\u0432\u0438\u043b\u0438\u0441\u044c \u043d\u0430 \u0417\u0435\u043c\u043b\u0435 2,1 \u043c\u0438\u043b\u043b\u0438\u0430\u0440\u0434\u0430 \u043b\u0435\u0442 \u043d\u0430\u0437\u0430\u0434, \u0432\u0441\u043a\u043e\u0440\u0435 \u043f\u043e\u0441\u043b\u0435 \u043a\u0438\u0441\u043b\u043e\u0440\u043e\u0434\u043d\u043e\u0439 \u0440\u0435\u0432\u043e\u043b\u044e\u0446\u0438\u0438 .', '\u041a\u043e\u0433\u0434\u0430 \u043f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u044f\u0432\u0438\u043b\u0438\u0441\u044c \u043c\u043d\u043e\u0433\u043e\u043a\u043b\u0435\u0442\u043e\u0447\u043d\u044b\u0435 \u0436\u0438\u0432\u043e\u0442\u043d\u044b\u0435?', 2)\n+\n+statement ok\n+PRAGMA create_fts_index('data', 'id', 'context', 'question', stemmer='russian', overwrite=1);\n+\n+query I\n+SELECT id FROM (SELECT *, fts_main_data.match_bm25(id, '\u041a\u0430\u043a\u0438\u0435') AS score FROM data) sq WHERE score IS NOT NULL ORDER BY score DESC;\n+----\n+1\n+0\n",
  "problem_statement": "FTS not working with stemmer\n### What happens?\n\nIt is not possible to execute a simple text search using a different stemmer for FTS, but it works when using a LIKE operator.\n\n### To Reproduce\n\nI used a parquet file source with Russian text content and  \"russian\" stemmer parameter for FTS PRAGMA as explained in the doc https://duckdb.org/docs/extensions/full_text_search.html.\r\n\r\nSee that performing a straightforward LIKE operation worked in the WHERE statement:\r\n`SELECT COUNT(*)  FROM \"https://huggingface.co/datasets/sberquad/resolve/refs%2Fconvert%2Fparquet/sberquad/test/0000.parquet?download=true\" WHERE question LIKE '\u041a\u0430\u043a\u0438\u0435%' ;\r\n` \r\n![image](https://github.com/duckdb/duckdb/assets/5564745/df994036-3f1e-4d75-b010-e9eea7f635c6)\r\n\r\nUsing FTS (Extension already installed and loaded):\r\n\r\n`CREATE OR REPLACE TABLE data AS SELECT context, question FROM \"https://huggingface.co/datasets/sberquad/resolve/refs%2Fconvert%2Fparquet/sberquad/test/0000.parquet?download=true\";\r\n`\r\n`CREATE OR REPLACE SEQUENCE serial START 0 MINVALUE 0;`\r\n\r\n`ALTER TABLE data ADD COLUMN id BIGINT DEFAULT nextval('serial');`\r\n\r\n`SELECT COUNT(*) FROM data WHERE question LIKE '\u041a\u0430\u043a\u0438\u0435%';`\r\n\r\n`PRAGMA create_fts_index('data', 'id', 'context', 'question', stemmer='russian', overwrite=1);`\r\n\r\n`SELECT id, question, score FROM (SELECT *, fts_main_data.match_bm25(id, '\u041a\u0430\u043a\u0438\u0435') AS score FROM data) sq WHERE score IS NOT NULL ORDER BY score DESC; `\r\n0 rows \r\nSee that it doesn't even generate a score value for other input text: \r\n![image](https://github.com/duckdb/duckdb/assets/5564745/d8104586-bd67-4f34-9e19-9c1f82367ad5)\r\n\n\n### OS:\n\nUbuntu 22.04.2 LTS x86_64\n\n### DuckDB Version:\n\nv0.9.2 3c695d7ba9\n\n### DuckDB Client:\n\nv0.9.2 3c695d7ba9\n\n### Full Name:\n\nAndrea Soria Jimenez\n\n### Affiliation:\n\nHugging Face\n\n### Have you tried this on the latest `main` branch?\n\nI have tested with a main build\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] Yes, I have\n",
  "hints_text": "",
  "created_at": "2024-01-18T10:08:11Z"
}