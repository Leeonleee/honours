{
  "repo": "duckdb/duckdb",
  "pull_number": 5550,
  "instance_id": "duckdb__duckdb-5550",
  "issue_numbers": [
    "5546",
    "5546"
  ],
  "base_commit": "45d857191be915d3a38c83b75a42a945ba04fe9d",
  "patch": "diff --git a/src/planner/binder/tableref/bind_table_function.cpp b/src/planner/binder/tableref/bind_table_function.cpp\nindex b310db62d7a6..07663ad16aa3 100644\n--- a/src/planner/binder/tableref/bind_table_function.cpp\n+++ b/src/planner/binder/tableref/bind_table_function.cpp\n@@ -92,11 +92,11 @@ bool Binder::BindTableFunctionParameters(TableFunctionCatalogEntry &table_functi\n \t\tif (expr->HasParameter()) {\n \t\t\tthrow ParameterNotResolvedException();\n \t\t}\n-\t\tif (!expr->IsFoldable()) {\n+\t\tif (!expr->IsScalar()) {\n \t\t\terror = \"Table function requires a constant parameter\";\n \t\t\treturn false;\n \t\t}\n-\t\tauto constant = ExpressionExecutor::EvaluateScalar(context, *expr);\n+\t\tauto constant = ExpressionExecutor::EvaluateScalar(context, *expr, true);\n \t\tif (parameter_name.empty()) {\n \t\t\t// unnamed parameter\n \t\t\tif (!named_parameters.empty()) {\n",
  "test_patch": "diff --git a/test/sql/table_function/range_non_foldable.test b/test/sql/table_function/range_non_foldable.test\nnew file mode 100644\nindex 000000000000..75db281ebe1c\n--- /dev/null\n+++ b/test/sql/table_function/range_non_foldable.test\n@@ -0,0 +1,32 @@\n+# name: test/sql/table_function/range_non_foldable.test\n+# description: Issue #5546: non-foldable constant parameters to table function\n+# group: [table_function]\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+query I\n+SELECT COUNT(*)\n+FROM range(\n+  current_date,\n+  current_date + interval '7' days,\n+  interval '1 day'\n+)\n+----\n+7\n+\n+statement ok\n+SELECT to_timestamp(range) as entry\n+    FROM range(\n+      epoch(date_trunc('month', current_date)),\n+      epoch(date_trunc('month', current_date) + interval '1 month' - interval '1 day'),\n+      epoch(interval '1 day')\n+    )\n+\n+statement ok\n+SELECT to_timestamp(range) as entry\n+FROM range(\n+  epoch(date_trunc('month', current_date)),\n+  epoch(date_trunc('month', current_date) + interval '1 month' - interval '1 day'),\n+  epoch(interval '1 day')\n+)\n",
  "problem_statement": "Table function stopped working in v0.6.\n### What happens?\n\nPrior to v0.6, I had been using the following query inside of a CTE to generate a calendar (basically a workaround to using `generate_series()` in postgres to create a table of days in the month for an analytical query).\r\n\r\nIt now fails with the following error:\r\n\r\n```sql\r\n    SELECT to_timestamp(range) as entry\r\n    FROM range(\r\n      epoch(date_trunc('month', current_date)),\r\n      epoch(date_trunc('month', current_date) + interval '1 month' - interval '1 day'),\r\n      epoch(interval '1 day')\r\n    )\r\n-- Error: Binder Error: Table function requires a constant parameter\r\n-- LINE 2:     FROM range(\r\n```\n\n### To Reproduce\n\n```sql\r\n    SELECT to_timestamp(range) as entry\r\n    FROM range(\r\n      epoch(date_trunc('month', current_date)),\r\n      epoch(date_trunc('month', current_date) + interval '1 month' - interval '1 day'),\r\n      epoch(interval '1 day')\r\n    )\r\n```\n\n### OS:\n\nMacOS and Linux (arm)\n\n### DuckDB Version:\n\n0.6.0\n\n### DuckDB Client:\n\nPython and duckdb-cli\n\n### Full Name:\n\nErik Wickstrom\n\n### Affiliation:\n\nLiftCertain\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\nTable function stopped working in v0.6.\n### What happens?\n\nPrior to v0.6, I had been using the following query inside of a CTE to generate a calendar (basically a workaround to using `generate_series()` in postgres to create a table of days in the month for an analytical query).\r\n\r\nIt now fails with the following error:\r\n\r\n```sql\r\n    SELECT to_timestamp(range) as entry\r\n    FROM range(\r\n      epoch(date_trunc('month', current_date)),\r\n      epoch(date_trunc('month', current_date) + interval '1 month' - interval '1 day'),\r\n      epoch(interval '1 day')\r\n    )\r\n-- Error: Binder Error: Table function requires a constant parameter\r\n-- LINE 2:     FROM range(\r\n```\n\n### To Reproduce\n\n```sql\r\n    SELECT to_timestamp(range) as entry\r\n    FROM range(\r\n      epoch(date_trunc('month', current_date)),\r\n      epoch(date_trunc('month', current_date) + interval '1 month' - interval '1 day'),\r\n      epoch(interval '1 day')\r\n    )\r\n```\n\n### OS:\n\nMacOS and Linux (arm)\n\n### DuckDB Version:\n\n0.6.0\n\n### DuckDB Client:\n\nPython and duckdb-cli\n\n### Full Name:\n\nErik Wickstrom\n\n### Affiliation:\n\nLiftCertain\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "\n",
  "created_at": "2022-11-30T11:38:38Z"
}