{
  "repo": "duckdb/duckdb",
  "pull_number": 4324,
  "instance_id": "duckdb__duckdb-4324",
  "issue_numbers": [
    "4309",
    "4309"
  ],
  "base_commit": "cf51f21dc0ef6dadd0b4c8dd89f00a6e46f53db0",
  "patch": "diff --git a/src/catalog/catalog_entry/table_catalog_entry.cpp b/src/catalog/catalog_entry/table_catalog_entry.cpp\nindex 5c536bb9b4c2..d8c7b0e44b37 100644\n--- a/src/catalog/catalog_entry/table_catalog_entry.cpp\n+++ b/src/catalog/catalog_entry/table_catalog_entry.cpp\n@@ -195,7 +195,11 @@ unique_ptr<CatalogEntry> TableCatalogEntry::AlterEntry(ClientContext &context, A\n \t}\n \tcase AlterTableType::FOREIGN_KEY_CONSTRAINT: {\n \t\tauto foreign_key_constraint_info = (AlterForeignKeyInfo *)table_info;\n-\t\treturn SetForeignKeyConstraint(context, *foreign_key_constraint_info);\n+\t\tif (foreign_key_constraint_info->type == AlterForeignKeyType::AFT_ADD) {\n+\t\t\treturn AddForeignKeyConstraint(context, *foreign_key_constraint_info);\n+\t\t} else {\n+\t\t\treturn DropForeignKeyConstraint(context, *foreign_key_constraint_info);\n+\t\t}\n \t}\n \tdefault:\n \t\tthrow InternalException(\"Unrecognized alter table type!\");\n@@ -533,7 +537,35 @@ unique_ptr<CatalogEntry> TableCatalogEntry::ChangeColumnType(ClientContext &cont\n \treturn move(result);\n }\n \n-unique_ptr<CatalogEntry> TableCatalogEntry::SetForeignKeyConstraint(ClientContext &context, AlterForeignKeyInfo &info) {\n+unique_ptr<CatalogEntry> TableCatalogEntry::AddForeignKeyConstraint(ClientContext &context, AlterForeignKeyInfo &info) {\n+\tD_ASSERT(info.type == AlterForeignKeyType::AFT_ADD);\n+\tauto create_info = make_unique<CreateTableInfo>(schema->name, name);\n+\tcreate_info->temporary = temporary;\n+\n+\tfor (idx_t i = 0; i < columns.size(); i++) {\n+\t\tcreate_info->columns.push_back(columns[i].Copy());\n+\t}\n+\tfor (idx_t i = 0; i < constraints.size(); i++) {\n+\t\tcreate_info->constraints.push_back(constraints[i]->Copy());\n+\t}\n+\tForeignKeyInfo fk_info;\n+\tfk_info.type = ForeignKeyType::FK_TYPE_PRIMARY_KEY_TABLE;\n+\tfk_info.schema = info.schema;\n+\tfk_info.table = info.fk_table;\n+\tfk_info.pk_keys = info.pk_keys;\n+\tfk_info.fk_keys = info.fk_keys;\n+\tcreate_info->constraints.push_back(\n+\t    make_unique<ForeignKeyConstraint>(info.pk_columns, info.fk_columns, move(fk_info)));\n+\n+\tauto binder = Binder::CreateBinder(context);\n+\tauto bound_create_info = binder->BindCreateTableInfo(move(create_info));\n+\n+\treturn make_unique<TableCatalogEntry>(catalog, schema, (BoundCreateTableInfo *)bound_create_info.get(), storage);\n+}\n+\n+unique_ptr<CatalogEntry> TableCatalogEntry::DropForeignKeyConstraint(ClientContext &context,\n+                                                                     AlterForeignKeyInfo &info) {\n+\tD_ASSERT(info.type == AlterForeignKeyType::AFT_DELETE);\n \tauto create_info = make_unique<CreateTableInfo>(schema->name, name);\n \tcreate_info->temporary = temporary;\n \n@@ -550,16 +582,6 @@ unique_ptr<CatalogEntry> TableCatalogEntry::SetForeignKeyConstraint(ClientContex\n \t\t}\n \t\tcreate_info->constraints.push_back(move(constraint));\n \t}\n-\tif (info.type == AlterForeignKeyType::AFT_ADD) {\n-\t\tForeignKeyInfo fk_info;\n-\t\tfk_info.type = ForeignKeyType::FK_TYPE_PRIMARY_KEY_TABLE;\n-\t\tfk_info.schema = info.schema;\n-\t\tfk_info.table = info.fk_table;\n-\t\tfk_info.pk_keys = info.pk_keys;\n-\t\tfk_info.fk_keys = info.fk_keys;\n-\t\tcreate_info->constraints.push_back(\n-\t\t    make_unique<ForeignKeyConstraint>(info.pk_columns, info.fk_columns, move(fk_info)));\n-\t}\n \n \tauto binder = Binder::CreateBinder(context);\n \tauto bound_create_info = binder->BindCreateTableInfo(move(create_info));\ndiff --git a/src/include/duckdb/catalog/catalog_entry/table_catalog_entry.hpp b/src/include/duckdb/catalog/catalog_entry/table_catalog_entry.hpp\nindex e7fa77f7db3c..8aafaf17b331 100644\n--- a/src/include/duckdb/catalog/catalog_entry/table_catalog_entry.hpp\n+++ b/src/include/duckdb/catalog/catalog_entry/table_catalog_entry.hpp\n@@ -88,6 +88,7 @@ class TableCatalogEntry : public StandardEntry {\n \tunique_ptr<CatalogEntry> RemoveColumn(ClientContext &context, RemoveColumnInfo &info);\n \tunique_ptr<CatalogEntry> SetDefault(ClientContext &context, SetDefaultInfo &info);\n \tunique_ptr<CatalogEntry> ChangeColumnType(ClientContext &context, ChangeColumnTypeInfo &info);\n-\tunique_ptr<CatalogEntry> SetForeignKeyConstraint(ClientContext &context, AlterForeignKeyInfo &info);\n+\tunique_ptr<CatalogEntry> AddForeignKeyConstraint(ClientContext &context, AlterForeignKeyInfo &info);\n+\tunique_ptr<CatalogEntry> DropForeignKeyConstraint(ClientContext &context, AlterForeignKeyInfo &info);\n };\n } // namespace duckdb\n",
  "test_patch": "diff --git a/test/sql/constraints/foreignkey/fk_4309.test b/test/sql/constraints/foreignkey/fk_4309.test\nnew file mode 100644\nindex 000000000000..8bca1cf88264\n--- /dev/null\n+++ b/test/sql/constraints/foreignkey/fk_4309.test\n@@ -0,0 +1,97 @@\n+# name: test/sql/constraints/foreignkey/fk_4309.test\n+# description: Issue #4309: Foreign key constraints are not honored when deleting rows from the parent table in the presence of multiple such constraints\n+# group: [foreignkey]\n+\n+statement ok\n+PRAGMA enable_verification\n+\n+# fks:\n+# d -> a\n+# e -> b\n+# f -> c\n+\n+statement ok\n+CREATE TABLE tf_1 (\n+  a integer, b integer, c integer,\n+  PRIMARY KEY (a),\n+  UNIQUE (b),\n+  UNIQUE (c)\n+);\n+\n+statement ok\n+CREATE TABLE tf_2 (\n+  d integer, e integer, f integer,\n+  FOREIGN KEY (d) REFERENCES tf_1 (a),\n+  FOREIGN KEY (e) REFERENCES tf_1 (b),\n+  FOREIGN KEY (f) REFERENCES tf_1 (c)\n+);\n+\n+# key \"1\" does not exist yet\n+statement error\n+INSERT INTO tf_2 VALUES (1, 1, 1);\n+\n+# insert key (1, 1, 1)\n+statement ok\n+INSERT INTO tf_1 VALUES (1, 1, 1);\n+\n+# all these fail (all three need to match)\n+statement error\n+INSERT INTO tf_2 VALUES (2, 1, 1);\n+\n+statement error\n+INSERT INTO tf_2 VALUES (1, 2, 1);\n+\n+statement error\n+INSERT INTO tf_2 VALUES (1, 1, 2);\n+\n+# this succeeds\n+statement ok\n+INSERT INTO tf_2 VALUES (1, 1, 1);\n+\n+# now insert (2, NULL, NULL)\n+statement ok\n+INSERT INTO tf_1 VALUES (2, NULL, NULL);\n+\n+# insert a dependency\n+statement ok\n+INSERT INTO tf_2 VALUES (2, NULL, NULL);\n+\n+# we should not be able to delete this key now\n+statement error\n+DELETE FROM tf_1 WHERE a = 2;\n+\n+# delete everything with a|b = 2\n+statement ok\n+DELETE FROM tf_2 WHERE d=2;\n+\n+statement ok\n+DELETE FROM tf_1 WHERE a=2;\n+\n+# insert (2, 3, NULL)\n+statement ok\n+INSERT INTO tf_1 VALUES (2, 3, NULL);\n+\n+# this is fine\n+statement ok\n+INSERT INTO tf_2 VALUES (1, 3, 1);\n+\n+# this should (still) not work\n+statement error\n+DELETE FROM tf_1 WHERE a = 2;\n+\n+# delete everything with a|b = 2\n+statement ok\n+DELETE FROM tf_2 WHERE d=2 OR e=3;\n+\n+statement ok\n+DELETE FROM tf_1 WHERE a=2;\n+\n+# insert (2, NULL, 4)\n+statement ok\n+INSERT INTO tf_1 VALUES (2, NULL, 4);\n+\n+statement ok\n+INSERT INTO tf_2 VALUES (1, 1, 4);\n+\n+statement error\n+DELETE FROM tf_1 WHERE a = 2;\n",
  "problem_statement": "Foreign key constraints are not honored when deleting rows from the parent table in the presence of multiple such constraints\n### What happens?\n\nThe catalog information, as returned by `duckdb_constraints()`, seems incomplete. This leads to omitted checks for FK constraints when deleting rows from the parent table in some cases.\r\n\r\nThe example below contains WATs that mark surprising (and wrong?) behavior.\r\n\r\nThe example is generated with krlmlr/duckdb@14d5652e4e3c398008946f9edcddef28d073f1f1, which is one ahead the current main branch 93af1c0582399dc301b1058e7066a2bae667ef27 and uses `\"REFERENCE KEY\"` instead of `\"FOREIGN KEY\"` in the `constraint_type` column.\n\n### To Reproduce\n\n```sql\r\nCREATE TABLE tf_1 (\r\n  a integer, \"b c\" integer, \"d e\" integer,\r\n  PRIMARY KEY (a),\r\n  UNIQUE (\"b c\"),\r\n  UNIQUE (\"d e\")\r\n);\r\nCREATE TABLE tf_2 (\r\n  d integer, e integer, f integer,\r\n  FOREIGN KEY (d) REFERENCES tf_1 (a),\r\n  FOREIGN KEY (e) REFERENCES tf_1 (\"b c\"),\r\n  FOREIGN KEY (f) REFERENCES tf_1 (\"d e\")\r\n);\r\n\r\nINSERT INTO tf_1 VALUES (1, 1, 1);\r\nINSERT INTO tf_2 VALUES (1, 1, 1);\r\nSELECT 'ok';\r\nINSERT INTO tf_2 VALUES (2, 1, 1);\r\nSELECT 'fail';\r\nINSERT INTO tf_2 VALUES (1, 2, 1);\r\nSELECT 'fail';\r\nINSERT INTO tf_2 VALUES (1, 1, 2);\r\nSELECT 'fail';\r\n\r\nINSERT INTO tf_1 VALUES (2, NULL, NULL);\r\nINSERT INTO tf_2 VALUES (2, 1, 1);\r\nSELECT 'ok';\r\nDELETE FROM tf_1 WHERE a = 2;\r\nSELECT 'wat';\r\n\r\nINSERT INTO tf_1 VALUES (2, 3, NULL);\r\nINSERT INTO tf_2 VALUES (1, 3, 1);\r\nSELECT 'ok';\r\nDELETE FROM tf_1 WHERE a = 2;\r\nSELECT 'wat';\r\n\r\nINSERT INTO tf_1 VALUES (2, NULL, 4);\r\nINSERT INTO tf_2 VALUES (1, 1, 4);\r\nSELECT 'ok';\r\nDELETE FROM tf_1 WHERE a = 2;\r\nSELECT 'fail';\r\n\r\nSELECT * FROM duckdb_constraints() WHERE constraint_type IN ('FOREIGN KEY', 'REFERENCED KEY');\r\n```\r\n\r\n```\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 17: Constraint Error: Constraint Error: violates foreign key constraint because key \"a: 2\" does not exist in referenced table\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 19: Constraint Error: Constraint Error: violates foreign key constraint because key \"b c: 2\" does not exist in referenced table\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 21: Constraint Error: Constraint Error: violates foreign key constraint because key \"d e: 2\" does not exist in referenced table\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'wat' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 wat   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'wat' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 wat   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 39: Constraint Error: Constraint Error: violates foreign key constraint because key \"f: 4\" exist in table has foreign key\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 schema_name \u2502 schema_oid \u2502 table_name \u2502 table_oid \u2502 constraint_index \u2502 constraint_type \u2502            constraint_text             \u2502 expression \u2502 constraint_column_indexes \u2502 constraint_column_names \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 main        \u2502 1          \u2502 tf_2       \u2502 1282      \u2502 0                \u2502 FOREIGN KEY     \u2502 FOREIGN KEY (d) REFERENCES tf_1(a)     \u2502            \u2502 [0]                       \u2502 [d]                     \u2502\r\n\u2502 main        \u2502 1          \u2502 tf_2       \u2502 1282      \u2502 1                \u2502 FOREIGN KEY     \u2502 FOREIGN KEY (e) REFERENCES tf_1(\"b c\") \u2502            \u2502 [1]                       \u2502 [e]                     \u2502\r\n\u2502 main        \u2502 1          \u2502 tf_2       \u2502 1282      \u2502 2                \u2502 FOREIGN KEY     \u2502 FOREIGN KEY (f) REFERENCES tf_1(\"d e\") \u2502            \u2502 [2]                       \u2502 [f]                     \u2502\r\n\u2502 main        \u2502 1          \u2502 tf_1       \u2502 1289      \u2502 6                \u2502 REFERENCED KEY  \u2502                                        \u2502            \u2502 [2]                       \u2502 [d e]                   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\n\n### OS:\n\nmacOS\n\n### DuckDB Version:\n\n93af1c0582399dc301b1058e7066a2bae667ef27\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nKirill M\u00fcller\n\n### Affiliation:\n\ncynkra GmbH\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\nForeign key constraints are not honored when deleting rows from the parent table in the presence of multiple such constraints\n### What happens?\n\nThe catalog information, as returned by `duckdb_constraints()`, seems incomplete. This leads to omitted checks for FK constraints when deleting rows from the parent table in some cases.\r\n\r\nThe example below contains WATs that mark surprising (and wrong?) behavior.\r\n\r\nThe example is generated with krlmlr/duckdb@14d5652e4e3c398008946f9edcddef28d073f1f1, which is one ahead the current main branch 93af1c0582399dc301b1058e7066a2bae667ef27 and uses `\"REFERENCE KEY\"` instead of `\"FOREIGN KEY\"` in the `constraint_type` column.\n\n### To Reproduce\n\n```sql\r\nCREATE TABLE tf_1 (\r\n  a integer, \"b c\" integer, \"d e\" integer,\r\n  PRIMARY KEY (a),\r\n  UNIQUE (\"b c\"),\r\n  UNIQUE (\"d e\")\r\n);\r\nCREATE TABLE tf_2 (\r\n  d integer, e integer, f integer,\r\n  FOREIGN KEY (d) REFERENCES tf_1 (a),\r\n  FOREIGN KEY (e) REFERENCES tf_1 (\"b c\"),\r\n  FOREIGN KEY (f) REFERENCES tf_1 (\"d e\")\r\n);\r\n\r\nINSERT INTO tf_1 VALUES (1, 1, 1);\r\nINSERT INTO tf_2 VALUES (1, 1, 1);\r\nSELECT 'ok';\r\nINSERT INTO tf_2 VALUES (2, 1, 1);\r\nSELECT 'fail';\r\nINSERT INTO tf_2 VALUES (1, 2, 1);\r\nSELECT 'fail';\r\nINSERT INTO tf_2 VALUES (1, 1, 2);\r\nSELECT 'fail';\r\n\r\nINSERT INTO tf_1 VALUES (2, NULL, NULL);\r\nINSERT INTO tf_2 VALUES (2, 1, 1);\r\nSELECT 'ok';\r\nDELETE FROM tf_1 WHERE a = 2;\r\nSELECT 'wat';\r\n\r\nINSERT INTO tf_1 VALUES (2, 3, NULL);\r\nINSERT INTO tf_2 VALUES (1, 3, 1);\r\nSELECT 'ok';\r\nDELETE FROM tf_1 WHERE a = 2;\r\nSELECT 'wat';\r\n\r\nINSERT INTO tf_1 VALUES (2, NULL, 4);\r\nINSERT INTO tf_2 VALUES (1, 1, 4);\r\nSELECT 'ok';\r\nDELETE FROM tf_1 WHERE a = 2;\r\nSELECT 'fail';\r\n\r\nSELECT * FROM duckdb_constraints() WHERE constraint_type IN ('FOREIGN KEY', 'REFERENCED KEY');\r\n```\r\n\r\n```\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 17: Constraint Error: Constraint Error: violates foreign key constraint because key \"a: 2\" does not exist in referenced table\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 19: Constraint Error: Constraint Error: violates foreign key constraint because key \"b c: 2\" does not exist in referenced table\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 21: Constraint Error: Constraint Error: violates foreign key constraint because key \"d e: 2\" does not exist in referenced table\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'wat' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 wat   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'wat' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 wat   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'ok' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 ok   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nError: near line 39: Constraint Error: Constraint Error: violates foreign key constraint because key \"f: 4\" exist in table has foreign key\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 'fail' \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 fail   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 schema_name \u2502 schema_oid \u2502 table_name \u2502 table_oid \u2502 constraint_index \u2502 constraint_type \u2502            constraint_text             \u2502 expression \u2502 constraint_column_indexes \u2502 constraint_column_names \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502 main        \u2502 1          \u2502 tf_2       \u2502 1282      \u2502 0                \u2502 FOREIGN KEY     \u2502 FOREIGN KEY (d) REFERENCES tf_1(a)     \u2502            \u2502 [0]                       \u2502 [d]                     \u2502\r\n\u2502 main        \u2502 1          \u2502 tf_2       \u2502 1282      \u2502 1                \u2502 FOREIGN KEY     \u2502 FOREIGN KEY (e) REFERENCES tf_1(\"b c\") \u2502            \u2502 [1]                       \u2502 [e]                     \u2502\r\n\u2502 main        \u2502 1          \u2502 tf_2       \u2502 1282      \u2502 2                \u2502 FOREIGN KEY     \u2502 FOREIGN KEY (f) REFERENCES tf_1(\"d e\") \u2502            \u2502 [2]                       \u2502 [f]                     \u2502\r\n\u2502 main        \u2502 1          \u2502 tf_1       \u2502 1289      \u2502 6                \u2502 REFERENCED KEY  \u2502                                        \u2502            \u2502 [2]                       \u2502 [d e]                   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\n\n### OS:\n\nmacOS\n\n### DuckDB Version:\n\n93af1c0582399dc301b1058e7066a2bae667ef27\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nKirill M\u00fcller\n\n### Affiliation:\n\ncynkra GmbH\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "\n",
  "created_at": "2022-08-08T13:18:35Z"
}