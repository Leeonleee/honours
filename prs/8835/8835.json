{
  "repo": "duckdb/duckdb",
  "pull_number": 8835,
  "instance_id": "duckdb__duckdb-8835",
  "issue_numbers": [
    "8833"
  ],
  "base_commit": "ce647e0ff3e9af413f464cf0cd77047e98baf625",
  "patch": "diff --git a/src/function/table/system/duckdb_columns.cpp b/src/function/table/system/duckdb_columns.cpp\nindex 72e1cf7c2489..42d8203e7966 100644\n--- a/src/function/table/system/duckdb_columns.cpp\n+++ b/src/function/table/system/duckdb_columns.cpp\n@@ -131,7 +131,9 @@ class TableColumnHelper : public ColumnHelper {\n \t}\n \tconst Value ColumnDefault(idx_t col) override {\n \t\tauto &column = entry.GetColumn(LogicalIndex(col));\n-\t\tif (column.DefaultValue()) {\n+\t\tif (column.Generated()) {\n+\t\t\treturn Value(column.GeneratedExpression().ToString());\n+\t\t} else if (column.DefaultValue()) {\n \t\t\treturn Value(column.DefaultValue()->ToString());\n \t\t}\n \t\treturn Value();\n",
  "test_patch": "diff --git a/test/sql/generated_columns/virtual/gcol_duckdb_columns.test b/test/sql/generated_columns/virtual/gcol_duckdb_columns.test\nnew file mode 100644\nindex 000000000000..d8f049a60b6e\n--- /dev/null\n+++ b/test/sql/generated_columns/virtual/gcol_duckdb_columns.test\n@@ -0,0 +1,13 @@\n+# name: test/sql/generated_columns/virtual/gcol_duckdb_columns.test\n+# group: [virtual]\n+\n+# Create a table containing a generated column\n+statement ok\n+create table t (i int, j int as (1));\n+\n+# duckdb_columns should return the stringified generated column expression as 'column_default'\n+query I\n+select column_default from duckdb_columns;\n+----\n+NULL\n+CAST(1 AS INTEGER)\n",
  "problem_statement": "\"INTERNAL Error: Calling DefaultValue() on a generated column\"\n### What happens?\n\nCreate a table with a computed column, then run a query on `duckdb_columns()`. The following error ensues:\r\n\r\n> SQL Error: FATAL Error: Failed: database has been invalidated because of a previous fatal error. The database must be restarted prior to being used again.\r\n> Original error: \"INTERNAL Error: Calling DefaultValue() on a generated column\"\r\n\r\nThis is a regression in 0.9.0-SNAPSHOT (using the JDBC driver). It didn't happen in 0.8.1\n\n### To Reproduce\n\n```sql\r\ncreate table t (i int, j int as (1));\r\nselect * from duckdb_columns;\r\n```\n\n### OS:\n\nMicrosoft Windows [Version 10.0.22621.2134]\n\n### DuckDB Version:\n\n0.9.0-SNAPSHOT\n\n### DuckDB Client:\n\nJDBC\n\n### Full Name:\n\nLukas Eder\n\n### Affiliation:\n\nData Geekery\n\n### Have you tried this on the latest `main` branch?\n\nI have tested with a main build\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] Yes, I have\n",
  "hints_text": "Note, while I downloaded `0.9.0-SNAPSHOT` from Maven (as instructed here: https://github.com/duckdb/duckdb/issues/8828#issuecomment-1710091751), the JDBC driver (in debaver) reports this version: `DuckDB v0.8.2-dev4025`",
  "created_at": "2023-09-07T13:32:11Z"
}