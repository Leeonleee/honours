{
  "repo": "duckdb/duckdb",
  "pull_number": 9059,
  "instance_id": "duckdb__duckdb-9059",
  "issue_numbers": [
    "7797",
    "7797"
  ],
  "base_commit": "ef947563f31c57e00f9c4627a02a79255638bef2",
  "patch": "diff --git a/src/main/settings/settings.cpp b/src/main/settings/settings.cpp\nindex ee42b92ac06a..1fe56fed5a30 100644\n--- a/src/main/settings/settings.cpp\n+++ b/src/main/settings/settings.cpp\n@@ -21,6 +21,10 @@ namespace duckdb {\n // Access Mode\n //===--------------------------------------------------------------------===//\n void AccessModeSetting::SetGlobal(DatabaseInstance *db, DBConfig &config, const Value &input) {\n+\tif (db) {\n+\t\tthrow InvalidInputException(\"Cannot change access_mode setting while database is running - it must be set when \"\n+\t\t                            \"opening or attaching the database\");\n+\t}\n \tauto parameter = StringUtil::Lower(input.ToString());\n \tif (parameter == \"automatic\") {\n \t\tconfig.options.access_mode = AccessMode::AUTOMATIC;\n",
  "test_patch": "diff --git a/test/api/test_reset.cpp b/test/api/test_reset.cpp\nindex a628cdc1b5a9..159e7fe24ac2 100644\n--- a/test/api/test_reset.cpp\n+++ b/test/api/test_reset.cpp\n@@ -45,7 +45,6 @@ void RequireValueEqual(ConfigurationOption *op, const Value &left, const Value &\n \n OptionValueSet &GetValueForOption(const string &name) {\n \tstatic unordered_map<string, OptionValueSet> value_map = {\n-\t    {\"access_mode\", {Value(\"READ_ONLY\"), Value(\"read_only\")}},\n \t    {\"threads\", {Value::BIGINT(42), Value::BIGINT(42)}},\n \t    {\"checkpoint_threshold\", {\"4.2GB\"}},\n \t    {\"debug_checkpoint_abort\", {{\"none\", \"before_truncate\", \"before_header\", \"after_free_list_write\"}}},\n@@ -112,6 +111,7 @@ OptionValueSet &GetValueForOption(const string &name) {\n \n bool OptionIsExcludedFromTest(const string &name) {\n \tstatic unordered_set<string> excluded_options = {\n+\t    \"access_mode\",\n \t    \"schema\",\n \t    \"search_path\",\n \t    \"debug_window_mode\",\ndiff --git a/test/sql/settings/access_mode.test b/test/sql/settings/access_mode.test\nnew file mode 100644\nindex 000000000000..f5c4c5eaf0a4\n--- /dev/null\n+++ b/test/sql/settings/access_mode.test\n@@ -0,0 +1,8 @@\n+# name: test/sql/settings/access_mode.test\n+# description: Test access mode setting\n+# group: [settings]\n+\n+statement error\n+SET access_mode='read_only'\n+----\n+Cannot change access_mode setting while database is running\ndiff --git a/test/sql/settings/setting_exhaustive.test b/test/sql/settings/setting_exhaustive.test\nindex 4095b21c8594..364a7690f2ae 100644\n--- a/test/sql/settings/setting_exhaustive.test\n+++ b/test/sql/settings/setting_exhaustive.test\n@@ -2,20 +2,6 @@\n # description: Exhaustive setting tests\n # group: [settings]\n \n-# access_mode\n-foreach access_mode AUTOMATIC READ_ONLY READ_WRITE\n-\n-statement ok\n-SET access_mode='${access_mode}';\n-\n-statement ok\n-SELECT * FROM duckdb_settings();\n-\n-endloop\n-\n-statement error\n-SET access_mode='unknown';\n-\n # debug_window_mode\n statement error\n SET debug_window_mode='unknown';\n",
  "problem_statement": "Setting access_mode on an open database silently fails\n### What happens?\n\nDuckDB silently fails to change the access mode on an open database. Setting the flag shouldn't do anything after a database is open, but it should probably throw an error\n\n### To Reproduce\n\n```sh\r\n$ duckdb test.db\r\nv0.8.0 e8e4cea5ec\r\nEnter \".help\" for usage hints.\r\nD set access_mode=read_only;\r\nD create table x (id varchar);\r\n```\n\n### OS:\n\nLinux\n\n### DuckDB Version:\n\n0.8.0\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nElliana May \n\n### Affiliation:\n\nDuckDB Labs\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\nSetting access_mode on an open database silently fails\n### What happens?\n\nDuckDB silently fails to change the access mode on an open database. Setting the flag shouldn't do anything after a database is open, but it should probably throw an error\n\n### To Reproduce\n\n```sh\r\n$ duckdb test.db\r\nv0.8.0 e8e4cea5ec\r\nEnter \".help\" for usage hints.\r\nD set access_mode=read_only;\r\nD create table x (id varchar);\r\n```\n\n### OS:\n\nLinux\n\n### DuckDB Version:\n\n0.8.0\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nElliana May \n\n### Affiliation:\n\nDuckDB Labs\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "This issue is stale because it has been open 90 days with no activity. Remove stale label or comment or this will be closed in 30 days.\nThis issue is stale because it has been open 90 days with no activity. Remove stale label or comment or this will be closed in 30 days.",
  "created_at": "2023-09-23T12:25:32Z"
}