You will be provided with a partial code base and an issue statement explaining a problem to resolve.

<issue>
Connection drop on QUIT when busy
The connection is simply dropped when there are commands in the pipeline. Reproduce with a simple nc(1) session as follows.

```
% echo 'subscribe foo\nunsubscribe foo\nquit\n'| nc localhost 6379
% 
```

The server must respond to all three commands before closing the connection.
</issue>

I need you to solve the provided issue by generating a code fix that can be applied directly to the repository

Respond below:
