diff --git a/src/server/main_service.cc b/src/server/main_service.cc
index 8d40a877923e..5f2c25570fc9 100644
--- a/src/server/main_service.cc
+++ b/src/server/main_service.cc
@@ -1658,16 +1658,17 @@ void Service::EvalInternal(CmdArgList args, const EvalArgs& eval_args, Interpret
     });
 
     ++ServerState::tlocal()->stats.eval_shardlocal_coordination_cnt;
-    boost::intrusive_ptr<Transaction> stub_tx = new Transaction{tx, *sid};
-    cntx->transaction = stub_tx.get();
-
     tx->PrepareMultiForScheduleSingleHop(*sid, tx->GetDbIndex(), args);
     tx->ScheduleSingleHop([&](Transaction*, EngineShard*) {
+      boost::intrusive_ptr<Transaction> stub_tx = new Transaction{tx, *sid};
+      cntx->transaction = stub_tx.get();
+
       result = interpreter->RunFunction(eval_args.sha, &error);
+
+      cntx->transaction = tx;
       return OpStatus::OK;
     });
 
-    cntx->transaction = tx;
     if (*sid != ServerState::tlocal()->thread_index()) {
       VLOG(1) << "Migrating connection " << cntx->conn() << " from " << ProactorBase::GetIndex()
               << " to " << *sid;
