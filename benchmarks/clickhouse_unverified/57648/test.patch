diff --git a/tests/queries/0_stateless/02942_consider_lwd_when_merge.reference b/tests/queries/0_stateless/02942_consider_lwd_when_merge.reference
new file mode 100644
index 000000000000..19920de3d3ca
--- /dev/null
+++ b/tests/queries/0_stateless/02942_consider_lwd_when_merge.reference
@@ -0,0 +1,3 @@
+2
+2
+1
diff --git a/tests/queries/0_stateless/02942_consider_lwd_when_merge.sql b/tests/queries/0_stateless/02942_consider_lwd_when_merge.sql
new file mode 100644
index 000000000000..a65e8877020c
--- /dev/null
+++ b/tests/queries/0_stateless/02942_consider_lwd_when_merge.sql
@@ -0,0 +1,23 @@
+DROP TABLE IF EXISTS lwd_merge;
+
+CREATE TABLE lwd_merge (id UInt64 CODEC(NONE))
+    ENGINE = MergeTree ORDER BY id
+SETTINGS max_bytes_to_merge_at_max_space_in_pool = 80000, exclude_deleted_rows_for_part_size_in_merge = 0;
+
+INSERT INTO lwd_merge SELECT number FROM numbers(10000);
+INSERT INTO lwd_merge SELECT number FROM numbers(10000, 10000);
+
+OPTIMIZE TABLE lwd_merge;
+SELECT count() FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_merge' AND active = 1;
+
+DELETE FROM lwd_merge WHERE id % 10 > 0;
+
+OPTIMIZE TABLE lwd_merge;
+SELECT count() FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_merge' AND active = 1;
+
+ALTER TABLE lwd_merge MODIFY SETTING exclude_deleted_rows_for_part_size_in_merge = 1;
+
+OPTIMIZE TABLE lwd_merge;
+SELECT count() FROM system.parts WHERE database = currentDatabase() AND table = 'lwd_merge' AND active = 1;
+
+DROP TABLE IF EXISTS lwd_merge;
