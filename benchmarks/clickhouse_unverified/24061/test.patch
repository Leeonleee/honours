diff --git a/tests/queries/0_stateless/01049_join_low_card_bug.reference b/tests/queries/0_stateless/01049_join_low_card_bug.reference
deleted file mode 100644
index b4ed81766524..000000000000
--- a/tests/queries/0_stateless/01049_join_low_card_bug.reference
+++ /dev/null
@@ -1,80 +0,0 @@
-	LowCardinality(String)
-str	LowCardinality(String)
-	LowCardinality(String)
-str	LowCardinality(String)
-	str	LowCardinality(String)	LowCardinality(String)
-	str	LowCardinality(String)	LowCardinality(String)
-	str	LowCardinality(String)	LowCardinality(String)
-	str	LowCardinality(String)	LowCardinality(String)
-	LowCardinality(String)
-str	LowCardinality(String)
-	LowCardinality(String)
-str	LowCardinality(String)
-	str	LowCardinality(String)	String
-	str	LowCardinality(String)	String
-	str	LowCardinality(String)	String
-	str	LowCardinality(String)	String
-	String
-str	String
-	String
-str	String
-	str	String	LowCardinality(String)
-	str	String	LowCardinality(String)
-	str	String	LowCardinality(String)
-	str	String	LowCardinality(String)
-	LowCardinality(String)
-str	LowCardinality(String)
-	LowCardinality(String)
-str	LowCardinality(String)
-	str	LowCardinality(String)	Nullable(String)
-	str	LowCardinality(String)	Nullable(String)
-	str	LowCardinality(String)	Nullable(String)
-	str	LowCardinality(String)	Nullable(String)
-\N	Nullable(String)
-str	Nullable(String)
-\N	Nullable(String)
-str	Nullable(String)
-\N	str	Nullable(String)	LowCardinality(String)
-\N	str	Nullable(String)	LowCardinality(String)
-\N	str	Nullable(String)	LowCardinality(String)
-\N	str	Nullable(String)	LowCardinality(String)
-\N	LowCardinality(Nullable(String))
-str	LowCardinality(Nullable(String))
-\N	LowCardinality(Nullable(String))
-str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	LowCardinality(Nullable(String))
-str	LowCardinality(Nullable(String))
-\N	LowCardinality(Nullable(String))
-str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	Nullable(String)
-str	Nullable(String)
-\N	Nullable(String)
-str	Nullable(String)
-\N	str	Nullable(String)
-\N	str	Nullable(String)
-\N	str	Nullable(String)
-\N	str	Nullable(String)
-\N	LowCardinality(Nullable(String))
-str	LowCardinality(Nullable(String))
-\N	LowCardinality(Nullable(String))
-str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	str	LowCardinality(Nullable(String))
-\N	Nullable(String)
-str	Nullable(String)
-\N	Nullable(String)
-str	Nullable(String)
-\N	str	Nullable(String)
-\N	str	Nullable(String)
-\N	str	Nullable(String)
-\N	str	Nullable(String)
diff --git a/tests/queries/0_stateless/01049_join_low_card_bug.sql b/tests/queries/0_stateless/01049_join_low_card_bug.sql
deleted file mode 100644
index 07558770abf6..000000000000
--- a/tests/queries/0_stateless/01049_join_low_card_bug.sql
+++ /dev/null
@@ -1,144 +0,0 @@
-DROP TABLE IF EXISTS l;
-DROP TABLE IF EXISTS r;
-DROP TABLE IF EXISTS nl;
-DROP TABLE IF EXISTS nr;
-DROP TABLE IF EXISTS l_lc;
-DROP TABLE IF EXISTS r_lc;
-
-CREATE TABLE l (x UInt32, lc String) ENGINE = Memory;
-CREATE TABLE r (x UInt32, lc String) ENGINE = Memory;
-CREATE TABLE nl (x Nullable(UInt32), lc Nullable(String)) ENGINE = Memory;
-CREATE TABLE nr (x Nullable(UInt32), lc Nullable(String)) ENGINE = Memory;
-CREATE TABLE l_lc (x UInt32, lc LowCardinality(String)) ENGINE = Memory;
-CREATE TABLE r_lc (x UInt32, lc LowCardinality(String)) ENGINE = Memory;
-
-INSERT INTO r VALUES (0, 'str');
-INSERT INTO nr VALUES (0, 'str');
-INSERT INTO r_lc VALUES (0, 'str');
-
---
-
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc);
- 
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(r.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(r.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(r.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(r.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (lc);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l RIGHT JOIN r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l RIGHT JOIN r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l FULL JOIN r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l FULL JOIN r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (lc);
-SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l RIGHT JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l RIGHT JOIN r_lc AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l FULL JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l FULL JOIN r_lc AS r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (lc);
-SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l RIGHT JOIN nr AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l RIGHT JOIN nr AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l FULL JOIN nr AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM l_lc AS l FULL JOIN nr AS r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (x);
-SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (lc);
-SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (x);
-SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM nl AS l RIGHT JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM nl AS l RIGHT JOIN r_lc AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM nl AS l FULL JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc), toTypeName(materialize(r.lc)) FROM nl AS l FULL JOIN r_lc AS r USING (lc);
-
-SET join_use_nulls = 1;
-
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (lc);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l RIGHT JOIN r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l RIGHT JOIN r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l FULL JOIN r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l FULL JOIN r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (lc);
-SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (x);
-SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l RIGHT JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l RIGHT JOIN r_lc AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l FULL JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l FULL JOIN r_lc AS r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (lc);
-SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (x);
-SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (lc);
-
---
-
-SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (x);
-SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (lc);
-SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (x);
-SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (lc);
-
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (lc);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (x);
-SELECT l.lc, r.lc, toTypeName(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (lc);
-
-DROP TABLE l;
-DROP TABLE r;
-DROP TABLE nl;
-DROP TABLE nr;
-DROP TABLE l_lc;
-DROP TABLE r_lc;
diff --git a/tests/queries/0_stateless/01049_join_low_card_bug_long.reference b/tests/queries/0_stateless/01049_join_low_card_bug_long.reference
new file mode 100644
index 000000000000..877b4370fcea
--- /dev/null
+++ b/tests/queries/0_stateless/01049_join_low_card_bug_long.reference
@@ -0,0 +1,407 @@
+str	LowCardinality(String)
+	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str	LowCardinality(String)
+	LowCardinality(String)
+str_l	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str_l	LowCardinality(String)
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+str	LowCardinality(String)
+	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str	LowCardinality(String)
+	LowCardinality(String)
+str_l	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str_l	LowCardinality(String)
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+str	String
+	String
+str_r	String
+str	String
+str	String
+	String
+str_l	String
+str_r	String
+str	String
+str_l	String
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)			String	String	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)			String	String	str_l	str_l
+str	LowCardinality(String)
+	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str	LowCardinality(String)
+	LowCardinality(String)
+str_l	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str_l	LowCardinality(String)
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(String)	LowCardinality(String)	str_l	str_l
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(String)	LowCardinality(String)	str_l	str_l
+str	Nullable(String)
+\N	Nullable(String)
+str	Nullable(String)
+str_r	Nullable(String)
+str	Nullable(String)
+\N	Nullable(String)
+str_l	Nullable(String)
+str	Nullable(String)
+str_l	Nullable(String)
+str_r	Nullable(String)
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)			Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)			Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+-- join_use_nulls --
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+String	String	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+String	String	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+String	String	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+String	String	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+str	Nullable(String)
+\N	Nullable(String)
+str	Nullable(String)
+str_r	Nullable(String)
+str	Nullable(String)
+\N	Nullable(String)
+str_l	Nullable(String)
+str	Nullable(String)
+str_l	Nullable(String)
+str_r	Nullable(String)
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+str	Nullable(String)
+\N	Nullable(String)
+str	Nullable(String)
+str_r	Nullable(String)
+str	Nullable(String)
+\N	Nullable(String)
+str_l	Nullable(String)
+str	Nullable(String)
+str_l	Nullable(String)
+str_r	Nullable(String)
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+str	LowCardinality(String)
+	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str	LowCardinality(String)
+	LowCardinality(String)
+str_l	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str_l	LowCardinality(String)
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+LowCardinality(String)	LowCardinality(String)			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+str	LowCardinality(String)
+	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str	LowCardinality(String)
+	LowCardinality(String)
+str_l	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str_l	LowCardinality(String)
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+String	String	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+String	String	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+String	String			LowCardinality(String)	LowCardinality(String)	str_l	str_l
+str	String
+	String
+str_r	String
+str	String
+str	String
+	String
+str_l	String
+str_r	String
+str	String
+str_l	String
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)			String	String	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	String	String		
+LowCardinality(String)	LowCardinality(String)	str	str	String	String	str	str
+LowCardinality(String)	LowCardinality(String)			String	String	str_l	str_l
+str	LowCardinality(String)
+	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str	LowCardinality(String)
+	LowCardinality(String)
+str_l	LowCardinality(String)
+str_r	LowCardinality(String)
+str	LowCardinality(String)
+str_l	LowCardinality(String)
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(String)	LowCardinality(String)	str_l	str_l
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(String)	LowCardinality(String)		
+Nullable(String)	Nullable(String)	str	str	LowCardinality(String)	LowCardinality(String)	str	str
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(String)	LowCardinality(String)	str_l	str_l
+str	Nullable(String)
+\N	Nullable(String)
+str	Nullable(String)
+str_r	Nullable(String)
+str	Nullable(String)
+\N	Nullable(String)
+str_l	Nullable(String)
+str	Nullable(String)
+str_l	Nullable(String)
+str_r	Nullable(String)
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)			Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)			Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+-- join_use_nulls --
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+String	String	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+String	String	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+String	String	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+String	String	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+str	Nullable(String)
+\N	Nullable(String)
+str	Nullable(String)
+str_r	Nullable(String)
+str	Nullable(String)
+\N	Nullable(String)
+str_l	Nullable(String)
+str	Nullable(String)
+str_l	Nullable(String)
+str_r	Nullable(String)
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+\N	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str	LowCardinality(Nullable(String))
+str_l	LowCardinality(Nullable(String))
+str_r	LowCardinality(Nullable(String))
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str	str	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str
+Nullable(String)	Nullable(String)	\N	\N	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_l	str_l
+Nullable(String)	Nullable(String)	str_r	str_r	LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N
+str	Nullable(String)
+\N	Nullable(String)
+str	Nullable(String)
+str_r	Nullable(String)
+str	Nullable(String)
+\N	Nullable(String)
+str_l	Nullable(String)
+str	Nullable(String)
+str_l	Nullable(String)
+str_r	Nullable(String)
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(String)	LowCardinality(String)	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(String)	LowCardinality(String)	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str	str	Nullable(String)	Nullable(String)	str	str
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	\N	\N	Nullable(String)	Nullable(String)	str_l	str_l
+LowCardinality(Nullable(String))	LowCardinality(Nullable(String))	str_r	str_r	Nullable(String)	Nullable(String)	\N	\N
+	LowCardinality(String)
+str	LowCardinality(String)
+
+
+str
diff --git a/tests/queries/0_stateless/01049_join_low_card_bug_long.sql b/tests/queries/0_stateless/01049_join_low_card_bug_long.sql
new file mode 100644
index 000000000000..e17328244282
--- /dev/null
+++ b/tests/queries/0_stateless/01049_join_low_card_bug_long.sql
@@ -0,0 +1,284 @@
+DROP TABLE IF EXISTS l;
+DROP TABLE IF EXISTS r;
+DROP TABLE IF EXISTS nl;
+DROP TABLE IF EXISTS nr;
+DROP TABLE IF EXISTS l_lc;
+DROP TABLE IF EXISTS r_lc;
+
+CREATE TABLE l (x UInt32, lc String) ENGINE = Memory;
+CREATE TABLE r (x UInt32, lc String) ENGINE = Memory;
+CREATE TABLE nl (x Nullable(UInt32), lc Nullable(String)) ENGINE = Memory;
+CREATE TABLE nr (x Nullable(UInt32), lc Nullable(String)) ENGINE = Memory;
+CREATE TABLE l_lc (x UInt32, lc LowCardinality(String)) ENGINE = Memory;
+CREATE TABLE r_lc (x UInt32, lc LowCardinality(String)) ENGINE = Memory;
+
+INSERT INTO r VALUES (0, 'str'),  (1, 'str_r');
+INSERT INTO nr VALUES (0, 'str'),  (1, 'str_r');
+INSERT INTO r_lc VALUES (0, 'str'),  (1, 'str_r');
+
+INSERT INTO l VALUES (0, 'str'), (2, 'str_l');
+INSERT INTO nl VALUES (0, 'str'), (2, 'str_l');
+INSERT INTO l_lc VALUES (0, 'str'), (2, 'str_l');
+
+
+SET join_use_nulls = 0;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SELECT '-- join_use_nulls --';
+
+SET join_use_nulls = 1;
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+set join_algorithm = 'partial_merge';
+
+SET join_use_nulls = 0;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SELECT '-- join_use_nulls --';
+
+SET join_use_nulls = 1;
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l RIGHT JOIN r USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l FULL JOIN r USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc RIGHT JOIN nr USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM l_lc FULL JOIN nr USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l RIGHT JOIN nr AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM l_lc AS l FULL JOIN nr AS r USING (lc) ORDER BY x;
+
+--
+
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl RIGHT JOIN r_lc USING (lc) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (x) ORDER BY x;
+SELECT lc, toTypeName(lc) FROM nl FULL JOIN r_lc USING (lc) ORDER BY x;
+
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l RIGHT JOIN r_lc AS r USING (lc) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (x) ORDER BY x;
+SELECT toTypeName(r.lc), toTypeName(materialize(r.lc)), r.lc, materialize(r.lc), toTypeName(l.lc), toTypeName(materialize(l.lc)), l.lc, materialize(l.lc) FROM nl AS l FULL JOIN r_lc AS r USING (lc) ORDER BY x;
+
+SET join_use_nulls = 0;
+SELECT lc, toTypeName(lc)  FROM l_lc AS l RIGHT JOIN r_lc AS r USING (x) ORDER BY l.lc;
+
+SELECT lowCardinalityKeys(lc.lc) FROM r FULL JOIN l_lc as lc USING (lc) ORDER BY lowCardinalityKeys(lc.lc);
+
+DROP TABLE l;
+DROP TABLE r;
+DROP TABLE nl;
+DROP TABLE nr;
+DROP TABLE l_lc;
+DROP TABLE r_lc;
diff --git a/tests/queries/0_stateless/01049_join_low_card_crash.reference b/tests/queries/0_stateless/01049_join_low_card_crash.reference
index 648a5de0a87c..33e6920cd7a0 100644
--- a/tests/queries/0_stateless/01049_join_low_card_crash.reference
+++ b/tests/queries/0_stateless/01049_join_low_card_crash.reference
@@ -4,9 +4,13 @@ a	1	2
 b	0	3
 	0	b	3
 a	1	a	2
+0
+7
 a	1
 b	\N
 a	1	2
 b	\N	3
 a	1	a	2
 \N	\N	b	3
+7
+\N
diff --git a/tests/queries/0_stateless/01049_join_low_card_crash.sql b/tests/queries/0_stateless/01049_join_low_card_crash.sql
index 4465fc9581f7..6681014effa7 100644
--- a/tests/queries/0_stateless/01049_join_low_card_crash.sql
+++ b/tests/queries/0_stateless/01049_join_low_card_crash.sql
@@ -11,11 +11,15 @@ SELECT * FROM Alpha FULL JOIN (SELECT 'b' as foo) js2 USING (foo) ORDER BY foo;
 SELECT * FROM Alpha FULL JOIN Beta USING (foo) ORDER BY foo;
 SELECT * FROM Alpha FULL JOIN Beta ON Alpha.foo = Beta.foo ORDER BY foo;
 
+-- https://github.com/ClickHouse/ClickHouse/issues/20315#issuecomment-789579457
+SELECT materialize(js2.k) FROM (SELECT toLowCardinality(number) AS k FROM numbers(1)) AS js1  FULL OUTER JOIN (SELECT number + 7 AS k FROM numbers(1)) AS js2 USING (k) ORDER BY js2.k;
+
 SET join_use_nulls = 1;
 
 SELECT * FROM Alpha FULL JOIN (SELECT 'b' as foo) js2 USING (foo) ORDER BY foo;
 SELECT * FROM Alpha FULL JOIN Beta USING (foo) ORDER BY foo;
 SELECT * FROM Alpha FULL JOIN Beta ON Alpha.foo = Beta.foo ORDER BY foo;
+SELECT materialize(js2.k) FROM (SELECT toLowCardinality(number) AS k FROM numbers(1)) AS js1  FULL OUTER JOIN (SELECT number + 7 AS k FROM numbers(1)) AS js2 USING (k) ORDER BY js2.k;
 
 DROP TABLE Alpha;
 DROP TABLE Beta;
