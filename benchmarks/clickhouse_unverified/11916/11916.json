{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 11916,
  "instance_id": "ClickHouse__ClickHouse-11916",
  "issue_numbers": [
    "11914"
  ],
  "base_commit": "751319d0ef69f58bd6a9629eb087c3156283f5ab",
  "patch": "diff --git a/src/Interpreters/ReplaceQueryParameterVisitor.cpp b/src/Interpreters/ReplaceQueryParameterVisitor.cpp\nindex 5c29c722f88e..7a5cec358075 100644\n--- a/src/Interpreters/ReplaceQueryParameterVisitor.cpp\n+++ b/src/Interpreters/ReplaceQueryParameterVisitor.cpp\n@@ -49,6 +49,7 @@ void ReplaceQueryParameterVisitor::visitQueryParameter(ASTPtr & ast)\n     const auto & ast_param = ast->as<ASTQueryParameter &>();\n     const String & value = getParamValue(ast_param.name);\n     const String & type_name = ast_param.type;\n+    String alias = ast_param.alias;\n \n     const auto data_type = DataTypeFactory::instance().get(type_name);\n     auto temp_column_ptr = data_type->createColumn();\n@@ -63,6 +64,7 @@ void ReplaceQueryParameterVisitor::visitQueryParameter(ASTPtr & ast)\n             + value.substr(0, read_buffer.count()), ErrorCodes::BAD_QUERY_PARAMETER);\n \n     ast = addTypeConversionToAST(std::make_shared<ASTLiteral>(temp_column[0]), type_name);\n+    ast->setAlias(alias);\n }\n \n }\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01342_query_parameters_alias.reference b/tests/queries/0_stateless/01342_query_parameters_alias.reference\nnew file mode 100644\nindex 000000000000..dffa16eaec2b\n--- /dev/null\n+++ b/tests/queries/0_stateless/01342_query_parameters_alias.reference\n@@ -0,0 +1,3 @@\n+a\n+Nullable(Nothing)\n+\\N\ndiff --git a/tests/queries/0_stateless/01342_query_parameters_alias.sh b/tests/queries/0_stateless/01342_query_parameters_alias.sh\nnew file mode 100755\nindex 000000000000..1f46f6b388e0\n--- /dev/null\n+++ b/tests/queries/0_stateless/01342_query_parameters_alias.sh\n@@ -0,0 +1,6 @@\n+#!/usr/bin/env bash\n+\n+CURDIR=$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\n+. $CURDIR/../shell_config.sh\n+\n+$CLICKHOUSE_CLIENT --param_x '\\N' --query 'SELECT {x:Nullable(Nothing)} as a' --format TSVWithNamesAndTypes\n",
  "problem_statement": "Alias is lost when query parameters are used\n```\r\nclickhouse-client --param_x='\\N' -q'SELECT {x:Nullable(Nothing)} as a' --format=TSVWithNamesAndTypes \r\nCAST(NULL, \\'Nullable(Nothing)\\')\r\nNullable(Nothing)\r\n\\N\r\n```\r\n\r\nExpected output:\r\n```\r\na\r\nNullable(Nothing)\r\n\\N\r\n```\n",
  "hints_text": "",
  "created_at": "2020-06-24T13:21:45Z",
  "modified_files": [
    "src/Interpreters/ReplaceQueryParameterVisitor.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/01342_query_parameters_alias.reference",
    "b/tests/queries/0_stateless/01342_query_parameters_alias.sh"
  ]
}