diff --git a/dbms/tests/queries/0_stateless/00701_rollup.reference b/dbms/tests/queries/0_stateless/00701_rollup.reference
index ec07ad52cae2..637ae0bcb52d 100644
--- a/dbms/tests/queries/0_stateless/00701_rollup.reference
+++ b/dbms/tests/queries/0_stateless/00701_rollup.reference
@@ -25,3 +25,13 @@ a	70	4
 b	50	4
 
 	120	8
+	120	8
+a	70	4
+b	50	4
+	0	120	8
+a	0	70	4
+a	1	25	2
+a	2	45	2
+b	0	50	4
+b	1	15	2
+b	2	35	2
diff --git a/dbms/tests/queries/0_stateless/00701_rollup.sql b/dbms/tests/queries/0_stateless/00701_rollup.sql
index 3f4df923f903..fa7f3a21657f 100644
--- a/dbms/tests/queries/0_stateless/00701_rollup.sql
+++ b/dbms/tests/queries/0_stateless/00701_rollup.sql
@@ -1,14 +1,9 @@
 DROP TABLE IF EXISTS rollup;
 CREATE TABLE rollup(a String, b Int32, s Int32) ENGINE = Memory;
 
-INSERT INTO rollup  VALUES('a', 1, 10);
-INSERT INTO rollup  VALUES('a', 1, 15);
-INSERT INTO rollup  VALUES('a', 2, 20);
-INSERT INTO rollup  VALUES('a', 2, 25);
-INSERT INTO rollup  VALUES('b', 1, 10);
-INSERT INTO rollup  VALUES('b', 1, 5);
-INSERT INTO rollup  VALUES('b', 2, 20);
-INSERT INTO rollup  VALUES('b', 2, 15);
+INSERT INTO rollup VALUES ('a', 1, 10), ('a', 1, 15), ('a', 2, 20);
+INSERT INTO rollup VALUES ('a', 2, 25), ('b', 1, 10), ('b', 1, 5);
+INSERT INTO rollup VALUES ('b', 2, 20), ('b', 2, 15);
 
 SELECT a, b, sum(s), count() from rollup GROUP BY ROLLUP(a, b) ORDER BY a, b;
 
@@ -20,4 +15,9 @@ SELECT a, sum(s), count() from rollup GROUP BY a WITH ROLLUP ORDER BY a;
 
 SELECT a, sum(s), count() from rollup GROUP BY a WITH ROLLUP WITH TOTALS ORDER BY a;
 
+SET group_by_two_level_threshold = 1;
+
+SELECT a, sum(s), count() from rollup GROUP BY a WITH ROLLUP ORDER BY a;
+SELECT a, b, sum(s), count() from rollup GROUP BY a, b WITH ROLLUP ORDER BY a, b;
+
 DROP TABLE rollup;
diff --git a/dbms/tests/queries/0_stateless/00720_with_cube.reference b/dbms/tests/queries/0_stateless/00720_with_cube.reference
index a0b951978f9b..818e8626dde8 100644
--- a/dbms/tests/queries/0_stateless/00720_with_cube.reference
+++ b/dbms/tests/queries/0_stateless/00720_with_cube.reference
@@ -18,8 +18,8 @@ b	1	15	2
 b	2	35	2
 
 	0	120	8
-	1	40	4
 	0	120	8
+	1	40	4
 	2	80	4
 a	0	70	4
 a	1	25	2
@@ -27,8 +27,8 @@ a	2	45	2
 b	0	50	4
 b	1	15	2
 b	2	35	2
-	1	40	4
 	0	120	8
+	1	40	4
 	2	80	4
 a	0	70	4
 a	1	25	2
@@ -38,3 +38,12 @@ b	1	15	2
 b	2	35	2
 
 	0	120	8
+	0	120	8
+	1	40	4
+	2	80	4
+a	0	70	4
+a	1	25	2
+a	2	45	2
+b	0	50	4
+b	1	15	2
+b	2	35	2
diff --git a/dbms/tests/queries/0_stateless/00720_with_cube.sql b/dbms/tests/queries/0_stateless/00720_with_cube.sql
index bcde617803e3..42b65c8222c4 100644
--- a/dbms/tests/queries/0_stateless/00720_with_cube.sql
+++ b/dbms/tests/queries/0_stateless/00720_with_cube.sql
@@ -1,21 +1,21 @@
-DROP TABLE IF EXISTS rollup;
-CREATE TABLE rollup(a String, b Int32, s Int32) ENGINE = Memory;
+DROP TABLE IF EXISTS cube;
+CREATE TABLE cube(a String, b Int32, s Int32) ENGINE = Memory;
 
-INSERT INTO rollup  VALUES('a', 1, 10);
-INSERT INTO rollup  VALUES('a', 1, 15);
-INSERT INTO rollup  VALUES('a', 2, 20);
-INSERT INTO rollup  VALUES('a', 2, 25);
-INSERT INTO rollup  VALUES('b', 1, 10);
-INSERT INTO rollup  VALUES('b', 1, 5);
-INSERT INTO rollup  VALUES('b', 2, 20);
-INSERT INTO rollup  VALUES('b', 2, 15);
+-- SET experimental_use_processors=1;
 
-SELECT a, b, sum(s), count() from rollup GROUP BY CUBE(a, b) ORDER BY a, b;
+INSERT INTO cube VALUES ('a', 1, 10), ('a', 1, 15), ('a', 2, 20);
+INSERT INTO cube VALUES ('a', 2, 25), ('b', 1, 10), ('b', 1, 5);
+INSERT INTO cube VALUES ('b', 2, 20), ('b', 2, 15);
 
-SELECT a, b, sum(s), count() from rollup GROUP BY CUBE(a, b) WITH TOTALS ORDER BY a, b;
+SELECT a, b, sum(s), count() from cube GROUP BY CUBE(a, b) ORDER BY a, b;
 
-SELECT a, b, sum(s), count() from rollup GROUP BY a, b WITH CUBE ORDER BY a;
+SELECT a, b, sum(s), count() from cube GROUP BY CUBE(a, b) WITH TOTALS ORDER BY a, b;
 
-SELECT a, b, sum(s), count() from rollup GROUP BY a, b WITH CUBE WITH TOTALS ORDER BY a;
+SELECT a, b, sum(s), count() from cube GROUP BY a, b WITH CUBE ORDER BY a, b;
 
-DROP TABLE rollup;
+SELECT a, b, sum(s), count() from cube GROUP BY a, b WITH CUBE WITH TOTALS ORDER BY a, b;
+
+SET group_by_two_level_threshold = 1;
+SELECT a, b, sum(s), count() from cube GROUP BY a, b WITH CUBE ORDER BY a, b;
+
+DROP TABLE cube;
