diff --git a/tests/queries/0_stateless/01818_input_format_with_names_use_header.reference b/tests/queries/0_stateless/01818_input_format_with_names_use_header.reference
new file mode 100644
index 000000000000..b7b577c46851
--- /dev/null
+++ b/tests/queries/0_stateless/01818_input_format_with_names_use_header.reference
@@ -0,0 +1,2 @@
+testdata1
+testdata2
diff --git a/tests/queries/0_stateless/01818_input_format_with_names_use_header.sh b/tests/queries/0_stateless/01818_input_format_with_names_use_header.sh
new file mode 100755
index 000000000000..953c39a40a2a
--- /dev/null
+++ b/tests/queries/0_stateless/01818_input_format_with_names_use_header.sh
@@ -0,0 +1,15 @@
+#!/usr/bin/env bash
+
+CUR_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
+# shellcheck source=../shell_config.sh
+. "$CUR_DIR"/../shell_config.sh
+
+${CLICKHOUSE_CLIENT} -q "DROP TABLE IF EXISTS \`01818_with_names\`;"
+
+${CLICKHOUSE_CLIENT} -q "CREATE TABLE \`01818_with_names\` (t String) ENGINE = MergeTree ORDER BY t;"
+
+echo -ne "t
testdata1
testdata2" | ${CLICKHOUSE_CLIENT} --input_format_with_names_use_header 0 --query "INSERT INTO \`01818_with_names\` FORMAT CSVWithNames"
+
+${CLICKHOUSE_CLIENT} -q "SELECT * FROM \`01818_with_names\`;"
+
+${CLICKHOUSE_CLIENT} -q "DROP TABLE IF EXISTS \`01818_with_names\`;"
