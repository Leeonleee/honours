{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 49090,
  "instance_id": "ClickHouse__ClickHouse-49090",
  "issue_numbers": [
    "49041"
  ],
  "base_commit": "426221cadf3fdc310caac223181f2e8308bbf53c",
  "patch": "diff --git a/docker/docs/builder/Dockerfile b/docker/docs/builder/Dockerfile\nindex 5946687dbefe..3ca2bdafcb34 100644\n--- a/docker/docs/builder/Dockerfile\n+++ b/docker/docs/builder/Dockerfile\n@@ -1,4 +1,3 @@\n-# rebuild in #36968\n # docker build -t clickhouse/docs-builder .\n # nodejs 17 prefers ipv6 and is broken in our environment\n FROM node:16-alpine\n",
  "test_patch": "diff --git a/tests/ci/ci_config.py b/tests/ci/ci_config.py\nindex 8b4bd3681a62..7ebed139b93f 100644\n--- a/tests/ci/ci_config.py\n+++ b/tests/ci/ci_config.py\n@@ -383,15 +383,16 @@\n \n # checks required by Mergeable Check\n REQUIRED_CHECKS = [\n-    \"Fast test\",\n-    \"Style Check\",\n     \"ClickHouse build check\",\n     \"ClickHouse special build check\",\n+    \"Docs Check\",\n+    \"Fast test\",\n     \"Stateful tests (release)\",\n     \"Stateless tests (release)\",\n-    \"Unit tests (release-clang)\",\n+    \"Style Check\",\n     \"Unit tests (asan)\",\n     \"Unit tests (msan)\",\n+    \"Unit tests (release-clang)\",\n     \"Unit tests (tsan)\",\n     \"Unit tests (ubsan)\",\n ]\ndiff --git a/tests/ci/commit_status_helper.py b/tests/ci/commit_status_helper.py\nindex 9b2b9e4bcd93..6260abac1eb7 100644\n--- a/tests/ci/commit_status_helper.py\n+++ b/tests/ci/commit_status_helper.py\n@@ -95,6 +95,7 @@ def remove_labels(gh: Github, pr_info: PRInfo, labels_names: List[str]) -> None:\n     pull_request = repo.get_pull(pr_info.number)\n     for label in labels_names:\n         pull_request.remove_from_labels(label)\n+        pr_info.labels.remove(label)\n \n \n def post_labels(gh: Github, pr_info: PRInfo, labels_names: List[str]) -> None:\n@@ -102,6 +103,7 @@ def post_labels(gh: Github, pr_info: PRInfo, labels_names: List[str]) -> None:\n     pull_request = repo.get_pull(pr_info.number)\n     for label in labels_names:\n         pull_request.add_to_labels(label)\n+        pr_info.labels.add(label)\n \n \n def format_description(description: str) -> str:\ndiff --git a/tests/ci/docs_check.py b/tests/ci/docs_check.py\nindex 4378c857afed..ed2743ca9655 100644\n--- a/tests/ci/docs_check.py\n+++ b/tests/ci/docs_check.py\n@@ -1,5 +1,6 @@\n #!/usr/bin/env python3\n import argparse\n+import atexit\n import logging\n import subprocess\n import os\n@@ -8,7 +9,7 @@\n from github import Github\n \n from clickhouse_helper import ClickHouseHelper, prepare_tests_results_for_clickhouse\n-from commit_status_helper import post_commit_status, get_commit\n+from commit_status_helper import post_commit_status, get_commit, update_mergeable_check\n from docker_pull_helper import get_image_with_version\n from env_helper import TEMP_PATH, REPO_COPY\n from get_robot_token import get_best_robot_token\n@@ -56,6 +57,7 @@ def main():\n     if rerun_helper.is_already_finished_by_status():\n         logging.info(\"Check is already finished according to github status, exiting\")\n         sys.exit(0)\n+    atexit.register(update_mergeable_check, gh, pr_info, NAME)\n \n     if not pr_info.has_changes_in_documentation() and not args.force:\n         logging.info(\"No changes in documentation\")\ndiff --git a/tests/ci/run_check.py b/tests/ci/run_check.py\nindex 4078b7644922..44e1e4132c82 100644\n--- a/tests/ci/run_check.py\n+++ b/tests/ci/run_check.py\n@@ -13,6 +13,7 @@\n     remove_labels,\n     set_mergeable_check,\n )\n+from docs_check import NAME as DOCS_NAME\n from env_helper import GITHUB_RUN_URL, GITHUB_REPOSITORY, GITHUB_SERVER_URL\n from get_robot_token import get_best_robot_token\n from pr_info import FORCE_TESTS_LABEL, PRInfo\n@@ -27,6 +28,7 @@\n OK_SKIP_LABELS = {\"release\", \"pr-backport\", \"pr-cherrypick\"}\n CAN_BE_TESTED_LABEL = \"can be tested\"\n DO_NOT_TEST_LABEL = \"do not test\"\n+FEATURE_LABEL = \"pr-feature\"\n SUBMODULE_CHANGED_LABEL = \"submodule changed\"\n \n # They are used in .github/PULL_REQUEST_TEMPLATE.md, keep comments there\n@@ -249,7 +251,15 @@ def check_pr_description(pr_info: PRInfo) -> Tuple[str, str]:\n     if pr_labels_to_remove:\n         remove_labels(gh, pr_info, pr_labels_to_remove)\n \n-    set_mergeable_check(commit, \"skipped\")\n+    if FEATURE_LABEL in pr_info.labels:\n+        print(f\"The '{FEATURE_LABEL}' in the labels, expect the 'Docs Check' status\")\n+        commit.create_status(\n+            context=DOCS_NAME,\n+            description=f\"expect adding docs for {FEATURE_LABEL}\",\n+            state=\"pending\",\n+        )\n+    else:\n+        set_mergeable_check(commit, \"skipped\")\n \n     if description_error:\n         print(\n",
  "problem_statement": "Enforce documentation for `pr-feature` PRs\nAfter some thoughts, we'll just add the pending documentation status. Everything will work as usual, but it will block merging the PR unless the DocsCheck is finished.\n",
  "hints_text": "",
  "created_at": "2023-04-24T08:43:10Z",
  "modified_files": [
    "docker/docs/builder/Dockerfile"
  ],
  "modified_test_files": [
    "tests/ci/ci_config.py",
    "tests/ci/commit_status_helper.py",
    "tests/ci/docs_check.py",
    "tests/ci/run_check.py"
  ]
}