diff --git a/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.reference b/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.reference
index f799e8ed8f03..6bf25043399c 100644
--- a/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.reference
+++ b/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.reference
@@ -5,3 +5,5 @@ OK
 OK
 OK
 OK
+OK
+OK
diff --git a/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.sh b/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.sh
index 9b190855adf6..68cb5e0e7606 100755
--- a/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.sh
+++ b/tests/queries/0_stateless/01017_mutations_with_nondeterministic_functions_zookeeper.sh
@@ -43,6 +43,12 @@ ${CLICKHOUSE_CLIENT} --query "ALTER TABLE $R1 DELETE WHERE ignore(rand())" 2>&1
 ${CLICKHOUSE_CLIENT} --query "ALTER TABLE $R1 UPDATE y = y + rand() % 1 WHERE not ignore()" 2>&1 \
 | fgrep -q "must use only deterministic functions" && echo 'OK' || echo 'FAIL'
 
+${CLICKHOUSE_CLIENT} --query "ALTER TABLE $R1 UPDATE y = x + arrayCount(x -> (x + y) % 2, range(y)) WHERE not ignore()" 2>&1 > /dev/null \
+&& echo 'OK' || echo 'FAIL'
+
+${CLICKHOUSE_CLIENT} --query "ALTER TABLE $R1 UPDATE y = x + arrayCount(x -> (rand() + x) % 2, range(y)) WHERE not ignore()" 2>&1 \
+| fgrep -q "must use only deterministic functions" && echo 'OK' || echo 'FAIL'
+
 
 # For regular tables we do not enforce deterministic functions
 ${CLICKHOUSE_CLIENT} --query "ALTER TABLE $T1 DELETE WHERE rand() = 0" 2>&1 > /dev/null \
