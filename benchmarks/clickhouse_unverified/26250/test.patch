diff --git a/tests/queries/0_stateless/01107_join_right_table_totals.reference b/tests/queries/0_stateless/01107_join_right_table_totals.reference
index f71d3b0d05f4..daf503b776d3 100644
--- a/tests/queries/0_stateless/01107_join_right_table_totals.reference
+++ b/tests/queries/0_stateless/01107_join_right_table_totals.reference
@@ -18,3 +18,31 @@
 0	0
 
 0	0
+1	1
+1	1
+
+0	0
+1	1
+1	1
+
+0	0
+1	1
+1	1
+
+0	0
+1	1
+1	1
+
+0	0
+1	1
+
+0	0
+1	foo	1	1	300
+
+0	foo	1	0	300
+1	100	1970-01-01	1	100	1970-01-01
+1	100	1970-01-01	1	200	1970-01-02
+1	200	1970-01-02	1	100	1970-01-01
+1	200	1970-01-02	1	200	1970-01-02
+
+0	0	1970-01-01	0	0	1970-01-01
diff --git a/tests/queries/0_stateless/01107_join_right_table_totals.sql b/tests/queries/0_stateless/01107_join_right_table_totals.sql
index a4f284e5e2da..f894b6bf8bbe 100644
--- a/tests/queries/0_stateless/01107_join_right_table_totals.sql
+++ b/tests/queries/0_stateless/01107_join_right_table_totals.sql
@@ -35,29 +35,66 @@ FULL JOIN
 ) rr
 USING (id);
 
-SELECT id, yago 
+SELECT id, yago
 FROM ( SELECT item_id AS id FROM t GROUP BY id ) AS ll
-FULL OUTER JOIN ( SELECT item_id AS id, arrayJoin([111, 222, 333, 444]), SUM(price_sold) AS yago FROM t GROUP BY id WITH TOTALS ) AS rr 
+FULL OUTER JOIN ( SELECT item_id AS id, arrayJoin([111, 222, 333, 444]), SUM(price_sold) AS yago FROM t GROUP BY id WITH TOTALS ) AS rr
 USING (id);
 
-SELECT id, yago 
+SELECT id, yago
 FROM ( SELECT item_id AS id, arrayJoin([111, 222, 333]) FROM t GROUP BY id WITH TOTALS ) AS ll
-FULL OUTER JOIN ( SELECT item_id AS id, SUM(price_sold) AS yago FROM t GROUP BY id ) AS rr 
+FULL OUTER JOIN ( SELECT item_id AS id, SUM(price_sold) AS yago FROM t GROUP BY id ) AS rr
 USING (id);
 
-SELECT id, yago 
+SELECT id, yago
 FROM ( SELECT item_id AS id, arrayJoin(emptyArrayInt32()) FROM t GROUP BY id WITH TOTALS ) AS ll
-FULL OUTER JOIN ( SELECT item_id AS id, SUM(price_sold) AS yago FROM t GROUP BY id ) AS rr 
+FULL OUTER JOIN ( SELECT item_id AS id, SUM(price_sold) AS yago FROM t GROUP BY id ) AS rr
 USING (id);
 
-SELECT id, yago 
+SELECT id, yago
 FROM ( SELECT item_id AS id FROM t GROUP BY id ) AS ll
-FULL OUTER JOIN ( SELECT item_id AS id, arrayJoin(emptyArrayInt32()), SUM(price_sold) AS yago FROM t GROUP BY id WITH TOTALS ) AS rr 
+FULL OUTER JOIN ( SELECT item_id AS id, arrayJoin(emptyArrayInt32()), SUM(price_sold) AS yago FROM t GROUP BY id WITH TOTALS ) AS rr
 USING (id);
 
-SELECT id, yago 
+SELECT id, yago
 FROM ( SELECT item_id AS id, arrayJoin([111, 222, 333]) FROM t GROUP BY id WITH TOTALS ) AS ll
-FULL OUTER JOIN ( SELECT item_id AS id, arrayJoin([111, 222, 333, 444]), SUM(price_sold) AS yago FROM t GROUP BY id WITH TOTALS ) AS rr 
+FULL OUTER JOIN ( SELECT item_id AS id, arrayJoin([111, 222, 333, 444]), SUM(price_sold) AS yago FROM t GROUP BY id WITH TOTALS ) AS rr
 USING (id);
 
+INSERT INTO t VALUES (1, 100, '1970-01-01'), (1, 200, '1970-01-02');
+
+SELECT *
+FROM (SELECT item_id FROM t GROUP BY item_id WITH TOTALS) l
+LEFT JOIN (SELECT item_id FROM t ) r
+ON l.item_id = r.item_id;
+
+SELECT *
+FROM (SELECT item_id FROM t GROUP BY item_id WITH TOTALS) l
+RIGHT JOIN (SELECT item_id FROM t ) r
+ON l.item_id = r.item_id;
+
+SELECT *
+FROM (SELECT item_id FROM t) l
+LEFT JOIN (SELECT item_id FROM t GROUP BY item_id WITH TOTALS ) r
+ON l.item_id = r.item_id;
+
+SELECT *
+FROM (SELECT item_id FROM t) l
+RIGHT JOIN (SELECT item_id FROM t GROUP BY item_id WITH TOTALS ) r
+ON l.item_id = r.item_id;
+
+SELECT *
+FROM (SELECT item_id FROM t GROUP BY item_id WITH TOTALS) l
+LEFT JOIN (SELECT item_id FROM t GROUP BY item_id WITH TOTALS ) r
+ON l.item_id = r.item_id;
+
+SELECT *
+FROM (SELECT item_id, 'foo' AS key, 1 AS val FROM t GROUP BY item_id WITH TOTALS) l
+LEFT JOIN (SELECT item_id, sum(price_sold) AS val FROM t GROUP BY item_id WITH TOTALS ) r
+ON l.item_id = r.item_id;
+
+SELECT *
+FROM (SELECT * FROM t GROUP BY item_id, price_sold, date WITH TOTALS) l
+LEFT JOIN (SELECT * FROM t GROUP BY item_id, price_sold, date WITH TOTALS ) r
+ON l.item_id = r.item_id;
+
 DROP TABLE t;
