{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 51756,
  "instance_id": "ClickHouse__ClickHouse-51756",
  "issue_numbers": [
    "36261",
    "51083"
  ],
  "base_commit": "933c2f3fb5564c48202bde8246d3b018250d2f8f",
  "patch": "diff --git a/src/Dictionaries/DictionaryStructure.h b/src/Dictionaries/DictionaryStructure.h\nindex f726a8a2a465..55060b1592f2 100644\n--- a/src/Dictionaries/DictionaryStructure.h\n+++ b/src/Dictionaries/DictionaryStructure.h\n@@ -34,7 +34,9 @@ enum class AttributeUnderlyingType : TypeIndexUnderlying\n     map_item(Decimal32), map_item(Decimal64), map_item(Decimal128), map_item(Decimal256),\n     map_item(DateTime64),\n \n-    map_item(UUID), map_item(String), map_item(Array)\n+    map_item(UUID), map_item(String), map_item(Array),\n+\n+    map_item(IPv4), map_item(IPv6)\n };\n \n #undef map_item\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02811_ip_dict_attribute.reference b/tests/queries/0_stateless/02811_ip_dict_attribute.reference\nnew file mode 100644\nindex 000000000000..a36cf2e3d8aa\n--- /dev/null\n+++ b/tests/queries/0_stateless/02811_ip_dict_attribute.reference\n@@ -0,0 +1,2 @@\n+('::2.2.2.2','2.2.2.2')\n+('::1.1.1.1','1.1.1.1')\ndiff --git a/tests/queries/0_stateless/02811_ip_dict_attribute.sql b/tests/queries/0_stateless/02811_ip_dict_attribute.sql\nnew file mode 100644\nindex 000000000000..0ffff6e4a530\n--- /dev/null\n+++ b/tests/queries/0_stateless/02811_ip_dict_attribute.sql\n@@ -0,0 +1,13 @@\n+CREATE TABLE src ( id UInt64, ip4 IPv4, ip6 IPv6 ) Engine=Memory AS\n+  SELECT * FROM VALUES( (1, '1.1.1.1', '::1.1.1.1'), (2, '2.2.2.2', '::2.2.2.2') );\n+\n+CREATE DICTIONARY dict ( id UInt64, ip4 IPv4, ip6 IPv6 )\n+  PRIMARY KEY id\n+  LAYOUT(HASHED())\n+  SOURCE (CLICKHOUSE ( table src))\n+  lifetime ( 10);\n+\n+SELECT dictGet('dict', ('ip6', 'ip4'), arrayJoin([2,1]));\n+\n+DROP DICTIONARY dict;\n+DROP TABLE src;\n",
  "problem_statement": "support IPv6 as a dictionary attribute\n```sql\r\ncreate table src ( id UInt64, ip6 IPv6) Engine=Memory;\r\n\r\ninsert into src values(1, 'fe80::9801:43ff:fe1f:7690');\r\n\r\nCREATE DICTIONARY dict\r\n(\r\n    id    UInt64,\r\n    ip6   IPv6\r\n)\r\nPRIMARY KEY id\r\nLAYOUT(HASHED())\r\nSOURCE (CLICKHOUSE ( table src))\r\nlifetime ( 10);\r\n\r\n(version 22.4.1):\r\nDB::Exception: Unknown type IPv6 for dictionary attribute. (UNKNOWN_TYPE)\r\n```\r\n\r\nWA: String\r\n\r\n```sql\r\nCREATE DICTIONARY dict\r\n(\r\n    id    UInt64,\r\n    ip6   String\r\n)\r\nPRIMARY KEY id\r\nLAYOUT(HASHED())\r\nSOURCE (CLICKHOUSE ( table src))\r\nlifetime ( 10);\r\n\r\nSELECT dictGet('dict', 'ip6', toUInt64(1))\r\n\u250c\u2500dictGet('dict', 'ip6', toUInt64(1))\u2500\u2510\r\n\u2502 fe80::9801:43ff:fe1f:7690           \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\n```\nIpv4 is not supported as a dictionary attribute anymore\nhttps://fiddle.clickhouse.com/5b6d5838-ce20-4a42-adb1-587fdaffe3da\r\n\r\nhttps://fiddle.clickhouse.com/18eca811-e125-418f-9031-6e0d108ce64c\r\n\r\n```sql\r\ncreate table src ( id UInt64, ip4 IPv4) Engine=Memory\r\nas select * from values((1, '0.0.0.0'),(2, '10.10.10.10'));\r\n\r\nCREATE DICTIONARY dict\r\n(\r\n    id    UInt64,\r\n    ip4   IPv4\r\n)\r\nPRIMARY KEY id\r\nLAYOUT(HASHED())\r\nSOURCE (CLICKHOUSE ( table src))\r\nlifetime ( 10);\r\n\r\nselect dictGet('dict', 'ip4', arrayJoin([1,2]));\r\n```\r\n\r\nDB::Exception: Unknown type IPv4 for dictionary attribute. (UNKNOWN_TYPE)\n",
  "hints_text": "Hi :-) Just checking in to see what the progress of this issue might be. Please provide a brief update when it's convenient. \nIt is not an easy task. Probably will be done in Q3 of 2022.\n@kitaisreal thanks!! I really appreciate the update. And I'll let interested folks know. \n@yakov-olkhovskiy \nbtw IPv6 never worked.\r\n* https://github.com/ClickHouse/ClickHouse/issues/36261",
  "created_at": "2023-07-04T02:22:33Z",
  "modified_files": [
    "src/Dictionaries/DictionaryStructure.h"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/02811_ip_dict_attribute.reference",
    "b/tests/queries/0_stateless/02811_ip_dict_attribute.sql"
  ]
}