diff --git a/tests/queries/0_stateless/02148_in_memory_part_flush.reference b/tests/queries/0_stateless/02148_in_memory_part_flush.reference
new file mode 100644
index 000000000000..219c5f4b22f6
--- /dev/null
+++ b/tests/queries/0_stateless/02148_in_memory_part_flush.reference
@@ -0,0 +1,4 @@
+before DETACH TABLE
+500
+after DETACH TABLE
+500
diff --git a/tests/queries/0_stateless/02148_in_memory_part_flush.sql b/tests/queries/0_stateless/02148_in_memory_part_flush.sql
new file mode 100644
index 000000000000..ec20721186e2
--- /dev/null
+++ b/tests/queries/0_stateless/02148_in_memory_part_flush.sql
@@ -0,0 +1,26 @@
+DROP TABLE IF EXISTS mem_part_flush;
+
+CREATE TABLE mem_part_flush
+(
+`key` UInt32,
+`ts` DateTime,
+`db_time` DateTime DEFAULT now()
+)
+ENGINE = MergeTree
+ORDER BY (key, ts)
+SETTINGS min_rows_for_compact_part = 1000000, min_bytes_for_compact_part = 200000000, in_memory_parts_enable_wal = 0;
+
+INSERT INTO mem_part_flush(key, ts) SELECT number % 1000, now() + intDiv(number,1000) FROM numbers(500);
+
+SELECT 'before DETACH TABLE';
+SELECT count(*) FROM mem_part_flush;
+
+DETACH TABLE mem_part_flush;
+
+ATTACH TABLE mem_part_flush;
+
+SELECT 'after DETACH TABLE';
+SELECT count(*) FROM mem_part_flush;
+
+
+DROP TABLE mem_part_flush;
