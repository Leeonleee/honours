diff --git a/src/Functions/ReplaceRegexpImpl.h b/src/Functions/ReplaceRegexpImpl.h
index 5d2549239c86..ad0ce08d9051 100644
--- a/src/Functions/ReplaceRegexpImpl.h
+++ b/src/Functions/ReplaceRegexpImpl.h
@@ -137,8 +137,14 @@ struct ReplaceRegexpImpl
 
                 if (replace_one)
                     can_finish_current_string = true;
-                else if (match.length() == 0)
-                    ++match_pos; /// Step one character to avoid infinite loop.
+
+                if (match.length() == 0)
+                {
+                    /// Step one character to avoid infinite loop
+                    ++match_pos;
+                    if (match_pos >= static_cast<size_t>(input.length()))
+                        can_finish_current_string = true;
+                }
             }
             else
                 can_finish_current_string = true;
