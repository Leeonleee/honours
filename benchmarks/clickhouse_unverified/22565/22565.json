{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 22565,
  "instance_id": "ClickHouse__ClickHouse-22565",
  "issue_numbers": [
    "22563"
  ],
  "base_commit": "d0effbb0fc5c23d378de0eb5ea506db4104e2ef7",
  "patch": "diff --git a/src/Columns/IColumnDummy.h b/src/Columns/IColumnDummy.h\nindex e844b54aaedf..7e1958f077e0 100644\n--- a/src/Columns/IColumnDummy.h\n+++ b/src/Columns/IColumnDummy.h\n@@ -59,13 +59,16 @@ class IColumnDummy : public IColumn\n \n     StringRef serializeValueIntoArena(size_t /*n*/, Arena & arena, char const *& begin) const override\n     {\n-        return { arena.allocContinue(0, begin), 0 };\n+        /// Has to put one useless byte into Arena, because serialization into zero number of bytes is ambiguous.\n+        char * res = arena.allocContinue(1, begin);\n+        *res = 0;\n+        return { res, 1 };\n     }\n \n     const char * deserializeAndInsertFromArena(const char * pos) override\n     {\n         ++s;\n-        return pos;\n+        return pos + 1;\n     }\n \n     const char * skipSerializedInArena(const char * pos) const override\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01787_arena_assert_column_nothing.reference b/tests/queries/0_stateless/01787_arena_assert_column_nothing.reference\nnew file mode 100644\nindex 000000000000..d00491fd7e5b\n--- /dev/null\n+++ b/tests/queries/0_stateless/01787_arena_assert_column_nothing.reference\n@@ -0,0 +1,1 @@\n+1\ndiff --git a/tests/queries/0_stateless/01787_arena_assert_column_nothing.sql b/tests/queries/0_stateless/01787_arena_assert_column_nothing.sql\nnew file mode 100644\nindex 000000000000..de6374a1bc3b\n--- /dev/null\n+++ b/tests/queries/0_stateless/01787_arena_assert_column_nothing.sql\n@@ -0,0 +1,1 @@\n+SELECT 1 GROUP BY emptyArrayToSingle(arrayFilter(x -> 1, []));\n",
  "problem_statement": "Failed assertion in Arena: additional_bytes > 0\n**Describe the bug**\r\nhttps://clickhouse-test-reports.s3.yandex.net/22534/0733144b4a355394fecb837ba01af76a50e3fa05/fuzzer_debug/server.log\r\n\r\n**How to reproduce**\r\n`SELECT emptyArrayToSingle(arrayFilter(x -> (x != inf), arrayJoin([[1024], []]))) FROM system.one ANY LEFT JOIN (SELECT dummy, [257], NULL, dummy AS value) AS js2 USING (dummy) GROUP BY emptyArrayToSingle(arrayFilter(x -> (x != 1.), arrayJoin([[]])))`\r\n\n",
  "hints_text": "Reproduced always.\n`SELECT 1 GROUP BY emptyArrayToSingle(arrayFilter(x -> 1, []))`",
  "created_at": "2021-04-03T19:52:34Z",
  "modified_files": [
    "src/Columns/IColumnDummy.h"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/01787_arena_assert_column_nothing.reference",
    "b/tests/queries/0_stateless/01787_arena_assert_column_nothing.sql"
  ]
}