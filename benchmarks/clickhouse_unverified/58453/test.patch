diff --git a/tests/config/config.d/graphite_alternative.xml b/tests/config/config.d/graphite_alternative.xml
index 1a00de52af54..6c0bd13ce43f 100644
--- a/tests/config/config.d/graphite_alternative.xml
+++ b/tests/config/config.d/graphite_alternative.xml
@@ -26,4 +26,28 @@
             </retention>
         </default>
     </graphite_rollup_alternative>
+    <graphite_rollup_alternative_no_function>
+        <version_column_name>Version</version_column_name>
+        <pattern>
+            <regexp>sum</regexp>
+            <retention>
+                <age>0</age>
+                <precision>600</precision>
+            </retention>
+            <retention>
+                <age>17280</age>
+                <precision>6000</precision>
+            </retention>
+        </pattern>
+        <default>
+            <retention>
+                <age>0</age>
+                <precision>600</precision>
+            </retention>
+            <retention>
+                <age>17280</age>
+                <precision>6000</precision>
+            </retention>
+        </default>
+    </graphite_rollup_alternative_no_function>
 </clickhouse>
diff --git a/tests/queries/0_stateless/02910_replicated_merge_parameters_must_consistent.sql b/tests/queries/0_stateless/02910_replicated_merge_parameters_must_consistent.sql
index 3c1bec4fb3f1..0f452105e6d8 100644
--- a/tests/queries/0_stateless/02910_replicated_merge_parameters_must_consistent.sql
+++ b/tests/queries/0_stateless/02910_replicated_merge_parameters_must_consistent.sql
@@ -8,13 +8,22 @@ CREATE TABLE t
 ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t/', 'r1', legacy_ver)
 ORDER BY id;
 
-CREATE TABLE t_r
+CREATE TABLE t_r_ok
+(
+    `id` UInt64,
+    `val` String,
+    `legacy_ver` UInt64,
+)
+ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t/', 'r2', legacy_ver)
+ORDER BY id;
+
+CREATE TABLE t_r_error
 (
     `id` UInt64,
     `val` String,
     `legacy_ver` UInt64
 )
-ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t/', 'r2')
+ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t/', 'r3')
 ORDER BY id; -- { serverError METADATA_MISMATCH }
 
 CREATE TABLE t2
@@ -27,14 +36,24 @@ CREATE TABLE t2
 ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t2/', 'r1', legacy_ver)
 ORDER BY id;
 
-CREATE TABLE t2_r
+CREATE TABLE t2_r_ok
 (
     `id` UInt64,
     `val` String,
     `legacy_ver` UInt64,
     `deleted` UInt8
 )
-ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t2/', 'r2', legacy_ver, deleted)
+ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t2/', 'r2', legacy_ver)
+ORDER BY id;
+
+CREATE TABLE t2_r_error
+(
+    `id` UInt64,
+    `val` String,
+    `legacy_ver` UInt64,
+    `deleted` UInt8
+)
+ENGINE = ReplicatedReplacingMergeTree('/tables/{database}/t2/', 'r3', legacy_ver, deleted)
 ORDER BY id; -- { serverError METADATA_MISMATCH }
 
 CREATE TABLE t3
@@ -46,13 +65,23 @@ CREATE TABLE t3
 ENGINE = ReplicatedSummingMergeTree('/tables/{database}/t3/', 'r1', metrics1)
 ORDER BY key;
 
-CREATE TABLE t3_r
+CREATE TABLE t3_r_ok
+(
+    `key` UInt64,
+    `metrics1` UInt64,
+    `metrics2` UInt64
+)
+ENGINE = ReplicatedSummingMergeTree('/tables/{database}/t3/', 'r2', metrics1)
+ORDER BY key;
+
+
+CREATE TABLE t3_r_error
 (
     `key` UInt64,
     `metrics1` UInt64,
     `metrics2` UInt64
 )
-ENGINE = ReplicatedSummingMergeTree('/tables/{database}/t3/', 'r2', metrics2)
+ENGINE = ReplicatedSummingMergeTree('/tables/{database}/t3/', 'r3', metrics2)
 ORDER BY key; -- { serverError METADATA_MISMATCH }
 
 CREATE TABLE t4
@@ -67,7 +96,7 @@ CREATE TABLE t4
 ENGINE = ReplicatedGraphiteMergeTree('/tables/{database}/t4/', 'r1', 'graphite_rollup')
 ORDER BY key;
 
-CREATE TABLE t4_r
+CREATE TABLE t4_r_ok
 (
     `key` UInt32,
     `Path` String,
@@ -76,5 +105,30 @@ CREATE TABLE t4_r
     `Version` UInt32,
     `col` UInt64
 )
-ENGINE = ReplicatedGraphiteMergeTree('/tables/{database}/t4/', 'r2', 'graphite_rollup_alternative')
+ENGINE = ReplicatedGraphiteMergeTree('/tables/{database}/t4/', 'r2', 'graphite_rollup')
+ORDER BY key;
+
+CREATE TABLE t4_r_error
+(
+    `key` UInt32,
+    `Path` String,
+    `Time` DateTime('UTC'),
+    `Value` Float64,
+    `Version` UInt32,
+    `col` UInt64
+)
+ENGINE = ReplicatedGraphiteMergeTree('/tables/{database}/t4/', 'r3', 'graphite_rollup_alternative')
 ORDER BY key; -- { serverError METADATA_MISMATCH }
+
+-- https://github.com/ClickHouse/ClickHouse/issues/58451
+CREATE TABLE t4_r_error_2
+(
+    `key` UInt32,
+    `Path` String,
+    `Time` DateTime('UTC'),
+    `Value` Float64,
+    `Version` UInt32,
+    `col` UInt64
+)
+ENGINE = ReplicatedGraphiteMergeTree('/tables/{database}/t4/', 'r4', 'graphite_rollup_alternative_no_function')
+ORDER BY key; -- { serverError METADATA_MISMATCH }
\ No newline at end of file
