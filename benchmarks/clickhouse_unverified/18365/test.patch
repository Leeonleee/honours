diff --git a/tests/queries/0_stateless/01605_dictinct_two_level.reference b/tests/queries/0_stateless/01605_dictinct_two_level.reference
new file mode 100644
index 000000000000..50d1615e1aae
--- /dev/null
+++ b/tests/queries/0_stateless/01605_dictinct_two_level.reference
@@ -0,0 +1,20 @@
+['0']
+['1']
+['2']
+['3']
+['4']
+['5']
+['6']
+['7']
+['8']
+['9']
+test.com	['foo3223','foo6455','foo382','foo5566','foo1037']
+test.com0	['foo0']
+test.com0.0001	['foo1']
+test.com0.0002	['foo2']
+test.com0.0003	['foo3']
+test.com0.0004	['foo4']
+test.com0.0005	['foo5']
+test.com0.0006	['foo6']
+test.com0.0007	['foo7']
+test.com0.0008	['foo8']
diff --git a/tests/queries/0_stateless/01605_dictinct_two_level.sql b/tests/queries/0_stateless/01605_dictinct_two_level.sql
new file mode 100644
index 000000000000..5f20ae590c5e
--- /dev/null
+++ b/tests/queries/0_stateless/01605_dictinct_two_level.sql
@@ -0,0 +1,25 @@
+SET group_by_two_level_threshold_bytes = 1;
+SET group_by_two_level_threshold = 1;
+
+SELECT groupArray(DISTINCT toString(number % 10)) FROM numbers_mt(50000) 
+    GROUP BY number ORDER BY number LIMIT 10
+    SETTINGS max_threads = 2, max_block_size = 2000;
+
+DROP TABLE IF EXISTS dictinct_two_level;
+
+CREATE TABLE dictinct_two_level (
+    time DateTime64(3),
+    domain String,
+    subdomain String
+) ENGINE = MergeTree ORDER BY time;
+
+INSERT INTO dictinct_two_level SELECT 1546300800000, 'test.com', concat('foo', toString(number % 10000)) from numbers(10000);
+INSERT INTO dictinct_two_level SELECT 1546300800000, concat('test.com', toString(number / 10000)) , concat('foo', toString(number % 10000)) from numbers(10000);
+
+SELECT
+    domain, groupArraySample(5, 11111)(DISTINCT subdomain) AS example_subdomains
+FROM dictinct_two_level
+GROUP BY domain ORDER BY domain, example_subdomains
+LIMIT 10;
+
+DROP TABLE IF EXISTS dictinct_two_level;
