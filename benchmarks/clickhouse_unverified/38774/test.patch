diff --git a/tests/queries/0_stateless/02346_non_negative_derivative.reference b/tests/queries/0_stateless/02346_non_negative_derivative.reference
new file mode 100644
index 000000000000..51fe2359bd01
--- /dev/null
+++ b/tests/queries/0_stateless/02346_non_negative_derivative.reference
@@ -0,0 +1,64 @@
+1
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	0.20550000000000002
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	6.165000000000001e-10
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	8.22e-7
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	0.0010275000000000002
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	1.233
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	86.31
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	5918.400000000001
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	159796.80000000002
+1979-12-12 21:21:23.000	1.54	0
+1979-12-12 21:21:21.127	3.7	0
+2283-11-11 23:37:36.788	1.1	0
+2283-11-11 23:37:36.789	2.34	0
+1979-12-12 21:21:21.129	2.1	0
+1979-12-12 21:21:22.000	1.3345	0
+1979-12-12 21:21:23.000	1.54	1242864
+1979-12-12 21:21:23.000	1.54	0
diff --git a/tests/queries/0_stateless/02346_non_negative_derivative.sql b/tests/queries/0_stateless/02346_non_negative_derivative.sql
new file mode 100644
index 000000000000..265a8afb2cb8
--- /dev/null
+++ b/tests/queries/0_stateless/02346_non_negative_derivative.sql
@@ -0,0 +1,65 @@
+DROP TABLE IF EXISTS nnd;
+
+CREATE TABLE nnd
+(
+    id Int8, ts DateTime64(3, 'UTC'), metric Float64
+)
+ENGINE=MergeTree()
+ORDER BY id;
+
+INSERT INTO nnd VALUES (1, toDateTime64('1979-12-12 21:21:21.123456788', 9, 'UTC'), 1.1), (2, toDateTime64('1979-12-12 21:21:21.123456789', 9, 'UTC'), 2.34), (3, toDateTime64('1979-12-12 21:21:21.127', 3, 'UTC'), 3.7);
+INSERT INTO nnd VALUES (4, toDateTime64('1979-12-12 21:21:21.129', 3, 'UTC'), 2.1), (5, toDateTime('1979-12-12 21:21:22', 'UTC'), 1.3345), (6, toDateTime('1979-12-12 21:21:23', 'UTC'), 1.54), (7, toDateTime('1979-12-12 21:21:23', 'UTC'), 1.54);
+
+OPTIMIZE TABLE nnd;
+
+-- shall work for precise intervals
+-- INTERVAL 1 SECOND shall be default
+SELECT (
+           SELECT
+               ts,
+               metric,
+               nonNegativeDerivative(metric, ts) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv
+           FROM nnd
+           LIMIT 5, 1
+       ) = (
+           SELECT
+               ts,
+               metric,
+               nonNegativeDerivative(metric, ts, toIntervalSecond(1)) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv
+           FROM nnd
+           LIMIT 5, 1
+       );
+SELECT ts, metric, nonNegativeDerivative(metric, ts) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS deriv FROM nnd;
+-- Nanosecond
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 3 NANOSECOND) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS deriv FROM nnd;
+-- Microsecond
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 4 MICROSECOND) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS deriv FROM nnd;
+-- Millisecond
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 5 MILLISECOND) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS deriv FROM nnd;
+-- Second
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 6 SECOND) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd;
+-- Minute
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 7 MINUTE) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND 2 FOLLOWING) AS deriv FROM nnd;
+-- Hour
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 8 HOUR) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd;
+-- Day
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 9 DAY) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 3 PRECEDING AND 3 FOLLOWING) AS deriv FROM nnd;
+-- Week
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 10 WEEK) OVER (PARTITION BY id>3 ORDER BY ts ASC Rows BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd;
+
+-- shall not work for month, quarter, year (intervals with floating number of seconds)
+-- Month
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 11 MONTH) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }
+-- Quarter
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 12 QUARTER) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }
+-- Year
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 13 YEAR) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError ILLEGAL_TYPE_OF_ARGUMENT }
+
+-- test against wrong arguments/types
+SELECT ts, metric, nonNegativeDerivative(metric, 1, INTERVAL 3 NANOSECOND) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError BAD_ARGUMENTS }
+SELECT ts, metric, nonNegativeDerivative('string not datetime', ts, INTERVAL 3 NANOSECOND) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError BAD_ARGUMENTS }
+SELECT ts, metric, nonNegativeDerivative(metric, ts, INTERVAL 3 NANOSECOND, id) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError BAD_ARGUMENTS }
+SELECT ts, metric, nonNegativeDerivative(metric) OVER (PARTITION BY metric ORDER BY ts ASC Rows BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS deriv FROM nnd; -- { serverError BAD_ARGUMENTS }
+
+-- cleanup
+DROP TABLE IF EXISTS nnd;
