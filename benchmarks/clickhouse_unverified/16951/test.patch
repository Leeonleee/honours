diff --git a/tests/queries/0_stateless/01561_aggregate_functions_of_key_with_join.reference b/tests/queries/0_stateless/01561_aggregate_functions_of_key_with_join.reference
new file mode 100644
index 000000000000..9874d6464ab7
--- /dev/null
+++ b/tests/queries/0_stateless/01561_aggregate_functions_of_key_with_join.reference
@@ -0,0 +1,1 @@
+1	2
diff --git a/tests/queries/0_stateless/01561_aggregate_functions_of_key_with_join.sql b/tests/queries/0_stateless/01561_aggregate_functions_of_key_with_join.sql
new file mode 100644
index 000000000000..66047fcc1a6a
--- /dev/null
+++ b/tests/queries/0_stateless/01561_aggregate_functions_of_key_with_join.sql
@@ -0,0 +1,5 @@
+SET optimize_aggregators_of_group_by_keys = 1;
+SELECT source.key, max(target.key) FROM (SELECT 1 key, 'x' name) source
+INNER JOIN (SELECT 2 key, 'x' name) target
+ON source.name = target.name
+GROUP BY source.key;
