{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 19972,
  "instance_id": "ClickHouse__ClickHouse-19972",
  "issue_numbers": [
    "19967"
  ],
  "base_commit": "474f151707ef13cc80bc38ed756729db36cb8a51",
  "patch": "diff --git a/src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp b/src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp\nindex 249026d1011a..d74569664675 100644\n--- a/src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp\n+++ b/src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp\n@@ -24,6 +24,7 @@\n #include <Interpreters/Set.h>\n #include <Interpreters/PreparedSets.h>\n #include <Interpreters/TreeRewriter.h>\n+#include <Interpreters/convertFieldToType.h>\n \n #include <Poco/File.h>\n #include <Poco/Path.h>\n@@ -44,9 +45,12 @@ namespace ErrorCodes\n     extern const int NUMBER_OF_ARGUMENTS_DOESNT_MATCH;\n }\n \n+using FieldVectorPtr = std::shared_ptr<FieldVector>;\n+\n \n // returns keys may be filter by condition\n-static bool traverseASTFilter(const String & primary_key, const DataTypePtr & primary_key_type, const ASTPtr & elem, const PreparedSets & sets, FieldVector & res)\n+static bool traverseASTFilter(\n+    const String & primary_key, const DataTypePtr & primary_key_type, const ASTPtr & elem, const PreparedSets & sets, FieldVectorPtr & res)\n {\n     const auto * function = elem->as<ASTFunction>();\n     if (!function)\n@@ -63,13 +67,9 @@ static bool traverseASTFilter(const String & primary_key, const DataTypePtr & pr\n     else if (function->name == \"or\")\n     {\n         // make sure every child has the key filter condition\n-        FieldVector child_res;\n         for (const auto & child : function->arguments->children)\n-        {\n-            if (!traverseASTFilter(primary_key, primary_key_type, child, sets, child_res))\n+            if (!traverseASTFilter(primary_key, primary_key_type, child, sets, res))\n                 return false;\n-        }\n-        res.insert(res.end(), child_res.begin(), child_res.end());\n         return true;\n     }\n     else if (function->name == \"equals\" || function->name == \"in\")\n@@ -108,9 +108,7 @@ static bool traverseASTFilter(const String & primary_key, const DataTypePtr & pr\n             prepared_set->checkColumnsNumber(1);\n             const auto & set_column = *prepared_set->getSetElements()[0];\n             for (size_t row = 0; row < set_column.size(); ++row)\n-            {\n-                res.push_back(set_column[row]);\n-            }\n+                res->push_back(set_column[row]);\n             return true;\n         }\n         else\n@@ -125,10 +123,12 @@ static bool traverseASTFilter(const String & primary_key, const DataTypePtr & pr\n             if (ident->name() != primary_key)\n                 return false;\n \n-            //function->name == \"equals\"\n+            /// function->name == \"equals\"\n             if (const auto * literal = value->as<ASTLiteral>())\n             {\n-                res.push_back(literal->value);\n+                auto converted_field = convertFieldToType(literal->value, *primary_key_type);\n+                if (!converted_field.isNull())\n+                    res->push_back(converted_field);\n                 return true;\n             }\n         }\n@@ -140,14 +140,14 @@ static bool traverseASTFilter(const String & primary_key, const DataTypePtr & pr\n /** Retrieve from the query a condition of the form `key = 'key'`, `key in ('xxx_'), from conjunctions in the WHERE clause.\n   * TODO support key like search\n   */\n-static std::pair<FieldVector, bool> getFilterKeys(const String & primary_key, const DataTypePtr & primary_key_type, const SelectQueryInfo & query_info)\n+static std::pair<FieldVectorPtr, bool> getFilterKeys(\n+    const String & primary_key, const DataTypePtr & primary_key_type, const SelectQueryInfo & query_info)\n {\n     const auto & select = query_info.query->as<ASTSelectQuery &>();\n     if (!select.where())\n-    {\n-        return std::make_pair(FieldVector{}, true);\n-    }\n-    FieldVector res;\n+        return {{}, true};\n+\n+    FieldVectorPtr res = std::make_shared<FieldVector>();\n     auto matched_keys = traverseASTFilter(primary_key, primary_key_type, select.where(), query_info.sets, res);\n     return std::make_pair(res, !matched_keys);\n }\n@@ -159,23 +159,19 @@ class EmbeddedRocksDBSource : public SourceWithProgress\n     EmbeddedRocksDBSource(\n         const StorageEmbeddedRocksDB & storage_,\n         const StorageMetadataPtr & metadata_snapshot_,\n-        const FieldVector & keys_,\n-        const size_t start_,\n-        const size_t end_,\n+        FieldVectorPtr keys_,\n+        FieldVector::const_iterator begin_,\n+        FieldVector::const_iterator end_,\n         const size_t max_block_size_)\n         : SourceWithProgress(metadata_snapshot_->getSampleBlock())\n         , storage(storage_)\n         , metadata_snapshot(metadata_snapshot_)\n-        , start(start_)\n+        , keys(std::move(keys_))\n+        , begin(begin_)\n         , end(end_)\n+        , it(begin)\n         , max_block_size(max_block_size_)\n     {\n-        // slice the keys\n-        if (end > start)\n-        {\n-            keys.resize(end - start);\n-            std::copy(keys_.begin() + start, keys_.begin() + end, keys.begin());\n-        }\n     }\n \n     String getName() const override\n@@ -185,27 +181,34 @@ class EmbeddedRocksDBSource : public SourceWithProgress\n \n     Chunk generate() override\n     {\n-        if (processed_keys >= keys.size() || (start == end))\n+        if (it >= end)\n             return {};\n \n-        std::vector<rocksdb::Slice> slices_keys;\n-        slices_keys.reserve(keys.size());\n-        std::vector<String> values;\n-        std::vector<WriteBufferFromOwnString> wbs(keys.size());\n+        size_t num_keys = end - begin;\n+\n+        std::vector<std::string> serialized_keys(num_keys);\n+        std::vector<rocksdb::Slice> slices_keys(num_keys);\n \n         const auto & sample_block = metadata_snapshot->getSampleBlock();\n         const auto & key_column = sample_block.getByName(storage.primary_key);\n         auto columns = sample_block.cloneEmptyColumns();\n         size_t primary_key_pos = sample_block.getPositionByName(storage.primary_key);\n \n-        for (size_t i = processed_keys; i < std::min(keys.size(), processed_keys + max_block_size); ++i)\n+        size_t rows_processed = 0;\n+        while (it < end && rows_processed < max_block_size)\n         {\n-            key_column.type->serializeBinary(keys[i], wbs[i]);\n-            auto str_ref = wbs[i].stringRef();\n-            slices_keys.emplace_back(str_ref.data, str_ref.size);\n+            WriteBufferFromString wb(serialized_keys[rows_processed]);\n+            key_column.type->serializeBinary(*it, wb);\n+            wb.finalize();\n+            slices_keys[rows_processed] = std::move(serialized_keys[rows_processed]);\n+\n+            ++it;\n+            ++rows_processed;\n         }\n \n+        std::vector<String> values;\n         auto statuses = storage.rocksdb_ptr->MultiGet(rocksdb::ReadOptions(), slices_keys, &values);\n+\n         for (size_t i = 0; i < statuses.size(); ++i)\n         {\n             if (statuses[i].ok())\n@@ -221,7 +224,6 @@ class EmbeddedRocksDBSource : public SourceWithProgress\n                 }\n             }\n         }\n-        processed_keys += max_block_size;\n \n         UInt64 num_rows = columns.at(0)->size();\n         return Chunk(std::move(columns), num_rows);\n@@ -231,12 +233,11 @@ class EmbeddedRocksDBSource : public SourceWithProgress\n     const StorageEmbeddedRocksDB & storage;\n \n     const StorageMetadataPtr metadata_snapshot;\n-    const size_t start;\n-    const size_t end;\n+    FieldVectorPtr keys;\n+    FieldVector::const_iterator begin;\n+    FieldVector::const_iterator end;\n+    FieldVector::const_iterator it;\n     const size_t max_block_size;\n-    FieldVector keys;\n-\n-    size_t processed_keys = 0;\n };\n \n \n@@ -289,7 +290,8 @@ Pipe StorageEmbeddedRocksDB::read(\n         unsigned num_streams)\n {\n     metadata_snapshot->check(column_names, getVirtuals(), getStorageID());\n-    FieldVector keys;\n+\n+    FieldVectorPtr keys;\n     bool all_scan = false;\n \n     auto primary_key_data_type = metadata_snapshot->getSampleBlock().getByName(primary_key).type;\n@@ -302,37 +304,34 @@ Pipe StorageEmbeddedRocksDB::read(\n     }\n     else\n     {\n-        if (keys.empty())\n+        if (keys->empty())\n             return {};\n \n-        std::sort(keys.begin(), keys.end());\n-        auto unique_iter = std::unique(keys.begin(), keys.end());\n-        if (unique_iter != keys.end())\n-            keys.erase(unique_iter, keys.end());\n+        std::sort(keys->begin(), keys->end());\n+        keys->erase(std::unique(keys->begin(), keys->end()), keys->end());\n \n         Pipes pipes;\n-        size_t start = 0;\n-        size_t end;\n \n-        const size_t num_threads = std::min(size_t(num_streams), keys.size());\n-        const size_t batch_per_size = ceil(keys.size() * 1.0 / num_threads);\n+        size_t num_keys = keys->size();\n+        size_t num_threads = std::min(size_t(num_streams), keys->size());\n \n-        for (size_t t = 0; t < num_threads; ++t)\n+        assert(num_keys <= std::numeric_limits<uint32_t>::max());\n+        assert(num_threads <= std::numeric_limits<uint32_t>::max());\n+\n+        for (size_t thread_idx = 0; thread_idx < num_threads; ++thread_idx)\n         {\n-            if (start >= keys.size())\n-                start = end = 0;\n-            else\n-                end = start + batch_per_size > keys.size() ? keys.size() : start + batch_per_size;\n+            size_t begin = num_keys * thread_idx / num_threads;\n+            size_t end = num_keys * (thread_idx + 1) / num_threads;\n \n-            pipes.emplace_back(\n-                std::make_shared<EmbeddedRocksDBSource>(*this, metadata_snapshot, keys, start, end, max_block_size));\n-            start += batch_per_size;\n+            pipes.emplace_back(std::make_shared<EmbeddedRocksDBSource>(\n+                    *this, metadata_snapshot, keys, keys->begin() + begin, keys->begin() + end, max_block_size));\n         }\n         return Pipe::unitePipes(std::move(pipes));\n     }\n }\n \n-BlockOutputStreamPtr StorageEmbeddedRocksDB::write(const ASTPtr & /*query*/, const StorageMetadataPtr & metadata_snapshot, const Context & /*context*/)\n+BlockOutputStreamPtr StorageEmbeddedRocksDB::write(\n+    const ASTPtr & /*query*/, const StorageMetadataPtr & metadata_snapshot, const Context & /*context*/)\n {\n     return std::make_shared<EmbeddedRocksDBBlockOutputStream>(*this, metadata_snapshot);\n }\n",
  "test_patch": "diff --git a/docker/test/fasttest/run.sh b/docker/test/fasttest/run.sh\nindex 17cec7ae2868..bb29959acd2f 100755\n--- a/docker/test/fasttest/run.sh\n+++ b/docker/test/fasttest/run.sh\n@@ -319,6 +319,7 @@ function run_tests\n \n          # In fasttest, ENABLE_LIBRARIES=0, so rocksdb engine is not enabled by default\n         01504_rocksdb\n+        01686_rocksdb\n \n         # Look at DistributedFilesToInsert, so cannot run in parallel.\n         01460_DistributedFilesToInsert\ndiff --git a/tests/queries/0_stateless/01686_rocksdb.reference b/tests/queries/0_stateless/01686_rocksdb.reference\nnew file mode 100644\nindex 000000000000..fa4e12d51ff7\n--- /dev/null\n+++ b/tests/queries/0_stateless/01686_rocksdb.reference\n@@ -0,0 +1,15 @@\n+123\tHello, world (123)\n+--\n+--\n+123\tHello, world (123)\n+4567\tHello, world (4567)\n+--\n+--\n+0\tHello, world (0)\n+--\n+123\tHello, world (123)\n+456\tHello, world (456)\n+--\n+99\tHello, world (99)\n+999\tHello, world (999)\n+9999\tHello, world (9999)\ndiff --git a/tests/queries/0_stateless/01686_rocksdb.sql b/tests/queries/0_stateless/01686_rocksdb.sql\nnew file mode 100644\nindex 000000000000..c9b133acff31\n--- /dev/null\n+++ b/tests/queries/0_stateless/01686_rocksdb.sql\n@@ -0,0 +1,27 @@\n+DROP TABLE IF EXISTS test;\n+\n+CREATE TABLE test (key UInt64, value String) Engine=EmbeddedRocksDB PRIMARY KEY(key);\n+\n+INSERT INTO test SELECT number, format('Hello, world ({})', toString(number)) FROM numbers(10000);\n+\n+SELECT * FROM test WHERE key = 123;\n+SELECT '--';\n+SELECT * FROM test WHERE key = -123;\n+SELECT '--';\n+SELECT * FROM test WHERE key = 123 OR key = 4567 ORDER BY key;\n+SELECT '--';\n+SELECT * FROM test WHERE key = NULL;\n+SELECT '--';\n+SELECT * FROM test WHERE key = NULL OR key = 0;\n+SELECT '--';\n+SELECT * FROM test WHERE key IN (123, 456, -123) ORDER BY key;\n+SELECT '--';\n+SELECT * FROM test WHERE key = 'Hello'; -- { serverError 53 }\n+\n+DETACH TABLE test NO DELAY;\n+ATTACH TABLE test;\n+\n+SELECT * FROM test WHERE key IN (99, 999, 9999, -123) ORDER BY key;\n+\n+DROP TABLE IF EXISTS test;\n+\ndiff --git a/tests/queries/0_stateless/arcadia_skip_list.txt b/tests/queries/0_stateless/arcadia_skip_list.txt\nindex 7f34b5a9a84d..160f10eb413c 100644\n--- a/tests/queries/0_stateless/arcadia_skip_list.txt\n+++ b/tests/queries/0_stateless/arcadia_skip_list.txt\n@@ -200,4 +200,5 @@\n 01676_clickhouse_client_autocomplete\n 01671_aggregate_function_group_bitmap_data\n 01674_executable_dictionary_implicit_key\n+01686_rocksdb\n 01683_dist_INSERT_block_structure_mismatch\n",
  "problem_statement": "Uninitialized memory in StorageEmbeddedRocksDB.\n```\r\nUninitialized bytes in MemcmpInterceptorCommon at offset 0 inside [0x7fec91eea3d9, 4)\r\n==86==WARNING: MemorySanitizer: use-of-uninitialized-value\r\n    #0 0x8d6ec9e in memcmp (/workspace/clickhouse+0x8d6ec9e)\r\n    #1 0x3fe0332c in rocksdb::Slice::compare(rocksdb::Slice const&) const obj-x86_64-linux-gnu/../contrib/rocksdb/include/rocksdb/slice.h:250:11\r\n    #2 0x3fe0332c in rocksdb::(anonymous namespace)::BytewiseComparatorImpl::Compare(rocksdb::Slice const&, rocksdb::Slice const&) const obj-x86_64-linux-gnu/../contrib/rocksdb/util/comparator.cc:27:14\r\n    #3 0x3f54660f in rocksdb::UserComparatorWrapper::Compare(rocksdb::Slice const&, rocksdb::Slice const&) const obj-x86_64-linux-gnu/../contrib/rocksdb/util/user_comparator_wrapper.h:33:30\r\n    #4 0x3f54660f in rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const obj-x86_64-linux-gnu/../contrib/rocksdb/db/dbformat.h:723:28\r\n    #5 0x3f54660f in rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const obj-x86_64-linux-gnu/../contrib/rocksdb/db/memtable.cc:248:21\r\n    #6 0x3f954332 in rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindGreaterOrEqual(char const*) const obj-x86_64-linux-gnu/../contrib/rocksdb/memtable/inlineskiplist.h:483:21\r\n    #7 0x3f954332 in rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Iterator::Seek(char const*) obj-x86_64-linux-gnu/../contrib/rocksdb/memtable/inlineskiplist.h:400:18\r\n    #8 0x3f954332 in rocksdb::(anonymous namespace)::SkipListRep::Iterator::Seek(rocksdb::Slice const&, char const*) obj-x86_64-linux-gnu/../contrib/rocksdb/memtable/skiplistrep.cc:131:15\r\n    #9 0x3f954332 in rocksdb::(anonymous namespace)::SkipListRep::Get(rocksdb::LookupKey const&, void*, bool (*)(void*, char const*)) obj-x86_64-linux-gnu/../contrib/rocksdb/memtable/skiplistrep.cc:84:14\r\n    #10 0x3f54ca27 in rocksdb::MemTable::GetFromTable(rocksdb::LookupKey const&, unsigned long, bool, rocksdb::ReadCallback*, bool*, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*) obj-x86_64-linux-gnu/../contrib/rocksdb/db/memtable.cc:891:11\r\n    #11 0x3f54ca27 in rocksdb::MemTable::Get(rocksdb::LookupKey const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, unsigned long*, rocksdb::ReadOptions const&, rocksdb::ReadCallback*, bool*, bool) obj-x86_64-linux-gnu/../contrib/rocksdb/db/memtable.cc:851:5\r\n    #12 0x3f1473be in rocksdb::MemTable::Get(rocksdb::LookupKey const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, rocksdb::ReadOptions const&, rocksdb::ReadCallback*, bool*, bool) obj-x86_64-linux-gnu/../contrib/rocksdb/db/memtable.h:235:12\r\n    #13 0x3f1473be in rocksdb::DBImpl::MultiGet(rocksdb::ReadOptions const&, std::__1::vector<rocksdb::ColumnFamilyHandle*, std::__1::allocator<rocksdb::ColumnFamilyHandle*> > const&, std::__1::vector<rocksdb::Slice, std::__1::allocator<rocksdb::Slice> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) obj-x86_64-linux-gnu/../contrib/rocksdb/db/db_impl/db_impl.cc:1914:31\r\n    #14 0x3f1443da in rocksdb::DBImpl::MultiGet(rocksdb::ReadOptions const&, std::__1::vector<rocksdb::ColumnFamilyHandle*, std::__1::allocator<rocksdb::ColumnFamilyHandle*> > const&, std::__1::vector<rocksdb::Slice, std::__1::allocator<rocksdb::Slice> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) obj-x86_64-linux-gnu/../contrib/rocksdb/db/db_impl/db_impl.cc:1811:10\r\n    #15 0x3f1ce2d4 in rocksdb::DB::MultiGet(rocksdb::ReadOptions const&, std::__1::vector<rocksdb::Slice, std::__1::allocator<rocksdb::Slice> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) obj-x86_64-linux-gnu/../contrib/rocksdb/include/rocksdb/db.h:494:12\r\n    #16 0x2e15e1cd in DB::EmbeddedRocksDBSource::generate() obj-x86_64-linux-gnu/../src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp:208:46\r\n    #17 0x2ef62be1 in DB::ISource::tryGenerate() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:79:18\r\n    #18 0x2ef62525 in DB::ISource::work() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:53:26\r\n    #19 0x2f593b63 in DB::SourceWithProgress::work() obj-x86_64-linux-gnu/../src/Processors/Sources/SourceWithProgress.cpp:36:30\r\n    #20 0x2f068d68 in DB::executeJob(DB::IProcessor*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:79:20\r\n    #21 0x2f068d68 in DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:96:13\r\n    #22 0x2f068d68 in decltype(std::__1::forward<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(fp)()) std::__1::__invoke<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #23 0x2f068d68 in void std::__1::__invoke_void_return_wrapper<void>::__call<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #24 0x2f068d68 in std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #25 0x2f068d68 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #26 0x2f0618d8 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #27 0x2f0618d8 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #28 0x2f0618d8 in DB::PipelineExecutor::executeStepImpl(unsigned long, unsigned long, std::__1::atomic<bool>*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:580:17\r\n    #29 0x2f05b0fb in DB::PipelineExecutor::executeSingleThread(unsigned long, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:473:5\r\n    #30 0x2f05b0fb in DB::PipelineExecutor::executeImpl(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:807:9\r\n    #31 0x2f0594c9 in DB::PipelineExecutor::execute(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:395:9\r\n    #32 0x2f098847 in DB::threadFunction(DB::PullingAsyncPipelineExecutor::Data&, std::__1::shared_ptr<DB::ThreadGroupStatus>, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:79:24\r\n    #33 0x2f098847 in DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:101:13\r\n    #34 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(fp)()) std::__1::__invoke_constexpr<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3682:1\r\n    #35 0x2f098847 in decltype(auto) std::__1::__apply_tuple_impl<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1415:1\r\n    #36 0x2f098847 in decltype(auto) std::__1::apply<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1424:1\r\n    #37 0x2f098847 in ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()::operator()() obj-x86_64-linux-gnu/../src/Common/ThreadPool.h:178:13\r\n    #38 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(fp)()) std::__1::__invoke<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #39 0x2f098847 in void std::__1::__invoke_void_return_wrapper<void>::__call<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #40 0x2f098847 in std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #41 0x2f098847 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #42 0x8f2ce96 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #43 0x8f2ce96 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #44 0x8f2ce96 in ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:247:17\r\n    #45 0x8f3b517 in void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()::operator()() const obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:124:73\r\n    #46 0x8f3b517 in decltype(std::__1::forward<void>(fp)(std::__1::forward<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(fp0)...)) std::__1::__invoke<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(void&&, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #47 0x8f3b517 in void std::__1::__thread_execute<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(std::__1::tuple<void, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:280:5\r\n    #48 0x8f3b517 in void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()> >(void*) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:291:5\r\n    #49 0x7feda5bdc608 in start_thread /build/glibc-eX1tMB/glibc-2.31/nptl/pthread_create.c:477:8\r\n    #50 0x7feda5b03292 in clone /build/glibc-eX1tMB/glibc-2.31/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95\r\n\r\n  Uninitialized value was stored to memory at\r\n    #0 0x8d64899 in __msan_memcpy (/workspace/clickhouse+0x8d64899)\r\n    #1 0x3f43a44d in rocksdb::LookupKey::LookupKey(rocksdb::Slice const&, unsigned long, rocksdb::Slice const*) obj-x86_64-linux-gnu/../contrib/rocksdb/db/dbformat.cc:186:3\r\n    #2 0x3f146eb0 in rocksdb::DBImpl::MultiGet(rocksdb::ReadOptions const&, std::__1::vector<rocksdb::ColumnFamilyHandle*, std::__1::allocator<rocksdb::ColumnFamilyHandle*> > const&, std::__1::vector<rocksdb::Slice, std::__1::allocator<rocksdb::Slice> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) obj-x86_64-linux-gnu/../contrib/rocksdb/db/db_impl/db_impl.cc:1901:15\r\n    #3 0x3f1443da in rocksdb::DBImpl::MultiGet(rocksdb::ReadOptions const&, std::__1::vector<rocksdb::ColumnFamilyHandle*, std::__1::allocator<rocksdb::ColumnFamilyHandle*> > const&, std::__1::vector<rocksdb::Slice, std::__1::allocator<rocksdb::Slice> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) obj-x86_64-linux-gnu/../contrib/rocksdb/db/db_impl/db_impl.cc:1811:10\r\n    #4 0x3f1ce2d4 in rocksdb::DB::MultiGet(rocksdb::ReadOptions const&, std::__1::vector<rocksdb::Slice, std::__1::allocator<rocksdb::Slice> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) obj-x86_64-linux-gnu/../contrib/rocksdb/include/rocksdb/db.h:494:12\r\n    #5 0x2e15e1cd in DB::EmbeddedRocksDBSource::generate() obj-x86_64-linux-gnu/../src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp:208:46\r\n    #6 0x2ef62be1 in DB::ISource::tryGenerate() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:79:18\r\n    #7 0x2ef62525 in DB::ISource::work() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:53:26\r\n    #8 0x2f593b63 in DB::SourceWithProgress::work() obj-x86_64-linux-gnu/../src/Processors/Sources/SourceWithProgress.cpp:36:30\r\n    #9 0x2f068d68 in DB::executeJob(DB::IProcessor*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:79:20\r\n    #10 0x2f068d68 in DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:96:13\r\n    #11 0x2f068d68 in decltype(std::__1::forward<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(fp)()) std::__1::__invoke<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #12 0x2f068d68 in void std::__1::__invoke_void_return_wrapper<void>::__call<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #13 0x2f068d68 in std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #14 0x2f068d68 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #15 0x2f0618d8 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #16 0x2f0618d8 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #17 0x2f0618d8 in DB::PipelineExecutor::executeStepImpl(unsigned long, unsigned long, std::__1::atomic<bool>*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:580:17\r\n    #18 0x2f05b0fb in DB::PipelineExecutor::executeSingleThread(unsigned long, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:473:5\r\n    #19 0x2f05b0fb in DB::PipelineExecutor::executeImpl(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:807:9\r\n    #20 0x2f0594c9 in DB::PipelineExecutor::execute(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:395:9\r\n    #21 0x2f098847 in DB::threadFunction(DB::PullingAsyncPipelineExecutor::Data&, std::__1::shared_ptr<DB::ThreadGroupStatus>, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:79:24\r\n    #22 0x2f098847 in DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:101:13\r\n    #23 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(fp)()) std::__1::__invoke_constexpr<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3682:1\r\n    #24 0x2f098847 in decltype(auto) std::__1::__apply_tuple_impl<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1415:1\r\n    #25 0x2f098847 in decltype(auto) std::__1::apply<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1424:1\r\n    #26 0x2f098847 in ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()::operator()() obj-x86_64-linux-gnu/../src/Common/ThreadPool.h:178:13\r\n    #27 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(fp)()) std::__1::__invoke<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #28 0x2f098847 in void std::__1::__invoke_void_return_wrapper<void>::__call<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #29 0x2f098847 in std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #30 0x2f098847 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #31 0x8f2ce96 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #32 0x8f2ce96 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #33 0x8f2ce96 in ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:247:17\r\n    #34 0x8f3b517 in void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()::operator()() const obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:124:73\r\n    #35 0x8f3b517 in decltype(std::__1::forward<void>(fp)(std::__1::forward<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(fp0)...)) std::__1::__invoke<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(void&&, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #36 0x8f3b517 in void std::__1::__thread_execute<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(std::__1::tuple<void, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:280:5\r\n    #37 0x8f3b517 in void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()> >(void*) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:291:5\r\n    #38 0x7feda5bdc608 in start_thread /build/glibc-eX1tMB/glibc-2.31/nptl/pthread_create.c:477:8\r\n\r\n  Uninitialized value was stored to memory at\r\n    #0 0x8d64899 in __msan_memcpy (/workspace/clickhouse+0x8d64899)\r\n    #1 0x8e56f51 in DB::WriteBuffer::write(char const*, unsigned long) obj-x86_64-linux-gnu/../src/IO/WriteBuffer.h:80:13\r\n    #2 0x2aa7c2ed in void DB::writePODBinary<unsigned int>(unsigned int const&, DB::WriteBuffer&) obj-x86_64-linux-gnu/../src/IO/WriteHelpers.h:85:9\r\n    #3 0x2aa7c2ed in std::__1::enable_if<is_arithmetic_v<unsigned int>, void>::type DB::writeBinary<unsigned int>(unsigned int const&, DB::WriteBuffer&) obj-x86_64-linux-gnu/../src/IO/WriteHelpers.h:906:47\r\n    #4 0x2aa7c2ed in DB::DataTypeNumberBase<unsigned int>::serializeBinary(DB::Field const&, DB::WriteBuffer&) const obj-x86_64-linux-gnu/../src/DataTypes/DataTypeNumberBase.cpp:158:5\r\n    #5 0x2e15d8ee in DB::EmbeddedRocksDBSource::generate() obj-x86_64-linux-gnu/../src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp:203:30\r\n    #6 0x2ef62be1 in DB::ISource::tryGenerate() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:79:18\r\n    #7 0x2ef62525 in DB::ISource::work() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:53:26\r\n    #8 0x2f593b63 in DB::SourceWithProgress::work() obj-x86_64-linux-gnu/../src/Processors/Sources/SourceWithProgress.cpp:36:30\r\n    #9 0x2f068d68 in DB::executeJob(DB::IProcessor*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:79:20\r\n    #10 0x2f068d68 in DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:96:13\r\n    #11 0x2f068d68 in decltype(std::__1::forward<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(fp)()) std::__1::__invoke<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #12 0x2f068d68 in void std::__1::__invoke_void_return_wrapper<void>::__call<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #13 0x2f068d68 in std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #14 0x2f068d68 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #15 0x2f0618d8 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #16 0x2f0618d8 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #17 0x2f0618d8 in DB::PipelineExecutor::executeStepImpl(unsigned long, unsigned long, std::__1::atomic<bool>*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:580:17\r\n    #18 0x2f05b0fb in DB::PipelineExecutor::executeSingleThread(unsigned long, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:473:5\r\n    #19 0x2f05b0fb in DB::PipelineExecutor::executeImpl(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:807:9\r\n    #20 0x2f0594c9 in DB::PipelineExecutor::execute(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:395:9\r\n    #21 0x2f098847 in DB::threadFunction(DB::PullingAsyncPipelineExecutor::Data&, std::__1::shared_ptr<DB::ThreadGroupStatus>, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:79:24\r\n    #22 0x2f098847 in DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:101:13\r\n    #23 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(fp)()) std::__1::__invoke_constexpr<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3682:1\r\n    #24 0x2f098847 in decltype(auto) std::__1::__apply_tuple_impl<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1415:1\r\n    #25 0x2f098847 in decltype(auto) std::__1::apply<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1424:1\r\n    #26 0x2f098847 in ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()::operator()() obj-x86_64-linux-gnu/../src/Common/ThreadPool.h:178:13\r\n    #27 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(fp)()) std::__1::__invoke<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #28 0x2f098847 in void std::__1::__invoke_void_return_wrapper<void>::__call<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #29 0x2f098847 in std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #30 0x2f098847 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #31 0x8f2ce96 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #32 0x8f2ce96 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #33 0x8f2ce96 in ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:247:17\r\n    #34 0x8f3b517 in void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()::operator()() const obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:124:73\r\n    #35 0x8f3b517 in decltype(std::__1::forward<void>(fp)(std::__1::forward<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(fp0)...)) std::__1::__invoke<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(void&&, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #36 0x8f3b517 in void std::__1::__thread_execute<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(std::__1::tuple<void, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:280:5\r\n    #37 0x8f3b517 in void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()> >(void*) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:291:5\r\n    #38 0x7feda5bdc608 in start_thread /build/glibc-eX1tMB/glibc-2.31/nptl/pthread_create.c:477:8\r\n\r\n  Uninitialized value was stored to memory at\r\n    #0 0x2aa7c304 in DB::DataTypeNumberBase<unsigned int>::serializeBinary(DB::Field const&, DB::WriteBuffer&) const obj-x86_64-linux-gnu/../src/DataTypes/DataTypeNumberBase.cpp:157:41\r\n    #1 0x2e15d8ee in DB::EmbeddedRocksDBSource::generate() obj-x86_64-linux-gnu/../src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp:203:30\r\n    #2 0x2ef62be1 in DB::ISource::tryGenerate() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:79:18\r\n    #3 0x2ef62525 in DB::ISource::work() obj-x86_64-linux-gnu/../src/Processors/ISource.cpp:53:26\r\n    #4 0x2f593b63 in DB::SourceWithProgress::work() obj-x86_64-linux-gnu/../src/Processors/Sources/SourceWithProgress.cpp:36:30\r\n    #5 0x2f068d68 in DB::executeJob(DB::IProcessor*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:79:20\r\n    #6 0x2f068d68 in DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:96:13\r\n    #7 0x2f068d68 in decltype(std::__1::forward<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(fp)()) std::__1::__invoke<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #8 0x2f068d68 in void std::__1::__invoke_void_return_wrapper<void>::__call<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&>(DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #9 0x2f068d68 in std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #10 0x2f068d68 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<DB::PipelineExecutor::addJob(DB::ExecutingGraph::Node*)::$_0, void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #11 0x2f0618d8 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #12 0x2f0618d8 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #13 0x2f0618d8 in DB::PipelineExecutor::executeStepImpl(unsigned long, unsigned long, std::__1::atomic<bool>*) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:580:17\r\n    #14 0x2f05b0fb in DB::PipelineExecutor::executeSingleThread(unsigned long, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:473:5\r\n    #15 0x2f05b0fb in DB::PipelineExecutor::executeImpl(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:807:9\r\n    #16 0x2f0594c9 in DB::PipelineExecutor::execute(unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:395:9\r\n    #17 0x2f098847 in DB::threadFunction(DB::PullingAsyncPipelineExecutor::Data&, std::__1::shared_ptr<DB::ThreadGroupStatus>, unsigned long) obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:79:24\r\n    #18 0x2f098847 in DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0::operator()() const obj-x86_64-linux-gnu/../src/Processors/Executors/PullingAsyncPipelineExecutor.cpp:101:13\r\n    #19 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(fp)()) std::__1::__invoke_constexpr<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3682:1\r\n    #20 0x2f098847 in decltype(auto) std::__1::__apply_tuple_impl<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1415:1\r\n    #21 0x2f098847 in decltype(auto) std::__1::apply<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&, std::__1::tuple<>&) obj-x86_64-linux-gnu/../contrib/libcxx/include/tuple:1424:1\r\n    #22 0x2f098847 in ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()::operator()() obj-x86_64-linux-gnu/../src/Common/ThreadPool.h:178:13\r\n    #23 0x2f098847 in decltype(std::__1::forward<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(fp)()) std::__1::__invoke<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #24 0x2f098847 in void std::__1::__invoke_void_return_wrapper<void>::__call<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'()&>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/__functional_base:348:9\r\n    #25 0x2f098847 in std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()>::operator()() obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1608:12\r\n    #26 0x2f098847 in void std::__1::__function::__policy_invoker<void ()>::__call_impl<std::__1::__function::__default_alloc_func<ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0>(DB::PullingAsyncPipelineExecutor::pull(DB::Chunk&, unsigned long)::$_0&&)::'lambda'(), void ()> >(std::__1::__function::__policy_storage const*) obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2089:16\r\n    #27 0x8f2ce96 in std::__1::__function::__policy_func<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2221:16\r\n    #28 0x8f2ce96 in std::__1::function<void ()>::operator()() const obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:2560:12\r\n    #29 0x8f2ce96 in ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:247:17\r\n    #30 0x8f3b517 in void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()::operator()() const obj-x86_64-linux-gnu/../src/Common/ThreadPool.cpp:124:73\r\n    #31 0x8f3b517 in decltype(std::__1::forward<void>(fp)(std::__1::forward<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(fp0)...)) std::__1::__invoke<void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(void&&, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()&&...) obj-x86_64-linux-gnu/../contrib/libcxx/include/type_traits:3676:1\r\n    #32 0x8f3b517 in void std::__1::__thread_execute<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>(std::__1::tuple<void, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()>&, std::__1::__tuple_indices<>) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:280:5\r\n    #33 0x8f3b517 in void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()> >(void*) obj-x86_64-linux-gnu/../contrib/libcxx/include/thread:291:5\r\n    #34 0x7feda5bdc608 in start_thread /build/glibc-eX1tMB/glibc-2.31/nptl/pthread_create.c:477:8\r\n\r\n  Uninitialized value was created by a heap allocation\r\n    #0 0x8dd9179 in operator new(unsigned long) (/workspace/clickhouse+0x8dd9179)\r\n    #1 0xc43cd00 in void* std::__1::__libcpp_operator_new<unsigned long>(unsigned long) obj-x86_64-linux-gnu/../contrib/libcxx/include/new:235:10\r\n    #2 0xc43cd00 in std::__1::__libcpp_allocate(unsigned long, unsigned long) obj-x86_64-linux-gnu/../contrib/libcxx/include/new:261:10\r\n    #3 0xc43cd00 in std::__1::allocator<DB::Field>::allocate(unsigned long) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:840:38\r\n    #4 0xc43cd00 in std::__1::allocator_traits<std::__1::allocator<DB::Field> >::allocate(std::__1::allocator<DB::Field>&, unsigned long) obj-x86_64-linux-gnu/../contrib/libcxx/include/__memory/allocator_traits.h:468:21\r\n    #5 0xc43cd00 in std::__1::__split_buffer<DB::Field, std::__1::allocator<DB::Field>&>::__split_buffer(unsigned long, unsigned long, std::__1::allocator<DB::Field>&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__split_buffer:314:29\r\n    #6 0xc43cd00 in std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >::__append(unsigned long) obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:1093:53\r\n    #7 0x2e15c2ea in std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >::resize(unsigned long) obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:2024:15\r\n    #8 0x2e15c2ea in DB::EmbeddedRocksDBSource::EmbeddedRocksDBSource(DB::StorageEmbeddedRocksDB const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> > const&, unsigned long, unsigned long, unsigned long) obj-x86_64-linux-gnu/../src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp:176:18\r\n    #9 0x2e146ddb in void std::__1::allocator<DB::EmbeddedRocksDBSource>::construct<DB::EmbeddedRocksDBSource, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&>(DB::EmbeddedRocksDBSource*, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:886:28\r\n    #10 0x2e146ddb in void std::__1::allocator_traits<std::__1::allocator<DB::EmbeddedRocksDBSource> >::__construct<DB::EmbeddedRocksDBSource, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&>(std::__1::integral_constant<bool, true>, std::__1::allocator<DB::EmbeddedRocksDBSource>&, DB::EmbeddedRocksDBSource*, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__memory/allocator_traits.h:519:21\r\n    #11 0x2e146ddb in void std::__1::allocator_traits<std::__1::allocator<DB::EmbeddedRocksDBSource> >::construct<DB::EmbeddedRocksDBSource, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&>(std::__1::allocator<DB::EmbeddedRocksDBSource>&, DB::EmbeddedRocksDBSource*, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&) obj-x86_64-linux-gnu/../contrib/libcxx/include/__memory/allocator_traits.h:481:14\r\n    #12 0x2e146ddb in std::__1::__shared_ptr_emplace<DB::EmbeddedRocksDBSource, std::__1::allocator<DB::EmbeddedRocksDBSource> >::__shared_ptr_emplace<DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&>(std::__1::allocator<DB::EmbeddedRocksDBSource>, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2594:9\r\n    #13 0x2e146ddb in std::__1::shared_ptr<DB::EmbeddedRocksDBSource> std::__1::allocate_shared<DB::EmbeddedRocksDBSource, std::__1::allocator<DB::EmbeddedRocksDBSource>, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&, void>(std::__1::allocator<DB::EmbeddedRocksDBSource> const&, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:3360:55\r\n    #14 0x2e146ddb in std::__1::shared_ptr<DB::EmbeddedRocksDBSource> std::__1::make_shared<DB::EmbeddedRocksDBSource, DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&, void>(DB::StorageEmbeddedRocksDB&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::vector<DB::Field, std::__1::allocator<DB::Field> >&, unsigned long&, unsigned long&, unsigned long&) obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:3369:12\r\n    #15 0x2e146ddb in DB::StorageEmbeddedRocksDB::read(std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo&, DB::Context const&, DB::QueryProcessingStage::Enum, unsigned long, unsigned int) obj-x86_64-linux-gnu/../src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp:328:17\r\n    #16 0x2d7d874b in DB::IStorage::read(DB::QueryPlan&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo&, DB::Context const&, DB::QueryProcessingStage::Enum, unsigned long, unsigned int) obj-x86_64-linux-gnu/../src/Storages/IStorage.cpp:108:17\r\n    #17 0x2bef4490 in DB::InterpreterSelectQuery::executeFetchColumns(DB::QueryProcessingStage::Enum, DB::QueryPlan&, std::__1::shared_ptr<DB::PrewhereDAGInfo> const&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:1606:18\r\n    #18 0x2becf2a2 in DB::InterpreterSelectQuery::executeImpl(DB::QueryPlan&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:873:9\r\n    #19 0x2beccffa in DB::InterpreterSelectQuery::buildQueryPlan(DB::QueryPlan&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:524:5\r\n    #20 0x2c7fdd9c in DB::InterpreterSelectWithUnionQuery::buildQueryPlan(DB::QueryPlan&) obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:355:38\r\n    #21 0x2c800d3b in DB::InterpreterSelectWithUnionQuery::execute() obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:410:5\r\n    #22 0x2cebfe85 in DB::executeQueryImpl(char const*, char const*, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool, DB::ReadBuffer*) obj-x86_64-linux-gnu/../src/Interpreters/executeQuery.cpp:541:32\r\n    #23 0x2ceb9fd0 in DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool) obj-x86_64-linux-gnu/../src/Interpreters/executeQuery.cpp:899:30\r\n    #24 0x2ede5956 in DB::TCPHandler::runImpl() obj-x86_64-linux-gnu/../src/Server/TCPHandler.cpp:260:24\r\n    #25 0x2ee18b98 in DB::TCPHandler::run() obj-x86_64-linux-gnu/../src/Server/TCPHandler.cpp:1417:9\r\n    #26 0x3941c88a in Poco::Net::TCPServerConnection::start() obj-x86_64-linux-gnu/../contrib/poco/Net/src/TCPServerConnection.cpp:43:3\r\n    #27 0x3941de74 in Poco::Net::TCPServerDispatcher::run() obj-x86_64-linux-gnu/../contrib/poco/Net/src/TCPServerDispatcher.cpp:112:19\r\n    #28 0x398cbf15 in Poco::PooledThread::run() obj-x86_64-linux-gnu/../contrib/poco/Foundation/src/ThreadPool.cpp:199:14\r\n    #29 0x398c6f28 in Poco::(anonymous namespace)::RunnableHolder::run() obj-x86_64-linux-gnu/../contrib/poco/Foundation/src/Thread.cpp:55:11\r\n    #30 0x398c2f2b in Poco::ThreadImpl::runnableEntry(void*) obj-x86_64-linux-gnu/../contrib/poco/Foundation/src/Thread_POSIX.cpp:345:27\r\n    #31 0x7feda5bdc608 in start_thread /build/glibc-eX1tMB/glibc-2.31/nptl/pthread_create.c:477:8\r\n```\r\n\r\nhttps://clickhouse-test-reports.s3.yandex.net/19960/078011ef2d15258b1f23b8b1b794e888b3078975/fuzzer_msan/server.log\r\n\r\nNote: This is not a bug in RocksDB. You just passed wrong keys to it.\r\n\r\nCC @sundy-li \n",
  "hints_text": "@sundy-li You did not check types of keys (Field).\r\n\r\n`key_column.type->serializeBinary(keys[i], wbs[i]);`\r\n\r\nThis is only legal if type of the field corresponds to the type of the column.\nok, I'll fix that soon.",
  "created_at": "2021-02-02T08:08:04Z",
  "modified_files": [
    "src/Storages/RocksDB/StorageEmbeddedRocksDB.cpp"
  ],
  "modified_test_files": [
    "docker/test/fasttest/run.sh",
    "b/tests/queries/0_stateless/01686_rocksdb.reference",
    "b/tests/queries/0_stateless/01686_rocksdb.sql",
    "tests/queries/0_stateless/arcadia_skip_list.txt"
  ]
}