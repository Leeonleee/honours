{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 14232,
  "instance_id": "ClickHouse__ClickHouse-14232",
  "issue_numbers": [
    "14231"
  ],
  "base_commit": "b601dd45960371309a67ba0c9f0741d915715138",
  "patch": "diff --git a/src/Databases/MySQL/MaterializeMySQLSyncThread.cpp b/src/Databases/MySQL/MaterializeMySQLSyncThread.cpp\nindex f8d5e3d61aa9..851ea3518766 100644\n--- a/src/Databases/MySQL/MaterializeMySQLSyncThread.cpp\n+++ b/src/Databases/MySQL/MaterializeMySQLSyncThread.cpp\n@@ -246,7 +246,7 @@ static inline BlockOutputStreamPtr getTableOutput(const String & database_name,\n         if (iterator != insert_columns_names.begin())\n             insert_columns_str << \", \";\n \n-        insert_columns_str << iterator->name;\n+        insert_columns_str << backQuoteIfNeed(iterator->name);\n     }\n \n \ndiff --git a/src/Parsers/Lexer.cpp b/src/Parsers/Lexer.cpp\nindex f8043c6865a8..baf547a0a1ab 100644\n--- a/src/Parsers/Lexer.cpp\n+++ b/src/Parsers/Lexer.cpp\n@@ -146,13 +146,20 @@ Token Lexer::nextTokenImpl()\n                 }\n             }\n \n-            /// word character cannot go just after number (SELECT 123FROM)\n+            /// Try to parse it to a identifier(1identifier_name), otherwise it return ErrorWrongNumber\n             if (pos < end && isWordCharASCII(*pos))\n             {\n                 ++pos;\n                 while (pos < end && isWordCharASCII(*pos))\n                     ++pos;\n-                return Token(TokenType::ErrorWrongNumber, token_begin, pos);\n+\n+                for (const char * iterator = token_begin; iterator < pos; ++iterator)\n+                {\n+                    if (!isWordCharASCII(*iterator) && *iterator != '$')\n+                        return Token(TokenType::ErrorWrongNumber, token_begin, pos);\n+                }\n+\n+                return Token(TokenType::BareWord, token_begin, pos);\n             }\n \n             return Token(TokenType::Number, token_begin, pos);\n@@ -313,10 +320,10 @@ Token Lexer::nextTokenImpl()\n         }\n \n         default:\n-            if (isWordCharASCII(*pos))\n+            if (isWordCharASCII(*pos) || *pos == '$')\n             {\n                 ++pos;\n-                while (pos < end && isWordCharASCII(*pos))\n+                while (pos < end && (isWordCharASCII(*pos) || *pos == '$'))\n                     ++pos;\n                 return Token(TokenType::BareWord, token_begin, pos);\n             }\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.reference b/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.reference\nnew file mode 100644\nindex 000000000000..f5b4a27081dd\n--- /dev/null\n+++ b/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.reference\n@@ -0,0 +1,4 @@\n+$alias$name$\n+1\n+1alias1name1\n+1\ndiff --git a/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.sql b/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.sql\nnew file mode 100644\nindex 000000000000..5a3aa9968990\n--- /dev/null\n+++ b/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.sql\n@@ -0,0 +1,2 @@\n+SELECT 1 AS $alias$name$ FORMAT TSVWithNames;\n+SELECT 1 AS 1alias1name1 FORMAT TSVWithNames;\n",
  "problem_statement": "MaterializeMySQL not support number started column name\n**Describe the bug**\r\n\r\nTable schema:\r\n> mysql> show create table name\\G\r\n> \r\n> *************************** 1. row ***************************\r\n>        Table: name\r\n> Create Table: CREATE TABLE `name` (\r\n>   `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\r\n>   `username` varchar(40) DEFAULT NULL,\r\n>   `1m_10m` smallint(6) DEFAULT NULL,\r\n>   PRIMARY KEY (`id`)\r\n> ) ENGINE=InnoDB AUTO_INCREMENT=178 DEFAULT CHARSET=latin1\r\n\r\nWhen doing DB creation:\r\n\r\n>  CREATE DATABASE clickhouse_test ENGINE = MaterializeMySQL('192.168.153.132:3306', 'clickhouse_test', 'root', 'password');\r\n\r\nGot error message:\r\n\r\n> Code: 62. DB::Exception: Received from 192.168.153.132:9000. DB::Exception: Syntax error: failed at position 80 ('1m_10m'): 1m_10m) VALUES. Wrong number.\r\n\n",
  "hints_text": "@zhang2014 @BohuTANG \nmany databaes do not support numberleading column names",
  "created_at": "2020-08-29T04:29:45Z",
  "modified_files": [
    "src/Databases/MySQL/MaterializeMySQLSyncThread.cpp",
    "src/Parsers/Lexer.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.reference",
    "b/tests/queries/0_stateless/01460_allow_dollar_and_number_in_identifier.sql"
  ]
}