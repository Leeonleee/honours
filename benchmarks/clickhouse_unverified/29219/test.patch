diff --git a/docker/test/integration/base/Dockerfile b/docker/test/integration/base/Dockerfile
index 519c64297e55..add4dad0132d 100644
--- a/docker/test/integration/base/Dockerfile
+++ b/docker/test/integration/base/Dockerfile
@@ -19,6 +19,7 @@ RUN apt-get update \
         sqlite3 \
         curl \
         tar \
+        lz4 \
         krb5-user \
         iproute2 \
         lsof \
diff --git a/tests/integration/test_backward_compatibility/test_aggregate_fixed_key.py b/tests/integration/test_backward_compatibility/test_aggregate_fixed_key.py
index 98658ec81d07..fc8d27cfa162 100644
--- a/tests/integration/test_backward_compatibility/test_aggregate_fixed_key.py
+++ b/tests/integration/test_backward_compatibility/test_aggregate_fixed_key.py
@@ -4,8 +4,8 @@
 
 cluster = ClickHouseCluster(__file__, name="aggregate_fixed_key")
 node1 = cluster.add_instance('node1', with_zookeeper=True, image='yandex/clickhouse-server', tag='21.3', with_installed_binary=True)
-node2 = cluster.add_instance('node2', with_zookeeper=True, image='yandex/clickhouse-server')
-node3 = cluster.add_instance('node3', with_zookeeper=True, image='yandex/clickhouse-server')
+node2 = cluster.add_instance('node2', with_zookeeper=True)
+node3 = cluster.add_instance('node3', with_zookeeper=True)
 
 
 @pytest.fixture(scope="module")
diff --git a/tests/integration/test_log_lz4_streaming/__init__.py b/tests/integration/test_log_lz4_streaming/__init__.py
new file mode 100644
index 000000000000..e69de29bb2d1
diff --git a/tests/integration/test_log_lz4_streaming/configs/logs.xml b/tests/integration/test_log_lz4_streaming/configs/logs.xml
new file mode 100644
index 000000000000..43a43cd231b9
--- /dev/null
+++ b/tests/integration/test_log_lz4_streaming/configs/logs.xml
@@ -0,0 +1,5 @@
+<yandex>
+    <logger>
+        <stream_compress>true</stream_compress>
+    </logger>
+</yandex>
diff --git a/tests/integration/test_log_lz4_streaming/test.py b/tests/integration/test_log_lz4_streaming/test.py
new file mode 100644
index 000000000000..7f2f22f28c94
--- /dev/null
+++ b/tests/integration/test_log_lz4_streaming/test.py
@@ -0,0 +1,44 @@
+import pytest
+import time
+
+from helpers.cluster import ClickHouseCluster
+
+cluster = ClickHouseCluster(__file__)
+
+node = cluster.add_instance('node', main_configs=['configs/logs.xml'], stay_alive=True)
+
+@pytest.fixture(scope="module")
+def started_cluster():
+    try:
+        cluster.start()
+        yield cluster
+
+    finally:
+        cluster.shutdown()
+
+
+def check_log_file():
+    assert node.file_exists("/var/log/clickhouse-server/clickhouse-server.log.lz4")
+
+    lz4_output = node.exec_in_container(["bash", "-c", "lz4 -t /var/log/clickhouse-server/clickhouse-server.log.lz4 2>&1"], user='root')
+    assert lz4_output.count('Error') == 0, lz4_output
+
+    compressed_size = int(node.exec_in_container(["bash", "-c", "du -b /var/log/clickhouse-server/clickhouse-server.log.lz4 | awk {' print $1 '}"], user='root'))
+    uncompressed_size = int(lz4_output.split()[3])
+    assert 0 < compressed_size < uncompressed_size, lz4_output
+
+
+def test_concatenation(started_cluster):
+    node.stop_clickhouse()
+    node.start_clickhouse()
+    node.stop_clickhouse()
+
+    check_log_file()
+
+
+def test_incomplete_rotation(started_cluster):
+    node.stop_clickhouse(kill=True)
+    node.start_clickhouse()
+    node.stop_clickhouse()
+
+    check_log_file()
