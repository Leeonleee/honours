diff --git a/docker/test/stateless/stress_tests.lib b/docker/test/stateless/stress_tests.lib
index ea79089175e8..2309e3073241 100644
--- a/docker/test/stateless/stress_tests.lib
+++ b/docker/test/stateless/stress_tests.lib
@@ -53,31 +53,28 @@ function configure()
       > /etc/clickhouse-server/config.d/keeper_port.xml.tmp
     sudo mv /etc/clickhouse-server/config.d/keeper_port.xml.tmp /etc/clickhouse-server/config.d/keeper_port.xml
 
-    function randomize_config_boolean_value {
+    function randomize_keeper_config_boolean_value {
         value=$(($RANDOM % 2))
-        sudo cat /etc/clickhouse-server/config.d/keeper_port.xml \
+        sudo cat /etc/clickhouse-server/config.d/$2.xml \
         | sed "s|<$1>[01]</$1>|<$1>$value</$1>|" \
-        > /etc/clickhouse-server/config.d/keeper_port.xml.tmp
-        sudo mv /etc/clickhouse-server/config.d/keeper_port.xml.tmp /etc/clickhouse-server/config.d/keeper_port.xml
+        > /etc/clickhouse-server/config.d/$2.xml.tmp
+        sudo mv /etc/clickhouse-server/config.d/$2.xml.tmp /etc/clickhouse-server/config.d/$2.xml
     }
 
     if [[ -n "$RANDOMIZE_KEEPER_FEATURE_FLAGS" ]] && [[ "$RANDOMIZE_KEEPER_FEATURE_FLAGS" -eq 1 ]]; then
         # Randomize all Keeper feature flags
-        randomize_config_boolean_value filtered_list
-        randomize_config_boolean_value multi_read
-        randomize_config_boolean_value check_not_exists
-        randomize_config_boolean_value create_if_not_exists
+        randomize_config_boolean_value filtered_list keeper_port
+        randomize_config_boolean_value multi_read keeper_port
+        randomize_config_boolean_value check_not_exists keeper_port
+        randomize_config_boolean_value create_if_not_exists keeper_port
     fi
 
     sudo chown clickhouse /etc/clickhouse-server/config.d/keeper_port.xml
     sudo chgrp clickhouse /etc/clickhouse-server/config.d/keeper_port.xml
 
-    #Randomize merge tree setting allow_experimental_block_number_column
-    value=$(($RANDOM % 2))
-    sudo cat /etc/clickhouse-server/config.d/merge_tree_settings.xml \
-    | sed "s|<allow_experimental_block_number_column>[01]</allow_experimental_block_number_column>|<allow_experimental_block_number_column>$value</allow_experimental_block_number_column>|" \
-    > /etc/clickhouse-server/config.d/merge_tree_settings.xml.tmp
-    sudo mv /etc/clickhouse-server/config.d/merge_tree_settings.xml.tmp /etc/clickhouse-server/config.d/merge_tree_settings.xml
+    randomize_config_boolean_value use_compression zookeeper
+
+    randomize_config_boolean_value allow_experimental_block_number_column merge_tree_settings
 
     # for clickhouse-server (via service)
     echo "ASAN_OPTIONS='malloc_context_size=10 verbosity=1 allocator_release_to_os_interval_ms=10000'" >> /etc/environment
diff --git a/tests/config/config.d/zookeeper.xml b/tests/config/config.d/zookeeper.xml
index 07142b1a55e8..a54149e66174 100644
--- a/tests/config/config.d/zookeeper.xml
+++ b/tests/config/config.d/zookeeper.xml
@@ -2,6 +2,7 @@
     <zookeeper>
         <!--<zookeeper_load_balancing>random / in_order / nearest_hostname / hostname_levenshtein_distance / first_or_random / round_robin</zookeeper_load_balancing>-->
         <zookeeper_load_balancing>random</zookeeper_load_balancing>
+        <use_compression>true</use_compression>
         <node index="1">
             <host>127.0.0.1</host>
             <port>9181</port>
diff --git a/tests/integration/test_keeper_compression/__init__.py b/tests/integration/test_keeper_compression/__init__.py
new file mode 100644
index 000000000000..e69de29bb2d1
diff --git a/tests/integration/test_keeper_compression/configs/keeper.xml b/tests/integration/test_keeper_compression/configs/keeper.xml
new file mode 100644
index 000000000000..322938c3dc8b
--- /dev/null
+++ b/tests/integration/test_keeper_compression/configs/keeper.xml
@@ -0,0 +1,29 @@
+<?xml version="1.0" encoding="utf-8"?>
+<clickhouse>
+    <keeper_server>
+        <tcp_port>9181</tcp_port>
+        <server_id>1</server_id>
+        <log_storage_path>/var/lib/clickhouse/coordination/log</log_storage_path>
+        <snapshot_storage_path>/var/lib/clickhouse/coordination/snapshots</snapshot_storage_path>
+        <coordination_settings>
+            <operation_timeout_ms>5000</operation_timeout_ms>
+            <raft_logs_level>trace</raft_logs_level>
+            <session_timeout_ms>10000</session_timeout_ms>
+        </coordination_settings>
+        <raft_configuration>
+            <server>
+                <can_become_leader>true</can_become_leader>
+                <hostname>node1</hostname>
+                <id>1</id>
+                <port>2888</port>
+                <priority>1</priority>
+            </server>
+        </raft_configuration>
+    </keeper_server>
+
+    <user_directories>
+        <replicated>
+            <zookeeper_path>/clickhouse/access</zookeeper_path>
+        </replicated>
+    </user_directories>
+</clickhouse>
diff --git a/tests/integration/test_keeper_compression/configs/keeper_with_compression.xml b/tests/integration/test_keeper_compression/configs/keeper_with_compression.xml
new file mode 100644
index 000000000000..566eb93af366
--- /dev/null
+++ b/tests/integration/test_keeper_compression/configs/keeper_with_compression.xml
@@ -0,0 +1,9 @@
+<clickhouse>
+    <zookeeper>
+        <use_compression>true</use_compression>
+        <node index="1">
+            <host>node1</host>
+            <port>9181</port>
+        </node>
+    </zookeeper>
+</clickhouse>
diff --git a/tests/integration/test_keeper_compression/configs/keeper_without_compression.xml b/tests/integration/test_keeper_compression/configs/keeper_without_compression.xml
new file mode 100644
index 000000000000..e328dd43b83e
--- /dev/null
+++ b/tests/integration/test_keeper_compression/configs/keeper_without_compression.xml
@@ -0,0 +1,9 @@
+<clickhouse>
+    <zookeeper>
+        <use_compression>false</use_compression>
+        <node index="1">
+            <host>node1</host>
+            <port>9181</port>
+        </node>
+    </zookeeper>
+</clickhouse>
diff --git a/tests/integration/test_keeper_compression/test_with_compression.py b/tests/integration/test_keeper_compression/test_with_compression.py
new file mode 100644
index 000000000000..1c0697ebcbba
--- /dev/null
+++ b/tests/integration/test_keeper_compression/test_with_compression.py
@@ -0,0 +1,28 @@
+#!/usr/bin/env python3
+
+import pytest
+
+from helpers.cluster import ClickHouseCluster
+
+cluster = ClickHouseCluster(__file__)
+
+node1 = cluster.add_instance(
+    "node1",
+    main_configs=["configs/keeper.xml", "configs/keeper_with_compression.xml"],
+    stay_alive=True,
+)
+
+
+# test that server is able to start
+@pytest.fixture(scope="module")
+def started_cluster():
+    try:
+        cluster.start()
+
+        yield cluster
+    finally:
+        cluster.shutdown()
+
+
+def test_select(started_cluster):
+    assert node1.query("SELECT 1") == "1
"
diff --git a/tests/integration/test_keeper_compression/test_without_compression.py b/tests/integration/test_keeper_compression/test_without_compression.py
new file mode 100644
index 000000000000..eb7936cfd42f
--- /dev/null
+++ b/tests/integration/test_keeper_compression/test_without_compression.py
@@ -0,0 +1,28 @@
+#!/usr/bin/env python3
+
+import pytest
+
+from helpers.cluster import ClickHouseCluster
+
+cluster = ClickHouseCluster(__file__)
+
+node1 = cluster.add_instance(
+    "node1",
+    main_configs=["configs/keeper.xml", "configs/keeper_without_compression.xml"],
+    stay_alive=True,
+)
+
+
+# test that server is able to start
+@pytest.fixture(scope="module")
+def started_cluster():
+    try:
+        cluster.start()
+
+        yield cluster
+    finally:
+        cluster.shutdown()
+
+
+def test_select(started_cluster):
+    assert node1.query("SELECT 1") == "1
"
