{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 42634,
  "instance_id": "ClickHouse__ClickHouse-42634",
  "issue_numbers": [
    "42548"
  ],
  "base_commit": "3fad4131bf2ceaefc6a1accb61a9033f25422c23",
  "patch": "diff --git a/src/Client/ClientBase.cpp b/src/Client/ClientBase.cpp\nindex 5d7de8ec799a..9a5002b17af9 100644\n--- a/src/Client/ClientBase.cpp\n+++ b/src/Client/ClientBase.cpp\n@@ -1173,7 +1173,7 @@ void ClientBase::sendData(Block & sample, const ColumnsDescription & columns_des\n \n     bool have_data_in_stdin = !is_interactive && !stdin_is_a_tty && !std_in.eof();\n \n-    if (need_render_progress && have_data_in_stdin)\n+    if (need_render_progress)\n     {\n         /// Set total_bytes_to_read for current fd.\n         FileProgress file_progress(0, std_in.getFileSize());\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02473_infile_progress.py b/tests/queries/0_stateless/02473_infile_progress.py\nnew file mode 100755\nindex 000000000000..c1b31eeecbbb\n--- /dev/null\n+++ b/tests/queries/0_stateless/02473_infile_progress.py\n@@ -0,0 +1,42 @@\n+#!/usr/bin/env python3\n+# Tags: no-replicated-database, no-parallel, no-fasttest\n+\n+import os\n+import sys\n+import signal\n+\n+CURDIR = os.path.dirname(os.path.realpath(__file__))\n+sys.path.insert(0, os.path.join(CURDIR, \"helpers\"))\n+\n+from client import client, prompt, end_of_block\n+\n+log = None\n+# uncomment the line below for debugging\n+# log=sys.stdout\n+\n+with client(name=\"client>\", log=log) as client1:\n+    filename = os.environ[\"CLICKHOUSE_TMP\"] + \"/infile_progress.tsv\"\n+\n+    client1.expect(prompt)\n+    client1.send(\"DROP TABLE IF EXISTS test.infile_progress\")\n+    client1.expect(prompt)\n+    client1.send(f\"SELECT number FROM numbers(5) INTO OUTFILE '{filename}'\")\n+    client1.expect(prompt)\n+    client1.send(\n+        \"CREATE TABLE test.infile_progress (a Int32) Engine=MergeTree order by tuple()\"\n+    )\n+    client1.expect(prompt)\n+    client1.send(f\"INSERT INTO test.infile_progress FROM INFILE '{filename}'\")\n+    client1.expect(\"Progress: 0.00 rows, 10.00 B.*\\)\")\n+    client1.expect(prompt)\n+\n+    # send Ctrl-C\n+    client1.send(\"\\x03\", eol=\"\")\n+    match = client1.expect(\"(%s)|([#\\$] )\" % prompt)\n+    if match.groups()[1]:\n+        client1.send(client1.command)\n+        client1.expect(prompt)\n+    client1.send(\"DROP TABLE test.infile_progress\")\n+    client1.expect(prompt)\n+\n+    os.remove(filename)\ndiff --git a/tests/queries/0_stateless/02473_infile_progress.reference b/tests/queries/0_stateless/02473_infile_progress.reference\nnew file mode 100644\nindex 000000000000..e69de29bb2d1\n",
  "problem_statement": "No progress indication on INSERT FROM INFILE.\n```\r\nmilovidov-desktop :) CREATE TABLE hits2 AS hits\r\n\r\nCREATE TABLE hits2 AS hits\r\n\r\nQuery id: ef73b907-c73b-42ba-8194-db88c88cc85b\r\n\r\nOk.\r\n\r\n0 rows in set. Elapsed: 0.024 sec. \r\n\r\nmilovidov-desktop :) INSERT INTO hits2 FROM INFILE 'hits.tsv'\r\n\r\nINSERT INTO hits2 FROM INFILE 'hits.tsv'\r\n\r\nQuery id: 0588941e-ff9e-4741-97ce-7784aee1e253\r\n\r\n\u2193 Progress: 0.00 rows, 0.00 B (0.00 rows/s., 0.00 B/s.)\r\n```\r\n\r\nTwo problems:\r\n- no progress;\r\n- it is displaying a fractional number of rows (`0.00`).\n",
  "hints_text": "",
  "created_at": "2022-10-25T01:45:16Z",
  "modified_files": [
    "src/Client/ClientBase.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/02473_infile_progress.py"
  ]
}