You will be provided with a partial code base and an issue statement explaining a problem to resolve.

<issue>
CH hangs with insertion (index_granularity  = 0)
```sql
CREATE TABLE t
(
   id Int64, 
   d String,
   p Map(String, String)
   
)
ENGINE = ReplacingMergeTree order by id settings index_granularity  = 0;


insert into t values (1,  's', {'a':'b'});

CH starts eating RAM until it crashes

the same with

insert into t select 1,  's', map('a','b');

```
</issue>

I need you to solve the provided issue by generating a code fix that can be applied directly to the repository

Respond below:
