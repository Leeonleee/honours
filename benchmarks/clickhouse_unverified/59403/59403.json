{
  "repo": "ClickHouse/ClickHouse",
  "pull_number": 59403,
  "instance_id": "ClickHouse__ClickHouse-59403",
  "issue_numbers": [
    "54380"
  ],
  "base_commit": "797ff834e07e5479ac9bfcf450b638f8d504516a",
  "patch": "diff --git a/src/Processors/Formats/Impl/ConstantExpressionTemplate.cpp b/src/Processors/Formats/Impl/ConstantExpressionTemplate.cpp\nindex 2602f8b881de..bf584b759f8b 100644\n--- a/src/Processors/Formats/Impl/ConstantExpressionTemplate.cpp\n+++ b/src/Processors/Formats/Impl/ConstantExpressionTemplate.cpp\n@@ -603,6 +603,8 @@ bool ConstantExpressionTemplate::parseLiteralAndAssertType(\n             memcpy(buf, istr.position(), bytes_to_copy);\n             buf[bytes_to_copy] = 0;\n \n+            const bool hex_like = bytes_to_copy >= 2 && buf[0] == '0' && (buf[1] == 'x' || buf[1] == 'X');\n+\n             char * pos_double = buf;\n             errno = 0;\n             Float64 float_value = std::strtod(buf, &pos_double);\n@@ -614,13 +616,13 @@ bool ConstantExpressionTemplate::parseLiteralAndAssertType(\n \n             char * pos_integer = buf;\n             errno = 0;\n-            UInt64 uint_value = std::strtoull(buf, &pos_integer, 0);\n+            UInt64 uint_value = std::strtoull(buf, &pos_integer, hex_like ? 16 : 10);\n             if (pos_integer == pos_double && errno != ERANGE && (!negative || uint_value <= (1ULL << 63)))\n             {\n                 istr.position() += pos_integer - buf;\n                 if (negative && type_info.main_type == Type::Int64)\n                     number = static_cast<Int64>(-uint_value);\n-                else if (!negative && type_info.main_type == Type::UInt64)\n+                else if (type_info.main_type == Type::UInt64 && (!negative || uint_value == 0))\n                     number = uint_value;\n                 else\n                     return false;\n",
  "test_patch": "diff --git a/tests/queries/0_stateless/02896_leading_zeroes_no_octal.reference b/tests/queries/0_stateless/02896_leading_zeroes_no_octal.reference\nnew file mode 100644\nindex 000000000000..7c69b7e02aa0\n--- /dev/null\n+++ b/tests/queries/0_stateless/02896_leading_zeroes_no_octal.reference\n@@ -0,0 +1,154 @@\n+Leading zeroes into Int64 (1XXX without input_format_values_interpret_expressions and 1XXXX with)\n+1\t1000\t0\t0\t0\tSingle zero\n+1\t1001\t00\t0\t0\tDouble zero\n+1\t1002\t000000000000000\t0\t0\tMutliple redundant zeroes\n+1\t1003\t01\t1\t1\tOctal like, interpret as decimal\n+1\t1004\t08\t8\t8\tOctal like, interpret as decimal\n+1\t1005\t0100\t100\t100\tOctal like, interpret as decimal\n+1\t1006\t0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes\n+1\t1010\t-0\t0\t0\tSingle zero negative\n+1\t1011\t-00\t0\t0\tDouble zero negative\n+1\t1012\t-000000000000000\t0\t0\tMutliple redundant zeroes negative\n+1\t1013\t-01\t-1\t-1\tOctal like, interpret as decimal negative\n+1\t1014\t-08\t-8\t-8\tOctal like, interpret as decimal negative\n+1\t1015\t-0100\t-100\t-100\tOctal like, interpret as decimal negative\n+1\t1016\t-0000000000100\t-100\t-100\tOctal like, interpret as decimal, multiple leading zeroes negative\n+1\t1020\t+0\t0\t0\tSingle zero positive\n+1\t1021\t+00\t0\t0\tDouble zero negpositiveative\n+1\t1022\t+000000000000000\t0\t0\tMutliple redundant zeroes positive\n+1\t1023\t+01\t1\t1\tOctal like, interpret as decimal positive\n+1\t1024\t+08\t8\t8\tOctal like, interpret as decimal positive\n+1\t1025\t+0100\t100\t100\tOctal like, interpret as decimal positive\n+1\t1026\t+0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes positive\n+1\t1030\t0000.008\t0\t0\tFloating point should work...\n+1\t1031\t-0000.008\t0\t0\tFloating point should work...\n+1\t1032\t+0000.008\t0\t0\tFloating point should work...\n+1\t1033\t0000.008e3\t8\t8\tFloating point should work...\n+1\t1034\t-0000.008e3\t-8\t-8\tFloating point should work...\n+1\t1035\t+0000.008e3\t8\t8\tFloating point should work...\n+1\t1036\t08000.008e-3\t8\t8\tFloating point should work...\n+1\t1037\t-08000.008e-3\t-8\t-8\tFloating point should work...\n+1\t1038\t+08000.008e-3\t8\t8\tFloating point should work...\n+1\t1060\t0x0abcd\t43981\t43981\tHex should be parsed\n+1\t1061\t-0x0abcd\t-43981\t-43981\tHex should be parsed\n+1\t1062\t+0x0abcd\t43981\t43981\tHex should be parsed\n+1\t1063\t0x0abcdP1\t87962\t87962\tHex should be parsed\n+1\t1064\t0x0abcdP+1\t87962\t87962\tHex should be parsed\n+1\t1065\t0x0abcdP-1\t21990\t21990\tHex should be parsed\n+1\t1066\t0x0abcdP01\t87962\t87962\tHex should be parsed\n+1\t1067\t0x0abcdP+01\t87962\t87962\tHex should be parsed\n+1\t1068\t0x0abcdP-01\t21990\t21990\tHex should be parsed\n+1\t11000\t0\t0\t0\tSingle zero\n+1\t11001\t00\t0\t0\tDouble zero\n+1\t11002\t000000000000000\t0\t0\tMutliple redundant zeroes\n+1\t11003\t01\t1\t1\tOctal like, interpret as decimal\n+1\t11004\t08\t8\t8\tOctal like, interpret as decimal\n+1\t11005\t0100\t100\t100\tOctal like, interpret as decimal\n+1\t11006\t0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes\n+1\t11010\t-0\t0\t0\tSingle zero negative\n+1\t11011\t-00\t0\t0\tDouble zero negative\n+1\t11012\t-000000000000000\t0\t0\tMutliple redundant zeroes negative\n+1\t11013\t-01\t-1\t-1\tOctal like, interpret as decimal negative\n+1\t11014\t-08\t-8\t-8\tOctal like, interpret as decimal negative\n+1\t11015\t-0100\t-100\t-100\tOctal like, interpret as decimal negative\n+1\t11016\t-0000000000100\t-100\t-100\tOctal like, interpret as decimal, multiple leading zeroes negative\n+1\t11020\t+0\t0\t0\tSingle zero positive\n+1\t11021\t+00\t0\t0\tDouble zero negpositiveative\n+1\t11022\t+000000000000000\t0\t0\tMutliple redundant zeroes positive\n+1\t11023\t+01\t1\t1\tOctal like, interpret as decimal positive\n+1\t11024\t+08\t8\t8\tOctal like, interpret as decimal positive\n+1\t11025\t+0100\t100\t100\tOctal like, interpret as decimal positive\n+1\t11026\t+0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes positive\n+1\t11030\t0000.008\t0\t0\tFloating point should work...\n+1\t11031\t-0000.008\t0\t0\tFloating point should work...\n+1\t11032\t+0000.008\t0\t0\tFloating point should work...\n+1\t11033\t0000.008e3\t8\t8\tFloating point should work...\n+1\t11034\t-0000.008e3\t-8\t-8\tFloating point should work...\n+1\t11035\t+0000.008e3\t8\t8\tFloating point should work...\n+1\t11036\t08000.008e-3\t8\t8\tFloating point should work...\n+1\t11037\t-08000.008e-3\t-8\t-8\tFloating point should work...\n+1\t11038\t+08000.008e-3\t8\t8\tFloating point should work...\n+1\t11050\t0b10000\t16\t16\tBinary should be parsed\n+1\t11051\t-0b10000\t-16\t-16\tBinary should be parsed\n+1\t11052\t+0b10000\t16\t16\tBinary should be parsed\n+1\t11060\t0x0abcd\t43981\t43981\tHex should be parsed\n+1\t11061\t-0x0abcd\t-43981\t-43981\tHex should be parsed\n+1\t11062\t+0x0abcd\t43981\t43981\tHex should be parsed\n+1\t11063\t0x0abcdP1\t87962\t87962\tHex should be parsed\n+1\t11064\t0x0abcdP+1\t87962\t87962\tHex should be parsed\n+1\t11065\t0x0abcdP-1\t21990\t21990\tHex should be parsed\n+1\t11066\t0x0abcdP01\t87962\t87962\tHex should be parsed\n+1\t11067\t0x0abcdP+01\t87962\t87962\tHex should be parsed\n+1\t11068\t0x0abcdP-01\t21990\t21990\tHex should be parsed\n+Leading zeroes into Float64 (2XXX without input_format_values_interpret_expressions and 2XXXX with)\n+1\t2000\t0\t0\t0\tSingle zero\n+1\t2001\t00\t0\t0\tDouble zero\n+1\t2002\t000000000000000\t0\t0\tMutliple redundant zeroes\n+1\t2003\t01\t1\t1\tOctal like, interpret as decimal\n+1\t2004\t08\t8\t8\tOctal like, interpret as decimal\n+1\t2005\t0100\t100\t100\tOctal like, interpret as decimal\n+1\t2006\t0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes\n+1\t2013\t-01\t-1\t-1\tOctal like, interpret as decimal negative\n+1\t2014\t-08\t-8\t-8\tOctal like, interpret as decimal negative\n+1\t2015\t-0100\t-100\t-100\tOctal like, interpret as decimal negative\n+1\t2016\t-0000000000100\t-100\t-100\tOctal like, interpret as decimal, multiple leading zeroes negative\n+1\t2020\t+0\t0\t0\tSingle zero positive\n+1\t2021\t+00\t0\t0\tDouble zero negpositiveative\n+1\t2022\t+000000000000000\t0\t0\tMutliple redundant zeroes positive\n+1\t2023\t+01\t1\t1\tOctal like, interpret as decimal positive\n+1\t2024\t+08\t8\t8\tOctal like, interpret as decimal positive\n+1\t2025\t+0100\t100\t100\tOctal like, interpret as decimal positive\n+1\t2026\t+0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes positive\n+1\t2030\t0000.008\t0.008\t0.008\tFloating point should work...\n+1\t2031\t-0000.008\t-0.008\t-0.008\tFloating point should work...\n+1\t2032\t+0000.008\t0.008\t0.008\tFloating point should work...\n+1\t2033\t0000.008e3\t8\t8\tFloating point should work...\n+1\t2034\t-0000.008e3\t-8\t-8\tFloating point should work...\n+1\t2035\t+0000.008e3\t8\t8\tFloating point should work...\n+1\t2036\t08.5e-3\t0.0085\t0.0085\tFloating point should work...\n+1\t2037\t-08.5e-3\t-0.0085\t-0.0085\tFloating point should work...\n+1\t2038\t+08.5e-3\t0.0085\t0.0085\tFloating point should work...\n+1\t2063\t0x0abcdP1\t87962\t87962\tHex should be parsed\n+1\t2064\t0x0abcdP+1\t87962\t87962\tHex should be parsed\n+1\t2065\t0x0abcdP-1\t21990.5\t21990.5\tHex should be parsed\n+1\t2066\t0x0abcdP01\t87962\t87962\tHex should be parsed\n+1\t2067\t0x0abcdP+01\t87962\t87962\tHex should be parsed\n+1\t2068\t0x0abcdP-01\t21990.5\t21990.5\tHex should be parsed\n+1\t2069\t0x01P-01\t0.5\t0.5\tHex should be parsed\n+1\t12000\t0\t0\t0\tSingle zero\n+1\t12001\t00\t0\t0\tDouble zero\n+1\t12002\t000000000000000\t0\t0\tMutliple redundant zeroes\n+1\t12003\t01\t1\t1\tOctal like, interpret as decimal\n+1\t12004\t08\t8\t8\tOctal like, interpret as decimal\n+1\t12005\t0100\t100\t100\tOctal like, interpret as decimal\n+1\t12006\t0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes\n+1\t12013\t-01\t-1\t-1\tOctal like, interpret as decimal negative\n+1\t12014\t-08\t-8\t-8\tOctal like, interpret as decimal negative\n+1\t12015\t-0100\t-100\t-100\tOctal like, interpret as decimal negative\n+1\t12016\t-0000000000100\t-100\t-100\tOctal like, interpret as decimal, multiple leading zeroes negative\n+1\t12020\t+0\t0\t0\tSingle zero positive\n+1\t12021\t+00\t0\t0\tDouble zero negpositiveative\n+1\t12022\t+000000000000000\t0\t0\tMutliple redundant zeroes positive\n+1\t12023\t+01\t1\t1\tOctal like, interpret as decimal positive\n+1\t12024\t+08\t8\t8\tOctal like, interpret as decimal positive\n+1\t12025\t+0100\t100\t100\tOctal like, interpret as decimal positive\n+1\t12026\t+0000000000100\t100\t100\tOctal like, interpret as decimal, multiple leading zeroes positive\n+1\t12030\t0000.008\t0.008\t0.008\tFloating point should work...\n+1\t12031\t-0000.008\t-0.008\t-0.008\tFloating point should work...\n+1\t12032\t+0000.008\t0.008\t0.008\tFloating point should work...\n+1\t12033\t0000.008e3\t8\t8\tFloating point should work...\n+1\t12034\t-0000.008e3\t-8\t-8\tFloating point should work...\n+1\t12035\t+0000.008e3\t8\t8\tFloating point should work...\n+1\t12036\t08.5e-3\t0.0085\t0.0085\tFloating point should work...\n+1\t12037\t-08.5e-3\t-0.0085\t-0.0085\tFloating point should work...\n+1\t12038\t+08.5e-3\t0.0085\t0.0085\tFloating point should work...\n+1\t12050\t0b10000\t16\t16\tBinary should be parsed\n+1\t12051\t-0b10000\t-16\t-16\tBinary should be parsed\n+1\t12052\t+0b10000\t16\t16\tBinary should be parsed\n+1\t12063\t0x0abcdP1\t87962\t87962\tHex should be parsed\n+1\t12064\t0x0abcdP+1\t87962\t87962\tHex should be parsed\n+1\t12065\t0x0abcdP-1\t21990.5\t21990.5\tHex should be parsed\n+1\t12066\t0x0abcdP01\t87962\t87962\tHex should be parsed\n+1\t12067\t0x0abcdP+01\t87962\t87962\tHex should be parsed\n+1\t12068\t0x0abcdP-01\t21990.5\t21990.5\tHex should be parsed\n+1\t12069\t0x01P-01\t0.5\t0.5\tHex should be parsed\ndiff --git a/tests/queries/0_stateless/02896_leading_zeroes_no_octal.sql b/tests/queries/0_stateless/02896_leading_zeroes_no_octal.sql\nnew file mode 100644\nindex 000000000000..05d841ce01f1\n--- /dev/null\n+++ b/tests/queries/0_stateless/02896_leading_zeroes_no_octal.sql\n@@ -0,0 +1,223 @@\n+DROP TABLE IF EXISTS t_leading_zeroes;\n+DROP TABLE IF EXISTS t_leading_zeroes_f;\n+\n+CREATE TABLE t_leading_zeroes(id Int64, input String, val Int64, expected Int64, comment String) ENGINE=MergeTree ORDER BY id;\n+CREATE TABLE t_leading_zeroes_f(id Int64, input String, val Float64, expected Float64, comment String) ENGINE=MergeTree ORDER BY id;\n+\n+SET input_format_values_interpret_expressions = 0;\n+\n+INSERT INTO t_leading_zeroes VALUES (1000, '0', 0, 0, 'Single zero');\n+INSERT INTO t_leading_zeroes VALUES (1001, '00', 00, 0, 'Double zero');\n+INSERT INTO t_leading_zeroes VALUES (1002, '000000000000000', 000000000000000, 0, 'Mutliple redundant zeroes');\n+INSERT INTO t_leading_zeroes VALUES (1003, '01', 01, 1, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes VALUES (1004, '08', 08, 8, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes VALUES (1005, '0100', 0100, 100, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes VALUES (1006, '0000000000100', 0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes');\n+\n+INSERT INTO t_leading_zeroes VALUES (1010, '-0', -0, 0, 'Single zero negative');\n+INSERT INTO t_leading_zeroes VALUES (1011, '-00', -00, 0, 'Double zero negative');\n+INSERT INTO t_leading_zeroes VALUES (1012, '-000000000000000', -000000000000000, 0, 'Mutliple redundant zeroes negative');\n+INSERT INTO t_leading_zeroes VALUES (1013, '-01', -01, -1, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes VALUES (1014, '-08', -08, -8, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes VALUES (1015, '-0100', -0100, -100, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes VALUES (1016, '-0000000000100', -0000000000100, -100, 'Octal like, interpret as decimal, multiple leading zeroes negative');\n+\n+INSERT INTO t_leading_zeroes VALUES (1020, '+0', +0, 0, 'Single zero positive');\n+INSERT INTO t_leading_zeroes VALUES (1021, '+00', +00, 0, 'Double zero negpositiveative');\n+INSERT INTO t_leading_zeroes VALUES (1022, '+000000000000000', +000000000000000, 0, 'Mutliple redundant zeroes positive');\n+INSERT INTO t_leading_zeroes VALUES (1023, '+01', +01, 1, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes VALUES (1024, '+08', +08, 8, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes VALUES (1025, '+0100', +0100, 100, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes VALUES (1026, '+0000000000100', +0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes positive');\n+\n+INSERT INTO t_leading_zeroes VALUES (1030, '0000.008', 0000.008, 0, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1031, '-0000.008', -0000.008, 0, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1032, '+0000.008', +0000.008, 0, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1033, '0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1034, '-0000.008e3', -0000.008e3, -8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1035, '+0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1036, '08000.008e-3', 08000.008e-3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1037, '-08000.008e-3', -08000.008e-3, -8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (1038, '+08000.008e-3', 08000.008e-3, 8, 'Floating point should work...');\n+\n+INSERT INTO t_leading_zeroes VALUES (1060, '0x0abcd', 0x0abcd, 43981, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1061, '-0x0abcd', -0x0abcd, -43981, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1062, '+0x0abcd', +0x0abcd, 43981, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1063, '0x0abcdP1', 0x0abcdP1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1064, '0x0abcdP+1', 0x0abcdP+1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1065, '0x0abcdP-1', 0x0abcdP-1, 21990, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1066, '0x0abcdP01', 0x0abcdP01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1067, '0x0abcdP+01', 0x0abcdP+01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (1068, '0x0abcdP-01', 0x0abcdP-01, 21990, 'Hex should be parsed');\n+\n+\n+-- Floating point numbers go via readFloatTextFastImpl - so should not be affected\n+\n+INSERT INTO t_leading_zeroes_f VALUES (2000, '0', 0, 0, 'Single zero');\n+INSERT INTO t_leading_zeroes_f VALUES (2001, '00', 00, 0, 'Double zero');\n+INSERT INTO t_leading_zeroes_f VALUES (2002, '000000000000000', 000000000000000, 0, 'Mutliple redundant zeroes');\n+INSERT INTO t_leading_zeroes_f VALUES (2003, '01', 01, 1, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes_f VALUES (2004, '08', 08, 8, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes_f VALUES (2005, '0100', 0100, 100, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes_f VALUES (2006, '0000000000100', 0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes');\n+\n+-- Float negative zero is machine/context dependent\n+-- INSERT INTO t_leading_zeroes_f VALUES (2010, '-0', -0, 0, 'Single zero negative');\n+-- INSERT INTO t_leading_zeroes_f VALUES (2011, '-00', -00, 0, 'Double zero negative');\n+-- INSERT INTO t_leading_zeroes_f VALUES (2012, '-000000000000000', -000000000000000, 0, 'Mutliple redundant zeroes negative');\n+INSERT INTO t_leading_zeroes_f VALUES (2013, '-01', -01, -1, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes_f VALUES (2014, '-08', -08, -8, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes_f VALUES (2015, '-0100', -0100, -100, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes_f VALUES (2016, '-0000000000100', -0000000000100, -100, 'Octal like, interpret as decimal, multiple leading zeroes negative');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (2020, '+0', +0, 0, 'Single zero positive');\n+INSERT INTO t_leading_zeroes_f VALUES (2021, '+00', +00, 0, 'Double zero negpositiveative');\n+INSERT INTO t_leading_zeroes_f VALUES (2022, '+000000000000000', +000000000000000, 0, 'Mutliple redundant zeroes positive');\n+INSERT INTO t_leading_zeroes_f VALUES (2023, '+01', +01, 1, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes_f VALUES (2024, '+08', +08, 8, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes_f VALUES (2025, '+0100', +0100, 100, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes_f VALUES (2026, '+0000000000100', +0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes positive');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (2030, '0000.008', 0000.008, 0.008, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2031, '-0000.008', -0000.008, -0.008, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2032, '+0000.008', +0000.008, 0.008, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2033, '0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2034, '-0000.008e3', -0000.008e3, -8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2035, '+0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2036, '08.5e-3', 08.5e-3, 0.0085, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2037, '-08.5e-3', -08.5e-3, -0.0085, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (2038, '+08.5e-3', 08.5e-3, 0.0085, 'Floating point should work...');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (2063, '0x0abcdP1', 0x0abcdP1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (2064, '0x0abcdP+1', 0x0abcdP+1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (2065, '0x0abcdP-1', 0x0abcdP-1, 21990.5, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (2066, '0x0abcdP01', 0x0abcdP01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (2067, '0x0abcdP+01', 0x0abcdP+01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (2068, '0x0abcdP-01', 0x0abcdP-01, 21990.5, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (2069, '0x01P-01', 0x01P-01, 0.5, 'Hex should be parsed');\n+\n+-- Coincidentally, the following result in 9 rather than 9e9 because of readFloatTextFastImpl\n+-- using readUIntTextUpToNSignificantDigits<4>(exponent, in)\n+-- INSERT INTO t_leading_zeroes_f VALUES (2070, '00009e00009', 00009e00009, 9e9, '???');\n+\n+-- Binary should not work with input_format_values_interpret_expressions = 0\n+\n+INSERT INTO t_leading_zeroes_f VALUES (2050, '0b10000', 0b10000, 16, 'Binary should not be parsed'); -- { clientError SYNTAX_ERROR }\n+INSERT INTO t_leading_zeroes_f VALUES (2051, '-0b10000', -0b10000, -16, 'Binary should not be parsed'); -- { clientError SYNTAX_ERROR }\n+INSERT INTO t_leading_zeroes_f VALUES (2052, '+0b10000', +0b10000, 16, 'Binary should not be parsed'); -- { clientError SYNTAX_ERROR }\n+\n+INSERT INTO t_leading_zeroes VALUES (1050, '0b10000', 0b10000, 16, 'Binary should not be parsed'); -- { clientError SYNTAX_ERROR }\n+INSERT INTO t_leading_zeroes VALUES (1051, '-0b10000', -0b10000, -16, 'Binary should not be parsed'); -- { clientError SYNTAX_ERROR }\n+INSERT INTO t_leading_zeroes VALUES (1052, '+0b10000', +0b10000, 16, 'Binary should not be parsed'); -- { clientError SYNTAX_ERROR }\n+\n+\n+\n+SET input_format_values_interpret_expressions = 1;\n+\n+INSERT INTO t_leading_zeroes VALUES (11000, '0', 0, 0, 'Single zero');\n+INSERT INTO t_leading_zeroes VALUES (11001, '00', 00, 0, 'Double zero');\n+INSERT INTO t_leading_zeroes VALUES (11002, '000000000000000', 000000000000000, 0, 'Mutliple redundant zeroes');\n+INSERT INTO t_leading_zeroes VALUES (11003, '01', 01, 1, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes VALUES (11004, '08', 08, 8, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes VALUES (11005, '0100', 0100, 100, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes VALUES (11006, '0000000000100', 0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes');\n+\n+INSERT INTO t_leading_zeroes VALUES (11010, '-0', -0, 0, 'Single zero negative');\n+INSERT INTO t_leading_zeroes VALUES (11011, '-00', -00, 0, 'Double zero negative');\n+INSERT INTO t_leading_zeroes VALUES (11012, '-000000000000000', -000000000000000, 0, 'Mutliple redundant zeroes negative');\n+INSERT INTO t_leading_zeroes VALUES (11013, '-01', -01, -1, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes VALUES (11014, '-08', -08, -8, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes VALUES (11015, '-0100', -0100, -100, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes VALUES (11016, '-0000000000100', -0000000000100, -100, 'Octal like, interpret as decimal, multiple leading zeroes negative');\n+\n+INSERT INTO t_leading_zeroes VALUES (11020, '+0', +0, 0, 'Single zero positive');\n+INSERT INTO t_leading_zeroes VALUES (11021, '+00', +00, 0, 'Double zero negpositiveative');\n+INSERT INTO t_leading_zeroes VALUES (11022, '+000000000000000', +000000000000000, 0, 'Mutliple redundant zeroes positive');\n+INSERT INTO t_leading_zeroes VALUES (11023, '+01', +01, 1, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes VALUES (11024, '+08', +08, 8, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes VALUES (11025, '+0100', +0100, 100, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes VALUES (11026, '+0000000000100', +0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes positive');\n+\n+INSERT INTO t_leading_zeroes VALUES (11030, '0000.008', 0000.008, 0, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11031, '-0000.008', -0000.008, 0, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11032, '+0000.008', +0000.008, 0, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11033, '0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11034, '-0000.008e3', -0000.008e3, -8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11035, '+0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11036, '08000.008e-3', 08000.008e-3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11037, '-08000.008e-3', -08000.008e-3, -8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes VALUES (11038, '+08000.008e-3', 08000.008e-3, 8, 'Floating point should work...');\n+\n+INSERT INTO t_leading_zeroes VALUES (11050, '0b10000', 0b10000, 16, 'Binary should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11051, '-0b10000', -0b10000, -16, 'Binary should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11052, '+0b10000', +0b10000, 16, 'Binary should be parsed');\n+\n+INSERT INTO t_leading_zeroes VALUES (11060, '0x0abcd', 0x0abcd, 43981, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11061, '-0x0abcd', -0x0abcd, -43981, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11062, '+0x0abcd', +0x0abcd, 43981, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11063, '0x0abcdP1', 0x0abcdP1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11064, '0x0abcdP+1', 0x0abcdP+1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11065, '0x0abcdP-1', 0x0abcdP-1, 21990, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11066, '0x0abcdP01', 0x0abcdP01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11067, '0x0abcdP+01', 0x0abcdP+01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes VALUES (11068, '0x0abcdP-01', 0x0abcdP-01, 21990, 'Hex should be parsed');\n+\n+-- Floating point numbers go via readFloatTextFastImpl - so should not be affected\n+\n+INSERT INTO t_leading_zeroes_f VALUES (12000, '0', 0, 0, 'Single zero');\n+INSERT INTO t_leading_zeroes_f VALUES (12001, '00', 00, 0, 'Double zero');\n+INSERT INTO t_leading_zeroes_f VALUES (12002, '000000000000000', 000000000000000, 0, 'Mutliple redundant zeroes');\n+INSERT INTO t_leading_zeroes_f VALUES (12003, '01', 01, 1, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes_f VALUES (12004, '08', 08, 8, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes_f VALUES (12005, '0100', 0100, 100, 'Octal like, interpret as decimal');\n+INSERT INTO t_leading_zeroes_f VALUES (12006, '0000000000100', 0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes');\n+\n+-- Float negative zero is machine/context dependent\n+-- INSERT INTO t_leading_zeroes_f VALUES (12010, '-0', -0, 0, 'Single zero negative');\n+-- INSERT INTO t_leading_zeroes_f VALUES (12011, '-00', -00, 0, 'Double zero negative');\n+-- INSERT INTO t_leading_zeroes_f VALUES (12012, '-000000000000000', -000000000000000, 0, 'Mutliple redundant zeroes negative');\n+INSERT INTO t_leading_zeroes_f VALUES (12013, '-01', -01, -1, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes_f VALUES (12014, '-08', -08, -8, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes_f VALUES (12015, '-0100', -0100, -100, 'Octal like, interpret as decimal negative');\n+INSERT INTO t_leading_zeroes_f VALUES (12016, '-0000000000100', -0000000000100, -100, 'Octal like, interpret as decimal, multiple leading zeroes negative');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (12020, '+0', +0, 0, 'Single zero positive');\n+INSERT INTO t_leading_zeroes_f VALUES (12021, '+00', +00, 0, 'Double zero negpositiveative');\n+INSERT INTO t_leading_zeroes_f VALUES (12022, '+000000000000000', +000000000000000, 0, 'Mutliple redundant zeroes positive');\n+INSERT INTO t_leading_zeroes_f VALUES (12023, '+01', +01, 1, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes_f VALUES (12024, '+08', +08, 8, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes_f VALUES (12025, '+0100', +0100, 100, 'Octal like, interpret as decimal positive');\n+INSERT INTO t_leading_zeroes_f VALUES (12026, '+0000000000100', +0000000000100, 100, 'Octal like, interpret as decimal, multiple leading zeroes positive');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (12030, '0000.008', 0000.008, 0.008, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12031, '-0000.008', -0000.008, -0.008, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12032, '+0000.008', +0000.008, 0.008, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12033, '0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12034, '-0000.008e3', -0000.008e3, -8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12035, '+0000.008e3', 0000.008e3, 8, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12036, '08.5e-3', 08.5e-3, 0.0085, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12037, '-08.5e-3', -08.5e-3, -0.0085, 'Floating point should work...');\n+INSERT INTO t_leading_zeroes_f VALUES (12038, '+08.5e-3', 08.5e-3, 0.0085, 'Floating point should work...');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (12050, '0b10000', 0b10000, 16, 'Binary should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12051, '-0b10000', -0b10000, -16, 'Binary should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12052, '+0b10000', +0b10000, 16, 'Binary should be parsed');\n+\n+INSERT INTO t_leading_zeroes_f VALUES (12063, '0x0abcdP1', 0x0abcdP1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12064, '0x0abcdP+1', 0x0abcdP+1, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12065, '0x0abcdP-1', 0x0abcdP-1, 21990.5, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12066, '0x0abcdP01', 0x0abcdP01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12067, '0x0abcdP+01', 0x0abcdP+01, 87962, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12068, '0x0abcdP-01', 0x0abcdP-01, 21990.5, 'Hex should be parsed');\n+INSERT INTO t_leading_zeroes_f VALUES (12069, '0x01P-01', 0x01P-01, 0.5, 'Hex should be parsed');\n+\n+SELECT 'Leading zeroes into Int64 (1XXX without input_format_values_interpret_expressions and 1XXXX with)';\n+SELECT t.val == t.expected AS ok, * FROM t_leading_zeroes t ORDER BY id;\n+\n+\n+SELECT 'Leading zeroes into Float64 (2XXX without input_format_values_interpret_expressions and 2XXXX with)';\n+SELECT t.val == t.expected AS ok, * FROM t_leading_zeroes_f t ORDER BY id;\n+\n+\n+DROP TABLE IF EXISTS t_leading_zeroes;\n+DROP TABLE IF EXISTS t_leading_zeroes_f;\n",
  "problem_statement": "Incorrect handling of leading zeroes during INSERT\n**How to reproduce**\r\n```sql\r\nCREATE TABLE EMPLOYEE\r\n(\r\n    `empId` INTEGER PRIMARY KEY,\r\n    `d` DOUBLE\r\n)\r\nENGINE = MergeTree\r\nORDER BY empId;\r\n\r\nINSERT INTO EMPLOYEE VALUES (0001, 1.456), (0005, 45.98), (0008, 4342.766), (0017, 345.87), (0021, 43.78), (0051, 0.781);\r\n\r\nSELECT * FROM EMPLOYEE;\r\n```\r\nResults into\r\n```\r\n\u250c\u2500empId\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500d\u2500\u2510\r\n\u2502     1 \u2502    1.456 \u2502\r\n\u2502     5 \u2502    45.98 \u2502\r\n\u2502     8 \u2502 4342.766 \u2502\r\n\u2502    15 \u2502   345.87 \u2502\r\n\u2502    17 \u2502    43.78 \u2502\r\n\u2502    41 \u2502    0.781 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n**Expected behavior**\r\n```\r\n\u250c\u2500empId\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500d\u2500\u2510\r\n\u2502     1 \u2502    1.456 \u2502\r\n\u2502     5 \u2502    45.98 \u2502\r\n\u2502     8 \u2502 4342.766 \u2502\r\n\u2502    17 \u2502   345.87 \u2502\r\n\u2502    21 \u2502    43.78 \u2502\r\n\u2502    51 \u2502    0.781 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n```\r\n\r\nReproduces on the latest master:\r\nhttps://fiddle.clickhouse.com/8d27f2fe-31a8-4af5-a54b-c0d1608886db\n",
  "hints_text": "The numbers are mistakenly parsed as octal. We shouldn't do that - octal numbers are harmful, as well as functions like `strto*` from C.",
  "created_at": "2024-01-30T20:14:32Z",
  "modified_files": [
    "src/Processors/Formats/Impl/ConstantExpressionTemplate.cpp"
  ],
  "modified_test_files": [
    "b/tests/queries/0_stateless/02896_leading_zeroes_no_octal.reference",
    "b/tests/queries/0_stateless/02896_leading_zeroes_no_octal.sql"
  ]
}