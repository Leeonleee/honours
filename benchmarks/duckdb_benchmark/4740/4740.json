{
  "repo": "duckdb/duckdb",
  "pull_number": 4740,
  "instance_id": "duckdb__duckdb-4740",
  "issue_numbers": [
    "4356",
    "4356"
  ],
  "base_commit": "72179ca25253304cfe07c1b85c357a8d7a1081dd",
  "patch": "diff --git a/src/planner/binder/statement/bind_export.cpp b/src/planner/binder/statement/bind_export.cpp\nindex e2c5a620f7a4..e5540881368e 100644\n--- a/src/planner/binder/statement/bind_export.cpp\n+++ b/src/planner/binder/statement/bind_export.cpp\n@@ -156,6 +156,13 @@ BoundStatement Binder::Bind(ExportStatement &stmt) {\n \t\tinfo->schema = table->schema->name;\n \t\tinfo->table = table->name;\n \n+\t\t// We can not export generated columns\n+\t\tfor (auto &col : table->columns) {\n+\t\t\tif (!col.Generated()) {\n+\t\t\t\tinfo->select_list.push_back(col.GetName());\n+\t\t\t}\n+\t\t}\n+\n \t\texported_data.table_name = info->table;\n \t\texported_data.schema_name = info->schema;\n \t\texported_data.file_path = info->file_path;\n",
  "test_patch": "diff --git a/test/sql/export/export_generated_columns.test b/test/sql/export/export_generated_columns.test\nindex 5618028aeb75..917f086c65e4 100644\n--- a/test/sql/export/export_generated_columns.test\n+++ b/test/sql/export/export_generated_columns.test\n@@ -31,6 +31,12 @@ ROLLBACK\n statement ok\n IMPORT DATABASE '__TEST_DIR__/export_generated_columns'\n \n+# We can get the data we exported just now\n+query II\n+SELECT * FROM tbl\n+----\n+5\t10\n+\n # Generated columns can not be inserted into directly\n statement error\n INSERT INTO tbl VALUES(2,3)\n",
  "problem_statement": "[Export] Generated columns aren't properly exported with `EXPORT DATABASE`\n### What happens?\n\nWhen exporting a database containing tables with generated column(s), attempting to reimport the database fails.\n\n### To Reproduce\n\n```sql\r\ncreate table y(id1 int not null, id2 int generated always as (id1 / 2), id3 text);\r\ninsert into y values(10, 'abc');\r\nexport database 'test';\r\ndrop table y;\r\nimport database 'test';\r\n```\n\n### OS:\n\nMacOS\n\n### DuckDB Version:\n\n4.0.1\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nThijs Bruineman\n\n### Affiliation:\n\nDuckDB Labs\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n[Export] Generated columns aren't properly exported with `EXPORT DATABASE`\n### What happens?\n\nWhen exporting a database containing tables with generated column(s), attempting to reimport the database fails.\n\n### To Reproduce\n\n```sql\r\ncreate table y(id1 int not null, id2 int generated always as (id1 / 2), id3 text);\r\ninsert into y values(10, 'abc');\r\nexport database 'test';\r\ndrop table y;\r\nimport database 'test';\r\n```\n\n### OS:\n\nMacOS\n\n### DuckDB Version:\n\n4.0.1\n\n### DuckDB Client:\n\nCLI\n\n### Full Name:\n\nThijs Bruineman\n\n### Affiliation:\n\nDuckDB Labs\n\n### Have you tried this on the latest `master` branch?\n\n- [X] I agree\n\n### Have you tried the steps to reproduce? Do they include all relevant data and configuration? Does the issue you report still appear there?\n\n- [X] I agree\n",
  "hints_text": "\n",
  "created_at": "2022-09-17T12:51:24Z",
  "modified_files": [
    "src/planner/binder/statement/bind_export.cpp"
  ],
  "modified_test_files": [
    "test/sql/export/export_generated_columns.test"
  ]
}