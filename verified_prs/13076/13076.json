{
  "repo": "duckdb/duckdb",
  "pull_number": 13076,
  "instance_id": "duckdb__duckdb-13076",
  "issue_numbers": [
    "13045",
    "13045"
  ],
  "base_commit": "ed6e86bbc4a3512c34a058197aa9a76d1cb72354",
  "patch": "diff --git a/src/core_functions/scalar/list/list_inner_product.cpp b/src/core_functions/scalar/list/list_inner_product.cpp\nindex 45293e0c4dac..9ec7d38c2284 100644\n--- a/src/core_functions/scalar/list/list_inner_product.cpp\n+++ b/src/core_functions/scalar/list/list_inner_product.cpp\n@@ -15,6 +15,9 @@ static void ListInnerProduct(DataChunk &args, ExpressionState &, Vector &result)\n \tauto &left_child = ListVector::GetEntry(left);\n \tauto &right_child = ListVector::GetEntry(right);\n \n+\tleft_child.Flatten(left_count);\n+\tright_child.Flatten(right_count);\n+\n \tD_ASSERT(left_child.GetVectorType() == VectorType::FLAT_VECTOR);\n \tD_ASSERT(right_child.GetVectorType() == VectorType::FLAT_VECTOR);\n \n",
  "test_patch": "diff --git a/test/sql/function/list/list_inner_product.test b/test/sql/function/list/list_inner_product.test\nindex 0430f04b9854..e1f76969b7d0 100644\n--- a/test/sql/function/list/list_inner_product.test\n+++ b/test/sql/function/list/list_inner_product.test\n@@ -1,6 +1,11 @@\n # name: test/sql/function/list/list_inner_product.test\n # group: [list]\n \n+query I\n+SELECT list_inner_product([], []);\n+----\n+0.0\n+\n foreach type FLOAT DOUBLE\n \n query I\n",
  "problem_statement": "`LIST_DOT_PRODUCT([], [])`: INTERNAL Error: Operation requires a flat vector but a non-flat vector was encountered\n### What happens?\n\nrunning `SELECT LIST_DOT_PRODUCT([], [])` raises `INTERNAL Error: Operation requires a flat vector but a non-flat vector was encountered`\r\n\r\nError exists in some environments:\r\n- mac m1, python, duckdb versions >=0.10.1\r\n\r\nDoes not exist:\r\n- mac m1, python, duckdb==0.10.0\r\n- shell.duckdb.org with duckdb 1.0.0\r\n\r\nMaybe related to https://github.com/duckdb/duckdb/issues/11542? At least the same error message.\n\n### To Reproduce\n\n```python\r\nimport duckdb\r\n\r\nsql = \"SELECT LIST_DOT_PRODUCT([], [])\"\r\nduckdb.sql(sql)\r\n```\n\n### OS:\n\nMacM1, MacOS 14.5\n\n### DuckDB Version:\n\nanything >=0.10.1\n\n### DuckDB Client:\n\npython\n\n### Full Name:\n\nNick Crews\n\n### Affiliation:\n\nShip Creek Group\n\n### What is the latest build you tested with? If possible, we recommend testing with the latest nightly build.\n\nI have tested with a stable release\n\n### Did you include all relevant data sets for reproducing the issue?\n\nYes\n\n### Did you include all code required to reproduce the issue?\n\n- [X] Yes, I have\n\n### Did you include all relevant configuration (e.g., CPU architecture, Python version, Linux distribution) to reproduce the issue?\n\n- [X] Yes, I have\n`LIST_DOT_PRODUCT([], [])`: INTERNAL Error: Operation requires a flat vector but a non-flat vector was encountered\n### What happens?\n\nrunning `SELECT LIST_DOT_PRODUCT([], [])` raises `INTERNAL Error: Operation requires a flat vector but a non-flat vector was encountered`\r\n\r\nError exists in some environments:\r\n- mac m1, python, duckdb versions >=0.10.1\r\n\r\nDoes not exist:\r\n- mac m1, python, duckdb==0.10.0\r\n- shell.duckdb.org with duckdb 1.0.0\r\n\r\nMaybe related to https://github.com/duckdb/duckdb/issues/11542? At least the same error message.\n\n### To Reproduce\n\n```python\r\nimport duckdb\r\n\r\nsql = \"SELECT LIST_DOT_PRODUCT([], [])\"\r\nduckdb.sql(sql)\r\n```\n\n### OS:\n\nMacM1, MacOS 14.5\n\n### DuckDB Version:\n\nanything >=0.10.1\n\n### DuckDB Client:\n\npython\n\n### Full Name:\n\nNick Crews\n\n### Affiliation:\n\nShip Creek Group\n\n### What is the latest build you tested with? If possible, we recommend testing with the latest nightly build.\n\nI have tested with a stable release\n\n### Did you include all relevant data sets for reproducing the issue?\n\nYes\n\n### Did you include all code required to reproduce the issue?\n\n- [X] Yes, I have\n\n### Did you include all relevant configuration (e.g., CPU architecture, Python version, Linux distribution) to reproduce the issue?\n\n- [X] Yes, I have\n",
  "hints_text": "\n",
  "created_at": "2024-07-19T08:26:04Z",
  "modified_files": [
    "a/src/core_functions/scalar/list/list_inner_product.cpp"
  ]
}