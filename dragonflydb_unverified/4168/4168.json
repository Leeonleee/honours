{
  "repo": "dragonflydb/dragonfly",
  "pull_number": 4168,
  "instance_id": "dragonflydb__dragonfly-4168",
  "issue_numbers": [
    "3776"
  ],
  "base_commit": "a012539f2c993d061794a7ea282010d76a9ac1aa",
  "patch": "diff --git a/helio b/helio\nindex 944be564ecd4..ff9b6cd35bf0 160000\n--- a/helio\n+++ b/helio\n@@ -1,1 +1,1 @@\n-Subproject commit 944be564ecd44865a9a057c09b5d4bbf7f6db772\n+Subproject commit ff9b6cd35bf082a9d48cf0904b0e8557cf31b6d2\ndiff --git a/src/server/dfly_main.cc b/src/server/dfly_main.cc\nindex 0dff2cf8e1ff..daac86bd411e 100644\n--- a/src/server/dfly_main.cc\n+++ b/src/server/dfly_main.cc\n@@ -762,44 +762,42 @@ Usage: dragonfly [FLAGS]\n \n   fb2::SetDefaultStackResource(&fb2::std_malloc_resource, kFiberDefaultStackSize);\n \n-  unique_ptr<util::ProactorPool> pool;\n+  {\n+    unique_ptr<util::ProactorPool> pool;\n \n #ifdef __linux__\n-  base::sys::KernelVersion kver;\n-  base::sys::GetKernelVersion(&kver);\n+    base::sys::KernelVersion kver;\n+    base::sys::GetKernelVersion(&kver);\n \n-  CHECK_LT(kver.major, 99u);\n-  dfly::kernel_version = kver.kernel * 100 + kver.major;\n+    CHECK_LT(kver.major, 99u);\n+    dfly::kernel_version = kver.kernel * 100 + kver.major;\n \n-  bool use_epoll = ShouldUseEpollAPI(kver);\n+    bool use_epoll = ShouldUseEpollAPI(kver);\n \n-  if (use_epoll) {\n-    pool.reset(fb2::Pool::Epoll(max_available_threads));\n-  } else {\n-    pool.reset(fb2::Pool::IOUring(1024, max_available_threads));  // 1024 - iouring queue size.\n-  }\n+    if (use_epoll) {\n+      pool.reset(fb2::Pool::Epoll(max_available_threads));\n+    } else {\n+      pool.reset(fb2::Pool::IOUring(1024, max_available_threads));  // 1024 - iouring queue size.\n+    }\n #else\n-  pool.reset(fb2::Pool::Epoll(max_available_threads));\n+    pool.reset(fb2::Pool::Epoll(max_available_threads));\n #endif\n \n-  pool->Run();\n+    pool->Run();\n \n-  SetupAllocationTracker(pool.get());\n+    SetupAllocationTracker(pool.get());\n \n-  AcceptServer acceptor(pool.get(), &fb2::std_malloc_resource, true);\n-  acceptor.set_back_log(absl::GetFlag(FLAGS_tcp_backlog));\n+    AcceptServer acceptor(pool.get(), &fb2::std_malloc_resource, true);\n+    acceptor.set_back_log(absl::GetFlag(FLAGS_tcp_backlog));\n \n-  dfly::RunEngine(pool.get(), &acceptor);\n+    dfly::RunEngine(pool.get(), &acceptor);\n \n-  pool->Stop();\n+    pool->Stop();\n \n-  if (!pidfile_path.empty()) {\n-    unlink(pidfile_path.c_str());\n+    if (!pidfile_path.empty()) {\n+      unlink(pidfile_path.c_str());\n+    }\n   }\n \n-  // Returns memory to OS.\n-  // This is a workaround for a bug in mi_malloc that may cause a crash on exit.\n-  mi_collect(true);\n-\n   return 0;\n }\ndiff --git a/src/server/main_service.cc b/src/server/main_service.cc\nindex 66614638b9a1..f8c7388effe2 100644\n--- a/src/server/main_service.cc\n+++ b/src/server/main_service.cc\n@@ -771,7 +771,7 @@ Service::Service(ProactorPool* pp)\n \n Service::~Service() {\n #ifdef PRINT_STACKTRACES_ON_SIGNAL\n-  ProactorBase::ClearSignal({SIGUSR1});\n+  ProactorBase::ClearSignal({SIGUSR1}, true);\n #endif\n \n   delete shard_set;\n",
  "test_patch": "diff --git a/tests/dragonfly/conftest.py b/tests/dragonfly/conftest.py\nindex cca0f1186b40..39ab2cec0b3f 100644\n--- a/tests/dragonfly/conftest.py\n+++ b/tests/dragonfly/conftest.py\n@@ -131,6 +131,7 @@ async def df_factory(request, tmp_dir, test_env) -> DflyInstanceFactory:\n         path=path,\n         cwd=tmp_dir,\n         gdb=request.config.getoption(\"--gdb\"),\n+        direct_output=request.config.getoption(\"--direct-out\"),\n         buffered_out=request.config.getoption(\"--buffered-output\"),\n         args=parse_args(request.config.getoption(\"--df\")),\n         existing_port=int(existing) if existing else None,\n@@ -259,6 +260,13 @@ def pytest_addoption(parser):\n         default=None,\n         help=\"Provide a port to the existing memcached process for the test\",\n     )\n+    parser.addoption(\n+        \"--direct-out\",\n+        action=\"store_true\",\n+        default=False,\n+        help=\"If true, does not post process dragonfly output\",\n+    )\n+\n     parser.addoption(\"--repeat\", action=\"store\", help=\"Number of times to repeat each test\")\n \n \ndiff --git a/tests/dragonfly/instance.py b/tests/dragonfly/instance.py\nindex f391f81a87bf..447c07391359 100644\n--- a/tests/dragonfly/instance.py\n+++ b/tests/dragonfly/instance.py\n@@ -26,6 +26,7 @@ class DflyParams:\n     path: str\n     cwd: str\n     gdb: bool\n+    direct_output: bool\n     buffered_out: bool\n     args: Dict[str, Union[str, None]]\n     existing_port: int\n@@ -186,7 +187,7 @@ def _wait_for_server(self):\n             try:\n                 self.get_port_from_psutil()\n                 logging.debug(\n-                    f\"Process started after {time.time() - s:.2f} seconds. port={self.port}\"\n+                    f\"Process {self.proc.pid} started after {time.time() - s:.2f} seconds. port={self.port}\"\n                 )\n                 break\n             except RuntimeError:\n@@ -202,18 +203,19 @@ def _wait_for_server(self):\n         sed_cmd = [\"sed\", \"-u\", \"-e\", sed_format]\n         if self.params.buffered_out:\n             sed_cmd.remove(\"-u\")\n-        self.sed_proc = subprocess.Popen(\n-            sed_cmd,\n-            stdin=self.proc.stdout,\n-            stdout=subprocess.PIPE,\n-            bufsize=1,\n-            universal_newlines=True,\n-        )\n-        self.stacktrace = []\n-        self.sed_thread = threading.Thread(\n-            target=read_sedout, args=(self.sed_proc.stdout, self.stacktrace), daemon=True\n-        )\n-        self.sed_thread.start()\n+        if not self.params.direct_output:\n+            self.sed_proc = subprocess.Popen(\n+                sed_cmd,\n+                stdin=self.proc.stdout,\n+                stdout=subprocess.PIPE,\n+                bufsize=1,\n+                universal_newlines=True,\n+            )\n+            self.stacktrace = []\n+            self.sed_thread = threading.Thread(\n+                target=read_sedout, args=(self.sed_proc.stdout, self.stacktrace), daemon=True\n+            )\n+            self.sed_thread.start()\n \n     def set_proc_to_none(self):\n         self.proc = None\n@@ -235,7 +237,8 @@ def stop(self, kill=False):\n                 # if the return code is positive it means abnormal exit\n                 if proc.returncode != 0:\n                     raise Exception(\n-                        f\"Dragonfly did not terminate gracefully, exit code {proc.returncode}\"\n+                        f\"Dragonfly did not terminate gracefully, exit code {proc.returncode}, \"\n+                        f\"pid: {proc.pid}\"\n                     )\n \n         except subprocess.TimeoutExpired:\n@@ -268,15 +271,18 @@ def _start(self):\n \n         all_args = self.format_args(self.args)\n         real_path = os.path.realpath(self.params.path)\n-        logging.debug(f\"Starting instance with arguments {' '.join(all_args)} from {real_path}\")\n \n         run_cmd = [self.params.path, *all_args]\n         if self.params.gdb:\n             run_cmd = [\"gdb\", \"--ex\", \"r\", \"--args\"] + run_cmd\n \n         self.proc = subprocess.Popen(\n-            run_cmd, cwd=self.params.cwd, stdout=subprocess.PIPE, stderr=subprocess.STDOUT\n+            run_cmd,\n+            cwd=self.params.cwd,\n+            stdout=None if self.params.direct_output else subprocess.PIPE,\n+            stderr=subprocess.STDOUT,\n         )\n+        logging.debug(f\"Starting {real_path} {' '.join(all_args)}, pid {self.proc.pid}\")\n \n     def _check_status(self):\n         if not self.params.existing_port:\n",
  "problem_statement": "test failed replication_test.py::test_take_over_counters\ninvestigate https://github.com/dragonflydb/dragonfly/actions/runs/10993785520/job/30521012937\r\n\n",
  "hints_text": "@adiholden do not assign this to @chakaz. It happens during shutdown and I think it's related to the one I am fixing\nwhoops was a hard crash. I did not see the traces \nIt's been a while since we opened this, perhaps it was already resolved. Let's optimistically close it, and reopen if needed.\n@chakaz I am pretty sure it was not, I saw it two week ago again.\nIndeed, also just now:\r\nhttps://github.com/dragonflydb/dragonfly/actions/runs/11763776680/job/32768184396#step:6:1067\nsucceeded to reproduce it. Got this stackl trace file:\r\n```\r\n#0  __pthread_kill_implementation (threadid=279096101982240, signo=signo@entry=6, no_tid=no_tid@entry=0)\r\n    at ./nptl/pthread_kill.c:44\r\n#1  0x0000fdd61f4c7690 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\r\n#2  0x0000fdd61f47cb3c in __GI_raise (sig=6) at ../sysdeps/posix/raise.c:26\r\n#3  0x0000b8c7e19c3730 in absl::lts_20240116::RaiseToDefaultHandler (signo=6)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/abseil_cpp-src/absl/debugging/failure_signal_handler.cc:77\r\n#4  0x0000b8c7e19c4268 in absl::lts_20240116::AbslFailureSignalHandler (signo=6, ucontext=0xfdd61fe8ee20)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/abseil_cpp-src/absl/debugging/failure_signal_handler.cc:393\r\n#5  <signal handler called>\r\n#6  __pthread_kill_implementation (threadid=279096101982240, signo=signo@entry=6, no_tid=no_tid@entry=0)\r\n    at ./nptl/pthread_kill.c:44\r\n#7  0x0000fdd61f4c7690 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\r\n#8  0x0000fdd61f47cb3c in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\r\n#9  0x0000fdd61f467e00 in __GI_abort () at ./stdlib/abort.c:79\r\n#10 0x0000b8c7e19357f4 in glog_internal_namespace_::Mutex::Lock (this=0xb8c7e266fdd0 <google::log_mutex>)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/base/mutex.h:272\r\n#11 0x0000b8c7e19358c4 in glog_internal_namespace_::MutexLock::MutexLock (this=0xffffeb8061c0,\r\n    mu=0xb8c7e266fdd0 <google::log_mutex>)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/base/mutex.h:290\r\n#12 0x0000b8c7e1930b28 in google::LogMessage::Flush (this=0xffffeb806268)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/logging.cc:1779\r\n#13 0x0000b8c7e19308d8 in google::LogMessage::~LogMessage (this=0xffffeb806268, __in_chrg=<optimized out>)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/logging.cc:1727\r\n#14 0x0000b8c7e1821c0c in util::fb2::(anonymous namespace)::SigAction (signal=15)\r\n    at /home/dev/projects/dragonfly/helio/util/fibers/proactor_base.cc:53\r\n#15 <signal handler called>\r\n#16 0x0000fdd61f526fcc in __GI_madvise () at ../sysdeps/unix/syscall-template.S:120\r\n#17 0x0000b8c7e177d808 in unix_madvise (advice=4, size=size@entry=281474632807847, addr=addr@entry=0x568f8170000)\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/prim/unix/prim.c:188\r\n#18 _mi_prim_decommit (start=start@entry=0x568f8170000, size=size@entry=32047104,\r\n    needs_recommit=needs_recommit@entry=0xffffeb8075a7)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/prim/unix/prim.c:401\r\n#19 0x0000b8c7e1772f14 in mi_os_decommit_ex (addr=addr@entry=0x568f8170000, size=size@entry=32047104,\r\n    needs_recommit=needs_recommit@entry=0xffffeb8075a7, tld_stats=<optimized out>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:426\r\n#20 0x0000b8c7e1774548 in _mi_os_purge_ex (stats=<optimized out>, allow_reset=true, size=32047104, p=0x568f8170000)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:476\r\n#21 _mi_os_purge_ex (stats=0xb8c7e26252c8 <tld_main+968>, allow_reset=true, size=32047104, p=0x568f8170000)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:466\r\n#22 _mi_os_purge (p=0x568f8170000, size=size@entry=32047104, stats=stats@entry=0xb8c7e26252c8 <tld_main+968>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:490\r\n#23 0x0000b8c7e17789c8 in mi_segment_purge (segment=segment@entry=0x568f8000000, p=p@entry=0x568f8170000 \"\",\r\n    size=size@entry=32047104, stats=stats@entry=0xb8c7e26252c8 <tld_main+968>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:522\r\n#24 0x0000b8c7e1779b50 in mi_segment_purge (stats=0xb8c7e26252c8 <tld_main+968>, size=32047104, p=0x568f8170000 \"\",\r\n    segment=0x568f8000000) at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:509\r\n#25 mi_segment_try_purge (segment=segment@entry=0x568f8000000, stats=0xb8c7e26252c8 <tld_main+968>, force=true)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:592\r\n#26 0x0000b8c7e177b1e8 in mi_segment_try_purge (stats=<optimized out>, force=true, segment=0x568f8000000)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:603\r\n#27 0x0000b8c7e176f74c in mi_heap_page_collect (arg2=0x0, arg_collect=<synthetic pointer>, page=0x568f8000948,\r\n    pq=0xb8c7e2624888 <_mi_heap_main+1408>, heap=0xb8c7e2624308 <_mi_heap_main>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:101\r\n#28 mi_heap_visit_pages (arg2=0x0, arg1=<synthetic pointer>, fn=<optimized out>,\r\n    heap=0xb8c7e2624308 <_mi_heap_main>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:46\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n#29 mi_heap_collect_ex (heap=0xb8c7e2624308 <_mi_heap_main>, collect=collect@entry=MI_FORCE)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:159\r\n#30 0x0000b8c7e176f8a8 in mi_heap_collect (force=force@entry=true, heap=<optimized out>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:180\r\n#31 0x0000b8c7e17703f0 in mi_process_done ()\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/init.c:638\r\n#32 mi_process_done () at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/init.c:622\r\n#33 0x0000fdd61f47f228 in __run_exit_handlers (status=0, listp=0xfdd61f5f0670 <__exit_funcs>,\r\n    run_list_atexit=run_list_atexit@entry=true, run_dtors=run_dtors@entry=true) at ./stdlib/exit.c:108\r\n#34 0x0000fdd61f47f30c in __GI_exit (status=<optimized out>) at ./stdlib/exit.c:138\r\n#35 0x0000fdd61f4684c8 in __libc_start_call_main (main=main@entry=0xb8c7e0d0e404 <main(int, char**)>,\r\n    argc=argc@entry=12, argv=argv@entry=0xffffeb8079d8) at ../sysdeps/nptl/libc_start_call_main.h:74\r\n#36 0x0000fdd61f468598 in __libc_start_main_impl (main=0xb8c7e0d0e404 <main(int, char**)>, argc=12,\r\n    argv=0xffffeb8079d8, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>,\r\n    stack_end=<optimized out>) at ../csu/libc-start.c:360\r\n#37 0x0000b8c7e0d094b0 in _start ()\r\n(gdb) bt\r\n#0  __pthread_kill_implementation (threadid=279096101982240, signo=signo@entry=6, no_tid=no_tid@entry=0)\r\n    at ./nptl/pthread_kill.c:44\r\n#1  0x0000fdd61f4c7690 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\r\n#2  0x0000fdd61f47cb3c in __GI_raise (sig=6) at ../sysdeps/posix/raise.c:26\r\n#3  0x0000b8c7e19c3730 in absl::lts_20240116::RaiseToDefaultHandler (signo=6)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/abseil_cpp-src/absl/debugging/failure_signal_handler.cc:77\r\n#4  0x0000b8c7e19c4268 in absl::lts_20240116::AbslFailureSignalHandler (signo=6, ucontext=0xfdd61fe8ee20)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/abseil_cpp-src/absl/debugging/failure_signal_handler.cc:393\r\n#5  <signal handler called>\r\n#6  __pthread_kill_implementation (threadid=279096101982240, signo=signo@entry=6, no_tid=no_tid@entry=0)\r\n    at ./nptl/pthread_kill.c:44\r\n#7  0x0000fdd61f4c7690 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\r\n#8  0x0000fdd61f47cb3c in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\r\n#9  0x0000fdd61f467e00 in __GI_abort () at ./stdlib/abort.c:79\r\n#10 0x0000b8c7e19357f4 in glog_internal_namespace_::Mutex::Lock (this=0xb8c7e266fdd0 <google::log_mutex>)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/base/mutex.h:272\r\n#11 0x0000b8c7e19358c4 in glog_internal_namespace_::MutexLock::MutexLock (this=0xffffeb8061c0,\r\n    mu=0xb8c7e266fdd0 <google::log_mutex>)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/base/mutex.h:290\r\n#12 0x0000b8c7e1930b28 in google::LogMessage::Flush (this=0xffffeb806268)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/logging.cc:1779\r\n#13 0x0000b8c7e19308d8 in google::LogMessage::~LogMessage (this=0xffffeb806268, __in_chrg=<optimized out>)\r\n    at /home/dev/projects/dragonfly/build-dbg/_deps/glog-src/src/logging.cc:1727\r\n#14 0x0000b8c7e1821c0c in util::fb2::(anonymous namespace)::SigAction (signal=15)\r\n    at /home/dev/projects/dragonfly/helio/util/fibers/proactor_base.cc:53\r\n#15 <signal handler called>\r\n#16 0x0000fdd61f526fcc in __GI_madvise () at ../sysdeps/unix/syscall-template.S:120\r\n#17 0x0000b8c7e177d808 in unix_madvise (advice=4, size=size@entry=281474632807847, addr=addr@entry=0x568f8170000)\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/prim/unix/prim.c:188\r\n#18 _mi_prim_decommit (start=start@entry=0x568f8170000, size=size@entry=32047104,\r\n    needs_recommit=needs_recommit@entry=0xffffeb8075a7)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/prim/unix/prim.c:401\r\n#19 0x0000b8c7e1772f14 in mi_os_decommit_ex (addr=addr@entry=0x568f8170000, size=size@entry=32047104,\r\n    needs_recommit=needs_recommit@entry=0xffffeb8075a7, tld_stats=<optimized out>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:426\r\n#20 0x0000b8c7e1774548 in _mi_os_purge_ex (stats=<optimized out>, allow_reset=true, size=32047104, p=0x568f8170000)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:476\r\n#21 _mi_os_purge_ex (stats=0xb8c7e26252c8 <tld_main+968>, allow_reset=true, size=32047104, p=0x568f8170000)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:466\r\n#22 _mi_os_purge (p=0x568f8170000, size=size@entry=32047104, stats=stats@entry=0xb8c7e26252c8 <tld_main+968>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/os.c:490\r\n#23 0x0000b8c7e17789c8 in mi_segment_purge (segment=segment@entry=0x568f8000000, p=p@entry=0x568f8170000 \"\",\r\n    size=size@entry=32047104, stats=stats@entry=0xb8c7e26252c8 <tld_main+968>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:522\r\n#24 0x0000b8c7e1779b50 in mi_segment_purge (stats=0xb8c7e26252c8 <tld_main+968>, size=32047104, p=0x568f8170000 \"\",\r\n    segment=0x568f8000000) at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:509\r\n#25 mi_segment_try_purge (segment=segment@entry=0x568f8000000, stats=0xb8c7e26252c8 <tld_main+968>, force=true)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:592\r\n#26 0x0000b8c7e177b1e8 in mi_segment_try_purge (stats=<optimized out>, force=true, segment=0x568f8000000)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/segment.c:603\r\n#27 0x0000b8c7e176f74c in mi_heap_page_collect (arg2=0x0, arg_collect=<synthetic pointer>, page=0x568f8000948,\r\n    pq=0xb8c7e2624888 <_mi_heap_main+1408>, heap=0xb8c7e2624308 <_mi_heap_main>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:101\r\n#28 mi_heap_visit_pages (arg2=0x0, arg1=<synthetic pointer>, fn=<optimized out>,\r\n    heap=0xb8c7e2624308 <_mi_heap_main>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:46\r\n--Type <RET> for more, q to quit, c to continue without paging--\r\n#29 mi_heap_collect_ex (heap=0xb8c7e2624308 <_mi_heap_main>, collect=collect@entry=MI_FORCE)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:159\r\n#30 0x0000b8c7e176f8a8 in mi_heap_collect (force=force@entry=true, heap=<optimized out>)\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/heap.c:180\r\n#31 0x0000b8c7e17703f0 in mi_process_done ()\r\n    at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/init.c:638\r\n#32 mi_process_done () at /home/dev/projects/dragonfly/build-dbg/third_party/mimalloc/src/init.c:622\r\n#33 0x0000fdd61f47f228 in __run_exit_handlers (status=0, listp=0xfdd61f5f0670 <__exit_funcs>,\r\n    run_list_atexit=run_list_atexit@entry=true, run_dtors=run_dtors@entry=true) at ./stdlib/exit.c:108\r\n#34 0x0000fdd61f47f30c in __GI_exit (status=<optimized out>) at ./stdlib/exit.c:138\r\n#35 0x0000fdd61f4684c8 in __libc_start_call_main (main=main@entry=0xb8c7e0d0e404 <main(int, char**)>,\r\n    argc=argc@entry=12, argv=argv@entry=0xffffeb8079d8) at ../sysdeps/nptl/libc_start_call_main.h:74\r\n#36 0x0000fdd61f468598 in __libc_start_main_impl (main=0xb8c7e0d0e404 <main(int, char**)>, argc=12,\r\n    argv=0xffffeb8079d8, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>,\r\n    stack_end=<optimized out>) at ../csu/libc-start.c:360\r\n#37 0x0000b8c7e0d094b0 in _start ()\r\n```\r\n\r\n\nOpened https://github.com/romange/helio/pull/343/files though this is not the root cause.",
  "created_at": "2024-11-22T17:25:00Z",
  "modified_files": [
    "helio",
    "src/server/dfly_main.cc",
    "src/server/main_service.cc"
  ],
  "modified_test_files": [
    "tests/dragonfly/conftest.py",
    "tests/dragonfly/instance.py"
  ]
}