{
  "repo": "dragonflydb/dragonfly",
  "pull_number": 2747,
  "instance_id": "dragonflydb__dragonfly-2747",
  "issue_numbers": [
    "2722"
  ],
  "base_commit": "30c3f63ca2c01f6edea5c203f22a951e827d28ba",
  "patch": "diff --git a/src/server/json_family.cc b/src/server/json_family.cc\nindex 55f136159ab5..1a0183dabdce 100644\n--- a/src/server/json_family.cc\n+++ b/src/server/json_family.cc\n@@ -5,6 +5,7 @@\n #include \"server/json_family.h\"\n \n #include <absl/strings/match.h>\n+#include <absl/strings/str_cat.h>\n #include <absl/strings/str_join.h>\n #include <absl/strings/str_split.h>\n \n@@ -1295,6 +1296,13 @@ OpResult<bool> OpSet(const OpArgs& op_args, string_view key, string_view path,\n }\n \n io::Result<JsonPathV2, string> ParsePathV2(string_view path) {\n+  // We expect all valid paths to start with the root selector, otherwise prepend it\n+  string tmp_buf;\n+  if (!path.empty() && path.front() != '$') {\n+    tmp_buf = absl::StrCat(\"$\", path.front() != '.' ? \".\" : \"\", path);\n+    path = tmp_buf;\n+  }\n+\n   if (absl::GetFlag(FLAGS_jsonpathv2)) {\n     return json::ParsePath(path);\n   }\n",
  "test_patch": "diff --git a/src/server/json_family_test.cc b/src/server/json_family_test.cc\nindex ca89f95b8ff0..6cf5606950f4 100644\n--- a/src/server/json_family_test.cc\n+++ b/src/server/json_family_test.cc\n@@ -69,6 +69,12 @@ TEST_F(JsonFamilyTest, SetGetBasic) {\n   resp = Run({\"JSON.GET\", \"json\", \"//book[0]\"});\n   EXPECT_THAT(resp, ArgType(RespExpr::ERROR));\n \n+  resp = Run({\"JSON.GET\", \"json\", \"store.book[0].category\"});\n+  EXPECT_EQ(resp, \"[\\\"Fantasy\\\"]\");\n+\n+  resp = Run({\"JSON.GET\", \"json\", \".store.book[0].category\"});\n+  EXPECT_EQ(resp, \"[\\\"Fantasy\\\"]\");\n+\n   resp = Run({\"SET\", \"xml\", xml});\n   ASSERT_THAT(resp, \"OK\");\n \n",
  "problem_statement": "\"$.\" can be optional for json path\nSee the attached \r\n\r\n![image](https://github.com/dragonflydb/dragonfly/assets/3674760/0f2c6583-0a66-433d-a3aa-f5cddf14154d)\r\n\n",
  "hints_text": "redis stack accepts it. Let's fix it only for our version of jsonpath parser. ",
  "created_at": "2024-03-19T14:59:33Z",
  "modified_files": [
    "src/server/json_family.cc"
  ],
  "modified_test_files": [
    "src/server/json_family_test.cc"
  ]
}