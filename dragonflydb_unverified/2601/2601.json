{
  "repo": "dragonflydb/dragonfly",
  "pull_number": 2601,
  "instance_id": "dragonflydb__dragonfly-2601",
  "issue_numbers": [
    "862"
  ],
  "base_commit": "58dda3bc4bba274ec27cb1d36a3939c0c67ce627",
  "patch": "diff --git a/src/server/server_family.cc b/src/server/server_family.cc\nindex e9f935eb274d..128de4bd611f 100644\n--- a/src/server/server_family.cc\n+++ b/src/server/server_family.cc\n@@ -19,6 +19,7 @@\n #include <filesystem>\n #include <optional>\n \n+#include \"absl/strings/ascii.h\"\n #include \"facade/error.h\"\n #include \"slowlog.h\"\n \n@@ -1658,7 +1659,7 @@ Metrics ServerFamily::GetMetrics() const {\n   Mutex mu;\n \n   auto cmd_stat_cb = [&dest = result.cmd_stats_map](string_view name, const CmdCallStats& stat) {\n-    auto& [calls, sum] = dest[string{name}];\n+    auto& [calls, sum] = dest[absl::AsciiStrToLower(name)];\n     calls += stat.first;\n     sum += stat.second;\n   };\n",
  "test_patch": "diff --git a/tests/dragonfly/replication_test.py b/tests/dragonfly/replication_test.py\nindex 863ada5c7730..c4dd9ae5d601 100644\n--- a/tests/dragonfly/replication_test.py\n+++ b/tests/dragonfly/replication_test.py\n@@ -1821,7 +1821,7 @@ async def test_client_pause_with_replica(df_local_factory, df_seeder_factory):\n     stats_after_sleep = await c_master.info(\"CommandStats\")\n     # Check no commands are executed except info and replconf called from replica\n     for cmd, cmd_stats in stats_after_sleep.items():\n-        if \"cmdstat_INFO\" != cmd and \"cmdstat_REPLCONF\" != cmd_stats:\n+        if \"cmdstat_info\" != cmd and \"cmdstat_replconf\" != cmd_stats:\n             assert stats[cmd] == cmd_stats, cmd\n \n     await asyncio.sleep(6)\n@@ -1830,7 +1830,7 @@ async def test_client_pause_with_replica(df_local_factory, df_seeder_factory):\n     stats_after_pause_finish = await c_master.info(\"CommandStats\")\n     more_exeuted = False\n     for cmd, cmd_stats in stats_after_pause_finish.items():\n-        if \"cmdstat_INFO\" != cmd and \"cmdstat_REPLCONF\" != cmd_stats and stats[cmd] != cmd_stats:\n+        if \"cmdstat_info\" != cmd and \"cmdstat_replconf\" != cmd_stats and stats[cmd] != cmd_stats:\n             more_exeuted = True\n     assert more_exeuted\n \n",
  "problem_statement": "INFO command output should use consistent letter cases\n\n",
  "hints_text": "please expand\nif you run `INFO ALL`\r\n\r\nsome sections are titled IN CAPS others are Normal",
  "created_at": "2024-02-15T17:34:44Z",
  "modified_files": [
    "src/server/server_family.cc"
  ],
  "modified_test_files": [
    "tests/dragonfly/replication_test.py"
  ]
}