{
  "repo": "dragonflydb/dragonfly",
  "pull_number": 1011,
  "instance_id": "dragonflydb__dragonfly-1011",
  "issue_numbers": [
    "833"
  ],
  "base_commit": "0312b662440a10a990fbbb136814ab1c6faec0cb",
  "patch": "diff --git a/src/server/zset_family.cc b/src/server/zset_family.cc\nindex e8e491efb598..bd61a2cfa606 100644\n--- a/src/server/zset_family.cc\n+++ b/src/server/zset_family.cc\n@@ -1755,6 +1755,7 @@ void ZSetFamily::ZPopMinMax(CmdArgList args, bool reverse, ConnectionContext* cn\n \n   RangeParams range_params;\n   range_params.reverse = reverse;\n+  range_params.with_scores = true;\n   ZRangeSpec range_spec;\n   range_spec.params = range_params;\n \n",
  "test_patch": "diff --git a/src/server/zset_family_test.cc b/src/server/zset_family_test.cc\nindex f1b109908d75..a17ca5be9bc8 100644\n--- a/src/server/zset_family_test.cc\n+++ b/src/server/zset_family_test.cc\n@@ -433,21 +433,23 @@ TEST_F(ZSetFamilyTest, ZPopMin) {\n   EXPECT_THAT(resp, IntArg(6));\n \n   resp = Run({\"zpopmin\", \"key\"});\n-  ASSERT_THAT(resp, \"a\");\n+  ASSERT_THAT(resp, ArrLen(2));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"a\", \"1\"));\n \n   resp = Run({\"zpopmin\", \"key\", \"2\"});\n-  ASSERT_THAT(resp, ArrLen(2));\n-  EXPECT_THAT(resp.GetVec(), ElementsAre(\"b\", \"c\"));\n+  ASSERT_THAT(resp, ArrLen(4));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"b\", \"2\", \"c\", \"3\"));\n \n   resp = Run({\"zpopmin\", \"key\", \"-1\"});\n   ASSERT_THAT(resp, ErrArg(\"value is out of range, must be positive\"));\n \n   resp = Run({\"zpopmin\", \"key\", \"1\"});\n-  ASSERT_THAT(resp, \"d\");\n+  ASSERT_THAT(resp, ArrLen(2));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"d\", \"4\"));\n \n   resp = Run({\"zpopmin\", \"key\", \"3\"});\n-  ASSERT_THAT(resp, ArrLen(2));\n-  EXPECT_THAT(resp.GetVec(), ElementsAre(\"e\", \"f\"));\n+  ASSERT_THAT(resp, ArrLen(4));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"e\", \"5\", \"f\", \"6\"));\n \n   resp = Run({\"zpopmin\", \"key\", \"1\"});\n   ASSERT_THAT(resp, ArrLen(0));\n@@ -458,21 +460,23 @@ TEST_F(ZSetFamilyTest, ZPopMax) {\n   EXPECT_THAT(resp, IntArg(6));\n \n   resp = Run({\"zpopmax\", \"key\"});\n-  ASSERT_THAT(resp, \"f\");\n+  ASSERT_THAT(resp, ArrLen(2));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"f\", \"6\"));\n \n   resp = Run({\"zpopmax\", \"key\", \"2\"});\n-  ASSERT_THAT(resp, ArrLen(2));\n-  EXPECT_THAT(resp.GetVec(), ElementsAre(\"e\", \"d\"));\n+  ASSERT_THAT(resp, ArrLen(4));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"e\", \"5\", \"d\", \"4\"));\n \n   resp = Run({\"zpopmax\", \"key\", \"-1\"});\n   ASSERT_THAT(resp, ErrArg(\"value is out of range, must be positive\"));\n \n   resp = Run({\"zpopmax\", \"key\", \"1\"});\n-  ASSERT_THAT(resp, \"c\");\n+  ASSERT_THAT(resp, ArrLen(2));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"c\", \"3\"));\n \n   resp = Run({\"zpopmax\", \"key\", \"3\"});\n-  ASSERT_THAT(resp, ArrLen(2));\n-  EXPECT_THAT(resp.GetVec(), ElementsAre(\"b\", \"a\"));\n+  ASSERT_THAT(resp, ArrLen(4));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"b\", \"2\", \"a\", \"1\"));\n \n   resp = Run({\"zpopmax\", \"key\", \"1\"});\n   ASSERT_THAT(resp, ArrLen(0));\n@@ -485,7 +489,7 @@ TEST_F(ZSetFamilyTest, ZAddPopCrash) {\n   }\n \n   auto resp = Run({\"zpopmin\", \"key\"});\n-  EXPECT_EQ(resp, \"element:0\");\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"element:0\", \"0\"));\n }\n \n TEST_F(ZSetFamilyTest, Resp3) {\n",
  "problem_statement": "ZPOPMAX and ZPOPMIN does not return scores\n**Describe the bug**\r\nZPOPMAX and ZPOPMIN does not return scores\r\n\r\n**To Reproduce**\r\nragonfly> ZADD myzset 1 \"one\"\r\n(integer) 1\r\ndragonfly> ZADD myzset 2 \"two\"\r\n(integer) 1\r\ndragonfly> ZADD myzset 3 \"three\"\r\n(integer) 1\r\n\r\ndragonfly> ZPOPMAX myzset\r\nEXPECTED:\r\n1) \"three\"\r\n2) \"3\"\r\nGOT:\r\n1) \"three\"\r\n\r\ndragonfly> ZPOPMIN myzset\r\nEXPECTED:\r\n1) \"one\"\r\n2) \"1\"\r\nGOT:\r\n1) \"one\"\r\n\r\n\n",
  "hints_text": "",
  "created_at": "2023-03-29T18:49:48Z",
  "modified_files": [
    "src/server/zset_family.cc"
  ],
  "modified_test_files": [
    "src/server/zset_family_test.cc"
  ]
}