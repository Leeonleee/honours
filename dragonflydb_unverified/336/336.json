{
  "repo": "dragonflydb/dragonfly",
  "pull_number": 336,
  "instance_id": "dragonflydb__dragonfly-336",
  "issue_numbers": [
    "326"
  ],
  "base_commit": "2686b9316af754bddc5f14c00dc774e0572c7a2e",
  "patch": "diff --git a/src/server/common.cc b/src/server/common.cc\nindex 06911663ab79..42e28f7cab0e 100644\n--- a/src/server/common.cc\n+++ b/src/server/common.cc\n@@ -5,6 +5,7 @@\n #include \"server/common.h\"\n \n #include <absl/strings/charconv.h>\n+#include <absl/strings/match.h>\n #include <absl/strings/str_cat.h>\n #include <mimalloc.h>\n \n@@ -168,9 +169,9 @@ bool ParseDouble(string_view src, double* value) {\n   if (src.empty())\n     return false;\n \n-  if (src == \"-inf\") {\n+  if (absl::EqualsIgnoreCase(src, \"-inf\")) {\n     *value = -HUGE_VAL;\n-  } else if (src == \"+inf\") {\n+  } else if (absl::EqualsIgnoreCase(src, \"+inf\")) {\n     *value = HUGE_VAL;\n   } else {\n     absl::from_chars_result result = absl::from_chars(src.data(), src.end(), *value);\n",
  "test_patch": "diff --git a/src/server/zset_family_test.cc b/src/server/zset_family_test.cc\nindex e416afe14a41..4d31d0ce5d56 100644\n--- a/src/server/zset_family_test.cc\n+++ b/src/server/zset_family_test.cc\n@@ -150,6 +150,16 @@ TEST_F(ZSetFamilyTest, ZRevRange) {\n   resp = Run({\"zrevrange\", \"key\", \"1\", \"2\", \"withscores\"});\n   ASSERT_THAT(resp, ArrLen(4));\n   EXPECT_THAT(resp.GetVec(), ElementsAre(\"b\", \"1\", \"a\", \"-inf\"));\n+\n+  // Make sure that when using with upper case it works as well (see\n+  // https://github.com/dragonflydb/dragonfly/issues/326)\n+  resp = Run({\"zrevrangebyscore\", \"key\", \"2\", \"-INF\"});\n+  ASSERT_THAT(resp, ArrLen(3));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"c\", \"b\", \"a\"));\n+\n+  resp = Run({\"zrevrangebyscore\", \"key\", \"2\", \"-INF\", \"withscores\"});\n+  ASSERT_THAT(resp, ArrLen(6));\n+  EXPECT_THAT(resp.GetVec(), ElementsAre(\"c\", \"2\", \"b\", \"1\", \"a\", \"-inf\"));\n }\n \n TEST_F(ZSetFamilyTest, ZScan) {\n",
  "problem_statement": "ZRANGEBYSCORE doesn't support +INF/-INF\n\r\n**To Reproduce**\r\n\"ZRANGEBYSCORE\" \"key\" \"31\" \"+INF\" \"WITHSCORES\"\r\n(error) ERR min or max is not a float\r\n\r\n**Expected behavior**\r\nRedis supports this.\r\n\n",
  "hints_text": "",
  "created_at": "2022-09-29T08:11:28Z",
  "modified_files": [
    "src/server/common.cc"
  ],
  "modified_test_files": [
    "src/server/zset_family_test.cc"
  ]
}