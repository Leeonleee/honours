diff --git a/src/server/transaction.cc b/src/server/transaction.cc
index 795de10baf4e..52f95664df93 100644
--- a/src/server/transaction.cc
+++ b/src/server/transaction.cc
@@ -294,7 +294,7 @@ void Transaction::InitByKeys(KeyIndex key_index) {
   // Validation. Check reverse mapping was built correctly.
   if (needs_reverse_mapping) {
     for (size_t i = 0; i < args_.size(); ++i) {
-      DCHECK_EQ(args_[i], ArgS(args, reverse_index_[i]));
+      DCHECK_EQ(args_[i], ArgS(args, reverse_index_[i])) << args;
     }
   }
 
@@ -393,7 +393,10 @@ void Transaction::MultiSwitchCmd(const CommandId* cid) {
     unique_shard_id_ = 0;
 
   unique_shard_cnt_ = 0;
+
   args_.clear();
+  reverse_index_.clear();
+
   cid_ = cid;
   cb_ptr_ = nullptr;
 
@@ -1414,7 +1417,7 @@ void Transaction::CancelBlocking() {
 }
 
 OpResult<KeyIndex> DetermineKeys(const CommandId* cid, CmdArgList args) {
-  if (cid->opt_mask() & CO::GLOBAL_TRANS)
+  if (cid->opt_mask() & (CO::GLOBAL_TRANS | CO::NO_KEY_TRANSACTIONAL))
     return KeyIndex::Empty();
 
   KeyIndex key_index;
