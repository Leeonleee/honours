{
  "repo": "dragonflydb/dragonfly",
  "pull_number": 1010,
  "instance_id": "dragonflydb__dragonfly-1010",
  "issue_numbers": [
    "834"
  ],
  "base_commit": "0312b662440a10a990fbbb136814ab1c6faec0cb",
  "patch": "diff --git a/src/server/list_family.cc b/src/server/list_family.cc\nindex aad6b30fa33c..b77812a3f940 100644\n--- a/src/server/list_family.cc\n+++ b/src/server/list_family.cc\n@@ -437,7 +437,7 @@ OpResult<uint32_t> OpPush(const OpArgs& op_args, std::string_view key, ListDir d\n   if (skip_notexist) {\n     auto it_res = es->db_slice().Find(op_args.db_cntx, key, OBJ_LIST);\n     if (!it_res)\n-      return it_res.status();\n+      return 0;  // Redis returns 0 for nonexisting keys for the *PUSHX actions.\n     it = *it_res;\n   } else {\n     try {\n",
  "test_patch": "diff --git a/src/server/list_family_test.cc b/src/server/list_family_test.cc\nindex 9038a0cdc2de..1830dd8c6e45 100644\n--- a/src/server/list_family_test.cc\n+++ b/src/server/list_family_test.cc\n@@ -813,4 +813,28 @@ TEST_F(ListFamilyTest, BLMove) {\n   ASSERT_THAT(resp.GetVec(), ElementsAre(\"val1\", \"val2\"));\n }\n \n+TEST_F(ListFamilyTest, LPushX) {\n+  // No push for 'lpushx' on nonexisting key.\n+  EXPECT_THAT(Run({\"lpushx\", kKey1, \"val1\"}), IntArg(0));\n+  EXPECT_THAT(Run({\"llen\", kKey1}), IntArg(0));\n+\n+  EXPECT_THAT(Run({\"lpush\", kKey1, \"val1\"}), IntArg(1));\n+  EXPECT_THAT(Run({\"lrange\", kKey1, \"0\", \"-1\"}), \"val1\");\n+\n+  EXPECT_THAT(Run({\"lpushx\", kKey1, \"val2\"}), IntArg(2));\n+  EXPECT_THAT(Run({\"lrange\", kKey1, \"0\", \"-1\"}).GetVec(), ElementsAre(\"val2\", \"val1\"));\n+}\n+\n+TEST_F(ListFamilyTest, RPushX) {\n+  // No push for 'rpushx' on nonexisting key.\n+  EXPECT_THAT(Run({\"rpushx\", kKey1, \"val1\"}), IntArg(0));\n+  EXPECT_THAT(Run({\"llen\", kKey1}), IntArg(0));\n+\n+  EXPECT_THAT(Run({\"rpush\", kKey1, \"val1\"}), IntArg(1));\n+  EXPECT_THAT(Run({\"lrange\", kKey1, \"0\", \"-1\"}), \"val1\");\n+\n+  EXPECT_THAT(Run({\"rpushx\", kKey1, \"val2\"}), IntArg(2));\n+  EXPECT_THAT(Run({\"lrange\", kKey1, \"0\", \"-1\"}).GetVec(), ElementsAre(\"val1\", \"val2\"));\n+}\n+\n }  // namespace dfly\n",
  "problem_statement": "LPUSHX does not work as expected\n**Describe the bug**\r\n`LPUSHX` returns an error `ERR no such key` when pushing to non-existing list.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n`LPUSHX foo bar`\r\n\r\n**Expected behavior**\r\nreply:\r\n```\r\n(integer) 0\r\n```\r\ninstead we get:\r\n```\r\n(error) ERR no such key\r\n```\n",
  "hints_text": "",
  "created_at": "2023-03-29T18:30:13Z",
  "modified_files": [
    "src/server/list_family.cc"
  ],
  "modified_test_files": [
    "src/server/list_family_test.cc"
  ]
}